import{u as X,r as c,t as Z,cc as ee,cd as se,w as te,m as s,ce as ae,z as A,aC as re,ak as le,cf as ne}from"./index-BPP_8qLW.js";import{l as ie}from"./lodash-BO8ePN9b.js";const he=({isOpen:y,onClose:F,selectedDeals:p})=>{const j=X(e=>e.deal.deal),[m,B]=c.useState([]),[o,f]=c.useState([]),[I,E]=c.useState(!1),[v,P]=c.useState(!1),[U,w]=c.useState(""),[de,$]=c.useState([]),[oe,L]=c.useState({currentPage:1,perPage:10,totalItems:0,totalPages:1,hasMorePages:!1}),[N,C]=c.useState({page:1,perPage:10,sortColumn:"created_at",sortOrder:"desc",search:""}),{showSnackbar:x}=Z();c.useEffect(()=>{y?H():(f([]),w(""),C(e=>({...e,search:"",page:1})))},[y,N.page,N.search]);const M=ie.debounce(e=>{C(t=>({...t,search:e,page:1}))},500),z=e=>{const t=e.target.value;w(t),M(t)},H=async()=>{var e,t,l,n,h,a,u,i,g,b,D;if(y){E(!0);try{const d=await ee(N),{data:r}=d==null?void 0:d.data,O=((t=(e=d==null?void 0:d.data)==null?void 0:e.data)==null?void 0:t.contacts)||[],S=await se(),_=((l=S==null?void 0:S.data)==null?void 0:l.blocked_by_users)||[];console.log("blockedList",_),$(_);const V=new Set(_.map(k=>k.id)),W=O.map(k=>({...k,isBlocked:V.has(k.user_id)}));B(W),L({currentPage:parseInt((n=r==null?void 0:r.page_context)==null?void 0:n.page)||1,perPage:parseInt((h=r==null?void 0:r.page_context)==null?void 0:h.per_page)||10,totalItems:parseInt((a=r==null?void 0:r.page_context)==null?void 0:a.total_records)||0,totalPages:Math.ceil(parseInt(((u=r==null?void 0:r.page_context)==null?void 0:u.total_records)||0)/parseInt(((i=r==null?void 0:r.page_context)==null?void 0:i.per_page)||10)),hasMorePages:((g=r==null?void 0:r.page_context)==null?void 0:g.has_more_page)==="true"})}catch(d){console.error("Error fetching contacts:",d),x(((D=(b=d==null?void 0:d.response)==null?void 0:b.data)==null?void 0:D.message)||"Failed to fetch contacts. Please try again.","error")}finally{E(!1)}}},T=e=>{f(t=>t.includes(e)?t.filter(l=>l!==e):[...t,e])},q=e=>{if(e.target.checked){const t=m.map(l=>l.id);f(t)}else f([])},K=async()=>{var e,t,l,n,h;if(o.length===0){x("Please select at least one contact","error");return}if(!p||p.length===0){x("No deals selected to share","error");return}P(!0);try{const a=await ne(o,p);x(((e=a==null?void 0:a.data)==null?void 0:e.message)||"Deals shared successfully with selected contacts","success"),F()}catch(a){console.error("Error sending deals:",a);let u="Failed to share deals. Please try again.";if((l=(t=a==null?void 0:a.response)==null?void 0:t.data)!=null&&l.errors){const i=a.response.data.errors;if(Array.isArray(i)&&i.length>0){const g=i[0],b=Object.keys(g)[0];b&&(u=g[b])}else if(typeof i=="object"&&i!==null){const g=Object.keys(i)[0];g&&(u=i[g])}else typeof i=="string"&&(u=i)}else(h=(n=a==null?void 0:a.response)==null?void 0:n.data)!=null&&h.message&&(u=a.response.data.message);x(u,"error")}finally{P(!1)}},Q=async()=>{if(!(j!=null&&j.unique_id)){x("Deal information not available","error");return}try{const t=`${window.location.origin}/deal-details/${j.unique_id}`;await navigator.clipboard.writeText(t),x("Share link copied to clipboard!","success")}catch(e){console.error("Failed to copy link:",e),x("Failed to copy share link","error")}},R=()=>{f([]),w(""),C(e=>({...e,search:"",page:1})),F()},Y=te(),G=()=>{Y("/all-contacts")};if(!y)return null;const J=e=>{var t,l,n,h,a;return!(e!=null&&e.user_id)||((t=e==null?void 0:e.user)==null?void 0:t.deleted_at)!==null?"Inactive":((l=e==null?void 0:e.user)==null?void 0:l.deleted_at)===null&&((n=e==null?void 0:e.user)==null?void 0:n.is_active)===1?"Active":((h=e==null?void 0:e.user)==null?void 0:h.deleted_at)===null&&((a=e==null?void 0:e.user)==null?void 0:a.is_active)===0?"Disabled":"Inactive"};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-[#fff] rounded-lg p-6 w-full max-w-3xl dark:bg-[#121212]",style:{maxHeight:"80vh",overflowY:"hidden"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-5",children:[s.jsx("h3",{className:"text-xl font-semibold dark:text-white",children:"Share as"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:Q,disabled:p.length!==1,className:`flex items-center gap-2 font-semibold
    ${p.length!==1?"text-gray-400 cursor-not-allowed":"text-[#6C5DD3] hover:text-[#5a4bb2]"}`,children:[s.jsx(ae,{className:"font-semibold"}),s.jsx("span",{children:"Copy link"})]}),s.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-3xl",onClick:R,children:"âœ•"})]})]}),s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"relative w-4/5",children:s.jsx("input",{type:"text",placeholder:"Email address",className:"w-full form-control py-3 px-4 text-base",value:U,onChange:z})}),s.jsx("h3",{className:"ml-4 text-sm font-semibold dark:text-white text-[#595959]",children:o&&o.length>0?`${o.length} user${o.length>1?"s":""} selected`:"None selected"})]}),s.jsxs("div",{className:"flex items-center gap-2 mb-3 pl-[9px]",children:[s.jsx("input",{type:"checkbox",checked:m.length>0&&o.length===m.length,onChange:q}),s.jsx("span",{className:"text-sm font-medium dark:text-white text-[#595959]",children:"Select all"})]}),s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("div",{className:"flex items-center gap-4"})}),s.jsx("div",{className:"overflow-x-auto overflow-y-auto",style:{minHeight:"200px",maxHeight:"calc(69vh - 250px)"},children:I?s.jsx("div",{className:"flex justify-center items-center h-full",children:s.jsx(A,{})}):m.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:s.jsx("div",{className:"text-center py-4 dark:text-white text-[#333]",children:"To share the deal you need to add contacts first."})}):s.jsx("table",{className:"w-full text-left border-collapse",children:s.jsx("tbody",{children:m.map((e,t)=>{var l;return s.jsxs("tr",{className:`
                          ${e.isBlocked?"opacity-50 pointer-events-none":""}
                          `,children:[s.jsxs("td",{className:"flex items-center gap-2 p-2 py-3 dark:text-white text-[#000]",children:[s.jsx("input",{type:"checkbox",disabled:e.isBlocked,checked:o.includes(e.id),onChange:()=>T(e.id)}),s.jsx("span",{className:"text-purple-800 font-semibold text-xl bg-purple-200 w-10 h-10 flex items-center justify-center rounded-full dark:bg-purple-950 dark:text-purple-700",children:(l=e.name)==null?void 0:l.charAt(0).toUpperCase()}),s.jsx("span",{className:"max-w-[100px] truncate cursor-pointer text-[#242424] text-lg font-medium dark:text-[#F8F8F8]",title:e.name,children:e.name})]}),s.jsx("td",{className:"p-4",children:(()=>{if(e.isBlocked)return s.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
          bg-gray-100 text-gray-600 border-gray-300 dark:bg-gray-800 dark:text-gray-400`,children:"Blocked"});const n=J(e);return s.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
          ${n==="Active"?"bg-[#ECFDF3] text-[#054F31] border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":n==="Disabled"?"bg-red-100 text-red-700 border-red-300":"bg-[#FFF8E1] text-[#FB6E0A] border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:n})})()})]},e.id)})})})}),s.jsxs("div",{className:"flex justify-between mt-6 items-center gap-4 flex-shrink-0",children:[s.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-md hover:bg-[#5a4bb2] transition-colors whitespace-nowrap",onClick:G,children:[s.jsx(re,{size:14}),s.jsx("span",{children:"Add Contact"})]}),s.jsx("button",{onClick:K,disabled:o.length===0||v,className:`flex items-center justify-center gap-2 px-6 py-2 bg-[#6C5DD3] text-white rounded-md transition duration-200 whitespace-nowrap ${o.length===0||v?"opacity-50 cursor-not-allowed":"hover:bg-[#5a4bb2]"}`,children:v?s.jsx(A,{size:20}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Send Deal"}),s.jsx(le,{className:"text-lg"})]})})]})]})})};export{he as S};
