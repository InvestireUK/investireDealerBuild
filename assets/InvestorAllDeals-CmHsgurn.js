import{r as l,u as b,w as de,t as pe,a8 as ue,v as me,m as t,A as he,z as xe,n as fe,c5 as ge,ab as ye,D as _e,E as be,H as je}from"./index-D5R_qjXS.js";import{S as we}from"./SendContactDealModal-CnCuHZlh.js";import{D as ve}from"./DeleteConfirmationModal-CwNKufye.js";import{P as Ne}from"./PaginationNew-CmHheeZc.js";import{A as De}from"./ArchiveConfirmationModal-CofDWk7C.js";import{A as Ee}from"./index-ByY_XAPM.js";import{l as Fe}from"./lodash-D7M7syda.js";import{A as ke,m as Ie}from"./proxy-CVzMB7ur.js";const Ve=B=>{const[p,Ae]=l.useState("all"),{user:Te,role:Oe}=b(e=>e.user),C=de(),[i,M]=l.useState([]);b(e=>e.deal.currentStep),b(e=>e.deal.dealFilters);const j=b(e=>e.deal.dealsTypes),[u,w]=l.useState([]),{showSnackbar:m}=pe(),[F,L]=l.useState(!1),[R,k]=l.useState(!1),[c,$]=l.useState(0),[V,I]=l.useState(!1),[U,A]=l.useState(!1),[T,Y]=l.useState(null),[O,z]=l.useState(null),[H,S]=l.useState(!1),[Q,P]=l.useState(!1),[g,q]=l.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[n,y]=l.useState({per_page:10,page:1,status:"all",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc",search:""}),G=[{label:"All Status",status:"all",count:c==null?void 0:c.all,value:"all"},{label:"Interested",status:"interested",count:c==null?void 0:c.interested,value:1},{label:"Not Interested",status:"not_interested",count:c==null?void 0:c.not_interested,value:2},{label:"Awaiting response",status:"awaiting_response",count:c==null?void 0:c.awaiting_response,value:0}],[J,K]=l.useState(""),W=Fe.debounce(e=>{y(s=>({...s,search:e,page:1}))},1e3),X=e=>{const s=e.target.value;K(s),W(s)};l.useEffect(()=>{var s,a;const e=p==="all"?1:((a=(s=j==null?void 0:j.deal_types)==null?void 0:s.find(o=>o.slug===p))==null?void 0:a.id)??null;y(o=>({...o,dealTypeId:e,page:1}))},[p]);const{data:v,loading:Z}=ue(ye);me();const N=async()=>{var e,s;try{k(!0);const a={page:n.page,perPage:n.per_page,status:n.status===""?null:n.status,year:n.year===""?null:n.year,propertyTypeId:n.propertyTypeId===""?null:n.propertyTypeId,sortColumn:n.sortColumn,sortOrder:n.sortOrder,search:n.search===""?null:n.search};p!=="all"&&p!=="tab"&&(a.dealTypeId=n.dealTypeId);const o=await ge(a);if(o&&o.data){$((s=(e=o==null?void 0:o.data)==null?void 0:e.data)==null?void 0:s.propertyDealShares),M(o.data.data.propertyDealShares||[]);const r=o.data.data.page_context;r&&q({currentPage:parseInt(r==null?void 0:r.page)||1,totalPages:Math.ceil(parseInt((r==null?void 0:r.total_records)||0)/parseInt((r==null?void 0:r.per_page)||10)),from:(parseInt(r.page)-1)*parseInt(r.per_page)+1,to:Math.min(parseInt(r==null?void 0:r.page)*parseInt(r==null?void 0:r.per_page),parseInt((r==null?void 0:r.total_records)||0)),total:parseInt((r==null?void 0:r.total_records)||0),hasMorePages:(r==null?void 0:r.has_more_page)==="true"})}}catch{m("Failed to fetch deals. Please try again.","error")}finally{k(!1)}};l.useEffect(()=>{n.dealTypeId&&N()},[n]);const ee=e=>{w(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},te=()=>{L(!1)},se=e=>{const{name:s,value:a}=e.target;y({...n,[s]:a,page:1})},D=async e=>{const s={user_id:e==null?void 0:e.user_id,property_deal_id:e==null?void 0:e.id};await je(s),C(`/deal-detail/${e.unique_id}`)},ae=async()=>{var e;if(O)try{P(!0);let s=await be(O);m((e=s==null?void 0:s.data)==null?void 0:e.message),N(),A(!1),z(null)}catch(s){console.error("Error deleting deal:",s),m("Failed to delete deal",s)}finally{P(!1)}},re=async()=>{var e;if(T)try{S(!0);let s=await _e(T);m((e=s==null?void 0:s.data)==null?void 0:e.message),N(),I(!1),Y(null)}catch(s){console.error("Error deleting deal:",s),m("Failed to delete deal","error")}finally{S(!1)}},ne=e=>{var o,r,x,f;const s=[];if(e!=null&&e.no_of_dwelling){const d=(e==null?void 0:e.deal_type_id)===2?e.no_of_dwelling>1?" Beds":" Bed":e.no_of_dwelling>1?" Bedrooms":" Bedroom";s.push(e.no_of_dwelling+d)}if(e!=null&&e.deal_type&&s.push(e.deal_type.title),(o=e==null?void 0:e.sub_category)!=null&&o.title&&s.push(e.sub_category.title),(r=e==null?void 0:e.property_type_category)!=null&&r.title&&s.push((x=e.property_type_category)==null?void 0:x.title),(f=e==null?void 0:e.exit_type)!=null&&f.title){let d=e.exit_type.title.toLowerCase();d==="sell"?d="Flip":d==="refinance"&&(d="BRRR"),s.push(d)}return s.join(",")};v!=null&&v.data;const le=new Date().getFullYear();Array.from({length:4},(e,s)=>le-s);const oe=e=>{switch(Number(e)){case 1:return t.jsx("span",{className:"border border-[#D9F99D] rounded-xl bg-[#F7FEE7] px-2 py-1 text-xs text-[#4D7C0F] dark:bg-[#1A2E05] dark:text-[#BEF264] dark:border-[#3F6212]",children:"Interested"});case 2:return t.jsx("span",{className:"border border-[#FFE0E0] rounded-xl bg-[#FEF2F2] px-2 py-1 text-xs text-[#DE2424] dark:bg-[#371C1C] dark:text-[#FFA9A9] dark:border-[#751D1D]",children:"Not Interested"});case 0:case 3:return t.jsx("span",{className:"border border-[#E2E8F0] rounded-xl bg-[#F8FAFC] px-2 py-1 text-xs text-[#334155] dark-text-[#CBD5E1] dark:bg-[#020617] dark:border-[#1E293B]",children:"Awaiting response"});default:return t.jsx("span",{className:"border border-[#E2E8F0] rounded-xl bg-[#F1F5F9] px-2 py-1 text-xs text-[#64748B]",children:"Unknown"})}},[_,E]=l.useState(null),[ce,ie]=l.useState(!1),h=l.useRef(null);return l.useEffect(()=>{function e(s){h.current&&!h.current.contains(s.target)&&E(null)}if(_!==null&&h.current){const s=h.current.getBoundingClientRect(),a=window.innerHeight-s.bottom;ie(a<150)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[_]),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsx(ve,{isOpen:V,onClose:()=>I(!1),onConfirm:re,title:"Delete Deal",isLoading:H}),t.jsx(De,{isOpen:U,onClose:()=>A(!1),onConfirm:ae,title:"Archive Deal",isLoading:Q}),t.jsxs("div",{className:"flex flex-col mb-5",children:[t.jsx("h1",{className:"text-3xl font-semibold text-dark dark:text-white",children:"Deals"}),t.jsx("p",{className:"text-[#898E97] dark:text-[#ECECEC]",children:"View deals you have received from Deal Sourcers"})]}),t.jsxs("div",{className:"total-deal-table-wrapper",children:[t.jsxs("div",{className:"flex flex-col md:flex-row space-x-4 justify-between px-4 py-4 gap-4 md:gap-0",children:[t.jsxs("div",{className:"relative custom-input-w",children:[t.jsx("input",{type:"text",placeholder:"Search for deals",className:"form-control",value:J,onChange:X,style:{paddingLeft:"40px"}}),t.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),t.jsx("div",{className:"p-1  rounded-xl",children:t.jsx("div",{children:t.jsx("ul",{className:"grid grid-cols-2 sm:flex sm:flex-wrap deal-types-tabs-wrap gap-1",children:G.map(({label:e,value:s,icon:a,count:o})=>t.jsx("li",{className:"w-full sm:w-auto",children:t.jsxs("button",{onClick:()=>se({target:{name:"status",value:s}}),className:`tab-btn flex items-center justify-center gap-2 w-full sm:w-auto ${n.status===s?"active":""}`,children:[t.jsx("span",{children:a}),t.jsx("span",{children:e}),o!==null&&t.jsx("span",{className:"ml-2 font-medium text-[#242424]",children:o})]})},s))})})})]}),R||Z?t.jsx(xe,{}):t.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:t.jsxs("table",{className:`${i.length<3?"overflow-dropdown-issue":""}  w-full text-left border-collapse`,children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-[#6C5DD3] text-black dark:text-[#EBEBEC]",children:[t.jsx("th",{className:"",children:t.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?w(i.map(s=>s==null?void 0:s.id)):w([])},checked:(u==null?void 0:u.length)===(i==null?void 0:i.length)&&(i==null?void 0:i.length)>0})}),t.jsx("th",{className:"",children:"TITLE"}),t.jsx("th",{className:"",children:"COMPANY"}),t.jsx("th",{className:"",children:"ROI"}),t.jsx("th",{className:"",children:"STATUS"}),t.jsx("th",{className:"",children:"DATE"}),t.jsx("th",{className:"",children:"ACTIONS"})]})}),t.jsx("tbody",{children:i.length>0?i.map((e,s)=>{var o,r,x,f,d;const a=e==null?void 0:e.property_deal;return t.jsxs("tr",{className:"",children:[t.jsx("td",{children:t.jsx("input",{type:"checkbox",checked:u.includes(a==null?void 0:a.id),onChange:()=>ee(a==null?void 0:a.id)})}),t.jsx("td",{className:"",children:t.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis cursor-pointer",onClick:()=>{D(a)},children:ne(a)})}),t.jsx("td",{className:"",children:t.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis cursor-pointer",onClick:()=>{D(a)},children:((o=e==null?void 0:e.contact)==null?void 0:o.company_name)||"-"})}),t.jsx("td",{children:(r=a==null?void 0:a.property_deal_investment)!=null&&r.return_on_cash_investment_percentage?`${parseFloat((x=a==null?void 0:a.property_deal_investment)==null?void 0:x.return_on_cash_investment_percentage).toFixed(0)}%`:(f=a==null?void 0:a.property_deal_sa_investment)!=null&&f.net_roi_percentage?`${parseFloat((d=a==null?void 0:a.property_deal_sa_investment)==null?void 0:d.net_roi_percentage).toFixed(0)}%`:"0%"}),t.jsx("td",{className:"",children:oe(e.intrust_status)}),t.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),t.jsx("td",{className:"relative",children:t.jsxs("div",{id:`dropdown-${a==null?void 0:a.id}`,className:"flex justify-center relative",children:[t.jsx("button",{onClick:()=>E(_===(a==null?void 0:a.id)?null:a==null?void 0:a.id),className:"text-lg",children:t.jsx(fe,{className:"text-[#595959]"})}),t.jsx(ke,{children:_===(a==null?void 0:a.id)&&t.jsx(Ie.div,{ref:h,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:`absolute right-0 w-40 bg-white rounded shadow-lg z-10 ${ce?"bottom-full mb-2":"bottom-full mt-2"}`,children:B!=="archive"&&t.jsxs("button",{onClick:()=>{D(a),E(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-sm dark:bg-[#121212] dark:border-[#121212]",children:[t.jsx(Ee,{className:"mr-2"})," View"]})})})]})})]},e==null?void 0:e.id)}):t.jsx("tr",{children:t.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No shared deals available"})})})]})}),t.jsx(Ne,{pagination:{total:g.total,currentPage:n.page,perPage:n.per_page>g.total?g.total:n.per_page,totalPages:Math.ceil(g.total/n.per_page)},setFilters:y})]}),F&&t.jsx(we,{isOpen:F,onClose:te,selectedDeals:u})]})};export{Ve as default};
