import{r as l,m as e,Q as ye,S as be,u as je,s as we,q as Ne,T as oe,U as ve,V as re,o as le,W as ke,X as _e,x as ie,Y as ce,Z as me,_ as de}from"./index-2LN8UDRv.js";import{u as Ce}from"./useRefreshUser-54vPAET6.js";import{c as Se,X as Pe}from"./x-CsOnEqEx.js";const $e="/assets/company-logo-baJq8U9U.png";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ee=Se("check",De),Ie=({isOpen:s,onClose:b,imageSrc:S,onCropComplete:_,aspectRatio:p=1})=>{const[f,G]=l.useState({x:0,y:0}),[g,P]=l.useState(1),[m,R]=l.useState(!1),[o,T]=l.useState({x:0,y:0}),U=l.useRef(null),$=l.useRef(null),O=l.useRef(null);l.useEffect(()=>{if(s&&S){const a=new Image;a.onload=()=>{O.current=a,A()},a.src=S}},[s,S,f,g]);const A=()=>{const a=U.current,u=O.current;if(!a||!u)return;const n=a.getContext("2d"),y=$.current;if(!y)return;const c=y.offsetWidth,x=y.offsetHeight;a.width=c,a.height=x,n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(0,0,c,x);const j=Math.min(c/u.width,x/u.height)*g,D=u.width*j,E=u.height*j,r=(c-D)/2+f.x,w=(x-E)/2+f.y;n.save(),n.globalCompositeOperation="destination-out";const h=Math.min(c,x)*.7,N=(c-h)/2,I=(x-h)/2;p===1?(n.beginPath(),n.arc(c/2,x/2,h/2,0,Math.PI*2),n.fill()):n.fillRect(N,I,h,h/p),n.restore(),n.globalCompositeOperation="destination-over",n.drawImage(u,r,w,D,E),n.globalCompositeOperation="source-over",n.strokeStyle="#fff",n.lineWidth=2,p===1?(n.beginPath(),n.arc(c/2,x/2,h/2,0,Math.PI*2),n.stroke()):n.strokeRect(N,I,h,h/p)},X=a=>{R(!0),T({x:a.clientX-f.x,y:a.clientY-f.y})},z=a=>{m&&G({x:a.clientX-o.x,y:a.clientY-o.y})},W=()=>{R(!1)},Y=l.useCallback(async()=>{const a=O.current,u=$.current;if(!a||!u)return;const n=u.offsetWidth,y=u.offsetHeight,c=Math.min(n/a.width,y/a.height)*g,x=a.width*c,j=a.height*c,D=(n-x)/2+f.x,E=(y-j)/2+f.y,r=Math.min(n,y)*.7,w=(n-r)/2,h=(y-r)/2,N=document.createElement("canvas");N.width=r,N.height=r/p;const I=N.getContext("2d"),d=(w-D)/c,H=(h-E)/c,Z=r/c,M=r/p/c;I.drawImage(a,d,H,Z,M,0,0,r,r/p),N.toBlob(V=>{_(V),b()},"image/jpeg",.95)},[f,g,p,_,b]);return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Crop Image"}),e.jsx("div",{ref:$,className:"relative h-96 bg-gray-100 dark:bg-gray-700 rounded-lg mb-4 overflow-hidden cursor-move",onMouseDown:X,onMouseMove:z,onMouseUp:W,onMouseLeave:W,children:e.jsx("canvas",{ref:U,className:"w-full h-full"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Zoom"}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:g,onChange:a=>P(parseFloat(a.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[e.jsx(Pe,{size:16})," Cancel"]}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-lg",children:[e.jsx(Ee,{size:16}),"  Save"]})]})]})})}):null},Me=be("pk_test_51R6uLuGhmABE4SukbmgqsLITna4D57Ittag620AxGwm1ckI0oeYBXvNUBO9w4WhygDlp3sWd7ldWiZlGbR8jzxXk00N3jUSXPv"),Fe=()=>{const{user:s,role:b,token:S}=je(t=>t.user);console.log("tokennn",S);const _=we(),{showSnackbar:p}=Ne(),f=Ce(),G="https://phplaravel-1547671-6035260.cloudwaysapps.com/storage",[g,P]=l.useState(!1),[m,R]=l.useState(!1),[o,T]=l.useState(!(s!=null&&s.company_name)||!(s!=null&&s.sub_domain)),[U,$]=l.useState(null),[O,A]=l.useState(null),[X,z]=l.useState(null),[W,Y]=l.useState(null),[a,u]=l.useState(!1),[n,y]=l.useState(null),[c,x]=l.useState(null),{register:j,handleSubmit:D,reset:E,formState:{errors:r}}=oe({defaultValues:{first_name:"",last_name:"",email:"",phone:""}}),{register:w,handleSubmit:h,reset:N,control:I,formState:{errors:d}}=oe({defaultValues:{company_name:"",sub_domain:"",company_email:"",company_phone:"",company_website:""}});l.useEffect(()=>{s&&(E({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||""}),N({company_name:s.company_name||"",sub_domain:s.sub_domain||"",company_email:s.company_email||"",company_phone:s.company_phone||"",company_website:s.company_website||""}),s.profile_image&&$(s.profile_image),s.company_logo_url&&A(s.company_logo_url))},[s]);const H=(t,i)=>{const k=t.target.files[0];if(!k)return;const F=new FileReader;F.onload=()=>{y(F.result),x(i),u(!0)},F.readAsDataURL(k),t.target.value=""},Z=t=>{const i=new File([t],"image.jpg",{type:"image/jpeg"}),k=URL.createObjectURL(t);c==="profile"?(z(i),$(k)):(Y(i),A(k))},M=ve({control:I,name:"sub_domain"}),V=async t=>{try{P(!0);const i=new FormData;i.append("_method","PATCH"),i.append("first_name",t.first_name),i.append("last_name",t.last_name),i.append("phone",t.phone),X&&i.append("profile_image",X),await ce(i),p("Profile updated successfully","success"),await f(),R(!1),z(null)}catch{p("Failed to update profile","error")}finally{P(!1)}},pe=t=>{document.cookie=`token=; Path=/; Domain=.${t}; Max-Age=0; Secure; SameSite=None`,document.cookie=`user=; Path=/; Domain=.${t}; Max-Age=0; Secure; SameSite=None`,document.cookie=`role=; Path=/; Domain=.${t}; Max-Age=0; Secure; SameSite=None`,localStorage.removeItem("persist:root"),sessionStorage.clear()},ue=async t=>{var i,k,F,te,se,ae;try{P(!0),console.log("datataa ===>",t);const v=new FormData;v.append("_method","PATCH"),Object.entries(t).forEach(([C,B])=>{B&&v.append(C,B)}),W&&v.append("company_logo",W);const L=await ce(v);console.log("responseee",L),p("Company updated successfully","success"),await f(),T(!1),Y(null);const q=(k=(i=L==null?void 0:L.data)==null?void 0:i.data)==null?void 0:k.user;if(console.log("updateddddddd",q),q){const C=window.location.hostname.split(".").slice(-2).join("."),B=(F=document.cookie.split("; ").find(ee=>ee.startsWith("token=")))==null?void 0:F.split("=")[1],Q=S||B;console.log("access token",Q);const K=b;console.log("userrole",K),document.cookie=`token=${Q}; Path=/; Domain=.${C}; Secure; SameSite=None`,document.cookie=`user=${encodeURIComponent(JSON.stringify(q))}; Path=/; Domain=.${C}; Secure; SameSite=None`,document.cookie=`role=${K}; Path=/; Domain=.${C}; Secure; SameSite=None`,_(me({user:q,token:Q})),_(de(K));const ne=(te=q.sub_domain)==null?void 0:te.trim();if(ne){const ee=`https://${ne.toLowerCase()}.${C}`;pe(C),_(me({user:null,token:null})),_(de(null)),window.location.replace(ee);return}}}catch(v){console.error(v);const L=((ae=(se=v==null?void 0:v.response)==null?void 0:se.data)==null?void 0:ae.message)||"Failed to update company";p(L,"error")}finally{P(!1)}},xe=t=>t!=null&&t.startsWith("http")||t!=null&&t.startsWith("blob:")?t:`${G}/${t}`,he=t=>t?t.split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" "):"Not Assigned";function fe(){if(typeof window>"u")return"visionvivante.in";const t=window.location.hostname.split(".");return t.length>2?t.slice(1).join("."):window.location.hostname}const J=fe(),ge=M!=null&&M.trim()?`https://${M.toLowerCase()}.${J}`:`https://your-company.${J}`;return e.jsx("div",{className:"min-h-screen my-5",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333]",children:[e.jsx("h1",{className:"text-3xl text-black dark:text-white",children:"My Profile"}),e.jsx("button",{onClick:()=>R(t=>!t),className:"flex items-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(re,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{})," ",e.jsx("span",{children:"Edit Profile"})]})})]}),e.jsx("div",{className:"flex justify-start mt-8 ml-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:U?e.jsx("img",{src:xe(U),alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(ke,{className:"w-full h-full text-[#6C5DD3]"})}),m&&e.jsxs("label",{htmlFor:"profileImage",className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Image",e.jsx("input",{type:"file",id:"profileImage",className:"hidden",accept:"image/*",onChange:t=>H(t,"profile")})]})]})}),e.jsx("form",{onSubmit:D(V),children:e.jsx("div",{className:"profile-detail-form-container-main-div",children:e.jsxs("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:[e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"First Name"}),e.jsx("input",{type:"text",...j("first_name",{required:"First name is required"}),readOnly:!m,className:`form-control w-full ${r.first_name?"border border-red-500":""} ${m?"":"opacity-75 cursor-not-allowed"}`}),r.first_name&&m&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Last Name"}),e.jsx("input",{type:"text",...j("last_name",{required:"Last name is required"}),readOnly:!m,className:`form-control w-full ${r.last_name?"border border-red-500":""} ${m?"":"opacity-75 cursor-not-allowed"}`}),r.last_name&&m&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.last_name.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Email"}),e.jsx("input",{type:"email",...j("email"),disabled:!0,className:"form-control w-full opacity-75 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Phone Number"}),e.jsx("input",{type:"tel",...j("phone",{validate:t=>t?/^0\d{9,10}$/.test(t)||"Phone number must start with 0 and be 10 or 11 digits long":!0}),readOnly:!m,className:`form-control w-full ${r.phone?"border border-red-500":""} ${m?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),r.phone&&m&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.phone.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 mt-5 inline-block",children:"Role:"}),e.jsxs("div",{className:"relative opacity-75 cursor-not-allowed",children:[e.jsx("input",{type:"text",className:"form-control w-full cursor-not-allowed",value:he(b),readOnly:!0,style:{paddingLeft:"40px"}}),e.jsx("span",{className:"inline-block absolute left-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",children:e.jsx(_e,{})})]})]})]}),m&&e.jsx("div",{className:"text-right mb-8 mt-5",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:g,children:g?e.jsx(ie,{size:20}):e.jsx(e.Fragment,{children:" Save Profile Changes"})})})]})})}),b!=="investor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333] mt-10",children:[e.jsx("h1",{className:"text-xl text-black dark:text-[#F8F8F8]",children:"Company Details"}),b!=="team"&&b!=="team-lead"&&e.jsx("button",{onClick:()=>T(t=>!t),className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(re,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{})," ",e.jsx("span",{children:"Edit Company"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-5",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:e.jsx("img",{src:O||$e,alt:"Company Logo",className:"w-full h-full object-cover"})}),o&&e.jsxs("label",{className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Logo",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>H(t,"company")})]})]}),e.jsxs("form",{onSubmit:h(ue),children:[e.jsx("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Name"}),e.jsx("input",{type:"text",...w("company_name",{required:"Company name is required"}),readOnly:!o,placeholder:"Enter company name",className:`form-control w-full ${d.company_name?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),d.company_name&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.company_name.message})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] my-2 inline-block",children:"Sub Domain"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"your-company",...w("sub_domain",{required:"Sub domain is required",pattern:{value:/^(?!-)[a-z0-9]+(-[a-z0-9]+)*$/,message:"Only lowercase letters, numbers, and hyphens are allowed. Cannot start or end with a hyphen."}}),readOnly:!o,className:`form-control w-full pr-48 ${d.sub_domain?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("span",{className:"absolute inset-y-0 right-3 flex items-center text-gray-500 text-sm font-medium pointer-events-none",children:[".",J]})]}),d.sub_domain&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.sub_domain.message}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Your app will be available at:"," ",e.jsx("strong",{className:"text-[#6C5DD3]",children:ge})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Email"}),e.jsx("input",{type:"email",...w("company_email",{required:"Company email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Enter a valid email address"}}),readOnly:!o,placeholder:"Enter company email",className:`form-control w-full ${d.company_email?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),d.company_email&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.company_email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Phone"}),e.jsx("input",{type:"tel",...w("company_phone",{required:"Company phone is required",pattern:{value:/^0\d{9,10}$/,message:"Phone number must start with 0 and be 10 or 11 digits long"}}),readOnly:!o,placeholder:"Enter phone number",className:`form-control w-full ${d.company_phone?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),d.company_phone&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:d.company_phone.message})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Website"}),e.jsx("input",{type:"text",...w("company_website"),readOnly:!o,placeholder:"Enter Company website",className:`form-control w-full ${o?"":"opacity-75 cursor-not-allowed"}`})]})]})}),o&&e.jsx("div",{className:"text-right mb-8",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:g,children:g?e.jsx(ie,{size:20}):e.jsx(e.Fragment,{children:" Save Company Changes"})})})]})]}),e.jsx(Ie,{isOpen:a,onClose:()=>u(!1),imageSrc:n,onCropComplete:Z,aspectRatio:1})]})})},Oe=()=>e.jsx(ye,{stripe:Me,children:e.jsx(Fe,{})});export{Oe as default};
