import{T as te,u as y,a6 as R,aH as le,at as ne,r as t,s as ie,t as oe,ce,m as e,cf as g,ar as de,ax as me,cg as pe}from"./index-CB3EpVXU.js";import{D as ue}from"./DragAndDrop-qZxFsjUl.js";const ke=({handleCloseManualComparable:N,handleFinishManualComparable:q,aiComparableData:xe=[]})=>{var U,M;const{register:o,handleSubmit:T,reset:fe,setValue:c,watch:v,formState:{errors:n}}=te({mode:"onChange"}),A=new Date().getFullYear(),b=Array.from(new Array(A-2021),(s,r)=>2022+r),{user:L,role:ge}=y(s=>s.user),{data:h,loading:O}=R(le),{property_types:z,property_radiuses:be}=(h==null?void 0:h.data)||{},d={property_types:z},{loading:B}=ne(),_=v("property_type_id"),a=y(s=>{var r;return(r=s==null?void 0:s.deal)==null?void 0:r.deal}),[V,G]=t.useState(!1),[m,w]=t.useState(null),W=ie(),[u,D]=t.useState(null),[Y,H]=t.useState([null,null]),[he,je]=t.useState(!1),[ye,J]=t.useState(!1);oe();const[Ne,k]=t.useState(!1),[ve,C]=t.useState(null),[_e,F]=t.useState(null),{comparableDealId:K}=y(s=>s==null?void 0:s.deal),[$,Q]=t.useState([null,null]);R(ce,K||null,a==null?void 0:a.deal_type_id);const X=s=>{const r=parseFloat(s.replace(/[^0-9.]/g,""));return isNaN(r)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(r)},x=v("price");t.useEffect(()=>{if(x&&!x.includes("$")){const s=X(x);c("price",s)}},[x,c]),t.useEffect(()=>{a!=null&&a.property_type_id&&c("property_type_id",String(a.property_type_id))},[a==null?void 0:a.property_type_id,c]),t.useEffect(()=>{a&&(a.no_of_dwelling!=null&&c("no_of_dwelling",Number(a.no_of_dwelling)),a.no_of_dwelling!=null&&c("no_of_bedroom",Number(a.no_of_dwelling)))},[a,c]);const Z=s=>{var i,p,f,P;let r={...s};r.price=parseFloat(String(s.price).replace(/[^0-9.]/g,"")),r.size_in_sqm=parseFloat(String(s.size_in_sqm).replace(/[^0-9.]/g,"")),r.no_of_bedroom=(a==null?void 0:a.deal_type_id)===2?r.no_of_dwelling:r.no_of_bedroom,delete r.no_of_dwelling,r.property_type_string=E[s.sub_category];const l={...r,type:"manual",property_title:(p=(i=d==null?void 0:d.property_types)==null?void 0:i.find(j=>j.id==_))==null?void 0:p.title,user_id:L.id,id:Date.now(),property_deal_id:a==null?void 0:a.id,image_url:u||"",title:((P=(f=d==null?void 0:d.property_types)==null?void 0:f.find(j=>j.id==_))==null?void 0:P.title)||"Untitled Property"};q(),W(pe(l))},S=t.useRef(null);t.useRef(null);const ee=()=>S.current.click(),se=(s,r)=>{const l=[...Y];l[r]=URL.createObjectURL(s),H(l);const i=[...$];i[r]=s,Q(i)},re=s=>new Promise((r,l)=>{const i=new FileReader;i.readAsDataURL(s),i.onload=()=>r(i.result),i.onerror=p=>l(p)}),ae=async s=>{const r=s.target.files;if(r&&r.length>0){const l=r[0],i=await re(l);D(i),k(!0),m&&m.startsWith("blob:")&&URL.revokeObjectURL(m);const p=l.type.split("/")[0];C(p);const f=URL.createObjectURL(l);w(f),J(!1),F(null)}else I()},I=()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),D(null),w(null),C(null),k(!0),F(null)},E={Flat:"Apartments/Flat",Detached:"Detached",SemiDetached:"Semi Detached",Terraced:"Terraced",Other:"Other"};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-5xl relative mx-5 dark:bg-[#181818]",children:[e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:N,children:"âœ•"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-[#F8F8F8]",children:"Enter details of property"})]}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto rounded-xl",children:[B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),e.jsxs("div",{className:"create-comparables-form-wrap",children:[O?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsxs("form",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:(M=(U=g)==null?void 0:U.fields)==null?void 0:M.no_of_bedroom}),e.jsx("input",{type:"number",min:"0",max:"100",onWheel:s=>s.target.blur(),onKeyDown:s=>{["ArrowUp","ArrowDown","e","E","+","-"].includes(s.key)&&s.preventDefault()},onInput:s=>{const r=parseInt(s.target.value);r>100&&(s.target.value="100"),r<0&&(s.target.value="0")},...o("no_of_bedroom",{required:"Number of bedrooms is required",validate:{positive:s=>s>=1||"Number of bedrooms cannot be zero",maxValue:s=>s<=100||"Number of bedrooms cannot exceed 100"}}),className:"form-control focus:outline-none"}),n.no_of_bedroom&&e.jsx("p",{className:"text-red-500 text-sm",children:n.no_of_bedroom.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Property Title"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...o("address",{required:"Property Title is required"}),className:"form-control focus:outline-none"})}),n.address&&e.jsx("p",{className:"text-red-500 text-sm",children:n.address.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Distance (in miles)"}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"0",...o("distance",{required:"Distance is required",min:{value:0,message:"Distance cannot be negative"}}),className:"form-control focus:outline-none"})}),n.distance&&e.jsx("p",{className:"text-red-500 text-sm",children:n.distance.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:g.fields.price}),e.jsx("div",{className:"custom-price-currn-input",children:e.jsx("input",{type:"text",onWheel:s=>s.target.blur(),onKeyDown:s=>{(s.key==="ArrowUp"||s.key==="ArrowDown")&&s.preventDefault(),["e","E","+","-"].includes(s.key)&&s.preventDefault()},onInput:s=>{parseInt(s.target.value)<0&&(s.target.value="0")},...o("price",{required:"Price is required",validate:{positive:s=>{const r=String(s).replace(/[,]/g,"");return parseFloat(r)>=0||"Price cannot be negative"},maxValue:s=>{const r=String(s).replace(/[,]/g,""),l=parseFloat(r);return isNaN(l)||l<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"}}}),className:"form-control focus:outline-none"})}),n.price&&e.jsx("p",{className:"text-red-500 text-sm",children:n.price.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:g.fields.year}),e.jsxs("select",{...o("year",{required:"Year is required"}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Year"}),b==null?void 0:b.map(s=>e.jsx("option",{value:s,children:s},s))]}),n.year&&e.jsx("p",{className:"text-red-500 text-sm",children:n.year.message})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Sub Category"}),e.jsx("div",{className:"",children:e.jsx("select",{...o("sub_category"),className:"form-select focus:outline-none",children:Object.entries(E).map(([s,r])=>e.jsx("option",{value:s,children:r},s))})})]})]})]}),e.jsxs("div",{className:"",children:[e.jsx("div",{children:e.jsx("div",{onClick:ee,className:"bg-[#EBEBEC] dark:bg-[#242424] flex items-center justify-center relative create-deal-upload-document-wrap dark:border-[#454545]",children:u?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"Property",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 z-10 text-2xl text-red-500",onClick:s=>{s.stopPropagation(),I()},children:e.jsx(de,{})})]}):e.jsxs("p",{className:"text-gray-400 cursor-pointer text-[17px] flex flex-col items-center justify-center mx-5 text-center",children:[e.jsx("span",{children:e.jsx(me,{size:50})}),e.jsx("span",{className:"text-[#6C5DD3]",children:"Click to upload"})," or drag and drop files PNG, JPEG, JPG (max size 25MB)"]})})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:S,onChange:ae,onClick:s=>{s.target.value=null}}),e.jsxs("div",{className:"mb-5 mt-4",children:[e.jsx("label",{className:"block form-label",children:g.fields.link}),e.jsx("input",{type:"text",...o("linked_search_url",{}),className:"form-control focus:outline-none"}),n.linked_search_url&&e.jsx("p",{className:"text-red-500 text-sm",children:n.linked_search_url.message})]})]})]})})}),V&&e.jsx(ue,{onImagesChange:se,maxFiles:100,initialImages:u?[u]:[],onClose:()=>G(!1),title:"Upload image or video",acceptedFileTypes:"image/*,video/*"})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"flex justify-end px-4",children:e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 my-3 mx-3",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg dark:text-white",onClick:N,children:"Cancel"}),e.jsx("button",{onClick:()=>{T(Z)()},className:"w-fit purple-btn items-center gap-5 justify-center",style:{display:"flex"},children:"Finish"})]})})})})]})})};export{ke as M};
