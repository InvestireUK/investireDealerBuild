import{m as a,bq as B,br as z,u as v,s as D,q as V,r as t,T as N,bC as A,x as O,cS as R,bs as S,cc as q,S as G}from"./index-iRB_0ci3.js";import{u as W}from"./useRefreshUser-CUoWi6PV.js";const X=({isOpen:d,onClose:c,title:e,children:n})=>d?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:c,children:a.jsxs("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] rounded-lg shadow-lg p-6 m-3 max-w-md w-full",onClick:i=>i.stopPropagation(),children:[a.jsx("div",{className:"flex justify-between items-center mb-4",children:a.jsx("h3",{className:"text-xl font-semibold dark:text-white text-[#333]",children:e})}),n]})}):null;G("pk_test_51R6uLuGhmABE4SukbmgqsLITna4D57Ittag620AxGwm1ckI0oeYBXvNUBO9w4WhygDlp3sWd7ldWiZlGbR8jzxXk00N3jUSXPv");const be=()=>{var g,y,j,w,C;const d=B(),c=z(),{user:e,role:n}=v(s=>s.user),{darkMode:i}=v(s=>s.theme);D();const{showSnackbar:l}=V();W();const[T,$]=t.useState(!1),[Y,Z]=t.useState(!1),[k,x]=t.useState(!1),[H,J]=t.useState(null),[K,Q]=t.useState(null),[ee,ae]=t.useState(null),[se,te]=t.useState(null),[re,oe]=t.useState({current:!1,new:!1,confirm:!1}),[u,P]=t.useState([]),[L,m]=t.useState(!1),[h,f]=t.useState(!1),{register:le,handleSubmit:ne,formState:{errors:de},reset:E,setValue:ce}=N({defaultValues:{first_name:(e==null?void 0:e.first_name)||"",last_name:(e==null?void 0:e.last_name)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||"",role:n||"",company_name:(e==null?void 0:e.company_name)||"",registration_number:(e==null?void 0:e.registration_number)||"",company_website:(e==null?void 0:e.company_website)||"",company_email:(e==null?void 0:e.company_email)||"",company_phone:(e==null?void 0:e.company_phone)||""}}),{register:ie,handleSubmit:me,formState:{errors:pe},reset:xe}=N({defaultValues:{current_password:"",new_password:"",confirm_password:""}});t.useEffect(()=>{e&&e.stripe_customer_id&&b(e.stripe_customer_id)},[e,E,n]);const b=async()=>{try{x(!0);const s=await A();s&&P(s==null?void 0:s.default_payment_method)}catch(s){console.error("Error fetching cards:",s),l("Failed to load payment methods","error")}finally{x(!1)}},I=async s=>{if(s.preventDefault(),!d||!c){l("Stripe not loaded yet","error");return}const _=c.getElement(S);if(!_){l("Card element not found","error");return}f(!0);try{const{error:o,paymentMethod:U}=await d.createPaymentMethod({type:"card",card:_});if(o)l(o.message||"Invalid card details","error");else{const F="https://phplaravel-1547671-6035260.cloudwaysapps.com/api/v1",M=localStorage.getItem("token"),ue=await q.put(`${F}/payment-method/update`,{payment_method_id:U.id},{headers:{Authorization:`Bearer ${M}`}});l("Card collected successfully","success"),await b(e.stripe_customer_id),m(!1)}}catch(o){l("Failed to update card","error"),console.error("Full error while updating card:",(o==null?void 0:o.response)||o)}finally{f(!1)}},r=u||null;console.log("latestCard",r);const p=r&&r.card&&r.card.last4;return console.log("hasCard",p),a.jsxs("div",{className:"min-h-screen my-5",children:[a.jsx("div",{className:"max-w-7xl mx-auto",children:n==="investor"?"":a.jsxs("div",{className:"profile-detail-form-container-main-div",children:[a.jsx("h2",{className:"text-xl text-black  dark:text-[#F8F8F8]",children:"Payment Method"}),a.jsx("div",{className:"profile-detail-form-container-wrap",children:k?a.jsx(O,{size:20}):p?a.jsx("div",{className:"p-4 rounded mb-4",children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:a.jsxs("div",{className:"p-7 border rounded-xl",children:[a.jsxs("div",{className:"flex gap-4 ",children:[((g=r.card)==null?void 0:g.brand)&&a.jsx("div",{children:a.jsx("p",{className:"dark:text-white text-black uppercase font-semibold border p-1",children:r.card.brand})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(R,{className:"text-purple-500"}),a.jsx("p",{className:"dark:text-white text-black font-medium",children:((y=r.billing_details)==null?void 0:y.name)||"Card"})]}),a.jsxs("p",{className:"text-gray-400",children:["**** **** **** ",(j=r.card)==null?void 0:j.last4]}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Expires ",(w=r.card)==null?void 0:w.exp_month,"/",(C=p.card)==null?void 0:C.exp_year]})]})]}),a.jsx("div",{className:"mt-5 text-center border py-2 px-3 rounded-xl text-sm",children:a.jsx("button",{onClick:()=>m(!0),children:"Add a new payment method"})})]})})}):a.jsx("p",{className:"text-center py-4",children:"No payment methods found."})})]})}),a.jsx(X,{isOpen:L,onClose:()=>m(!1),title:"Update Payment Method",children:a.jsxs("form",{onSubmit:I,children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Card Details"}),a.jsx("div",{className:"p-3 dark:bg-[#15172b] bg-[#ffff] rounded",children:a.jsx(S,{options:{style:{base:{fontSize:"16px",color:i?"#fff":"#000000","::placeholder":{color:i?"#cccccc":"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0}})})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[a.jsx("button",{type:"button",className:"red-btn",onClick:()=>m(!1),children:"Cancel"}),a.jsx("button",{type:"submit",className:"purple-btn",disabled:h,children:h?"Updating...":"Update Card"})]})]})})]})};export{be as default};
