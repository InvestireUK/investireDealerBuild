import{t as be,s as ye,u as F,au as fe,a7 as je,bB as Ne,r,bE as J,m as e,c2 as w,bH as c,bI as _e,ax as we,c3 as k,bT as X,bK as ve,bL as Ce,bV as Fe,aL as ke,aM as Se,aG as Pe,ar as Le,N as De}from"./index-D8BtCFJG.js";import{u as Ae}from"./useRefreshUser-kexRPWCk.js";import{F as Ie}from"./FinancialSummaryView-B8uY4qgh.js";import{P as Ee}from"./PaginationNew-Dfy1HSM9.js";const ze=()=>{var B,G,U,Y,O,V,K,W,q,Q;const b=be(),d=ye(),Z=Ae(),t=F(s=>s.deal.deal),S=F(s=>s.deal.currentStep),ee=F(s=>s.deal.comparableMode),se="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",{handleApiCall:te,loading:ae}=fe(),{data:v}=je(Ne,t==null?void 0:t.id,{type:ee});(B=v==null?void 0:v.data)!=null&&B.dealComparables;const m=((...s)=>s.find(a=>Array.isArray(a)&&a.length>0)||[])(t==null?void 0:t.newcomperable,t==null?void 0:t.property_deal_comparables,t==null?void 0:t.property_deal_sa_comparables),l=(t==null?void 0:t.deal_type_id)===2?t.property_deal_sa_comparables||[]:t.property_deal_comparables||[],[x,re]=r.useState({page:1,per_page:(l==null?void 0:l.length)>=5?5:l==null?void 0:l.length}),P=(x.page-1)*x.per_page,u=l.slice(P,P+x.per_page),le={currentPage:x.page,perPage:x.per_page,total:l.length,totalPages:Math.ceil(l.length/x.per_page)};t!=null&&t.address_line_1,t!=null&&t.address_line_2,t!=null&&t.post_code,(G=t==null?void 0:t.country)!=null&&G.name;const L=(t==null?void 0:t.image_url)||null,ne=(t==null?void 0:t.map_image_url)||null,ie=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const a={lat:s.coords.latitude,lng:s.coords.longitude};setUserLocation(a),setAddressCoordinates(a)},()=>{alert("Location access denied or unavailable.")}):alert("Geolocation is not supported by this browser.")},oe=s=>{var n,i,o,_;const a=[];if(s!=null&&s.no_of_dwelling){const p=(s==null?void 0:s.deal_type_id)===2?s.no_of_dwelling>1?" Beds":" Bed":s.no_of_dwelling>1?" Bedrooms":" Bedroom";a.push(s.no_of_dwelling+p)}if(s.deal_type&&a.push(s.deal_type.title),(n=s==null?void 0:s.sub_category)!=null&&n.title&&a.push(s.sub_category.title),(i=s==null?void 0:s.property_type_category)!=null&&i.title&&a.push((o=s.property_type_category)==null?void 0:o.title),(_=s==null?void 0:s.exit_type)!=null&&_.title){let p=s.exit_type.title.toLowerCase();p==="sell"?p="Flip":p==="refinance"&&(p="BRRR"),a.push(p)}return a.join(",")},y={description:(t==null?void 0:t.description_type)==="ai"?(t==null?void 0:t.description_ai)||"No AI description available":(t==null?void 0:t.description)||"No description available"},f={location:(t==null?void 0:t.description_type)==="ai"?(t==null?void 0:t.location_ai)||"No AI location available":(t==null?void 0:t.location)||"No location available"},[D,A]=r.useState(!1),[I,E]=r.useState(!1),[ce,pe]=r.useState(!1),[de,me]=r.useState(!1),j=r.useRef(null),N=r.useRef(null);r.useEffect(()=>{if(j.current){const a=parseFloat(getComputedStyle(j.current).lineHeight)*3;pe(j.current.scrollHeight>a)}if(N.current){const a=parseFloat(getComputedStyle(N.current).lineHeight)*3;me(N.current.scrollHeight>a)}},[y,f]);const xe=()=>{A(s=>{const a=!s;return a&&E(!1),a})},ue=()=>{E(s=>{const a=!s;return a&&A(!1),a})},he=()=>{const s={_method:"PATCH",status:"publish",step:5};te({apiFn:()=>Pe(t.id,s),data:s,successMessage:"Deal uploaded successfully",errorMessage:"Failed to upload Deal",onSuccess:async a=>{const h={step:5,...a==null?void 0:a.deal};d(Le(!0)),d(De(h)),await Z(),b("/deals/deal-view/"+t.id)}})};r.useEffect(()=>(d(J(!0)),d({type:"deal/setCurrentStep",payload:Math.max(S,5)}),()=>{d(J(!1))}),[d,S]);const[ge,R]=r.useState(!1),[H,C]=r.useState(0),g=((U=t==null?void 0:t.property_deal_media)==null?void 0:U.map(s=>{var a;return(a=s==null?void 0:s.media)==null?void 0:a.media_url}))||[],T=s=>{C(s),R(!0)},M=s=>{s.stopPropagation(),R(!1)},$=s=>{s.stopPropagation(),C(a=>(a+1)%g.length)},z=s=>{s.stopPropagation(),C(a=>(a-1+g.length)%g.length)};return e.jsxs("div",{className:"create-deal-summary-page-wrap",children:[e.jsx("h4",{className:"text-[#333333] font-bold mb-4 light-black dark:text-[#F8F8F8]",children:"Summary"}),ae?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-add-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Title"}),e.jsxs("button",{type:"button",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>b("/create-deal/address"),children:[e.jsx(w,{className:"text-lg"}),"Edit details"]})]}),e.jsxs("div",{className:"summary-property-map-wrap",children:[e.jsxs("div",{className:"flex items-center justify-between purchased-price-with-location",children:[e.jsx("p",{className:"text-[#242424] font-medium property-location-text mb-4 dark:text-[#F8F8F8]",children:oe(t)}),(t==null?void 0:t.deal_type_id)===2?e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Rent: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:(Y=t==null?void 0:t.property_deal_sa_investment)!=null&&Y.rent?`£${parseFloat((O=t==null?void 0:t.property_deal_sa_investment)==null?void 0:O.rent).toLocaleString()}`:"0"})]}):e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Purchased Price: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:(V=t==null?void 0:t.property_deal_investment)!=null&&V.purchase_price?`£${parseFloat((K=t==null?void 0:t.property_deal_investment)==null?void 0:K.purchase_price).toLocaleString()}`:"0"})]})]}),e.jsxs("div",{className:"summary-property-map-grid-wrap",children:[e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${((W=t==null?void 0:t.property_deal_media)==null?void 0:W.length)>0?"summary-property-col":""}`,children:[e.jsx("div",{className:"summary-property-subimages-div",children:(q=t==null?void 0:t.property_deal_media)==null?void 0:q.slice(0,4).map((s,a)=>{var i,o;const n=(((i=t==null?void 0:t.property_deal_media)==null?void 0:i.length)||0)-4;return e.jsx("div",{className:"summary-property-subimages relative",children:s?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(o=s==null?void 0:s.media)==null?void 0:o.media_url,alt:"Property",className:"w-full h-full object-cover cursor-pointer",onClick:()=>T(a)}),a===3&&n>0&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white text-lg font-semibold cursor-pointer",onClick:()=>T(a),children:["+",n]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:c.noImageAvailable})},a)})}),e.jsx("div",{className:"summary-property-main-images-div h-full",children:e.jsx("div",{className:"w-full bg-gray-700 summary-property-div",children:L?e.jsx("img",{src:L,alt:"Property",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:c.noImageAvailable})})})]}),ge&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:M,children:e.jsxs("div",{className:"relative max-w-4xl w-full p-4 flex items-center justify-center",onClick:s=>s.stopPropagation(),children:[e.jsx("img",{src:g[H],alt:"Large view",className:"max-h-[80vh] max-w-full object-contain mx-auto rounded-lg shadow-lg"}),e.jsx("div",{className:"absolute inset-y-0 left-0 w-1/2 cursor-pointer",onClick:s=>{s.stopPropagation(),z(s)}}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-1/2 cursor-pointer",onClick:s=>{s.stopPropagation(),$(s)}}),e.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:s=>{s.stopPropagation(),z(s)},children:"❮"}),e.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:s=>{s.stopPropagation(),$(s)},children:"❯"}),e.jsx("button",{className:"fixed top-4 right-4 text-white text-3xl z-50",onClick:M,children:e.jsx(_e,{})}),e.jsxs("div",{className:"absolute bottom-4 text-white text-center w-full",children:[H+1," / ",g.length]})]})})]}),e.jsx("div",{className:"summary-map-loaction-col",children:e.jsx("div",{className:"w-full bg-gray-700 summary-map-wrapper",children:ne?e.jsxs(e.Fragment,{children:[e.jsx("iframe",{width:"600",height:"358",className:"rounded-lg w-full",style:{border:0,borderRadius:"12px"},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:`https://www.google.com/maps/embed/v1/place?key=${se}&q=${t==null?void 0:t.lat},${t==null?void 0:t.lng}&zoom=16`,title:"Google Map"}),e.jsx("button",{type:"button",className:"absolute bottom-[-20px] right-[50px] bg-black text-white px-2 py-2 rounded-full border border-white text-sm shadow transition",onClick:ie,children:e.jsx(we,{})})]}):e.jsx("div",{className:"w-full flex items-center justify-center text-gray-500",children:c.noMapImageAvailable})})})]})]})]}),e.jsxs("div",{className:"deal-summart-description-wrap mt-6",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Description"}),e.jsxs(k,{to:"/create-deal/description",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(w,{className:"text-lg"}),c.editDetails]})]}),e.jsxs("div",{className:"summary-description-text",children:[e.jsxs("div",{className:"summary-description-heading-wrap",children:[e.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2 dark:text-[#ECECEC]",children:"Property description:"}),e.jsx("p",{ref:j,className:`text-[#595959] whitespace-pre-line overflow-hidden transition-all duration-300 dark:text-[#C5C5C5] ${D?"":"line-clamp-3"}`,dangerouslySetInnerHTML:{__html:X(y==null?void 0:y.description)}}),ce&&e.jsx("button",{onClick:xe,className:"mt-2 text-sm text-[#6C5DD3] font-semibold",children:D?"Read less":"Read more"})]}),e.jsxs("div",{className:"summary-description-heading-wrap mt-6",children:[e.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2 dark:text-[#ECECEC]",children:"Location description:"}),e.jsx("p",{ref:N,className:`text-[#595959] whitespace-pre-line overflow-hidden transition-all duration-300 dark:text-[#C5C5C5] ${I?"":"line-clamp-3"}`,dangerouslySetInnerHTML:{__html:X(f==null?void 0:f.location)}}),de&&e.jsx("button",{onClick:ue,className:"mt-2 text-sm text-[#6C5DD3] font-semibold",children:I?"Read less":"Read more"})]})]})]}),e.jsxs("div",{className:"mt-6 DealsDetails-page-wrapper summary-financials-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:c.financials}),e.jsxs(k,{to:"/create-deal/financials",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(w,{className:"text-lg"}),c.editDetails]})]}),e.jsx("div",{className:"min-h-screen financial-page-main-div-wrap",children:e.jsxs("div",{className:"financial-page-inner-div-wrap",children:[(t==null?void 0:t.deal_type_id)===2?e.jsx(ve,{deal:t}):e.jsx(Ce,{deal:t}),e.jsx(Ie,{})]})})]}),e.jsxs("div",{className:"summary-page-comparables-sec",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:c.comparables}),e.jsxs(k,{to:(m==null?void 0:m.length)>0?(t==null?void 0:t.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>b("/create-deal/comparable-table"),children:[e.jsx(w,{className:"text-lg"}),c.editDetails]})]}),e.jsxs("div",{children:[(t==null?void 0:t.deal_type_id)===2?u.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"summary-page-comapare-table-main-div",children:e.jsx("div",{className:"overflow-x-auto comparable-listing-table-wrap",children:u.map((s,a)=>e.jsx(Fe,{comp:s},a))})}):u.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"border dark:border-[#454545]",children:e.jsx("div",{className:"overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark text-[12px] border-b dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SL NO."}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:u==null?void 0:u.map((s,a)=>{var h,n,i,o;return e.jsxs("tr",{className:"border-b dark:border-[#333333]",children:[e.jsx("td",{className:"p-4",children:a+1}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:(s==null?void 0:s.image_url)||ke,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px]",children:s==null?void 0:s.address}),s!=null&&s.linked_search_url?e.jsx("a",{href:s.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(s==null?void 0:s.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:Se,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4",children:(i=(n=(h=(s==null?void 0:s.property_type_string)||(s==null?void 0:s.sub_category))==null?void 0:h.toLowerCase())==null?void 0:n.replace(/_/g," "))==null?void 0:i.replace(/\b\w/g,_=>_.toUpperCase())}),e.jsx("td",{className:"p-4",children:s.no_of_bedroom}),e.jsxs("td",{className:"p-4",children:["£",Number(s.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4",children:s.year}),e.jsx("td",{className:"p-4",children:(s==null?void 0:s.distance)!=null?`${(o=parseInt(s==null?void 0:s.distance))==null?void 0:o.toFixed(2)} Mile${(s==null?void 0:s.distance)>1?"s":""}`:"-"})]},s.id||a)})})]})})}),l.length>0&&e.jsx(Ee,{pagination:le,setFilters:re})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg text-gray-600 my-2",children:[e.jsxs("span",{className:"dark:text-[#F8F8F8]",children:["Last updated by: ",e.jsx("strong",{children:((Q=t==null?void 0:t.last_updated_by)==null?void 0:Q.name)||"-"})]}),e.jsx("span",{className:"dark:text-[#F8F8F8]",children:t!=null&&t.updated_at?new Date(t.updated_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):""})]}),e.jsxs("div",{className:"flex justify-end items-center mt-5 gap-4",children:[e.jsx("button",{className:"w-fit flex items-center gap-5 justify-center gray-outline-btn",onClick:()=>{const s=(m==null?void 0:m.length)>0?(t==null?void 0:t.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables";b(s)},children:"Back"}),e.jsx("button",{onClick:he,className:"w-fit purple-btn items-center justify-center",children:"Publish"})]})]})]})};export{ze as default};
