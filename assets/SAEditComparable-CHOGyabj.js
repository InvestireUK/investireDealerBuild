import{V as z,v as L,u as v,r as i,w as P,av as G,m as e,z as w,co as H,aM as T,cp as Y,cq as Q,cr as V,cs as K,ct as A,cu as U,aO as J,aP as W,cv as X,Q as Z,aH as ee,aR as se}from"./index-0vzpDfIT.js";import{S as ae}from"./SAManualComparables-ChngaYzX.js";import{S as le}from"./SAComparablesMaps--_LytR4z.js";import"./DragAndDrop-Zn1IX8Gr.js";import"./index-DktUvCWa.js";import"./ModifiedAutoAddressInput-L4EVVpkA.js";const de=()=>{const{register:g,watch:h,reset:N}=z({defaultValues:{bedrooms:"",no_of_beds:""}}),u=L(),E="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",s=v(a=>{var l;return(l=a==null?void 0:a.deal)==null?void 0:l.deal}),d=v(a=>a.deal.manualComperable),[I,m]=i.useState(!1),[b,S]=i.useState([]),_=P(),[f,p]=i.useState(!1),[c,j]=i.useState([]),{handleApiCall:k}=G(),x=i.useRef(null),y=h("bedrooms"),D=h("no_of_beds"),B=h("type_of_space"),o=i.useMemo(()=>[...Array.isArray(d)?d:[],...Array.isArray(s==null?void 0:s.property_deal_sa_comparables)?s==null?void 0:s.property_deal_sa_comparables:[],...Array.isArray(b)?b:[]].map((l,t)=>{const r=l.uniqueId||l.id||l.listing_url||l.temp_id||`stable-${t}-${l.title||"item"}-${l.lat||""}-${l.lng||""}`;return{...l,uniqueId:r}}),[d,s==null?void 0:s.property_deal_sa_comparables,b]);i.useEffect(()=>{const a=(s==null?void 0:s.property_deal_sa_comparables)||[],l=d||[],t=new Set(a.map(n=>n.uniqueId||n.id||n.listing_url||n.temp_id).filter(Boolean)),r=new Set(l.map(n=>n.uniqueId||n.id||n.listing_url||n.temp_id).filter(Boolean));j(n=>{const O=n.filter(R=>r.has(R));return[...new Set([...O,...Array.from(t)])]})},[s==null?void 0:s.property_deal_sa_comparables,d]),i.useEffect(()=>{if(!x.current)return;const a=o.length,l=c.length;x.current.checked=l===a&&a>0,x.current.indeterminate=l>0&&l<a},[c.length,o.length]);const F=()=>{j(a=>a.length===o.length?[]:o.map(l=>l.uniqueId))},C=async()=>{var a,l;p(!0);try{const t={address1:(s==null?void 0:s.address_line_1)||"",address2:(s==null?void 0:s.address_line_2)||"",city:(s==null?void 0:s.city)||"",postCode:(s==null?void 0:s.post_code)||"",country:((a=s==null?void 0:s.country)==null?void 0:a.name)||"",no_of_bedroom:y||1,no_of_beds:D||1,type_of_space:B||"",no_of_dwellings:(s==null?void 0:s.no_of_dwelling)||1,type:"ai"},r=await J(s.id,1,t);S(((l=r==null?void 0:r.data)==null?void 0:l.dealComparables)||[])}catch(t){console.error("Error fetching AI comparables:",t)}finally{p(!1)}},q=()=>{m(!0)},M=()=>{m(!1)},$=async()=>{var a;try{p(!0);const l=o.filter(r=>c.includes(r.uniqueId)),t=await W(s==null?void 0:s.id,1,l,y);u(X(((a=t==null?void 0:t.data)==null?void 0:a.dealComparables)||[])),await k({apiFn:()=>ee(s==null?void 0:s.id,{_method:"PATCH"}),onSuccess:r=>{var n;u(Z({...r==null?void 0:r.deal,id:(n=r==null?void 0:r.deal)==null?void 0:n.id}))}}),_("/create-deal/sa-comparable-table",{replace:!0}),u(se())}catch(l){console.error("Error:",l)}finally{p(!1)}};return i.useEffect(()=>{s&&N({bedrooms:(s==null?void 0:s.no_of_dwelling)??"",no_of_beds:(s==null?void 0:s.no_of_guests)??""})},[s,N]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sa-api-comparables-map-wrap",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h5",{children:"Comparables"})}),I&&e.jsx(ae,{handleFinishSAManualComparable:q,handleCloseManualComparable:M,onClose:()=>m(!1)}),e.jsx("div",{className:"map-generated-sec mb-10",children:e.jsx("div",{className:"bg-[#EBEBEC] dark:bg-[#222632] flex items-center justify-center relative create-deal-upload-document-wrap",children:e.jsx(le,{locations:o,apiKey:E})})}),e.jsxs("div",{className:"sa-api-comparables-data-wrap relative",children:[f&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(w,{})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h5",{className:"font-semibold",children:"Nearby listings"}),e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>m(!0),children:"+ Add Comparable"})]}),e.jsx("div",{className:"filters my-5",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-2 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Bedrooms"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...g("bedrooms"),className:"form-control focus:outline-none"})})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"No. of beds"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...g("no_of_beds"),className:"form-control focus:outline-none"})})]}),e.jsx("div",{className:"",children:e.jsx("div",{className:"purple-btn mt-7",children:e.jsxs("button",{className:"flex items-center gap-2 whitespace-nowrap",onClick:C,children:[e.jsx(H,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})}),e.jsx("div",{className:"mb-5 flex items-center justify-center mt-3"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",ref:x,onChange:F,className:"sr-only",id:"select-all-checkbox"}),e.jsx("label",{htmlFor:"select-all-checkbox",className:"purple-btn px-4 py-2 cursor-pointer select-none inline-block",children:c.length===o.length&&o.length>0?"Unselect All":"Select All"})]}),e.jsx("button",{type:"button",className:"purple-btn my-4 flex items-center gap-2",onClick:C,disabled:f,children:f?e.jsx(w,{size:"sm"}):"Refresh AI"})]}),o.map(a=>{const l=a.uniqueId;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-[15px_1fr_2fr_10%] gap-5 my-10 items-center",children:[e.jsx("input",{type:"checkbox",checked:c.includes(l),onChange:()=>{j(t=>t.includes(l)?t.filter(r=>r!==l):[...t,l])}}),e.jsx("div",{className:"w-full h-[200px]",children:e.jsx("img",{src:(a==null?void 0:a.image_url)||(a==null?void 0:a.image)||T,alt:"Image",className:"w-full h-full object-cover rounded-[20px]"})}),e.jsxs("div",{className:"ai-api-data flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"ai-title",children:e.jsxs("p",{className:"font-semibold text-[20px]",children:[a.title," ",e.jsxs("span",{className:"text-sm text-[#595959]",children:[a.distance_meters,"ml"]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"ai-information flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{}),e.jsx("span",{className:"font-semibold text-base",children:a.no_of_bedroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{}),e.jsx("span",{className:"font-semibold text-base",children:a.no_of_bathroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{}),e.jsxs("span",{className:"font-semibold text-base",children:[a.beds," Guests"]})]})]}),e.jsxs("div",{className:"reviews flex items-center gap-1",children:[e.jsx(K,{className:"text-[#FB6E0A]"}),e.jsx("p",{children:a.rating||0}),e.jsxs("p",{children:["(",a.reviews||0," reviews)"]})]})]}),e.jsxs("div",{className:"ai-percentage flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:a.days_available||"-"}),e.jsx("h6",{className:"text-sm",children:"Days available"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:a.occupancy||"-"}),e.jsx("h6",{className:"text-sm",children:"Occupancy"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsxs("p",{className:"text-2xl",children:["£",a.adr||"-"]}),e.jsx("h6",{className:"text-sm",children:"ADR"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:a!=null&&a.revenue?`£${a.revenue}`:"-"}),e.jsx("h6",{className:"text-sm",children:"Revenue"})]})]})]}),e.jsxs("div",{className:"links flex flex-col items-center gap-5 border-l border-[#ECECEC]",children:[a.listing_url?e.jsx("a",{href:a.listing_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(A,{className:"w-7 h-7 text-[#6C5DD3] cursor-pointer"})}):e.jsx(A,{className:"w-7 h-7 text-gray-400 cursor-not-allowed"}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lng}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(U,{className:"w-7 h-7 text-[#6C5DD3]"})}),e.jsx("p",{className:"w-6 h-6",children:"-"})]})]},l)})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-5",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:()=>_("/create-deal/description"),children:"Cancel"}),e.jsx("button",{onClick:()=>c.length>0&&$(),className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${c.length>0?"purple-btn cursor-pointer":"bg-[#ECECEC] text-[#AFAFAF] cursor-not-allowed"}`,style:{display:"flex"},disabled:c.length===0,children:`Import ${c.length||""} item${c.length===1?"":"s"}`})]})]})})};export{de as default};
