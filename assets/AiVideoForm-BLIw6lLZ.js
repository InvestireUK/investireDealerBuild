import{r as c,h as ar,m as e,b1 as ht,b2 as sr,t as ir,s as nr,$ as lr,u as pe,b3 as or,b4 as qe,b5 as me,b6 as ye,b7 as cr,b8 as dr,b9 as ur,ba as pr,bb as mr,bc as xr,bd as fr,be as hr,bf as gr}from"./index-ylv6dO9O.js";import{l as xe}from"./lodash-DaxULG_T.js";import{C as gt}from"./index-lyYFGRsi.js";import{b as br}from"./index-w1-DHrWo.js";import{u as vr}from"./useRefreshUser-q3BPzeVv.js";import{X as yr}from"./x-XAuasxzL.js";const Q="/assets/aiii-qzy6FebL.webp";function wr({show:Y,onClose:V,avatars:H,onSelect:G,VideoScenes:I,activeBlock:_,videoVariables:ie}){const[ee,U]=c.useState(null),[D,$]=c.useState([]),[fe,z]=c.useState(!1),[B,X]=c.useState(!1),[ne,v]=c.useState(!1),[C,K]=c.useState(null),[W,j]=c.useState("all");if(!Y)return null;const E=async k=>{var M;v(!0);try{const J=`https://api.heygen.com/v2/avatar_group/${k.id}/avatars`,ce=await fetch(J,{method:"GET",headers:{"X-Api-Key":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V","Content-Type":"application/json"}});if(!ce.ok)throw new Error(`HTTP ${ce.status}`);const R=await ce.json();$(((M=R.data)==null?void 0:M.avatar_list)||[]),U(k),z(!0),X(!1)}catch(J){console.error("[AvatarModal] fetch error:",J)}finally{v(!1)}},O=()=>{z(!1),U(null),$([]),K(null),X(!1)},F=()=>{X(!1),K(null)},te=k=>{K(k),X(!0)},le=H.filter(k=>{var M,J;return W==="all"?!0:W==="male"?((M=k.gender)==null?void 0:M.toLowerCase())==="male":W==="female"?((J=k.gender)==null?void 0:J.toLowerCase())==="female":!0}),he=()=>{if(!C){console.warn("[AvatarModal] No avatar selected");return}if(!G){console.error("[AvatarModal] onSelect prop missing");return}if(!_){console.error("[AvatarModal] activeBlock (scene ID) missing");return}const k={avatar_id:C.avatar_id||C.id,preview_image_url:C.image_url||C.preview_image_url,...C};G(k,_),X(!1),K(null),z(!1),U(null),$([])},oe=()=>{if(!C||!G||!Array.isArray(I)){console.warn("[AvatarModal] Invalid state for Apply to All");return}const k={avatar_id:C.avatar_id||C.id,preview_image_url:C.image_url||C.preview_image_url,...C};G(k,"ALL"),X(!1),K(null),z(!1),U(null),$([])};return ar.createPortal(e.jsxs(e.Fragment,{children:[!fe&&!B&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[9999] bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-5xl relative flex flex-col max-h-[80vh] m-5 md:m-0",children:[e.jsx("button",{onClick:V,className:"absolute top-2 right-2 text-xl text-gray-600 hover:text-black z-10",children:"X"}),e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Choose an Avatar Group"})}),e.jsx("div",{className:"p-4 overflow-y-auto",children:ne?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"})}):e.jsx("div",{className:"select-ai-voice-grid-wrap",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:le.length>0?le.map(k=>e.jsxs("div",{className:"cursor-pointer flex flex-col p-2 border rounded-md hover:border-blue-500 transition-colors",onClick:()=>E(k),children:[e.jsx("img",{src:k.preview_image||Q,alt:k.name,className:"w-full h-32 object-contain rounded-md border",onError:M=>M.currentTarget.src=Q}),e.jsxs("div",{className:"flex justify-between items-center mt-2 px-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:k.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[k.num_looks," looks"]})]})]},k.id)):e.jsx("p",{className:"col-span-full text-gray-500 text-center",children:"No avatar groups available"})})})}),e.jsx("div",{className:"flex justify-start p-4 border-t",children:e.jsx("button",{onClick:V,className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Back"})})]})}),fe&&!B&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[9999] bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-5xl relative flex flex-col max-h-[80vh] m-5 md:m-0",children:[e.jsx("button",{onClick:V,className:"absolute top-2 right-2 text-xl text-gray-600 hover:text-black z-10",children:"X"}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h2",{className:"text-lg font-semibold",children:[(ee==null?void 0:ee.name)||"Avatar"," - Select a Look"]})}),e.jsx("div",{className:"p-4 overflow-y-auto",children:ne?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"})}):e.jsx("div",{className:"select-ai-voice-grid-wrap",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:D.length>0?D.map((k,M)=>e.jsxs("div",{className:"cursor-pointer flex flex-col items-center p-2 border rounded-md hover:border-purple-500 transition-colors",onClick:()=>te(k),children:[e.jsx("img",{src:k.image_url||k.preview_image_url||Q,alt:k.avatar_name||`Avatar ${M+1}`,className:"w-full h-32 object-contain rounded-md border",onError:J=>J.currentTarget.src=Q}),k.avatar_name&&e.jsx("p",{className:"mt-2 text-xs font-medium truncate max-w-full",children:k.avatar_name})]},k.avatar_id||k.id||M)):e.jsx("p",{className:"col-span-full text-gray-500 text-center",children:"No looks available"})})})}),e.jsx("div",{className:"flex justify-start p-4 border-t",children:e.jsx("button",{onClick:O,className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Back"})})]})}),B&&C&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[9999] bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-xl relative flex flex-col m-5 md:m-0",children:[e.jsx("button",{onClick:V,className:"absolute top-2 right-2 text-xl text-gray-600 hover:text-black z-10",children:"X"}),e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Confirm Avatar"})}),e.jsxs("div",{className:"p-6 flex flex-col items-center",children:[e.jsx("div",{className:"relative w-40 h-40 rounded-full overflow-hidden border-4 border-purple-500 ring-4 ring-purple-200 mb-4",children:e.jsx("img",{src:C.image_url||C.preview_image_url||Q,alt:"Selected",className:"w-full h-full object-cover",onError:k=>k.currentTarget.src=Q})}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:C.avatar_name||C.name||"Avatar"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Ready to apply"})]}),e.jsxs("div",{className:"p-4 border-t flex gap-3",children:[e.jsx("button",{onClick:F,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300",children:"Back"}),e.jsxs("button",{onClick:he,className:"flex-1 px-4 py-2 bg-[#6C5DD3] text-white rounded-md hover:bg-purple-700 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Apply One"]}),e.jsxs("button",{onClick:oe,className:"flex-1 px-4 py-2 bg-[#6C5DD3] text-white rounded-md flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Apply to All"]})]})]})}),e.jsx("style",{jsx:!0,children:`
        .loader {
          border-top-color: #3498db;
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      `})]}),document.body)}function jr({isModalOpen:Y,setIsModalOpen:V,voices:H=[],heygenVoiceIds:G=new Set,voiceKey:I,videoVariables:_,playingAudioId:ie,handlePlayAudio:ee,handleVoiceSelect:U,loading:D=!1}){const[$,fe]=c.useState("all"),[z,B]=c.useState(null),[X,ne]=c.useState(!1);console.log("VoiceModal voices prop:",H);const C=(()=>{var te,le,he;const j=I==null?void 0:I.match(/scene_(\d+)_script/);if(!j)return null;const O=`voice_id_${j[1]}`,F=_==null?void 0:_[O];return((te=F==null?void 0:F.properties)==null?void 0:te.voice_id)||((le=F==null?void 0:F.voice)==null?void 0:le.Voice_id)||((he=F==null?void 0:F.voice)==null?void 0:he.voice_id)||null})(),K=c.useMemo(()=>{if(!Array.isArray(H)||H.length===0)return[];const j=H.filter(E=>(E==null?void 0:E.voice_id)&&G.has(E.voice_id));return $==="male"?j.filter(E=>E.gender==="male"):$==="female"?j.filter(E=>E.gender==="female"):j},[H,$,G]);console.log("filteredVoices",K);const W=j=>G.has(j);return Y?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0",onClick:()=>V(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 w-full max-w-4xl max-h-[85vh] overflow-hidden rounded-lg shadow-xl flex flex-col mx-4",children:[e.jsx("button",{onClick:()=>V(!1),className:"absolute top-4 right-4 text-2xl z-10 text-gray-600 hover:text-black dark:text-gray-300",children:"X"}),e.jsx("h2",{className:"text-xl font-semibold p-6 pb-3 text-black dark:text-white",children:"ðŸŽ™ï¸ Select AI Voice"}),e.jsx("div",{className:"flex justify-center gap-4 px-6 border-b pb-4",children:["all","male","female"].map(j=>e.jsx("button",{onClick:E=>{E.stopPropagation(),fe(j),B(null)},className:`px-6 py-2 rounded-lg font-medium transition ${$===j?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:j.charAt(0).toUpperCase()+j.slice(1)},j))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:D?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin"})}):K.length===0?e.jsx("p",{className:"text-center text-gray-500 py-10",children:D?"Loading voices...":$==="all"?"No supported voices available":`No supported ${$} voices available`}):e.jsx("div",{className:"select-ai-voice-grid-wrap",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:K.map(j=>{const E=W(j.voice_id),O=C===j.voice_id;return e.jsx("div",{onClick:()=>E&&B(j),className:`
                      flex flex-col items-center justify-between p-2 rounded-lg border transition shadow-sm text-sm
                      ${O?"bg-[#EDF4FF] text-black/[1] border-[#6C5DD3]":"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:shadow-md"}
                    
                    `,children:e.jsxs("div",{className:"flex items-center gap-2 w-full min-w-0",children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),E&&ee(j)},disabled:!E,className:`
                          p-1 rounded-full transition text-sm
                          ${O?"bg-white text-[#6C5DD3]":"bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-purple-600"}
                          ${E?"":"opacity-50 cursor-not-allowed"}
                        `,children:ie===j.voice_id?e.jsx(ht,{className:"text-base"}):e.jsx(gt,{className:"text-base"})}),e.jsx("span",{className:`font-medium truncate ${O?"text-black":"text-gray-800 dark:text-gray-200"}`,children:j.name}),e.jsx("div",{className:"ml-1 flex gap-[2px] items-end flex-shrink-0",children:[...Array(5)].map((F,te)=>e.jsx("span",{className:`w-[2px] h-2 bg-[#6C5DD3] rounded ${ie===j.voice_id&&E?"animate-pulse":"opacity-50"}`,style:{animationDelay:`${te*.1}s`}},te))})]})},j.voice_id)})})})}),z&&e.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg w-full max-w-xl relative flex flex-col m-5 md:m-0 shadow-2xl",children:[e.jsx("button",{onClick:()=>B(null),className:"absolute top-3 right-3 text-2xl text-gray-600 hover:text-black dark:text-gray-300 dark:hover:text-white z-10",children:"X"}),e.jsx("div",{className:"p-6 pb-4 border-b border-gray-200 dark:border-gray-700 text-center",children:e.jsx("h2",{className:"text-2xl font-bold text-black dark:text-white",children:"Confirm Voice"})}),e.jsxs("div",{className:"p-8 flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-28 h-28 bg-[#6C5DD3] rounded-full flex items-center justify-center text-white text-5xl font-bold mx-auto mb-6 shadow-lg",children:"ðŸŽ™ï¸"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-2",children:z.name}),e.jsx("p",{className:"text-base text-gray-500 dark:text-gray-400",children:"Ready to apply voice"})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-4",children:[e.jsx("button",{onClick:()=>B(null),className:"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition font-medium",children:"Cancel"}),e.jsx("button",{disabled:X,onClick:async()=>{ne(!0),await new Promise(j=>setTimeout(j,100));try{await U(z,"current")}finally{ne(!1),B(null),V(!1)}},className:"flex-1 px-6 py-3 bg-[#6C5DD3] text-white rounded-lg hover:bg-purple-700 disabled:opacity-60 disabled:cursor-not-allowed transition font-medium flex items-center justify-center gap-3",children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Applying..."]}):"Apply One"}),e.jsx("button",{disabled:X,onClick:async()=>{ne(!0),await new Promise(j=>setTimeout(j,100));try{await U(z,"all")}finally{ne(!1),B(null),V(!1)}},className:"flex-1 px-6 py-3 bg-[#6C5DD3] text-white rounded-lg hover:bg-purple-700 disabled:opacity-60 disabled:cursor-not-allowed transition font-medium flex items-center justify-center gap-3",children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Applying..."]}):"Apply to All"})]})]})})]})]}):null}function _r({show:Y,onClose:V,modalTitle:H,modalMessage:G,showProgress:I}){return Y?e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:V}),e.jsxs("div",{className:"absolute top-20 right-8 bg-white dark:bg-gray-900 w-full max-w-md rounded-2xl shadow-lg p-6 text-center z-50",children:[e.jsx("button",{onClick:V,className:"absolute top-3 right-3 text-2xl text-gray-600 hover:text-black dark:text-gray-300 dark:hover:text-white",children:"âœ•"}),e.jsxs("div",{className:"flex items-start gap-4",children:[I&&e.jsx(sr,{className:"text-black animate-spin text-3xl"}),e.jsxs("div",{className:"text-start",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:H}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:G})]})]}),I&&e.jsx("div",{className:"mt-6 w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-2 bg-[#6C5DD3] rounded-full animate-progress"})})]})]}):null}function kr({loading:Y}){return Y?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-8 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-purple-200 dark:border-purple-900 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-purple-600 rounded-full animate-spin"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"Resetting..."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Please wait while we restore the original template"})]})]})}):null}function Rr(){const Y=ir(),V=nr(),H=lr(),G=vr(),{templateId:I}=H.state,_=pe(t=>t.deal.VideoScenes||[]),ie=pe(t=>t.deal.AiAvatars||[]),ee=pe(t=>t.deal.AiAvatarGroups||[]),U=pe(t=>t.deal.VideoVariables),D=pe(t=>t.deal.deal),{user:$}=pe(t=>t),fe=Object.entries(U).filter(([t,r])=>r.type==="character").map(([t,r])=>({id:t,...r})),[z,B]=c.useState([]),[X,ne]=c.useState(null),[v,C]=c.useState(U),[K,W]=c.useState(!1),[j,E]=c.useState(null),[O,F]=c.useState(!1),[te,le]=c.useState(!1),[he,oe]=c.useState(""),[k,M]=c.useState(""),[J,ce]=c.useState(!1),[R,bt]=c.useState([]),[Ae,de]=c.useState(0),[Nr,Cr]=c.useState(""),[vt,Se]=c.useState({}),[Ze,Ee]=c.useState(!1),[yt,we]=c.useState(null),[Le,Be]=c.useState(0),wt=150,je=5,_e=pe(t=>t.deal.AiVoices||[]),[Qe,Ve]=c.useState({}),[Oe,$e]=c.useState(null),[jt,We]=c.useState(!1),[et,ke]=c.useState({}),[ge,ue]=c.useState(null),[P,be]=c.useState(null),[ze,Ie]=c.useState([]),[De,tt]=c.useState(!1),[_t,rt]=c.useState(),[Ar,kt]=c.useState({}),Nt=t=>{F(!0),We(!0),E(t),setTimeout(()=>{F(!1)},1e3)},Ct=c.useCallback(async(t,r="current")=>{if(t!=null&&t.voice_id){if(C(a=>{const n=xe.cloneDeep(a);if(r==="current"&&j){const i=j.match(/scene_(\d+)_script/);if(i){const s=`voice_id_${i[1]}`;n[s]||(n[s]={name:s,type:"voice",properties:{}}),n[s].properties.voice_id=t.voice_id}}return r==="all"&&Object.keys(n).forEach(i=>{i.startsWith("voice_id_")&&(n[i]||(n[i]={name:i,type:"voice",properties:{}}),n[i].properties.voice_id=t.voice_id)}),n}),r==="current"&&j&&Ve(a=>({...a,[j]:t})),r==="all"){const a={};R.forEach(n=>{n.scripts.forEach(i=>{const l=`${n.id}-${i.name}`;a[l]=t})}),Ve(a)}We(!1),E(null)}},[j,R]),At=["PUBLIC_PHOTO","PUBLIC","COMMUNITY_PHOTO"],St=ee.filter(t=>{var r;return At.includes((r=t.group_type)==null?void 0:r.trim().toUpperCase())}),Et=async(t,r)=>{try{let a=[];return{cleanedVariables:Object.fromEntries(Object.entries(r).filter(([i,l])=>{var S,N,g,u;const s=(S=l==null?void 0:l.properties)==null?void 0:S.content,o=((N=l==null?void 0:l.properties)==null?void 0:N.url)||_t,p=(g=l==null?void 0:l.properties)==null?void 0:g.character_id,f=(u=l==null?void 0:l.properties)==null?void 0:u.voice_id,h=p!=null&&String(p).trim()!==""&&String(p)!=="undefined",d=typeof s=="string"&&s.trim()!=="",m=o&&String(o).trim()!=="",x=f&&String(f).trim()!=="",y=d||m||h||x;return y||a.push(i),y})),emptyKeys:a}}catch(a){return console.error("API error:",a),{cleanedVariables:{},emptyKeys:[]}}},Vt=async(t,r,a)=>{var n;try{await ye({template_id:I,user_id:(n=$.user)==null?void 0:n.id,deal_id:D.id,variables:{...a,[t]:{...a[t],properties:{...a[t].properties,content:r}}}})}catch(i){console.error("Error saving to API",i)}};c.useEffect(()=>{ge||be(null)},[ge]);const Ge=(t="")=>t.trim()===""?0:t.trim().split(/\s+/).length,$t=async()=>{var t,r;try{if(Object.values(Fe).some(h=>h)){M("Word limit exceeded"),oe("Please reduce words before generating the video."),W(!0);return}const{cleanedVariables:n,emptyKeys:i}=await Et(I,v);if(i.length>0){M("Missing Fields"),oe("Some fields are still missing:"),ce(!1),W(!0);return}if(!n||Object.keys(n).length===0){M("No Variables"),oe("All fields are empty. Please fill them before generating."),ce(!1),W(!0);return}M("Generatingâ€¦"),oe(""),ce(!0),W(!0);const l=await fetch(`https://api.heygen.com/v2/template/${I}/generate`,{method:"POST",headers:{"Content-Type":"application/json","X-API-KEY":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V"},body:JSON.stringify({test:!0,variables:n,dimension:{width:1280,height:720}})});if(!l.ok)throw new Error("Failed to generate video");const s=await l.json(),o=await cr({user_id:(t=$.user)==null?void 0:t.id});console.log("Minus Count Response:",o);const p=await dr({deal:D.id,ai_video_id:(r=s==null?void 0:s.data)==null?void 0:r.video_id}),f=await G();if(console.log("User after minus count:",f),p!=null&&p.status)sessionStorage.setItem(`video_generated_${D.id}`,"true"),Y(`/deals/deal-view/${D.id}`);else throw new Error("Failed to save generated video")}catch(a){console.error("Error during video generation:",a),ce(!1),M("Error"),oe("There is some error please contact admin or try again in some time"),W(!0)}};c.useEffect(()=>{_&&_.length>0&&bt(_)},[_]);const zt=async()=>{var t,r,a,n,i;if(I){le(!0);try{const l={template_id:I,user_id:(t=$.user)==null?void 0:t.id,deal_id:D.id};await ur(l,I);const s=await pr({template_id:I,user_id:(r=$.user)==null?void 0:r.id,deal_id:D.id});let o=((a=s==null?void 0:s.data)==null?void 0:a.variables)??((i=(n=s==null?void 0:s.data)==null?void 0:n.data)==null?void 0:i.variables)??(s==null?void 0:s.variables)??{};V(me(o)),C(o);const p={};Object.entries(o).forEach(([h,d])=>{var m;((m=d==null?void 0:d.properties)==null?void 0:m.content)!==void 0&&(p[h]=d.properties.content)}),Se(p);const f=_.map(h=>({id:h.id,scripts:h.variables.filter(d=>d.type==="text"&&d.name.endsWith("_script")).map(d=>{var x,y;const m=((y=(x=o[d.name])==null?void 0:x.properties)==null?void 0:y.content)||"";return{name:d.name,value:m}})}));Ie(f),kt({}),rt(null),Ve({}),at({}),E(null),$e(null),ke({}),ue(null),B([]),be(null),Object.keys(re.current).forEach(h=>{re.current[h]&&clearTimeout(re.current[h])}),re.current={},It.current={},setTimeout(()=>{Object.keys(o).forEach(h=>{var m,x;const d=document.getElementById(h);if(d&&d.contentEditable==="true"){const y=((x=(m=o[h])==null?void 0:m.properties)==null?void 0:x.content)||st(h);d.textContent!==y&&(d.textContent=y)}})},100)}catch(l){console.error("âŒ Reset failed:",l),M("Reset Failed"),oe("Unable to reset. Please try again."),W(!0)}finally{le(!1)}}};c.useEffect(()=>{const t={};Object.entries(v).forEach(([r,a])=>{var n;((n=a==null?void 0:a.properties)==null?void 0:n.content)!==void 0&&(t[r]=a.properties.content)}),Se(t)},[v]),c.useEffect(()=>{console.log("videoVariables state updated (local):",v),console.log("Redux VideoVariables (from selector):",U)},[v,U]),c.useEffect(()=>{if(_&&_.length>0){const t=_.map(r=>{const a=r.variables.filter(n=>n.type==="text"&&n.name.endsWith("_script")).map(n=>{var i,l;return{name:n.name,value:((l=(i=v[n.name])==null?void 0:i.properties)==null?void 0:l.content)||""}});return{id:r.id,scripts:a}});Ie(t)}},[_]);const It=c.useRef({}),re=c.useRef({}),[Fe,at]=c.useState({}),Re=40,Ue=c.useRef(new Map),Dt=(t,r,a)=>{const i=Ge(a)>Re;if(Ie(l=>l.map(s=>s.id===t?{...s,scripts:s.scripts.map(o=>o.name===r?{...o,value:a}:o)}:s)),at(l=>({...l,[r]:i?`Maximum ${Re} words allowed`:""})),i){re.current[r]&&clearTimeout(re.current[r]);return}Ue.current.set(r,a),re.current[r]&&clearTimeout(re.current[r]),re.current[r]=setTimeout(()=>{var o;const l=Ue.current.get(r)||a,s=xe.cloneDeep(v);s[r]||(s[r]={name:r,type:"text",properties:{}}),s[r].properties.content=l,C(s),V(me(s)),ye({template_id:I,user_id:(o=$.user)==null?void 0:o.id,deal_id:D.id,variables:s}).catch(console.error)},800)};c.useEffect(()=>()=>{Ue.current.clear()},[]),c.useEffect(()=>{if(v&&Object.keys(v).length>0){const t={};Object.entries(v).forEach(([r,a])=>{var n;(n=a==null?void 0:a.properties)!=null&&n.content&&(t[r]=a.properties.content)}),Object.keys(t).length>0&&Se(r=>({...t,...r}))}},[v]);function Ft(t){const r=t.name,{name:a,type:n}=t||{};if(!a||!n||!a.includes("__")||a.endsWith("_script"))return null;const i=a.split("__").filter(Boolean),l=i[0],s=i.slice(1);let o=null,p=null,f=null,h={},d=[];const m=[];let x=null,y=!1,S=!1,N=!1;for(const g of s)if(g==="FI")o="1 / -1",p="1 / -1",f="FI";else if(g.startsWith("P_")){const u=g.split("_");if(u.length===5){const w=+u[1],b=+u[2],A=+u[3],T=+u[4];[w,b,A,T].every(Number.isFinite)&&(o=`${w} / ${A+1}`,p=`${b} / ${T+1}`,f=`${w}-${b}-${A}-${T}`)}}else if(g.startsWith("BG_")){const u=g.replace("BG_","").trim();/^[0-9a-fA-F]{6}$/.test(u)&&(h.background=`#${u}`)}else if(g.startsWith("JL"))h.justifyContent="left";else if(g.startsWith("JR"))h.justifyContent="right";else if(g.startsWith("JC"))h.justifyContent="center";else if(g.startsWith("FR_C"))d.push("circle-frame");else if(g.startsWith("PD_")){const u=g.split("_");if(u.length===5){const w=+u[1],b=+u[2],A=+u[3],T=+u[4];[w,b,A,T].every(Number.isFinite)&&(h.padding=`${w}px ${T}px ${A}px ${b}px`)}}else if(g.startsWith("Z_")){const u=+g.split("_")[1];Number.isFinite(u)&&(h.zIndex=u)}else if(g.startsWith("AL_")||g.startsWith("BL_")){const u=g.split("_");if(u.length===5){const w=+u[1],b=+u[2],A=+u[3],T=+u[4];[w,b,A,T].every(Number.isFinite)&&m.push({kind:g.startsWith("AL_")?"AL":"BL",sc:w,sr:b,ec:A,er:T,gridCol:`${w} / ${A+1}`,gridRow:`${b} / ${T+1}`,raw:g})}}else if(g.startsWith("F_")){const u=g.split("_");if(u.length>=2){const w=+u[1];Number.isFinite(w)&&(x=w);const b=u[2]||"";y=b.includes("B"),S=b.includes("I"),N=b.includes("U")}}return!o&&m.length===0?null:{id:l,type:n,gridCol:o,gridRow:p,key:f,elStyle:h,classes:d,lines:m,sceneId:r,fontSize:x,bold:y,italic:S,underline:N}}function Rt(t){const r=(t||"").toLowerCase();return r.startsWith("header")?"header":r.startsWith("subtitle")?"subtitle":r.startsWith("title")?"title":r.startsWith("callout")?"callout":""}function st(t){if(!t)return"Enter text...";let r=t;return r.includes("__")&&(r=r.split("__")[0]),r=r.replace(/_P_\d+_\d+_\d+_\d+.*$/,""),r=r.replace(/_FI.*$/,""),r=r.replace(/_BG_[a-fA-F0-9]+.*$/,""),r=r.replace(/_FR_C.*$/,""),r=r.replace(/_PD_\d+_\d+_\d+_\d+.*$/,""),r=r.replace(/_Z_\d+.*$/,""),r=r.replace(/_AL_\d+_\d+_\d+_\d+.*$/,""),r=r.replace(/_BL_\d+_\d+_\d+_\d+.*$/,""),r||t}const Te=new Map,Ne=new Map,Tt=async(t,r)=>{if(Te.has(t))return Te.get(t);if(Ne.has(t))return Ne.get(t);r(a=>({...a,[t]:!0}));try{const a=fetch(`https://api.heygen.com/v2/avatar/${t}/details`,{method:"GET",headers:{"X-API-KEY":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V","Content-Type":"application/json"}}).then(i=>{if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return i.json()});Ne.set(t,a);const n=await a;return Te.set(t,n),Ne.delete(t),n}catch(a){return console.error("Error fetching avatar details:",a),Ne.delete(t),null}finally{r(a=>({...a,[t]:!1}))}},[Me,Mt]=c.useState({}),[Pt,Lt]=c.useState({}),Xe=c.useRef(new Set),He=c.useRef(!0);c.useEffect(()=>()=>{He.current=!1},[]);const it=c.useMemo(()=>{const t=new Set;return _.forEach(r=>{var n,i;const a=r.variables.find(l=>l.type==="character");if(a){const l=(i=(n=v[a.name])==null?void 0:n.properties)==null?void 0:i.character_id;l&&t.add(l)}}),Array.from(t)},[_,v]);c.useEffect(()=>{it.forEach(t=>{!Te.has(t)&&!Me[t]&&!Xe.current.has(t)&&(Xe.current.add(t),Tt(t,Lt).then(r=>{He.current&&r&&Mt(a=>({...a,[t]:r}))}).catch(r=>{He.current&&(console.error("Failed to fetch avatar details:",r),Xe.current.delete(t))}))})},[it]);function Bt({sceneId:t,elStyle:r,classes:a,videoVariables:n,setVideoVariables:i,dispatch:l,isThumbnail:s}){var y,S,N,g;const o=c.useRef(null),[p,f]=c.useState({}),h=/^cc_bgimg\d+_cc__FI__Z_0$/.test(t),d="https://investier.visionvivante.in/storage/deal_images/GJO5G81JE5jkAtseXrJjUyphnBjEc3QvTOj2bwVO.jpg?text="+encodeURIComponent(t),m=p[t]||((S=(y=n[t])==null?void 0:y.properties)==null?void 0:S.url)||((g=(N=n[t])==null?void 0:N.properties)==null?void 0:g.image)||d,x=async(u,w,b)=>{var A;try{await ye({template_id:I,user_id:(A=$.user)==null?void 0:A.id,deal_id:D.id,variables:{...w,[u]:{...w[u],properties:{...w[u].properties,url:b}}}})}catch(T){console.error("Error saving image",T)}};return e.jsxs("div",{className:"sceneblock",style:{padding:r==null?void 0:r.padding,zIndex:r==null?void 0:r.zIndex},children:[e.jsx("div",{className:`image ${a!=null&&a.includes("circle-frame")?"circle-frame":""}`,onClick:()=>{var u;!s&&!h&&((u=o.current)==null||u.click())},style:{cursor:s?"default":"pointer"},children:e.jsx("img",{alt:t,src:m,className:a!=null&&a.includes("circle-frame")?"circle-frame":""})}),!s&&!h&&e.jsx("input",{type:"file",accept:"image/*",ref:o,style:{display:"none"},onChange:async u=>{const w=u.target.files[0];if(!w)return;const b=new FormData;b.append("image",w);let A;try{A=await gr(b)}catch(ve){console.log(ve)}const T=new FileReader;T.onload=ve=>{ve.target.result;const L=xe.cloneDeep(n);L[t]||(L[t]={properties:{}}),L[t].properties.url=A.data.url,i(L),l(me(L)),f(ae=>({...ae,[t]:A.data.url})),rt(A.data.url),x(t,L,A.data.url)},T.readAsDataURL(w)}})]},t)}function Ot(t,r=!1){var u,w,b,A,T,ve;const{id:a,type:n,elStyle:i={},classes:l=[],sceneId:s,fontSize:o,bold:p,italic:f,underline:h}=t;if(n==="image")return i.background?e.jsx("div",{className:"sceneblock",style:{padding:i.padding,zIndex:i.zIndex},children:e.jsx("div",{className:"image",style:{background:i.background}})},a):e.jsx(Bt,{sceneId:s,elStyle:i,classes:l,videoVariables:v,setVideoVariables:C,dispatch:V,templateId:I,user:$,deal:D},a);if(n==="character"){const L=_.find(Z=>Z.id===s),ae=L==null?void 0:L.variables.find(Z=>Z.type==="character"),se=(ae==null?void 0:ae.name)||s,q=(w=(u=v[se])==null?void 0:u.properties)==null?void 0:w.character_id,Ce=(A=(b=v[se])==null?void 0:b.properties)==null?void 0:A.image,Je=ie.find(Z=>Z.avatar_id===q)||ie.find(Z=>{const ft=fe.find(rr=>rr.id===s);return ft&&Z.avatar_id===ft.properties.character_id}),er=Ce||((ve=(T=Me[q])==null?void 0:T.data)==null?void 0:ve.preview_image_url)||(Je==null?void 0:Je.preview_image_url)||`https://investier.visionvivante.in/storage/profile/images/default-avatar.png?text=${encodeURIComponent(a)}`,tr=Pt[q];return e.jsx("div",{className:"sceneblock",style:{padding:i==null?void 0:i.padding,zIndex:i==null?void 0:i.zIndex},children:e.jsx("div",{className:`avatar ${l!=null&&l.includes("circle-frame")?"circle-frame":""}`,children:tr?e.jsx("div",{className:"loading-placeholder",children:"Loading..."}):e.jsx("img",{alt:a,src:er,className:`cursor-pointer ${l!=null&&l.includes("circle-frame")?"circle-frame":""} w-100 h-100 object-cover`,onClick:()=>{we(s),Ee(!0)},onError:Z=>{Z.target.src.includes("default-avatar.png")||(Z.target.src=`https://investier.visionvivante.in/storage/profile/images/default-avatar.png?text=${encodeURIComponent(a)}`)}})})},a)}const[d,m]=c.useState({}),x=L=>{const ae=L.currentTarget.textContent,se=L.currentTarget.id,q=xe.cloneDeep(v);q[se]||(q[se]={properties:{}}),q[se].properties.content=ae,C(q),V(me(q)),Se(Ce=>({...Ce,[se]:ae})),Vt(se,ae,q),m(Ce=>({...Ce,[se]:!0}))},y=["cc_titleplaceholder","cc_hero_cc","cc_img","cc_ds_name_cc","cc_phone_cc","cc_email_cc"],S=/^cc_plh\d+_cc/.test(s),N=!r&&(S||y.some(L=>s.startsWith(L))||!s.startsWith("cc_")),g=r&&o?o*.5:o;return e.jsx("div",{contentEditable:N,suppressContentEditableWarning:!0,id:s,className:`text ${Rt(s)} ${r?"thumbnail-text":""}`,style:{...i,fontSize:g?`${g}px`:void 0,fontWeight:p?"bold":"normal",fontStyle:f?"italic":"normal",textDecoration:h?"underline":"none",cursor:N?"text":"not-allowed"},onFocus:()=>{N&&m(L=>({...L,[s]:!0}))},onBlur:x,children:vt[s]||st(s)},s)}function nt(t){const r=t.match(/__VP_(\d+)$/);return r?parseInt(r[1],10):1/0}function lt({scene:t,index:r,isThumbnail:a=!1}){const n=c.useMemo(()=>(t.variables||[]).map(Ft).filter(Boolean),[t]),i=c.useMemo(()=>{const l=new Map;for(const s of n)s.key&&(l.has(s.key)||l.set(s.key,[]),l.get(s.key).push(s));for(const[s,o]of l.entries())o.sort((p,f)=>{const h=nt(p.sceneId),d=nt(f.sceneId);return h-d});return l},[n]);return e.jsxs("div",{className:"scene-root",children:[!a&&e.jsxs("div",{className:"scene-badge",children:["Scene ",r+1]}),e.jsxs("div",{className:"grid",children:[[...i.entries()].map(([l,s])=>e.jsx("div",{className:"area-wrapper",style:{gridColumn:s[0].gridCol,gridRow:s[0].gridRow},children:s.map(o=>Ot(o,!1))},l)),n.flatMap(l=>(l.lines||[]).map((s,o)=>{const p=s.sc===s.ec,f=s.sr===s.er,h={gridColumn:s.gridCol,gridRow:s.gridRow,display:"flex",width:"100%",height:"100%",boxSizing:"border-box",pointerEvents:"none",zIndex:30};return p?e.jsx("div",{className:"line-wrapper",style:{...h,justifyContent:s.kind==="BL"?"flex-start":"flex-end",alignItems:"stretch"},children:e.jsx("div",{style:{width:2,height:"100%",background:s.kind==="AL"?"#0b1220":"#6b7280",opacity:s.kind==="AL"?1:.9}})},`${s.raw}-${o}`):f?e.jsx("div",{className:"line-wrapper",style:{...h,alignItems:s.kind==="BL"?"flex-start":"flex-end",justifyContent:"stretch"},children:e.jsx("div",{style:{height:3,width:"100%",background:s.kind==="AL"?"#0b1220":"transparent",borderTop:s.kind==="BL"?"2px dashed #6b7280":void 0}})},`${s.raw}-${o}`):e.jsx("div",{className:"line-wrapper",style:{...h,alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{height:2,width:"100%",background:"#0b1220"}})},`${s.raw}-${o}`)}))]})]})}c.useEffect(()=>{const t=r=>{R.length&&(r.key==="ArrowLeft"&&de(a=>(a-1+R.length)%R.length),r.key==="ArrowRight"&&de(a=>(a+1)%R.length))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[R.length]);const[Wt,Gt]=c.useState([]),[Ut,Xt]=c.useState(new Set),[Ht,ot]=c.useState(!0);c.useEffect(()=>{(async()=>{var r,a;try{ot(!0);const n=await mr(),i=((r=n==null?void 0:n.data)==null?void 0:r.data)||[];console.log("Custom Voices Response:",n),console.log("Custom Voices List:",i);const l=i.filter(f=>f.active===1||f.active==="1").map(f=>({voice_id:f.Voice_id||f.voice_id,name:f.Voice_name||f.voice_name||"Unnamed Voice",gender:f.Female==="x"||f.female==="x"?"female":"male",preview_url:f.preview_url||null,source:"custom"}));Gt(l),V(xr(l));const o=await(await fetch("https://api.heygen.com/v2/voices",{headers:{"Content-Type":"application/json","X-API-KEY":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V"}})).json(),p=new Set((((a=o==null?void 0:o.data)==null?void 0:a.voices)||[]).map(f=>f.voice_id));Xt(p)}catch(n){console.error("Voice load error:",n)}finally{ot(!1)}})()},[V]);const Pe=c.useRef(null),ct=t=>{if(Oe===t.voice_id){Pe.current.pause(),$e(null);return}Pe.current&&Pe.current.pause();const r=new Audio(t.preview_audio);Pe.current=r,r.play(),$e(t.voice_id),r.onended=()=>$e(null)};c.useEffect(()=>{const t={};ze.forEach(r=>{r.scripts.forEach(a=>{const n=`${r.id}-${a.name}`;!Qe[n]&&_e.length>0&&(t[n]=_e[0])})}),Object.keys(t).length>0&&Ve(r=>({...r,...t}))},[ze,_e]);const Kt=(t,r)=>{ke(a=>({...a,[t]:!a[t]})),E(r),ue(null)},dt=t=>{ue(r=>r===t?null:t),ke({})},Ke=c.useRef(null),ut=c.useRef({});c.useEffect(()=>{function t(r){const a=document.querySelectorAll("[data-avatar-button]"),n=Array.from(a).some(p=>p.contains(r.target)),i=document.querySelectorAll("[data-voice-button]"),l=Array.from(i).some(p=>p.contains(r.target));n||l||Ke.current&&Ke.current.contains(r.target)||Object.values(ut.current).some(p=>p&&p.contains(r.target))||r.target.closest(".right, .slider, .thumbnail-slider")||(ke({}),ue(null))}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const Yt=async(t,r=null)=>{var l,s;const a=r||ge;if(!a){console.error("No scene to update");return}const n=_.find(o=>o.id===a),i=n==null?void 0:n.variables.find(o=>o.type==="character");if(i){const o=xe.cloneDeep(v);o[i.name]={...o[i.name],properties:{...(l=o[i.name])==null?void 0:l.properties,character_id:t.avatar_id||t.id,image:t.image_url||t.preview_image_url}},C(o),V(me(o));try{await ye({template_id:I,user_id:(s=$.user)==null?void 0:s.id,deal_id:D.id,variables:o})}catch(p){console.error("Error saving avatar",p)}}},Jt=t=>{if(!(t>=Le&&t<Le+je)){const a=Math.max(0,t-Math.floor(je/2)),n=Math.max(0,R.length-je),i=Math.min(a,n);Be(i)}};c.useEffect(()=>{Jt(Ae)},[Ae,je,R.length]),c.useEffect(()=>{console.log("videoVariables updated",v)},[v]);const qt=async t=>{try{const a=await(await fetch("https://api.heygen.com/v2/avatar_group.list?include_public=true",{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V"}})).json();V(fr(a.data.avatar_group_list))}catch(r){console.error("API error:",r)}finally{}};c.useEffect(()=>{qt()},[]);const[Sr,pt]=c.useState(!1),[Er,mt]=c.useState(null),Zt=async t=>{var r;try{pt(!0),mt(null);const a=await fetch(`https://api.heygen.com/v2/avatar_group/${t}/avatars`,{method:"GET",headers:{"X-Api-Key":"sk_V2_hgu_kFHRWykcXEd_oisfR7mnYitgiX8vwtraF2NoDtg3J73V"}});if(!a.ok)throw new Error(`API call failed: ${a.status}`);const i=((r=(await a.json()).data)==null?void 0:r.avatar_list)||[];B(i)}catch(a){console.error("Error fetching avatar group:",a),mt(a.message)}finally{pt(!1)}},xt=async()=>{var t,r;try{F(!0);const a={userId:(t=$.user)==null?void 0:t.id,dealId:D.id},i=(r=(await hr(a)).data)==null?void 0:r.data;if(!i)return;Ie(l=>l.map(s=>{const o=s.scripts.map(p=>({...p,value:i[p.name]||p.value}));return{...s,scripts:o}}))}catch(a){console.error("Error fetching scripts:",a)}finally{F(!1)}},[Ye,Qt]=c.useState([]);return c.useEffect(()=>{if(ge){const t=["PUBLIC_PHOTO","PUBLIC","COMMUNITY_PHOTO"],a=ee.filter(n=>{var i;return t.includes((i=n.group_type)==null?void 0:i.trim().toUpperCase())}).sort(()=>Math.random()-.5).slice(0,4);Qt(a)}},[ge,ee]),e.jsxs(e.Fragment,{children:[e.jsx(kr,{loading:te}),e.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-[#121212] text-white px-4 py-3 shadow-md rounded-lg mb-1 container mx-auto hide-in-landscape",children:[e.jsxs("button",{onClick:()=>Y("/deal-view-ai-video-generator"),className:"flex items-center gap-2 text-lg font-semibold text-black dark:text-white  transition",children:[e.jsx(br,{className:"text-xl"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-around gap-3 md:gap-8 relative",children:[e.jsx(or,{}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-5 py-3 rounded-xl transition",onClick:zt,children:"Reset"}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-5 py-3 rounded-xl transition",onClick:$t,children:"Generate"}),e.jsx(_r,{show:K,onClose:()=>W(!1),modalTitle:k,modalMessage:he,showProgress:J})]})]}),e.jsxs("div",{className:"app-root",children:[e.jsx("style",{children:`
            :root{
          --slide-radius: 18px;
          --gap: 10px;
          --card-bg: #ffffff;
          --app-bg: #0f1220;
          --shadow: 0 10px 30px rgba(0,0,0,.35);
          --text-soft:#6b7280;
          --text-strong:#111827;
        }
        .app-root{ min-height:60vh;  align-items:center; justify-content:center; padding:24px; box-sizing:border-box; background: #FDFDFD; }
       
        .dark .app-root{
        background:#121212
        }
          font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
          color:var(--text-strong);
        }
           .app-root {
          var(--app-bg);
          font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
          color:var(--text-strong);
          }
        .layout{ width:100%; max-width:1200px; display:flex; background-color:#FDFDFD }
        textarea{ width: 100%; }
        // .left{ color:#fff; width: 100%; min-width: 400px; background:white; box-shadow: var(--shadow); border-radius:15px; }
          .left{ color:#fff; width: 100%; min-width: 400px;}
        .right{ flex:1; display:flex; align-items:center; justify-content:center; }
        .slider{ position:relative; width: min(92vw, 700px); aspect-ratio: 12 / 6; background: var(--card-bg); border-radius: var(--slide-radius); overflow:hidden; margin: auto; }
        .scene-root{height:100% ; background: #F3F3F3; }
        .slide{ position:absolute; inset:0; opacity:0; pointer-events:none; transition: opacity .45s ease;  box-sizing:border-box; }
        .slide.active{ opacity:1; pointer-events:auto; }
        .grid{ display:grid; grid-template-columns: repeat(12, 1fr); grid-template-rows: repeat(6, 1fr);  width:100%; height:100%; }
        .area-wrapper{ display:grid; grid-auto-rows: 1fr; width:100%; height:100%; border-radius: 12px; overflow:hidden; position:relative; }
        .sceneblock{ display:flex; align-items:center; justify-content:center; width:100%; height:100%; box-sizing:border-box; position:relative; margin:4px; max-width: 100%; max-height: 100%; overflow: hidden; text-align: center; z-index: 9; }
        .text{ padding: 12px 14px; color: var(--text-strong); width: calc(100% - 4px); height: calc(100% - 4px); margin: 2px; display:flex; align-items:center; justify-content:center; text-align:center; font-size: 14px; line-height: 1.4; color: #222; word-wrap: break-word; word-break: break-word; white-space: normal; overflow: hidden; text-overflow: ellipsis; max-width: 100%; max-height: 100%; }
        .text:focus { outline: none; border: none;}
        .text.header{ font-weight: 800; font-size: clamp(16px, 2vw, 22px); }
        .text.subtitle{ font-weight: 600; font-size: clamp(14px, 1.6vw, 18px); color: var(--text-soft); }
        .text.title{ font-weight: 700; font-size: clamp(15px, 1.8vw, 20px); }
        .text.callout{ font-weight: 700; font-size: clamp(14px, 1.6vw, 18px); border-color:#ffe6b3; }
        .image{ width:100%; height:100%; overflow:hidden; border-radius: 12px; }
        .image > img{ width:100%; height:100%; object-fit: cover; display:block; }
        .avatar{ width: 100%; display: contents; }
        .avatar img{ height: 100%; }
        .circle-frame, .circle-frame > img{ border-radius: 50% !important; width: 100%; height: 100%; object-position: top; background-color: #fff; object-fit: cover; }
       .nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 30px;
    height: 30px;
    border: none;
    border-radius: 50%;
    background: rgba(0, 0, 0, .55);
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    z-index: 20;
}
        .nav.prev{ left:14px; }
        .nav.next{ right:14px; }
        .scene-badge{ position:absolute; right:16px; top:14px; background: rgba(17,24,39,.75); color:#fff; font-size:12px; padding:6px 10px; border-radius:999px; z-index: 20; }
        .line-wrapper { display:flex; align-items:center; justify-content:stretch; pointer-events:none; z-index:20; }
        .error{ color:#fecaca; background:#7f1d1d; border:1px solid #fecaca33; padding:8px 10px; margin:8px 0; border-radius:8px; font-size:12px; }
        .controls{ display:flex; gap:8px; align-items:center; margin-top:8px; }
        .btn{ background:#111827; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; box-shadow: 0 6px 16px rgba(0,0,0,.25); }
        .btn:active{ transform: translateY(1px); }
        textarea{color:#000}
        .thumbnail .avatar img { pointer-events: none; cursor: default; }
 .thumbnail .image,
.thumbnail .image img {
  pointer-events: none;
  cursor: default;
}
  /* Add these new rules to your existing CSS */
.thumbnail .text {
  padding: 6px 7px;
  font-size: 7px;
  line-height: 1.2;
}

.thumbnail .text.header {
  font-size: clamp(8px, 1vw, 11px);
}

.thumbnail .text.subtitle {
  font-size: clamp(7px, 0.8vw, 9px);
}

.thumbnail .text.title {
  font-size: clamp(7.5px, 0.9vw, 10px);
}

.thumbnail .text.callout {
  font-size: clamp(7px, 0.8vw, 9px);
}

.thumbnail .sceneblock {
  margin: 2px;
}
  @media (max-width: 768px) {
    .layout {
      flex-direction: column;
    }
    .left {
      min-width: 100%;
      margin-bottom: 20px;
    }
    .right {
      width: 100%;
      margin-top: 20px;
    }
  } 
    @media(max-width:579px){
    .app-root {
    padding: 94px}
    }
     @media(max-width:768px){
    .app-root {
    padding: 94px}
    }

    @media (orientation: landscape) and (max-width:579px) {
  .hide-in-landscape {
    display: none;
  }


}
  @media (max-width: 820px) {
  .app-root {
   padding: 147px 24px;
  }

  @media (max-width: 768px) {
  .scene-root {
    font-size: 13px;
  }

}

 @media (max-width:579px) {
  .scene-root {
    font-size: 7px;
  }

  .scene-badge {
    font-size: 7px;
    padding: 4px 8px;
  }

  .slider .text {
  padding: 6px 7px;
  font-size: 7px;
  line-height: 1.2;
}
}


@media (max-width: 768px) {
  /* General text inside the main scene */
  .slider .text {
    font-size: 10px;
    line-height: 1.3;
    padding: 8px 10px;
  }


  .slider .text.header {
    font-size: clamp(11px, 2vw, 14px);
  }

  .slider .text.subtitle {
    font-size: clamp(10px, 1.8vw, 13px);
  }

  .slider .text.title {
    font-size: clamp(10.5px, 1.9vw, 13.5px);
  }

  .slider .text.callout {
    font-size: clamp(10px, 1.8vw, 12.5px);
  }

  .scene-badge {
    font-size: 10px;
    padding: 4px 8px;
  }
}


@media (max-width: 579px) {
  .slider .text {
    font-size: 8.5px;
    line-height: 1.3;
  }

  .slider .text.header {
    font-size: clamp(9px, 2.2vw, 12px);
  }

  .slider .text.subtitle,
  .slider .text.title,
  .slider .text.callout {
    font-size: clamp(8px, 2vw, 11px);
  }

  .scene-badge {
    font-size: 8px;
  }
}


      `}),e.jsxs("div",{className:"layout container mx-auto",children:[e.jsx("button",{onClick:()=>tt(!De),className:"lg:hidden fixed bottom-6 right-6 z-50 bg-[#6C5DD3] text-white p-3 px-5 rounded-md shadow-lg hover:bg-[#5a4bc4] transition-all duration-200","aria-label":"Toggle Script Panel",children:De?e.jsx(yr,{className:"w-6 h-6"}):"Scripts"}),e.jsxs("div",{className:`
        lg:hidden fixed inset-x-0 bottom-0 w-full h-full max-h-[85vh]
        bg-white dark:bg-gray-900 rounded-t-3xl shadow-2xl z-40 overflow-y-auto
        transform transition-transform duration-300 ease-in-out
        ${De?"translate-y-0":"translate-y-full"}
      `,children:[e.jsx("div",{className:"sticky top-0 pt-4 pb-3 flex justify-center bg-inherit z-10",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"p-4 pb-24",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-black font-semibold text-lg",children:"Script"}),e.jsx("button",{onClick:xt,disabled:O,className:`bg-[#6C5DD3] text-white px-5 py-3 rounded-xl transition flex items-center gap-2 ${O?"opacity-70 cursor-not-allowed":"hover:bg-[#5a4bc4]"}`,children:O?"Generating...":"Generate Scripts"})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"62vh"},children:ze.map((t,r)=>e.jsx("div",{className:"mb-6 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm bg-white dark:bg-gray-800",children:t.scripts.map(a=>{const n=`${t.id}-${a.name}`;return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-3 items-start flex-col",children:[(()=>{var f,h,d,m;const i=_.find(x=>x.id===t.id),l=i==null?void 0:i.variables.find(x=>x.type==="character");if(!l)return null;const s=v[l.name],o=(f=s==null?void 0:s.properties)==null?void 0:f.character_id,p=((d=(h=Me[o])==null?void 0:h.data)==null?void 0:d.preview_image_url)||((m=ie.find(x=>x.avatar_id===o))==null?void 0:m.preview_image_url)||Q;return e.jsxs("button",{onClick:()=>dt(t.id),className:"flex items-center gap-2 px-3 py-2 border rounded-lg hover:shadow-md transition",children:[e.jsx("img",{src:p,alt:"Avatar",className:"w-8 h-8 rounded-full object-cover"}),e.jsx(qe,{className:"text-sm"})]})})(),e.jsx("div",{className:"flex-1 space-y-3 w-full"})]})},n)})},t.id))})]})]}),e.jsx("div",{className:`
  hidden lg:block lg:relative h-full lg:w-auto w-full left fixed
  bg-white dark:bg-[#121212] z-40
  overflow-y-auto
`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"text-black dark:text-[#F8F8F8]",children:"Script"}),e.jsx("button",{className:`bg-[#6C5DD3] text-white px-5 py-3 rounded-xl transition flex items-center justify-center gap-2 mb-4 ${O?"opacity-70 cursor-not-allowed":""}`,onClick:xt,disabled:O,children:O?"Generating...":"Generate Scripts"})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"70vh",padding:"10px"},children:ze.map((t,r)=>{var n;return(((n=_[r])==null?void 0:n.variables)||[]).filter(i=>i.type==="character"),e.jsx("div",{onFocus:()=>de(r),className:"mb-6 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm bg-white dark:bg-gray-900 focus-within:ring-2 focus-within:ring-[#6C5DD3] focus-within:outline-none",children:t.scripts.map((i,l)=>{const s=`${t.id}-${i.name}`,o=Qe[s];return et[s],e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 justify-start",children:[(()=>{const p=_.find(d=>d.id===t.id),f=p==null?void 0:p.variables.find(d=>d.type==="character");return f&&v[f.name]?e.jsxs("div",{className:"relative inline-block",children:[e.jsxs("button",{"data-avatar-button":"true",onClick:()=>dt(t.id),className:"flex items-center justify-between px-4 py-2 border border-gray-300 bg-white text-black font-medium rounded-lg shadow-md hover:shadow-lg transition-all duration-200 w-auto",children:[(()=>{var g,u,w;const d=_.find(b=>b.id===t.id),m=d==null?void 0:d.variables.find(b=>b.type==="character");if(!m)return e.jsx("span",{className:"text-sm",children:"No Character"});const x=v[m.name],y=(g=x==null?void 0:x.properties)==null?void 0:g.character_id,S=ie.find(b=>b.avatar_id===y),N=((w=(u=Me[y])==null?void 0:u.data)==null?void 0:w.preview_image_url)||(S==null?void 0:S.preview_image_url)||Q;return e.jsx("img",{src:N,alt:"Avatar",className:"w-6 h-6 rounded-full object-cover",onError:b=>{b.target.src=Q}})})(),e.jsx(qe,{className:"ml-2 text-black flex-shrink-0"})]}),ge===t.id&&e.jsxs("div",{ref:Ke,className:"absolute left-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:z&&z.length>0?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>{P?be(null):B([])},className:"flex items-center gap-1 text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors duration-200",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]})}):e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Select Avatar"})}),e.jsx("div",{className:"flex items-center justify-center my-4",children:e.jsx("div",{className:`flex justify-center gap-3 ${z&&z.length>0&&!P?"overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent":""}`,children:z&&z.length>0&&P?e.jsxs("div",{className:"flex flex-col items-center justify-center w-full px-4",children:[e.jsx("div",{className:"relative w-24 h-24 rounded-full overflow-hidden border-2 border-purple-500 ring-2 ring-purple-200",children:e.jsx("img",{src:P.preview_image_url??P.image_url??P.image,alt:"Selected avatar",className:"w-full h-full object-cover",onError:d=>d.currentTarget.src=Q})}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:P.name||P.avatar_name||`Avatar ${P.avatar_id??P.id}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Ready to apply"})]})]}):z&&z.length>0?z.map((d,m)=>{const x=_.find(N=>N.id===t.id);if(!(x==null?void 0:x.variables.find(N=>N.type==="character")))return null;const S=(d==null?void 0:d.image_url)||(d==null?void 0:d.preview_image_url);return e.jsx("div",{className:"flex flex-col items-center flex-shrink-0",children:e.jsx("button",{onClick:()=>{be(d)},className:"relative w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200 hover:border-purple-300 hover:ring-2 hover:ring-purple-100 transition-all duration-200 flex-shrink-0",children:S?e.jsx("img",{src:S,alt:`Avatar ${m+1}`,className:"w-full h-full object-cover",onError:()=>console.error("Failed to load avatar image:",S)}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z",clipRule:"evenodd"})})})})},`modal_${m}`)}):Ye&&Ye.length>0?Ye.map((d,m)=>{var w;const x=_.find(b=>b.id===t.id),y=x==null?void 0:x.variables.find(b=>b.type==="character");if(!y)return null;const S=v[y.name],N=(w=S==null?void 0:S.properties)==null?void 0:w.character_id,g=d.preview_image||d.image,u=N===d.avatar_id;return e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("button",{onClick:async()=>{const b=d.id||d.avatar_id;try{await Zt(b)}catch(A){console.error("Error fetching avatars:",A)}},className:`relative w-16 h-16 rounded-full overflow-hidden border-2 transition-all duration-200 flex-shrink-0 ${u?"border-purple-500 ring-2 ring-purple-200":"border-gray-200 hover:border-purple-300 hover:ring-2 hover:ring-purple-100"}`,children:g?e.jsx("img",{src:g,alt:d.name||`Avatar ${m+1}`,className:"w-full h-full object-cover",onError:()=>console.error("Failed to load avatar image:",g)}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center text-gray-400",children:e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z",clipRule:"evenodd"})})})})},d.avatar_id||d.id||m)}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ‘¤"}),e.jsx("p",{className:"text-sm",children:"No avatars available"})]})})}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-3",children:z&&z.length>0&&P?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{await Yt(P,t.id),ue(null),B([]),be(null)},className:"flex-1 px-4 py-2 text-sm font-medium text-[#6C5DD3] bg-white rounded-md transition-colors duration-200 border border-purple-200 hover:border-purple-300 flex items-center justify-center gap-2",children:"Apply One"}),e.jsx("button",{onClick:async()=>{var x,y;if(!P)return;const d={avatar_id:P.avatar_id??P.id,preview_image_url:P.preview_image_url??P.image_url},m=xe.cloneDeep(v);for(const S of _){const N=S.variables.find(g=>g.type==="character");N&&(m[N.name]={...m[N.name],properties:{...(x=m[N.name])==null?void 0:x.properties,character_id:d.avatar_id,image:d.preview_image_url}})}C(m),V(me(m)),await ye({template_id:I,user_id:(y=$.user)==null?void 0:y.id,deal_id:D.id,variables:m}),ue(null),B([]),be(null)},className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-[#6C5DD3] rounded-md transition-colors duration-200 flex items-center justify-center gap-2",children:"Apply to All"})]}):z&&z.length>0?e.jsx("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 py-2",children:"Select an avatar above to continue"}):e.jsx("button",{onClick:()=>{const d=_.find(x=>x.id===t.id),m=d==null?void 0:d.variables.find(x=>x.type==="character");we(m?m.name:t.id),Ee(!0),ue(null)},className:"w-full px-4 py-2 text-sm font-medium text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md transition-colors duration-200 border border-purple-200 hover:border-purple-300",children:"View All Avatars"})})]})]}):null})(),(()=>{var m,x;const p=s.match(/scene_(\d+)_script/);if(!p)return null;const h=`voice_id_${p[1]}`;return((x=(m=v[h])==null?void 0:m.properties)==null?void 0:x.voice_id)?e.jsxs("div",{className:"relative inline-block w-1/2",children:[e.jsxs("button",{"data-voice-button":"true",onClick:()=>Kt(s,s),className:"flex items-center justify-between px-4 py-2 border dark:border-gray-600 rounded-lg dark:bg-gray-800 shadow-md hover:bg-gray-200 dark:hover:bg-gray-700 transition text-left text-black w-full",children:[e.jsx("span",{className:"truncate max-w-[70%]",children:(()=>{var w,b;const y=s.match(/scene_(\d+)_script/);if(!y)return(o==null?void 0:o.name)||"Select AI Voice";const N=`voice_id_${y[1]}`,g=(b=(w=v[N])==null?void 0:w.properties)==null?void 0:b.voice_id,u=_e.find(A=>A.voice_id===g)||o;return(u==null?void 0:u.name)||"Select AI Voice"})()}),e.jsx(qe,{className:"ml-2 text-gray-500 shrink-0"})]}),et[s]&&o&&e.jsxs("div",{ref:y=>ut.current[s]=y,className:"absolute mt-2 w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg z-50 p-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-around my-1",children:[e.jsx("button",{onClick:()=>ct(o),className:"px-3 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg transition flex items-center justify-center",children:Oe===(o==null?void 0:o.voice_id)?e.jsx(ht,{className:"text-lg text-purple-600"}):e.jsx(gt,{className:"text-lg text-purple-600"})}),e.jsx("span",{className:"text-sm text-center text-black font-medium",children:(()=>{var w,b;const y=s.match(/scene_(\d+)_script/);if(!y)return o==null?void 0:o.name;const N=`voice_id_${y[1]}`,g=(b=(w=v[N])==null?void 0:w.properties)==null?void 0:b.voice_id,u=_e.find(A=>A.voice_id===g)||o;return(u==null?void 0:u.name)||"Select AI Voice"})()})]}),e.jsx("button",{onClick:()=>{Nt(s),ke(y=>({...y,[s]:!1}))},className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition",children:"View All"})]})]}):null})()]}),(()=>{var p;return(p=i.value)!=null&&p.trim().split(/\s+/).filter(Boolean).length,e.jsxs(e.Fragment,{children:[e.jsx("textarea",{rows:4,value:i.value,onFocus:()=>de(r),onChange:f=>Dt(t.id,i.name,f.target.value),placeholder:"Write your script here...",className:`w-full p-3 rounded-lg shadow-sm resize-none focus:outline-none transition
          dark:border-gray-600 dark:bg-gray-800 text-black dark:text-white
          ${Fe[i.name]?"border border-red-500":""}`}),Fe[i.name]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Fe[i.name]}),e.jsxs("p",{className:`text-xs mt-1 ${Ge(i.value)>Re?"text-red-500":"text-gray-400"}`,children:[Ge(i.value)," / ",Re," words"]})]})})()]},s)})},t.id)})})]})}),De&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30",onClick:()=>tt(!1)}),e.jsx("div",{className:"right",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center lg:block",children:e.jsx("div",{className:"w-full px-4 lg:px-0",children:e.jsxs("div",{className:"slider",children:[e.jsx("button",{className:"nav prev",onClick:()=>R.length&&de(t=>(t-1+R.length)%R.length),"aria-label":"Previous",children:"â®"}),e.jsx("button",{className:"nav next",onClick:()=>R.length&&de(t=>(t+1)%R.length),"aria-label":"Next",children:"â¯"}),R.map((t,r)=>e.jsx("div",{className:`slide ${r===Ae?"active":""}`,children:e.jsx(lt,{scene:t,index:r})},t.id||r))]})})}),e.jsx("div",{className:"fixed bottom-20 left-0 right-0 lg:relative lg:bottom-auto lg:left-auto lg:right-auto lg:mt-3 hide-in-landscape",children:e.jsxs("div",{className:"thumbnail-slider flex items-center justify-center relative px-4 lg:px-0 bg-white dark:bg-[#121212] lg:py-0 lg:bg-transparent",children:[e.jsx("button",{className:"thumb-nav prev",onClick:()=>Be(t=>Math.max(t-1,0)),children:"â®"}),e.jsx("div",{className:"thumbnails-wrapper overflow-hidden w-full sm:w-[750px]",children:e.jsx("div",{className:"thumbnails-track flex transition-transform duration-300",style:{transform:`translateX(-${Le*wt}px)`},children:R.map((t,r)=>e.jsx("div",{className:`thumbnail ${r===Ae?"active":""} 
                w-[100px] h-[60px] sm:w-[140px] sm:h-[80px] mr-2`,onClick:a=>{var n;a.stopPropagation(),de(r),(n=document.getElementById(`textarea-${t.id}`))==null||n.scrollIntoView({behavior:"smooth",block:"center"})},children:e.jsx(lt,{scene:t,index:r,isThumbnail:!0})},t.id||r))})}),e.jsx("button",{className:"thumb-nav next",onClick:()=>Be(t=>Math.min(t+1,R.length-je)),children:"â¯"})]})})]})})]}),Ze&&e.jsx(wr,{show:Ze,onClose:()=>{Ee(!1),we(null)},avatars:St,VideoScenes:_,activeBlock:yt,videoVariables:v,onSelect:async(t,r)=>{var i;const a=xe.cloneDeep(v),n=l=>{var h,d;const s=l==null?void 0:l.trim();let o=_.find(m=>m.id===s);if(o||(o=_.find(m=>m.variables.some(x=>x.name===s||x.name.startsWith(s)))),!o){if(console.warn(`[Parent] Scene ${s} not found in VideoScenes`),console.warn("[Parent] Trying to find character variable directly in videoVariables..."),v[s]){a[s]={...a[s],properties:{...(h=a[s])==null?void 0:h.properties,character_id:t.avatar_id,image:t.preview_image_url}};return}console.error("[Parent] Could not find scene or variable for:",s);return}const p=o.variables.find(m=>m.type==="character");if(!p){console.warn(`[Parent] No character variable in scene ${o.id}`);return}const f=p.name;a[f]={...a[f],properties:{...(d=a[f])==null?void 0:d.properties,character_id:t.avatar_id,image:t.preview_image_url}}};r==="ALL"?_.forEach(l=>{l.variables.find(o=>o.type==="character")&&n(l.id)}):r&&n(r),C(a),V(me(a));try{await ye({template_id:I,user_id:(i=$.user)==null?void 0:i.id,deal_id:D.id,variables:a})}catch(l){console.error("[Parent] Error saving avatar to API",l)}Ee(!1),we(null)}}),e.jsx(jr,{isModalOpen:jt,setIsModalOpen:We,voices:Wt,heygenVoiceIds:Ut,loading:Ht,voiceKey:j,videoVariables:v,playingAudioId:Oe,handlePlayAudio:ct,handleVoiceSelect:Ct})]})]})}export{Rr as default};
