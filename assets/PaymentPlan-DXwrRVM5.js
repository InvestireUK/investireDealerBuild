import{m as e,bu as I,bv as V,u as _,v as q,t as B,r as t,W as C,bG as O,z as A,cX as D,bw as N,ch as R,V as X}from"./index-BPP_8qLW.js";import{u as G}from"./useRefreshUser-CJ-DUsZ_.js";const H=({isOpen:l,onClose:c,title:a,children:d})=>l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:c,children:e.jsxs("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] rounded-lg shadow-lg p-6 m-3 max-w-md w-full",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-xl font-semibold dark:text-white text-[#333]",children:a})}),d]})}):null;X("pk_test_51SkhC3RFrqOLQadKtGogmFPAHqpk6OXbj1KBfaSc0lbA1c1nJn2fBLmXmsUs20PM7LFqfaPQJ3EvtEbPZzHqcUqz00iuwxVFYm");const be=()=>{var b,g,y,j,w;const l=I(),c=V(),{user:a,role:d}=_(s=>s.user),{darkMode:i}=_(s=>s.theme);q();const{showSnackbar:n}=B();G();const[J,K]=t.useState(!1),[Q,$]=t.useState(!1),[S,p]=t.useState(!1),[W,Y]=t.useState(null),[Z,T]=t.useState(null),[ee,ae]=t.useState(null),[se,te]=t.useState(null),[re,oe]=t.useState({current:!1,new:!1,confirm:!1}),[f,k]=t.useState([]),[P,m]=t.useState(!1),[x,h]=t.useState(!1),{register:ne,handleSubmit:de,formState:{errors:le},reset:L,setValue:ce}=C({defaultValues:{first_name:(a==null?void 0:a.first_name)||"",last_name:(a==null?void 0:a.last_name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",role:d||"",company_name:(a==null?void 0:a.company_name)||"",registration_number:(a==null?void 0:a.registration_number)||"",company_website:(a==null?void 0:a.company_website)||"",company_email:(a==null?void 0:a.company_email)||"",company_phone:(a==null?void 0:a.company_phone)||""}}),{register:ie,handleSubmit:me,formState:{errors:pe},reset:fe}=C({defaultValues:{current_password:"",new_password:"",confirm_password:""}});t.useEffect(()=>{a&&a.stripe_customer_id&&u(a.stripe_customer_id)},[a,L,d]);const u=async()=>{try{p(!0);const s=await O();s&&k(s==null?void 0:s.default_payment_method)}catch(s){console.error("Error fetching cards:",s),n("Failed to load payment methods","error")}finally{p(!1)}},E=async s=>{if(s.preventDefault(),!l||!c){n("Stripe not loaded yet","error");return}const v=c.getElement(N);if(!v){n("Card element not found","error");return}h(!0);try{const{error:o,paymentMethod:F}=await l.createPaymentMethod({type:"card",card:v});if(o)n(o.message||"Invalid card details","error");else{const M="https://phplaravel-1547671-6035260.cloudwaysapps.com/api/v1",z=localStorage.getItem("token"),xe=await R.put(`${M}/payment-method/update`,{payment_method_id:F.id},{headers:{Authorization:`Bearer ${z}`}});n("Card collected successfully","success"),await u(a.stripe_customer_id),m(!1)}}catch(o){n("Failed to update card","error"),console.error("Full error while updating card:",(o==null?void 0:o.response)||o)}finally{h(!1)}},r=f||null,U=r&&r.card&&r.card.last4;return e.jsxs("div",{className:"min-h-screen my-5",children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:d==="investor"?"":e.jsxs("div",{className:"profile-detail-form-container-main-div",children:[e.jsx("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333]",children:e.jsx("h1",{className:"text-3xl text-black dark:text-white font-semibold",children:"Payment Method"})}),e.jsx("div",{className:"profile-detail-form-container-wrap",children:S?e.jsx(A,{size:20}):U?e.jsx("div",{className:"rounded mb-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"p-7 border rounded-xl",children:[e.jsxs("div",{className:"flex gap-4 ",children:[((b=r.card)==null?void 0:b.brand)&&e.jsx("div",{children:e.jsx("p",{className:"dark:text-white text-black uppercase font-semibold border p-1",children:r.card.brand})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(D,{className:"text-purple-500"}),e.jsx("p",{className:"dark:text-white text-black font-medium",children:((g=r.billing_details)==null?void 0:g.name)||"Card"})]}),e.jsxs("p",{className:"text-gray-400",children:["**** **** **** ",(y=r.card)==null?void 0:y.last4]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Expires ",(j=r.card)==null?void 0:j.exp_month,"/",(w=r.card)==null?void 0:w.exp_year]})]})]}),e.jsx("div",{className:"mt-5 text-center border py-2 px-3 rounded-xl text-sm",children:e.jsx("button",{onClick:()=>m(!0),children:"Add a new payment method"})})]})})}):e.jsx("p",{className:"text-center py-4",children:"No payment methods found."})})]})}),e.jsx(H,{isOpen:P,onClose:()=>m(!1),title:"Update Payment Method",children:e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Card Details"}),e.jsx("div",{className:"p-3 dark:bg-[#15172b] bg-[#ffff] rounded",children:e.jsx(N,{options:{style:{base:{fontSize:"16px",color:i?"#fff":"#000000","::placeholder":{color:i?"#cccccc":"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[e.jsx("button",{type:"button",className:"red-btn",onClick:()=>m(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"purple-btn",disabled:x,children:x?"Updating...":"Update Card"})]})]})})]})};export{be as default};
