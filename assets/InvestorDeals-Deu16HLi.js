import{t as H,r as c,q as J,a6 as K,s as Q,m as s,x as U,ai as W,p as X,ak as Z,al as ee,c4 as se,a9 as te,C as ae,D as re}from"./index-iRB_0ci3.js";import{S as le}from"./SendContactDealModal-Dva2yDbg.js";import{D as ne}from"./DeleteConfirmationModal-BSQMlgow.js";import"./lodash-BLzwDM3w.js";const he=()=>{const I=H(),[u,b]=c.useState([]),[P,oe]=c.useState([]),{showSnackbar:p}=J(),[f,w]=c.useState(!1),[M,j]=c.useState(!1),[S,g]=c.useState(!1),[y,_]=c.useState(null),[T,N]=c.useState(!1),[i,m]=c.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[r,d]=c.useState({per_page:10,page:1,status:"all",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc"}),{data:x,loading:C}=K(te);Q();const v=async()=>{try{j(!0);const e=await se({page:r.page,perPage:r.per_page,status:r.status,year:r.year===""?null:r.year,propertyTypeId:r.propertyTypeId===""?null:r.propertyTypeId,dealTypeId:r.dealTypeId===""?null:r.dealTypeId,sortColumn:r.sortColumn,sortOrder:r.sortOrder});if(e&&e.data){const a=e.data.data.propertyDealShares||[];b(a);const t=e.data.data.page_context;if(t)m({currentPage:parseInt(t==null?void 0:t.page)||1,totalPages:Math.ceil(parseInt((t==null?void 0:t.total_records)||0)/parseInt((t==null?void 0:t.per_page)||10)),from:(parseInt(t.page)-1)*parseInt(t.per_page)+1,to:Math.min(parseInt(t==null?void 0:t.page)*parseInt(t==null?void 0:t.per_page),parseInt((t==null?void 0:t.total_records)||0)),total:parseInt((t==null?void 0:t.total_records)||0),hasMorePages:(t==null?void 0:t.has_more_page)==="true"});else if(e.data.data.total!==void 0){const l=parseInt(e.data.data.total||0),n=parseInt(r.per_page),o=parseInt(r.page);m({currentPage:o,totalPages:Math.ceil(l/n),from:(o-1)*n+1,to:Math.min(o*n,l),total:l,hasMorePages:o*n<l})}else m({currentPage:1,totalPages:1,from:a.length>0?1:0,to:a.length,total:a.length,hasMorePages:!1})}}catch{p("Failed to fetch shared deals. Please try again.","error")}finally{j(!1)}};c.useEffect(()=>{v()},[r]);const F=()=>{w(!1)},h=e=>{const{name:a,value:t}=e.target;d({...r,[a]:t,page:1})},O=e=>{d(a=>({...a,sortColumn:e,sortOrder:a.sortColumn===e&&a.sortOrder==="asc"?"desc":"asc",page:1}))},A=()=>{i.hasMorePages&&d(e=>({...e,page:e.page+1}))},k=()=>{r.page>1&&d(e=>({...e,page:e.page-1}))},L=e=>{e>=1&&e<=i.totalPages&&d(a=>({...a,page:e}))},E=async e=>{const a={user_id:e==null?void 0:e.user_id,property_deal_id:e==null?void 0:e.id};await re(a),I(`/deal-detail/${e.unique_id}`)},$=e=>{switch(e){case 1:return s.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-green-500 text-white",children:"Interested"});case 2:return s.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-red-500 text-white",children:"Not Interested"});default:return s.jsx("span",{className:"px-2 py-1  text-xs  text-white",children:"-"})}},R=e=>{_(e),g(!0)},V=async()=>{if(y)try{N(!0);const e=await ae(y);e&&e.data?(p("Deal deleted successfully","success"),v()):p("Failed to delete deal","error"),g(!1),_(null)}catch(e){console.error("Error deleting deal:",e),p("Failed to delete deal","error")}finally{N(!1)}},Y=e=>{const a=e.property_deal,t=[];a.address_line_1&&t.push(a.address_line_1),a.address_line_2&&t.push(a.address_line_2),a.city&&t.push(a.city),a.post_code&&t.push(a.post_code);const l=t.join(", "),n=120;return l.length>n?l.substring(0,n)+"...":l},D=(x==null?void 0:x.data)||{property_types:[],deal_types:[]},q=new Date().getFullYear(),z=Array.from({length:4},(e,a)=>q-a),B=()=>{const e=i.totalPages,a=i.currentPage;if(e<=5)return Array.from({length:e},(o,G)=>G+1);const t=[1];let l=Math.max(2,a-1),n=Math.min(e-1,a+1);a<=3?n=Math.min(4,e-1):a>=e-2&&(l=Math.max(e-3,2)),l>2&&t.push("...");for(let o=l;o<=n;o++)t.push(o);return n<e-1&&t.push("..."),e>1&&t.push(e),t};return s.jsxs("div",{className:"overflow-x-auto p-4",children:[s.jsx(ne,{isOpen:S,onClose:()=>g(!1),onConfirm:V,title:"Delete Deal",isLoading:T}),s.jsxs("div",{className:"grid lg:grid-cols-4 md:grid-cols-2 gap-4 mb-4",children:[s.jsxs("select",{name:"year",value:r.year,onChange:h,className:"form-select",children:[s.jsx("option",{value:"",children:"All Years"}),z.map(e=>s.jsx("option",{value:e.toString(),children:e},e))]}),s.jsxs("select",{name:"propertyTypeId",value:r.propertyTypeId,onChange:h,className:"form-select",children:[s.jsx("option",{value:"",children:"All Property Types"}),D.property_types.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]}),s.jsxs("select",{name:"dealTypeId",value:r.dealTypeId,onChange:h,className:"form-select",children:[s.jsx("option",{value:"",children:"All Deal Types"}),D.deal_types.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]}),s.jsxs("select",{name:"status",value:r.status,onChange:h,className:"form-select",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"1",children:"Interested"}),s.jsx("option",{value:"2",children:"Not Interested"})]})]}),M||C?s.jsx(U,{}):s.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-[#6C5DD3] text-white",children:[s.jsx("th",{className:"",children:"Sl No"}),s.jsx("th",{className:"",children:"Property Address"}),s.jsx("th",{className:"",children:"Description"}),s.jsx("th",{className:"",children:"GDV"}),s.jsx("th",{className:"",children:"Purchase Price"}),s.jsx("th",{className:"",children:"ROI"}),s.jsx("th",{className:"",children:"Interest Status"}),s.jsxs("th",{className:"cursor-pointer",onClick:()=>O("created_at"),children:["Created Date",r.sortColumn==="created_at"&&s.jsx("span",{className:"ml-1",children:r.sortOrder==="asc"?"↑":"↓"})]}),s.jsx("th",{className:"",children:"Actions"})]})}),s.jsx("tbody",{children:u.length>0?u.map((e,a)=>{var l,n,o;const t=e.property_deal;return s.jsxs("tr",{className:"",children:[s.jsx("td",{className:"",children:a+1}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:Y(e)})}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:t.description||"No description"})}),s.jsx("td",{className:"",children:(l=t.property_deal_investment)!=null&&l.gross_domestic_value?`£${parseFloat(t.property_deal_investment.gross_domestic_value).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(n=t==null?void 0:t.property_deal_investment)!=null&&n.purchase_price?`£${parseFloat(t==null?void 0:t.property_deal_investment.purchase_price).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(o=t==null?void 0:t.property_deal_investment)!=null&&o.return_on_cash_investment_percentage?`${parseFloat(t==null?void 0:t.property_deal_investment.return_on_cash_investment_percentage).toFixed(2)}%`:"0%"}),s.jsx("td",{className:"",children:$(e.intrust_status)}),s.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),s.jsx("td",{className:"",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>E(t),className:"text-lg",children:s.jsx(W,{})}),s.jsx("button",{onClick:()=>R(e.id),className:"text-lg",children:s.jsx(X,{})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No shared deals available"})})})]})}),u.length>0&&s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm text-sm",children:["Showing ",i.from,"-",i.to," of ",i.total," ","deals"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:k,className:"p-2 rounded-l-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r.page<=1,children:s.jsx(Z,{size:14})}),s.jsx("div",{className:"flex space-x-2",children:B().map((e,a)=>e==="..."?s.jsx("span",{className:"p-2  bg-gray-700 text-white",children:"..."},`ellipsis-${a}`):s.jsx("button",{onClick:()=>L(e),className:`px-2 py-1 min-w-[40px]  text-center ${e===i.currentPage?"bg-[#6C5DD3] text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e},`page-${e}`))}),s.jsx("button",{onClick:A,className:"p-2 rounded-r-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!i.hasMorePages,children:s.jsx(ee,{size:14})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{value:r.per_page,onChange:e=>d({...r,per_page:parseInt(e.target.value),page:1}),className:"form-select",children:[s.jsx("option",{value:"10",children:"10 / 10"}),s.jsx("option",{value:"20",children:"20 / 20"}),s.jsx("option",{value:"50",children:"50 / 50"}),s.jsx("option",{value:"100",children:"100 / 100"})]})})]}),f&&s.jsx(le,{isOpen:f,onClose:F,selectedDeals:P})]})};export{he as default};
