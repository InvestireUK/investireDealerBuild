import{V as oe,r as o,av as de,a8 as ie,aJ as pe,v as xe,u as f,aK as he,w as ue,m as e,z as ye,aL as Ne,aM as me,aN as be,aO as ne,cJ as H,cK as _e,aP as Ce,aQ as ve,aR as we,Q as U,aH as W,cv as Fe,am as ke,an as Se,cw as De,ar as Ae}from"./index-eIodm8oU.js";import{M as Ee}from"./ManualAddComperable-DARcF10P.js";import"./DragAndDrop-DTwf9dxV.js";import"./index-CRe_XmSW.js";const Oe=({onCloseFirst:x,loading:M,dealTypeId:je,handleManualcomparableModel:K,onClose:J,dealComparables:F})=>{var le,re,ce;const{register:y,watch:h,formState:{errors:g}}=oe({mode:"onChange",defaultValues:{property_radius_id:"3.0",year:"2024",tenure_type:"Freehold"}});new Date().getFullYear();const Q=[2020,2022,2023,2024],N=o.useRef(),{handleApiCall:_}=de(),{data:k}=ie(pe),u=xe(),s=f(a=>{var r;return(r=a==null?void 0:a.deal)==null?void 0:r.deal}),{property_types:q,property_radiuses:X}=(k==null?void 0:k.data)||{},[c,C]=he.useState([]),[Z,fe]=o.useState(!1),[R,P]=o.useState([]),[ee,L]=o.useState(!1);f(a=>a.deal.newComperableData);const v=f(a=>a.deal.manualComperable),d=[...Array.isArray(v)?v:[],...Array.isArray(s==null?void 0:s.property_deal_comparables)?s==null?void 0:s.property_deal_comparables:[],...Array.isArray(R)?R:[]],w=h("property_radius_id"),S=h("bedrooms"),T=h("year"),Y=h("sub_category"),z=h("tenure_type"),D=async()=>{var a,r;if(s!=null&&s.id){const l={address1:(s==null?void 0:s.address_line_1)||"",address2:(s==null?void 0:s.address_line_2)||"",city:(s==null?void 0:s.city)||"",postCode:(s==null?void 0:s.post_code)||"",country:((a=s==null?void 0:s.country)==null?void 0:a.name)||"",no_of_bedroom:S,no_of_dwellings:(s==null?void 0:s.no_of_dwelling)||1,year_of_sale:T||"1",distance:w||"3.0",type:"ai",property_type:Y||((r=s==null?void 0:s.sub_category)==null?void 0:r.title)||"Others",tenure_type:z||"Freehold"};try{const i=await ne(s.id,Number(w),l);u(H()),P(i.data.dealComparables)}catch(i){console.error("API error:",i)}}},B=async()=>{var a,r;try{L(!0);const l=await ne(s==null?void 0:s.id,1,{type:"ai"});u(H()),u(_e(((a=l==null?void 0:l.data)==null?void 0:a.dealComparables)||[])),P(((r=l==null?void 0:l.data)==null?void 0:r.dealComparables)||[])}catch{}finally{L(!1)}};o.useEffect(()=>{v.length>0&&B()},[v]),o.useEffect(()=>{if(!N.current)return;const a=d.length,r=c.length;N.current.indeterminate=!1,N.current.checked=a>0&&r===a},[c,d.length]);const $=ue(),[G,t]=o.useState(!1),[n,m]=o.useState(!1),[b,A]=o.useState([]),E=async()=>{var a,r;try{m(!0);const l=await Ce(s==null?void 0:s.id,1,b,S);u(ve(((a=l==null?void 0:l.data)==null?void 0:a.dealComparables)||[])),u(we()),t(((r=l==null?void 0:l.data)==null?void 0:r.data)||[]);const i={_method:"PATCH"};await _({apiFn:()=>W(s==null?void 0:s.id,i),onSuccess:p=>{var I;const j={...p==null?void 0:p.deal,id:(I=p==null?void 0:p.deal)==null?void 0:I.id};u(U(j))},onError:p=>{console.error("Error updating deal:",p)}})}catch(l){console.error("Error fetching comparables:",l)}finally{m(!1)}};o.useEffect(()=>{const a=d.filter((r,l)=>c.includes(l));A(a)},[c]);const O={Flat:"Apartments/Flat",Detached:"Detached",Semi_Detached:"Semi Detached",Terraced:"Terraced",Other:"Other"},ae=a=>(a==null?void 0:a.toLowerCase().replace(/[-/\\\s]/g,""))||"",se=a=>{var r;return((r=Object.entries(O).find(([l,i])=>ae(i)===ae(a)))==null?void 0:r[0])||"Other"},[te,ge]=o.useState(!1);o.useEffect(()=>{var a;if(!te&&((a=s==null?void 0:s.property_deal_comparables)==null?void 0:a.length)>0){const r=s.property_deal_comparables.map(l=>d.findIndex(i=>i.id===l.id));C(r.filter(l=>l!==-1)),ge(!0)}},[d,te,s]);const V={property_radiuses:[{id:"0.0",title:"0.0 miles"},{id:"0.25",title:"0.25 miles"},{id:"0.5",title:"0.5 miles"},{id:"1.0",title:"1.0 miles"},{id:"3.0",title:"3.0 miles"},{id:"5.0",title:"5.0 miles"},{id:"10.0",title:"10.0 miles"},{id:"15.0",title:"15.0 miles"}]};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-5xl relative mx-5 dark:bg-[#121212]",children:[ee&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(ye,{})}),e.jsxs("div",{className:"form-header px-5 flex items-center justify-between",children:[e.jsx("button",{className:"purple-btn",onClick:D,children:"Refresh AI"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-2xl",onClick:x,children:"✕"})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h4",{children:"Filters"}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-2 mb-5 items-end",children:[e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Distance"}),e.jsxs("select",{...y("property_radius_id",{}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select distance"}),(le=V==null?void 0:V.property_radiuses)==null?void 0:le.map(a=>e.jsx("option",{value:a==null?void 0:a.id,children:a==null?void 0:a.title},a==null?void 0:a.id))]})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Year of sale"}),e.jsxs("select",{...y("year"),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Option"}),Q.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Sub Category"}),e.jsx("select",{...y("sub_category"),defaultValue:(re=s==null?void 0:s.sub_category)!=null&&re.title?se(s.sub_category.title):(ce=s==null?void 0:s.property_type_category)!=null&&ce.title?se(s.property_type_category.title):"Other",className:"form-select focus:outline-none",children:Object.entries(O).map(([a,r])=>e.jsx("option",{value:a,children:r},a))})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Tenure Type"}),e.jsx("div",{children:e.jsxs("select",{...y("tenure_type",{defaultValue:"Freehold"}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Option"}),e.jsx("option",{value:"Freehold",children:"Freehold"}),e.jsx("option",{value:"Leasehold",children:"Leasehold"})]})})]}),e.jsx("div",{className:"",children:e.jsx("div",{className:"purple-btn mb-1",style:{width:"fit-content"},children:e.jsxs("button",{className:"flex items-center gap-2 whitespace-nowrap",onClick:D,children:[e.jsx(Ne,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})})]}),e.jsx("div",{className:"max-h-[50vh] overflow-y-auto border rounded-xl dark:border-[#333333]",children:e.jsxs("table",{className:"w-full text-left border-collapse  ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-white text-[12px] rounded-xl dark:bg-[#242424]",children:[e.jsx("th",{className:"p-4",children:e.jsx("input",{type:"checkbox",ref:N,onChange:a=>{const r=a.target.checked;C(r?d.map((l,i)=>i):[])},checked:d.length>0&&c.length===d.length})}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-4 text-center text-gray-500",children:"Loading comparables..."})}):(d==null?void 0:d.length)>0?d==null?void 0:d.map((a,r)=>{var l,i,p;return e.jsxs("tr",{className:"border-b dark:border-b-[#333333]",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:c.includes(r),onChange:()=>{C(j=>j.includes(r)?j.filter(I=>I!==r):[...j,r])}})}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:(a==null?void 0:a.image_url)||me,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px] dark:text-[#F8F8F8]",children:a==null?void 0:a.address}),a!=null&&a.linked_search_url?e.jsx("a",{href:a.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(a==null?void 0:a.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:be,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:(p=(i=(l=(a==null?void 0:a.property_type_string)||(a==null?void 0:a.sub_category))==null?void 0:l.toLowerCase())==null?void 0:i.replace(/_/g," "))==null?void 0:p.replace(/\b\w/g,j=>j.toUpperCase())}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:a.no_of_bedroom}),e.jsxs("td",{className:"p-4 dark:text-[#F8F8F8]",children:["£",Number(a.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:a.year}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:(a==null?void 0:a.distance)!=null?`${parseFloat(a==null?void 0:a.distance).toFixed(2)} Mile${(a==null?void 0:a.distance)>1?"s":""}`:"-"})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-4 text-center text-gray-500",children:"No comparables found."})})})]})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between px-4",children:[e.jsx("div",{children:e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>{K(!0)},children:"+ Add Manually"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 mt-3",children:[e.jsx("button",{className:"text-[#242424] dark:text-[#F8F8F8] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:x,children:"Cancel"}),e.jsx("button",{onClick:()=>{J(),(c==null?void 0:c.length)>0&&(E(),$("/create-deal/comparable-table"))},className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${(c==null?void 0:c.length)>0?"purple-btn cursor-pointer":"bg-[#ECECEC] text-[#AFAFAF] cursor-not-allowed"}`,style:{display:"flex"},disabled:(c==null?void 0:c.length)===0,children:`Import ${(c==null?void 0:c.length)||""} item${(c==null?void 0:c.length)===1?"":"s"}`})]})})]})})]})})},Le=()=>{var G;const x=xe(),[M,je]=o.useState(!1),[K,J]=o.useState([]),[F,y]=o.useState([]),[h,g]=o.useState(!1),[Q,N]=he.useState([]),{data:_}=ie(pe),{property_types:k,property_radiuses:u}=(_==null?void 0:_.data)||{},s=f(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.deal});f(t=>t.deal.newComperableData);const q=f(t=>t.deal.currentStep),[X,c]=o.useState(!1),{handleApiCall:C}=de(),Z=()=>{g(!1)},{register:fe,handleSubmit:R,reset:P,setValue:ee,watch:L,formState:{errors:v}}=oe({mode:"onChange"}),{comparableDealId:d}=f(t=>t==null?void 0:t.deal),w=ue(),S=()=>{d&&x(De()),w("/create-deal/description")},T=()=>{x(Ae(!0));const t={_method:"PATCH"};C({apiFn:()=>W(s.id,t),onSuccess:n=>{var b;const m={...n==null?void 0:n.deal,id:(b=n==null?void 0:n.deal)==null?void 0:b.id};x(U(m))},onError:n=>{console.error("Error updating deal:",n)}}),x({type:"deal/setCurrentStep",payload:Math.max(q,4)}),w("/create-deal/summary")},Y=t=>{t&&(g(!1),c(!0))},z=t=>{x(H())},D=()=>{c(!1)},B=()=>{g(!0),c(!1)},$=()=>{g(!0),x(U(W)),c(!1)};return e.jsxs("div",{className:"min-h-screen dark:bg[#111827]",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flx-col md:flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Comparables"})}),e.jsxs("div",{children:[e.jsxs("button",{className:"purple-btn my-4",style:{display:"flex",alignItems:"center",justifyContent:"center"},onClick:$,children:["+ Edit Comparable ",e.jsx(Fe,{className:"text-white h-[30px] w-[30px]"})]}),h&&e.jsx(Oe,{handleManualcomparableModel:Y,dealTypeId:s==null?void 0:s.deal_type_id,onClose:()=>g(!1),onCloseFirst:Z,onComparableUpdate:z,dealComparables:s==null?void 0:s.property_deal_comparables}),X&&e.jsx(Ee,{handleCloseManualComparable:D,handleFinishManualComparable:B})]})]})}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsx("div",{className:"overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-white text-[12px] rounded-xl dark:bg-[#242424]",children:[e.jsx("th",{className:"p-4",children:"SL NO."}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:((G=s==null?void 0:s.property_deal_comparables)==null?void 0:G.length)>0?s==null?void 0:s.property_deal_comparables.map((t,n)=>{var m,b,A,E;return e.jsxs("tr",{className:"border-b dark:border-b-[#333333]",children:[e.jsx("td",{className:"p-4",children:n+1}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:(t==null?void 0:t.image_url)||me,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px]",children:t==null?void 0:t.address}),t!=null&&t.linked_search_url?e.jsx("a",{href:t.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(t==null?void 0:t.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:be,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4",children:(A=(b=(m=(t==null?void 0:t.property_type_string)||(t==null?void 0:t.sub_category))==null?void 0:m.toLowerCase())==null?void 0:b.replace(/_/g," "))==null?void 0:A.replace(/\b\w/g,O=>O.toUpperCase())}),e.jsx("td",{className:"p-4",children:t.no_of_bedroom}),e.jsxs("td",{className:"p-4",children:["£",Number(t.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4",children:t.year}),e.jsx("td",{className:"p-4",children:(t==null?void 0:t.distance)!=null?`${(E=parseInt(t==null?void 0:t.distance))==null?void 0:E.toFixed(2)} Mile${(t==null?void 0:t.distance)>1?"s":""}`:"-"})]},t.id||n)}):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-6 text-center text-gray-500 font-medium",children:"No comparables found"})})})]})}),!M&&(F==null?void 0:F.length)>0&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center p-4 gap-4 bg-[#F8F8F8] border-t",children:[e.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm",children:["Showing"," ",pagination.totalItems===0?0:(pagination.currentPage-1)*pagination.perPage+1," ","/"," ",Math.min(pagination.currentPage*pagination.perPage,pagination.totalItems)," "]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2",children:[e.jsx("span",{className:"text-sm text-gray-800",children:"Go To Page"}),e.jsx("input",{type:"number",min:1,max:pagination.totalPages,value:pagination.currentPage,onChange:t=>{const n=Number(t.target.value);n>=1&&n<=pagination.totalPages&&goToPage(n)},className:"w-12 text-center border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-[#6C5DD3]"}),e.jsxs("span",{className:"text-sm text-gray-800",children:["of ",pagination.totalPages]})]})}),e.jsx("div",{className:"flex items-center gap-2"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("button",{onClick:S,className:"w-fit items-center gap-5 justify-center flex",children:[e.jsx(ke,{}),"Back"]}),e.jsxs("button",{onClick:T,className:"w-fit purple-btn items-center gap-5 justify-center  xyz",style:{display:"flex"},children:["Next",e.jsx(Se,{})]})]})]})};export{Le as default};
