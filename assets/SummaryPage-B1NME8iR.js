import{w as xe,v as ue,u as C,av as he,a8 as ge,bF as be,r,bI as W,m as e,c6 as N,bL as c,bM as ye,ay as fe,c7 as F,bV as je,bW as Ne,bX as _e,bZ as we,aM as ve,aN as Ce,aH as Fe,as as ke,Q as Pe}from"./index-CgNjIY1j.js";import{u as Se}from"./useRefreshUser-B3WNguxk.js";import{F as Le}from"./FinancialSummaryView-B8pQM6aU.js";import{P as Ae}from"./PaginationNew-BtnkNvdH.js";const ze=()=>{var M,T,z,$,B,U,Y,G,O,V;const b=xe(),d=ue(),Q=Se(),s=C(t=>t.deal.deal);console.log("deal in summary page =>>",s);const k=C(t=>t.deal.currentStep),q=C(t=>t.deal.comparableMode),K="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",{handleApiCall:X,loading:Z}=he(),{data:_}=ge(be,s==null?void 0:s.id,{type:q});(M=_==null?void 0:_.data)!=null&&M.dealComparables;const m=((...t)=>t.find(a=>Array.isArray(a)&&a.length>0)||[])(s==null?void 0:s.newcomperable,s==null?void 0:s.property_deal_comparables,s==null?void 0:s.property_deal_sa_comparables),l=(s==null?void 0:s.deal_type_id)===2?s.property_deal_sa_comparables||[]:s.property_deal_comparables||[],[x,J]=r.useState({page:1,per_page:(l==null?void 0:l.length)>=5?5:l==null?void 0:l.length}),P=(x.page-1)*x.per_page,u=l.slice(P,P+x.per_page),ee={currentPage:x.page,perPage:x.per_page,total:l.length,totalPages:Math.ceil(l.length/x.per_page)};s!=null&&s.address_line_1,s!=null&&s.address_line_2,s!=null&&s.post_code,(T=s==null?void 0:s.country)!=null&&T.name;const S=(s==null?void 0:s.image_url)||null,se=(s==null?void 0:s.map_image_url)||null,te=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const a={lat:t.coords.latitude,lng:t.coords.longitude};setUserLocation(a),setAddressCoordinates(a)},()=>{alert("Location access denied or unavailable.")}):alert("Geolocation is not supported by this browser.")},ae=t=>{var n,i,o,j;const a=[];if(t!=null&&t.no_of_dwelling){const p=(t==null?void 0:t.deal_type_id)===2?t.no_of_dwelling>1?" Beds":" Bed":t.no_of_dwelling>1?" Bedrooms":" Bedroom";a.push(t.no_of_dwelling+p)}if(t.deal_type&&a.push(t.deal_type.title),(n=t==null?void 0:t.sub_category)!=null&&n.title&&a.push(t.sub_category.title),(i=t==null?void 0:t.property_type_category)!=null&&i.title&&a.push((o=t.property_type_category)==null?void 0:o.title),(j=t==null?void 0:t.exit_type)!=null&&j.title){let p=t.exit_type.title.toLowerCase();p==="sell"?p="Flip":p==="refinance"&&(p="BRRR"),a.push(p)}return a.join(",")},y={description:(s==null?void 0:s.description_type)==="ai"?(s==null?void 0:s.description_ai)||"No AI description available":(s==null?void 0:s.description)||"No description available"},re={location:(s==null?void 0:s.description_type)==="ai"?(s==null?void 0:s.location_ai)||"No AI location available":(s==null?void 0:s.location)||"No location available"},[L,le]=r.useState(!1),[Ie,ne]=r.useState(!1),[ie,oe]=r.useState(!1),[Ee,ce]=r.useState(!1),f=r.useRef(null),w=r.useRef(null);r.useEffect(()=>{if(f.current){const a=parseFloat(getComputedStyle(f.current).lineHeight)*3;oe(f.current.scrollHeight>a)}if(w.current){const a=parseFloat(getComputedStyle(w.current).lineHeight)*3;ce(w.current.scrollHeight>a)}},[y,re]);const pe=()=>{le(t=>{const a=!t;return a&&ne(!1),a})},de=()=>{const t={_method:"PATCH",status:"publish",step:5};X({apiFn:()=>Fe(s.id,t),data:t,successMessage:"Deal uploaded successfully",errorMessage:"Failed to upload Deal",onSuccess:async a=>{const h={step:5,...a==null?void 0:a.deal};d(ke(!0)),d(Pe(h)),await Q(),b("/deals/deal-view/"+s.id)}})};r.useEffect(()=>(d(W(!0)),d({type:"deal/setCurrentStep",payload:Math.max(k,5)}),()=>{d(W(!1))}),[d,k]);const[me,A]=r.useState(!1),[D,v]=r.useState(0),g=((z=s==null?void 0:s.property_deal_media)==null?void 0:z.map(t=>{var a;return(a=t==null?void 0:t.media)==null?void 0:a.media_url}))||[],I=t=>{v(t),A(!0)},E=t=>{t.stopPropagation(),A(!1)},R=t=>{t.stopPropagation(),v(a=>(a+1)%g.length)},H=t=>{t.stopPropagation(),v(a=>(a-1+g.length)%g.length)};return e.jsxs("div",{className:"create-deal-summary-page-wrap",children:[e.jsx("h4",{className:"text-[#333333] font-bold mb-4 light-black dark:text-[#F8F8F8]",children:"Summary"}),Z?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-add-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Title"}),e.jsxs("button",{type:"button",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>b("/create-deal/address"),children:[e.jsx(N,{className:"text-lg"}),"Edit details"]})]}),e.jsxs("div",{className:"summary-property-map-wrap",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between purchased-price-with-location",children:[e.jsx("p",{className:"text-[#242424] font-medium property-location-text mb-4 dark:text-[#F8F8F8]",children:ae(s)}),(s==null?void 0:s.deal_type_id)===2?e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Rent: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:($=s==null?void 0:s.property_deal_sa_investment)!=null&&$.rent?`£${parseFloat((B=s==null?void 0:s.property_deal_sa_investment)==null?void 0:B.rent).toLocaleString()}`:"0"})]}):e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Purchased Price: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:(U=s==null?void 0:s.property_deal_investment)!=null&&U.purchase_price?`£${parseFloat((Y=s==null?void 0:s.property_deal_investment)==null?void 0:Y.purchase_price).toLocaleString()}`:"0"})]})]}),e.jsxs("div",{className:"summary-property-map-grid-wrap",children:[e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${((G=s==null?void 0:s.property_deal_media)==null?void 0:G.length)>0?"summary-property-col":""}`,children:[e.jsx("div",{className:"summary-property-subimages-div",children:(O=s==null?void 0:s.property_deal_media)==null?void 0:O.slice(0,4).map((t,a)=>{var i,o;const n=(((i=s==null?void 0:s.property_deal_media)==null?void 0:i.length)||0)-4;return e.jsx("div",{className:"summary-property-subimages relative",children:t?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(o=t==null?void 0:t.media)==null?void 0:o.media_url,alt:"Property",className:"w-full h-full object-cover cursor-pointer",onClick:()=>I(a)}),a===3&&n>0&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white text-lg font-semibold cursor-pointer",onClick:()=>I(a),children:["+",n]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:c.noImageAvailable})},a)})}),e.jsx("div",{className:"summary-property-main-images-div h-full",children:e.jsx("div",{className:"w-full bg-gray-700 summary-property-div",children:S?e.jsx("img",{src:S,alt:"Property",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:c.noImageAvailable})})})]}),me&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:E,children:e.jsxs("div",{className:"relative max-w-4xl w-full p-4 flex items-center justify-center",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:g[D],alt:"Large view",className:"max-h-[80vh] max-w-full object-contain mx-auto rounded-lg shadow-lg"}),e.jsx("div",{className:"absolute inset-y-0 left-0 w-1/2 cursor-pointer",onClick:t=>{t.stopPropagation(),H(t)}}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-1/2 cursor-pointer",onClick:t=>{t.stopPropagation(),R(t)}}),e.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:t=>{t.stopPropagation(),H(t)},children:"❮"}),e.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:t=>{t.stopPropagation(),R(t)},children:"❯"}),e.jsx("button",{className:"fixed top-4 right-4 text-white text-3xl z-50",onClick:E,children:e.jsx(ye,{})}),e.jsxs("div",{className:"absolute bottom-4 text-white text-center w-full",children:[D+1," / ",g.length]})]})})]}),e.jsx("div",{className:"summary-map-loaction-col",children:e.jsx("div",{className:"w-full bg-gray-700 summary-map-wrapper",children:se?e.jsxs(e.Fragment,{children:[e.jsx("iframe",{width:"600",height:"358",className:"rounded-lg w-full",style:{border:0,borderRadius:"12px"},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:`https://www.google.com/maps/embed/v1/place?key=${K}&q=${s==null?void 0:s.lat},${s==null?void 0:s.lng}&zoom=16`,title:"Google Map"}),e.jsx("button",{type:"button",className:"absolute bottom-[-20px] right-[50px] bg-black text-white px-2 py-2 rounded-full border border-white text-sm shadow transition",onClick:te,children:e.jsx(fe,{})})]}):e.jsx("div",{className:"w-full flex items-center justify-center text-gray-500",children:c.noMapImageAvailable})})})]})]})]}),e.jsxs("div",{className:"deal-summart-description-wrap mt-6",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Description"}),e.jsxs(F,{to:"/create-deal/description",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(N,{className:"text-lg"}),c.editDetails]})]}),e.jsx("div",{className:"summary-description-text",children:e.jsxs("div",{className:"summary-description-heading-wrap",children:[e.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2 dark:text-[#ECECEC]",children:"Property description:"}),e.jsx("p",{ref:f,className:`text-[#595959] whitespace-pre-line overflow-hidden transition-all duration-300 dark:text-[#C5C5C5] ${L?"":"line-clamp-3"}`,dangerouslySetInnerHTML:{__html:je(y==null?void 0:y.description)}}),ie&&e.jsx("button",{onClick:pe,className:"mt-2 text-sm text-[#6C5DD3] font-semibold",children:L?"Read less":"Read more"})]})})]}),e.jsxs("div",{className:"mt-6 DealsDetails-page-wrapper summary-financials-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:c.financials}),e.jsxs(F,{to:"/create-deal/financials",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(N,{className:"text-lg"}),c.editDetails]})]}),e.jsx("div",{className:"min-h-screen financial-page-main-div-wrap",children:e.jsxs("div",{className:"financial-page-inner-div-wrap",children:[(s==null?void 0:s.deal_type_id)===2?e.jsx(Ne,{deal:s}):e.jsx(_e,{deal:s}),e.jsx(Le,{})]})})]}),e.jsxs("div",{className:"summary-page-comparables-sec",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:c.comparables}),e.jsxs(F,{to:(m==null?void 0:m.length)>0?(s==null?void 0:s.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>b("/create-deal/comparable-table"),children:[e.jsx(N,{className:"text-lg"}),c.editDetails]})]}),e.jsxs("div",{children:[(s==null?void 0:s.deal_type_id)===2?u.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"summary-page-comapare-table-main-div",children:e.jsx("div",{className:"overflow-x-auto comparable-listing-table-wrap",children:u.map((t,a)=>e.jsx(we,{comp:t},a))})}):u.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"border dark:border-[#454545]",children:e.jsx("div",{className:"overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark text-[12px] border-b dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SL NO."}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:u==null?void 0:u.map((t,a)=>{var h,n,i,o;return e.jsxs("tr",{className:"border-b dark:border-[#333333]",children:[e.jsx("td",{className:"p-4",children:a+1}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:(t==null?void 0:t.image_url)||ve,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px]",children:t==null?void 0:t.address}),t!=null&&t.linked_search_url?e.jsx("a",{href:t.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(t==null?void 0:t.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:Ce,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4",children:(i=(n=(h=(t==null?void 0:t.property_type_string)||(t==null?void 0:t.sub_category))==null?void 0:h.toLowerCase())==null?void 0:n.replace(/_/g," "))==null?void 0:i.replace(/\b\w/g,j=>j.toUpperCase())}),e.jsx("td",{className:"p-4",children:t.no_of_bedroom}),e.jsxs("td",{className:"p-4",children:["£",Number(t.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4",children:t.year}),e.jsx("td",{className:"p-4",children:(t==null?void 0:t.distance)!=null?`${(o=parseInt(t==null?void 0:t.distance))==null?void 0:o.toFixed(2)} Mile${(t==null?void 0:t.distance)>1?"s":""}`:"-"})]},t.id||a)})})]})})}),l.length>0&&e.jsx(Ae,{pagination:ee,setFilters:J})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between text-lg text-gray-600 my-2",children:[e.jsxs("span",{className:"dark:text-[#F8F8F8]",children:["Last updated by: ",e.jsx("strong",{children:((V=s==null?void 0:s.last_updated_by)==null?void 0:V.name)||"-"})]}),e.jsx("span",{className:"dark:text-[#F8F8F8]",children:s!=null&&s.updated_at?new Date(s.updated_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):""})]}),e.jsxs("div",{className:"flex justify-end items-center mt-5 gap-4",children:[e.jsx("button",{className:"w-fit flex items-center gap-5 justify-center gray-outline-btn",onClick:()=>{const t=(m==null?void 0:m.length)>0?(s==null?void 0:s.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables";b(t)},children:"Back"}),e.jsx("button",{onClick:de,className:"w-fit purple-btn items-center justify-center",children:"Publish"})]})]})]})};export{ze as default};
