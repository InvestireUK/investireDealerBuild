import{u as we,a2 as Ue,s as rt,t as st,r as V,au as ot,aY as Qe,V as ct,W as q,aZ as it,m as o,a_ as $t,aJ as Ne,al as ut,am as _t,aG as lt,ao as mt,N as gt,o as ze,a$ as Xe,b0 as Nt,b1 as Ye,b2 as Lt,b3 as qt}from"./index-CmbPD93j.js";import{F as It}from"./FinancialSummaryView-DpJD8PfG.js";const vt="",Ot="cursor-not-allowed",T=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},At=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),_=parseFloat(g);return isNaN(_)||_<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},xt=(e,s,r,g,_,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!tt(e,s,r,g,_,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(_(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},tt=(e,s,r,g,_,C,H)=>{if(!e||e==="")return{isValid:!0};const se=String(e).replace(/[,%]/g,""),b=parseFloat(se),K={isValid:!0},v=ie=>({isValid:!1,message:ie});if(isNaN(b)&&r!=="payback_period")return _(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(b<0||b===0)return _(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return _(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"refurbishment_cost":if(b<=0)return _(r,{type:"manual",message:"Refurbishment cost cannot be negative"}),v("Refurbishment cost cannot be negative");break;case"gross_domestic_value":if(b<0||b===0)return _(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return _(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return _(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return _(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return _(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return _(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},Ce=e=>{const s=T(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},Et=e=>e?String(e).replace(/[,%]/g,""):"0",zt=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":"Percentage must be between 0% and 100%";const _=r.split(".");return _.length===2&&_[1].length>2?"Maximum 2 decimal places allowed":!0},Ut=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},Te=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const _=g[0],C=g[1].substring(0,2);return`${_}.${C}%`}},Gt=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const _=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${_} ${C}`}},Pt=()=>{const e=we(m=>{var p;return(p=m==null?void 0:m.deal)==null?void 0:p.deal}),s=Ue();we(m=>{var p;return(p=m==null?void 0:m.deal)==null?void 0:p.currentStep});const r=rt(),g=st(),[_,C]=V.useState(null),{handleApiCall:H,loading:se}=ot(),[b,K]=V.useState(!1),[v,ie]=V.useState(!1),[Ge,Be]=V.useState([]),[ue,Fe]=V.useState(!1);s.pathname.includes("/summary");const je=["before_refurb_mortgage_value","before_refurb_mortage_cost","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Re=e?Qe(e):{},{register:ke,handleSubmit:U,reset:S,control:G,setValue:i,formState:{errors:pe},getValues:w,setError:W,clearErrors:B}=ct({defaultValues:Re,mode:"onChange"});V.useEffect(()=>{if(e&&!v){const m=Qe(e);S(m),ie(!0)}},[e,S,v]),V.useEffect(()=>{if(e&&v){const m=Qe(e);Object.entries(m).forEach(([k,P])=>{P!==""&&P!==null&&P!==void 0&&i(k,P)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(k=>{const P=w(k);if(P&&!String(P).includes("%")){const L=document.querySelector(`input[name="${k}"]`);L&&!L.readOnly&&(L.value=Te(P))}})}},[e,i,v]);const Z=q({control:G,name:"purchase_price"}),fe=q({control:G,name:"effective_rate_percentage"});V.useEffect(()=>{if(Z&&T(Z)>0&&(e!=null&&e.country_id)){K(!1);const m=setTimeout(()=>{_e(e.country_id,e.property_type_id,Z,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(m)}},[Z,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const _e=async(m,p,k,P)=>{try{const L=await it({countryId:m,propertyTypeId:p,price:k,tenure_type:P});if(L&&L.data&&L.data.stamp_duty_amount!==void 0){const O=T(k),J=L.data.stamp_duty_amount;C(J),K(!0);const z=w("stamp_duty_amount");if(!z||z==="0"||Z!==k){i("stamp_duty_amount",Ce(J)),B("stamp_duty_amount");const t=O>0?J/O*100:0,a=Number(t.toFixed(4));i("effective_rate_percentage",a),B("effective_rate_percentage")}}else C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}catch{C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}},Q=q({control:G,name:"stamp_duty_amount"});V.useEffect(()=>{if(!ue||!Q||!Z)return;const m=T(Q),p=T(Z),k=p>0?m/p*100:0,P=Number(k.toFixed(4));i("effective_rate_percentage",P),B("effective_rate_percentage")},[Q,Z,ue,i,B]);const le=m=>{const p=T(m.target.value);i("purchase_price",m.target.value),K(!1),p>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?_e(e.country_id,e.property_type_id,p,e==null?void 0:e.tenure_type):p<=0&&(C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0"))},$=q({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","insurance","other_expenses","monthly_rental_income"]});V.useEffect(()=>{if(!$||!$[0])return;const m=setTimeout(()=>{const p=T($[0]),k=T($[1])/100,P=T($[3]),L=T($[4]),O=T($[5]),J=T($[6]),z=T($[7]),t=T($[8]),a=T($[9]),c=T($[10])/100,n=T($[11])/100,l=T($[12]),h=T($[13]);T($[14]),T($[15])/100,T($[16]),T($[17])/100,T($[18]),T($[19]);const u=p*k,f=u*T($[2])/100/12;let d=T(_);const N=T(w("stamp_duty_amount"));d=N>0?N:d,T(w("effective_rate_percentage"));const D=k>0?p*(1-k):0,I=J>0?O*(J/100):0,ce=100-T($[1]),y=f+D+P+L+d,j=d+D+P+L+O+I+z+t+l,M=a*c,X=M*n/12,me=M-u,ve=j-me,He=j>0?Math.round(ve/j*100):0,Ke=j>0?parseFloat((me/j*100).toFixed(2)):0;h===1&&T(w("monthly_rental_income"));const De=parseFloat((a-j-u).toFixed(2)),Ie=De>0,Ve=ve!==0?Math.round(De/j*100):0,Y=(E,ge)=>{if(E==="return_on_cash_investment_percentage"){const Me=ge.toLocaleString("en-US")+"%";i(E,Me)}else if(E==="payback_period")i(E,Gt(ge));else if((E==="deposit_amount_required"||E==="deposit_percentage")&&k===0)i(E,"0");else if(ge<0&&(E==="after_refurb_money_left_in"||E==="profit_amount")){const Me=ge.toLocaleString("en-US");i(E,Me)}else{if((E==="stamp_duty_amount"||E==="effective_rate_percentage")&&b&&($[1]!==void 0||$[2]!==void 0))return;if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(E))if(ge>0&&E!=="money_in_cash_invested_percentage"){const de=Te(ge);i(E,de)}else if(ge<0&&E==="money_in_cash_invested_percentage"){const de=ge.toLocaleString("en-US")+"%";i(E,de)}else i(E,"");else if(ge>0){const de=Ce(ge);i(E,de)}else i(E,"");if((E==="stamp_duty_amount"||E==="effective_rate_percentage")&&b&&!ue&&($[1]!==void 0||$[2]!==void 0))return}};Y("before_refurb_mortgage_value",u),Y("before_refurb_mortage_cost",f),Y("stamp_duty_amount",d),Y("deposit_amount_required",D),Y("deposit_percentage",ce),Y("contigency_amount",I),Y("total_investment",y),Y("total_cash_investment",j),Y("after_refurb_mortgage_value",M),Y("after_refurb_mortage_cost",X),Y("after_refurb_money_out",me),Y("after_refurb_money_left_in",ve),Y("money_in_cash_invested_percentage",He),Y("money_out_cash_invested_percentage",Ke),Y("profit_amount",De),Ie?i("profitable","Profitable"):i("profitable","Not Profitable"),Y("return_on_cash_investment_percentage",Ve)},300);return()=>clearTimeout(m)},[$,_,b,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,fe]);const R=q({control:G,name:"no_of_dwelling"});V.useEffect(()=>{if(!R)return;const m=T(R),p=T(w("average_rent_per_unit"));if(m===1&&p>0)i("monthly_rental_income",Ce(p));else if(m>1&&p>0){const k=m*p;i("monthly_rental_income",Ce(k))}},[R]);const oe=(m,p)=>{let k=m.target.value;const P=m.target,L=P.selectionStart,O=k.includes("%");let J=k.replace(/%/g,""),z=Ut(J);const t=J.length-z.length;if(parseFloat(z)>100&&(z="100"),tt(z,i,p,pe,W,B,w).isValid){if(!xt(z,i,p,pe,W,B,w))return}else return;i(p,z);const c=Te(z);if(m.target.value=c,setTimeout(()=>{if(O)t>0&&L>z.length?P.setSelectionRange(Math.max(0,L-t),Math.max(0,L-t)):L<J.length?P.setSelectionRange(L,L):P.setSelectionRange(c.length-1,c.length-1);else if(L===k.length)P.setSelectionRange(c.length-1,c.length-1);else{const n=Math.max(0,L-t);P.setSelectionRange(n,n)}},0),p==="after_refurb_interest_rate_percentage"){const n=T(w("after_refurb_loan_to_value_percentage"))/100,l=T(w("gross_domestic_value")),h=T(z)/100,f=l*n*h/12,d=f>0?Ce(f):"";i("after_refurb_mortage_cost",d)}},be=m=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const p={};Object.keys(m).forEach(P=>{p[P]=typeof m[P]=="string"?Et(m[P]):m[P]}),je.forEach(P=>{(!p[P]||p[P]==="")&&(p[P]="0")});const k={step:2,_method:"PATCH",purchase_price:p.purchase_price||0,before_refurb_loan_to_value_percentage:p.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:p.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:p.before_refurb_mortgage_value||0,before_refurb_mortage_cost:p.before_refurb_mortage_cost||0,stamp_duty_amount:p.stamp_duty_amount||0,effective_rate_percentage:p.effective_rate_percentage||0,deposit_percentage:p.deposit_percentage||0,deposit_amount_required:p.deposit_amount_required||0,before_refurb_professional_fees:p.before_refurb_professional_fees||0,deal_sourcing_fees:p.deal_sourcing_fees||0,total_investment:p.total_investment||0,refurbishment_cost:p.refurbishment_cost||0,contigency_percentage:p.contigency_percentage||0,contigency_amount:p.contigency_amount||0,furnishing_cost:p.furnishing_cost||0,project_management_fees:p.project_management_fees||0,total_cash_investment:p.total_cash_investment||0,gross_domestic_value:p.gross_domestic_value||0,after_refurb_loan_to_value_percentage:p.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:p.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:p.after_refurb_mortgage_value||0,after_refurb_mortage_cost:p.after_refurb_mortage_cost||0,after_refurb_professional_fees:p.after_refurb_professional_fees||0,after_refurb_money_left_in:p.after_refurb_money_left_in||0,money_in_cash_invested_percentage:p.money_in_cash_invested_percentage||0,after_refurb_money_out:p.after_refurb_money_out||0,money_out_cash_invested_percentage:p.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:p.no_of_dwelling||0,average_rent_per_unit:p.average_rent_per_unit||0,monthly_rental_income:p.monthly_rental_income||0,annual_rental_income:p.annual_rental_income||0,management_fee_percentage:p.management_fee_percentage||0,management_fees:p.management_fees||0,maintenance_fee_percentage:p.maintenance_fee_percentage||0,insurance:p.insurance||0,other_expenses:p.other_expenses||0,profit_amount:p.profit_amount||0,annual_profit_amount:p.annual_profit_amount||0,return_on_cash_investment_percentage:p.return_on_cash_investment_percentage||0,payback_period:p.payback_period||0};H({apiFn:()=>lt(e.id,k),onSuccess:P=>{var O;r(mt(!0));const L={step:"2",...P.deal,id:(O=P==null?void 0:P.deal)==null?void 0:O.id,management_fee_percentage:p.management_fee_percentage||"",mortgage_payment:p.mortgage_payment||"",contigency_percentage:p.contigency_percentage||""};r(gt(L)),g("/create-deal/description")},onError:P=>{console.error("Error updating deal:",P)}})},ae=(m,p,k)=>{const P=m.reversed,L=m.name==="payback_period",J=["profitable"].includes(m.name),z=T(w("no_of_dwelling"));if(m.name==="average_rent_per_unit"&&z===1)return null;const t=(m==null?void 0:m.name)==="stamp_duty_amount"?!ue:m.name==="monthly_rental_income"&&z===1?!1:m.calculated,a=m.name==="monthly_rental_income"&&z===1?!1:m.calculated,c=J?{}:{required:!a&&`${m.label} is required`,...L||a?{}:{pattern:{value:m.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...m.isPercentage?{percentage:u=>zt(u,m.name)}:{},maxValue:u=>At(u,m.name)}}},n={placeholder:a?"0":m.isPercentage?"0%":"Enter Amount",className:(m==null?void 0:m.name)==="stamp_duty_amount"?vt:t?Ot:vt,onKeyPress:u=>{if(!L&&!(u.key==="Backspace"||u.key==="Delete"||u.key==="Tab"||u.key==="Escape"||u.key==="Enter"||u.key==="."||u.key===","||m.isPercentage&&u.key==="%")){if(!/[0-9]/.test(u.key)){u.preventDefault();return}if(m.isPercentage){const f=u.target.value.replace(/%/g,""),d=u.target.selectionStart;if(u.target.selectionStart!==u.target.selectionEnd)return;const N=f.split(".");if(N.length===2&&d>N[0].length&&N[1].length>=2){u.preventDefault();return}const D=f.indexOf(".");if(D===-1){if(parseFloat(f+u.key)>100){u.preventDefault();return}}else if(d<=D){const I=f.substring(0,d)+u.key+f.substring(d);if(parseFloat(I)>100){u.preventDefault();return}}}}},readOnly:t,onFocus:u=>{if(m.isPercentage&&!t){const f=u.target.value;f&&f.includes("%")&&setTimeout(()=>{const d=f.length-1;u.target.setSelectionRange(d,d)},0)}},onChange:u=>{let f=u.target.value;if(m.isPercentage){oe(u,m.name);return}const d=f.replace(/[,%]/g,"");if(!L&&!a&&!m.readOnly){if(d.match(/\.\d{3,}$/)){const I=parseFloat(d);f=Math.round(I).toString(),u.target.value=f}tt(f,i,m.name,k,W,B,w).isValid&&xt(f,i,m.name,k,W,B,w)}if(!a&&(i(m.name,d),d&&!isNaN(parseFloat(d))&&d.trim()!=="")){const N=parseFloat(d);if(!isNaN(N)){const D=Math.round(N);u.target.value=D.toLocaleString("en-US")}}},onBlur:u=>{if(m.name==="purchase_price")le(u);else if(m.isPercentage&&!t){const f=u.target.value;f&&!f.includes("%")?(u.target.value=Te(f),i(m.name,f)):f===""&&(u.target.value="",i(m.name,""))}}};if(t&&m.isPercentage){const u=w(m.name);u&&(n.value=Te(u))}const l=o.jsxs("div",{children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...p(m.name,c),...n})}),m.name==="stamp_duty_amount"&&o.jsx("button",{type:"button",className:`absolute right-3 top-[50%] ${ue?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(u=>!u),children:o.jsx(ze,{className:"w-4 h-4"})})]}),k[m.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:k[m.name].message})]}),h=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:m.label})});return o.jsx("div",{className:"purchase-custom-grid",children:P?o.jsxs(o.Fragment,{children:[l,h]}):o.jsxs(o.Fragment,{children:[h,l]})})},re=(m,p,k)=>{const P=T(w("no_of_dwelling"));if(m.fields.length===1&&m.fields[0].name==="average_rent_per_unit"&&P===1)return null;const L=(m.highlight,"my-4");return m.columns===2?o.jsx("div",{className:L,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.fields.map(O=>o.jsx("div",{className:"purchase-price-group-wrap relative",children:O.name==="stamp_duty_amount"?o.jsx("div",{className:"relative",children:o.jsx("div",{children:ae(O,p,k)})}):ae(O,p,k)},O.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:m.fields.map(O=>O.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[ae(O,p,k),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ue?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(J=>!J),children:o.jsx(ze,{className:"w-4 h-4"})})]},O.name):o.jsx("div",{children:ae(O,p,k)},O.name))})},he=(m,p,k)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:m.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:m.fields.map(P=>P.rows.map((L,O)=>o.jsx(Ne.Fragment,{children:re(L,p,k)},O)))})]})})}),ye=q({control:G,name:"before_refurb_loan_to_value_percentage"});return q({control:G,name:"deposit_percentage"}),V.useEffect(()=>{if(!ye)return;const m=T(ye),p=100-m;i("deposit_percentage",p.toString()),B("deposit_percentage");const k=document.querySelector('input[name="deposit_percentage"]');k&&!k.readOnly&&(k.value=Te(p));const P=T(w("purchase_price"));if(P>0&&m>0){const L=P*(p/100);i("deposit_amount_required",Ce(L))}},[ye]),o.jsxs(o.Fragment,{children:[se&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:U(be),children:[$t.map(m=>o.jsx(Ne.Fragment,{children:he(m,ke,pe)},m.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case1 m-5",children:[o.jsxs("button",{type:"button",onClick:()=>g("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"button",onClick:U(be),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:se,children:["Next",o.jsx(_t,{})]})]})]})]})},St="",Bt="cursor-not-allowed",F=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},Ht=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),_=parseFloat(g);return isNaN(_)||_<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},Ft=(e,s,r,g,_,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!nt(e,s,r,g,_,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(_(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},nt=(e,s,r,g,_,C,H)=>{if(!e||e==="")return{isValid:!0};const se=String(e).replace(/[,%]/g,""),b=parseFloat(se),K={isValid:!0},v=ie=>({isValid:!1,message:ie});if(isNaN(b)&&r!=="payback_period")return _(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(b<0||b===0)return _(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(b<=0)return _(r,{type:"manual",message:"Stamp duty must be a valid percentage"}),v("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return _(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(b<=0||b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage."}),v("Interest rate must be a valid percentage.");if(b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage.h"}),v("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(b<0||b===0)return _(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return _(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return _(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return _(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return _(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return _(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},ne=e=>{const s=F(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},Kt=e=>e?String(e).replace(/[,%]/g,""):"0",Wt=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100){if(s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage")return"Occupancy Rate between 0% and 100%";if(s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage")return"Interest rate must be a valid percentage";if(s==="occupancy_rate_monthly")return"Occupancy Rate between 0% and 100%"}const _=r.split(".");return _.length===2&&_[1].length>2?"Maximum 2 decimal places allowed":!0},Jt=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},Ee=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const _=g[0],C=g[1].substring(0,2);return`${_}.${C}%`}},Vt=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const _=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${_} ${C}`}},Zt=()=>{const e=we(t=>{var a;return(a=t==null?void 0:t.deal)==null?void 0:a.deal}),s=Ue(),r=we(t=>{var a;return(a=t==null?void 0:t.deal)==null?void 0:a.currentStep}),g=rt(),_=st(),[C,H]=V.useState(null),{handleApiCall:se,loading:b}=ot(),[K,v]=V.useState(!1),[ie,Ge]=V.useState(!1),Be=s.pathname.includes("/summary"),ue=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Fe=e?Xe(e):{},{register:je,handleSubmit:Re,reset:ke,control:U,setValue:S,formState:{errors:G},getValues:i,setError:pe,clearErrors:w}=ct({defaultValues:Fe,mode:"onChange"});V.useEffect(()=>{if(e&&!ie){const t=Xe(e);ke(t),Ge(!0)}},[e,ke,ie]),V.useEffect(()=>{if(e&&ie){const t=Xe(e);Object.entries(t).forEach(([c,n])=>{n!==""&&n!==null&&n!==void 0&&S(c,n)}),["occupancy_rate_monthly"].forEach(c=>{const n=i(c);if(n&&!String(n).includes("%")){const l=document.querySelector(`input[name="${c}"]`);l&&!l.readOnly&&(l.value=Ee(n))}})}},[e,S,ie]);const W=q({control:U,name:"purchase_price"});q({control:U,name:"effective_rate_percentage"}),V.useEffect(()=>{if(W&&F(W)>0&&(e!=null&&e.country_id)){v(!1);const t=setTimeout(()=>{B(e.country_id,e.property_type_id,W,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(t)}},[W,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const B=async(t,a,c,n)=>{try{const l=await it({countryId:t,propertyTypeId:a,price:c,tenure_type:n});if(l&&l.data&&l.data.stamp_duty_amount!==void 0){const h=F(c),u=l.data.stamp_duty_amount;H(u),v(!0);const f=i("stamp_duty_amount");if(!f||f==="0"||W!==c){S("stamp_duty_amount",ne(u));const d=h>0?u/h*100:0;S("effective_rate_percentage",ne(d))}}else H(0),S("stamp_duty_amount","0"),S("effective_rate_percentage","0")}catch{H(0),S("stamp_duty_amount","0"),S("effective_rate_percentage","0")}},Z=t=>{const a=F(t.target.value);S("purchase_price",t.target.value),v(!1),a>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?B(e.country_id,e.property_type_id,a,e==null?void 0:e.tenure_type):a<=0&&(H(0),S("stamp_duty_amount","0"),S("effective_rate_percentage","0"))},fe=q({control:U,name:["rent","administration","deal_sourcing_fees"]});V.useEffect(()=>{if(!fe||(fe==null?void 0:fe.length)<3)return;const t=setTimeout(()=>{const a=F(fe[0]),c=F(fe[1]),n=F(fe[2]),l=a+c+n;S("aquisition_cost",l.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[fe]);const _e=q({control:U,name:["furnishing","refurbishment","ota_setup_fee","channel_manager_setup"]});V.useEffect(()=>{if(!_e||(_e==null?void 0:_e.length)<4)return;const t=setTimeout(()=>{const a=F(_e[0]),c=F(_e[1]),n=F(_e[2]),l=F(_e[3]),h=a+c+n+l;S("setup_cost",h.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[_e]);const Q=q({control:U,name:["council_tax_or_business_rates","water_gas_electric_and_broadband","insurance","cleaning","laundry","other"]});V.useEffect(()=>{if(!Q||(Q==null?void 0:Q.length)<6)return;const t=setTimeout(()=>{const a=F(Q[0]),c=F(Q[1]),n=F(Q[2]),l=F(Q[3]),h=F(Q[4]),u=F(Q[5]),f=a+c+n+l+h+u;S("monthly_expense",f.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[Q]);const le=q({control:U,name:["aquisition_cost","expected_daily_rate","occupancy_rate_monthly","rent"]});V.useEffect(()=>{if(!le||(le==null?void 0:le.length)<3)return;const t=setTimeout(()=>{F(le[0]);const a=F(le[1]),c=F(le[3]);let n=String($[1]).replace(/[%\\s]/g,""),l=parseFloat(n);isNaN(l)?l=0:l=l/100;const h=a*30*l-c;S("monthly_revenue",h.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[le]);const $=q({control:U,name:["expected_daily_rate","occupancy_rate_monthly"]});V.useEffect(()=>{if(!$||($==null?void 0:$.length)<2)return;const t=setTimeout(()=>{const a=F($[0]);let c=String($[1]).replace(/[%\\s]/g,""),n=parseFloat(c);isNaN(n)?n=0:n=n/100;const l=a*n*30;S("total_monthly_income",l.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[$]);const R=q({control:U,name:["rent","total_monthly_income","monthly_expense"]});V.useEffect(()=>{if(!R||(R==null?void 0:R.length)<3)return;const t=setTimeout(()=>{const a=F(R[0]),c=F(R[1]),n=F(R[2]),l=c-a-n;S("net_income_monthly",l.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[R]);const oe=q({control:U,name:["net_income_monthly"]});V.useEffect(()=>{if(!oe||(oe==null?void 0:oe.length)<1)return;const t=setTimeout(()=>{const c=F(oe[0])*12;S("net_income_per_year",c.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[oe]);const be=q({control:U,name:["total_monthly_income"]});V.useEffect(()=>{if(!be||(be==null?void 0:be.length)<1)return;const t=setTimeout(()=>{const c=F(be[0])*12;S("gross_income_per_year",c.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[be]);const ae=q({control:U,name:["gross_income_per_year","setup_cost"]});V.useEffect(()=>{if(!ae||(ae==null?void 0:ae.length)<2)return;const t=setTimeout(()=>{const a=F(ae[0]),c=F(ae[1]),n=c>0?a/c*100:0;S("gross_ROI",`${Math.round(n)}%`)},300);return()=>clearTimeout(t)},[ae]);const re=q({control:U,name:["setup_cost","net_income_per_year","aquisition_cost"]});V.useEffect(()=>{if(!re||(re==null?void 0:re.length)<2)return;const t=setTimeout(()=>{const a=F(re[0]),c=F(re[1]),n=F(re[2]),l=a>0?c/(a+n)*100:0;S("net_ROI",ne(l)+"%")},300);return()=>clearTimeout(t)},[re]);const he=q({control:U,name:["net_income_monthly","setup_cost"]});V.useEffect(()=>{if(!he||he.length<2)return;const t=setTimeout(()=>{const a=F(he[0]),c=F(he[1]),n=a!==0?c/a:0,l=n===0?0:n>0?Math.ceil(n):Math.floor(n);S("months_until_break_even",l.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[he]);const ye=q({control:U,name:"monthly_rental_income"}),m=q({control:U,name:"management_fee_percentage"});V.useEffect(()=>{if(!ye||F(i("no_of_dwelling"))!==1)return;const a=setTimeout(()=>{const c=F(ye),n=F(m)/100,l=F(i("after_refurb_mortage_cost")),h=c*n,u=parseFloat((c-(l+h)).toFixed(2)),f=u*12,d=F(i("after_refurb_money_left_in")),N=d>0?Math.round(Math.max(0,f/d*100)):0,D=f>0?Math.max(0,d/f):0;S("management_fees",ne(h)),S("profit_amount",ne(u)),S("annual_profit_amount",ne(f)),S("return_on_cash_investment_percentage",ne(N)+"%"),S("payback_period",Vt(D));const I=c*12;S("annual_rental_income",ne(I))},300);return()=>clearTimeout(a)},[ye,m]),V.useEffect(()=>{if(!m)return;const t=setTimeout(()=>{const a=F(m)/100,c=F(i("monthly_rental_income"));if(c>0&&a>0){const n=c*a;S("management_fees",ne(n));const l=F(i("after_refurb_mortage_cost")),h=parseFloat((c-(l+n)).toFixed(2)),u=h*12;S("profit_amount",ne(h)),S("annual_profit_amount",ne(u));const f=F(i("after_refurb_money_left_in"));if(f>0){const d=Math.max(0,u/f*100),N=u>0?Math.max(0,f/u):0;S("return_on_cash_investment_percentage",ne(d)+"%"),S("payback_period",Vt(N))}}},300);return()=>clearTimeout(t)},[m]);const p=q({control:U,name:"average_rent_per_unit"});V.useEffect(()=>{if(!p)return;if(F(i("no_of_dwelling"))===1){const a=F(p);S("monthly_rental_income",ne(a))}},[p]);const k=q({control:U,name:"no_of_dwelling"});V.useEffect(()=>{if(!k)return;const t=F(k),a=F(i("average_rent_per_unit"));if(t===1&&a>0)S("monthly_rental_income",ne(a));else if(t>1&&a>0){const c=t*a;S("monthly_rental_income",ne(c))}},[k]);const P=(t,a)=>{let c=t.target.value;const n=t.target,l=n.selectionStart,h=c.includes("%");let u=c.replace(/%/g,""),f=Jt(u);const d=u.length-f.length;if(parseFloat(f)>100&&(f="100"),nt(f,S,a,G,pe,w,i).isValid){if(!Ft(f,S,a,G,pe,w,i))return}else return;S(a,f);const D=Ee(f);if(t.target.value=D,setTimeout(()=>{if(h)d>0&&l>f.length?n.setSelectionRange(Math.max(0,l-d),Math.max(0,l-d)):l<u.length?n.setSelectionRange(l,l):n.setSelectionRange(D.length-1,D.length-1);else if(l===c.length)n.setSelectionRange(D.length-1,D.length-1);else{const I=Math.max(0,l-d);n.setSelectionRange(I,I)}},0),a==="after_refurb_interest_rate_percentage"){const I=F(i("after_refurb_loan_to_value_percentage"))/100,ce=F(i("gross_domestic_value")),y=F(f)/100,M=ce*I*y/12,X=M>0?ne(M):"";S("after_refurb_mortage_cost",X)}},L=t=>{if(!(e!=null&&e.id))return;const a={};Object.keys(t).forEach(n=>{a[n]=typeof t[n]=="string"?Kt(t[n]):t[n]}),ue.forEach(n=>{(!a[n]||a[n]==="")&&(a[n]="0")});const c={step:2,_method:"PATCH",rent:a.rent||0,administration_amount:a.administration||0,sourcing_fees:a.deal_sourcing_fees||0,aquisition_cost:a.aquisition_cost||0,expected_daily_rate:a.expected_daily_rate||0,occupancy_rate_monthly_percentage:a.occupancy_rate_monthly||0,furnishing_fees:a.furnishing||0,refurbishment_fees:a.refurbishment||0,ota_setup_fees:a.ota_setup_fee||0,channel_manager_setup_fees:a.channel_manager_setup||0,setup_cost:a.setup_cost||0,council_tax_or_business_rates_expense:a.council_tax_or_business_rates||0,water_gas_electric_broadband_expense:a.water_gas_electric_and_broadband||0,insurance_expense:a.insurance||0,cleaning_expense:a.cleaning||0,laundry_expense:a.laundry||0,other_expense:a.other||0,monthly_expense:a.monthly_expense||0,monthly_revenue:a.monthly_revenue||0,total_monthly_income:a.total_monthly_income||0,net_income_monthly:a.net_income_monthly||0,net_income_per_year:a.net_income_per_year||0,gross_income_per_year:a.gross_income_per_year||0,gross_roi_percentage:a.gross_ROI||0,net_roi_percentage:a.net_ROI||0,months_until_break_even:a.months_until_break_even||0};se({apiFn:()=>lt(e.id,c),onSuccess:n=>{var h;g(mt(!0));const l={step:"3",...n==null?void 0:n.deal,id:(h=n==null?void 0:n.deal)==null?void 0:h.id,management_fee_percentage:a.management_fee_percentage||"",mortgage_payment:a.mortgage_payment||"",contigency_percentage:a.contigency_percentage||""};g(gt(l)),g({type:"deal/setCurrentStep",payload:Math.max(r,3)}),_("/create-deal/description")},onError:n=>{console.error("Error updating deal:",n)}})},O=(t,a,c)=>{const n=t.reversed,l=t.name==="payback_period",h=F(i("no_of_dwelling")),u=Be;if(t.name==="average_rent_per_unit"&&h===1)return null;const f=u||(t.name==="monthly_rental_income"&&h===1?!1:t.calculated),d=t.name==="monthly_rental_income"&&h===1?!1:t.calculated,N={required:!d&&!["Maintenance Fee","Other Expenses","Occupancy Rate (Monthly)"].includes(t.label)&&`${t.label} is required`,...l||d?{}:{pattern:{value:t.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...t.isPercentage?{percentage:y=>Wt(y,t.name)}:{},maxValue:y=>Ht(y,t.name)}}},D={placeholder:d?"0":t.isPercentage?"0%":"Enter Amount",className:(t==null?void 0:t.name)==="stamp_duty_amount"?St:f?Bt:St,onKeyPress:y=>{if(!l&&!(y.key==="Backspace"||y.key==="Delete"||y.key==="Tab"||y.key==="Escape"||y.key==="Enter"||y.key==="."||y.key===","||t.isPercentage&&y.key==="%")){if(!/[0-9]/.test(y.key)){y.preventDefault();return}if(t.isPercentage){const j=y.target.value.replace(/%/g,""),M=y.target.selectionStart;if(y.target.selectionStart!==y.target.selectionEnd)return;const X=j.split(".");if(X.length===2&&M>X[0].length&&X[1].length>=2){y.preventDefault();return}const me=j.indexOf(".");if(me===-1){if(parseFloat(j+y.key)>100){y.preventDefault();return}}else if(M<=me){const ve=j.substring(0,M)+y.key+j.substring(M);if(parseFloat(ve)>100){y.preventDefault();return}}}}},readOnly:f,onFocus:y=>{if(t.isPercentage&&!f){const j=y.target.value;j&&j.includes("%")&&setTimeout(()=>{const M=j.length-1;y.target.setSelectionRange(M,M)},0)}},onChange:y=>{let j=y.target.value;if(t.isPercentage){P(y,t.name);return}const M=j.replace(/[,%]/g,"");if(!l&&!d&&!t.readOnly){if(M.match(/\.\d{3,}$/)){const ve=parseFloat(M);j=Math.round(ve).toString(),y.target.value=j}nt(j,S,t.name,c,pe,w,i).isValid&&Ft(j,S,t.name,c,pe,w,i)}if(!d&&(S(t.name,M),M&&!isNaN(parseFloat(M))&&M.trim()!=="")){const X=parseFloat(M);if(!isNaN(X)){const me=Math.round(X);y.target.value=me.toLocaleString("en-US")}}},onBlur:y=>{if(t.name==="purchase_price")Z(y);else if(t.isPercentage&&!f){const j=y.target.value;j&&!j.includes("%")?(y.target.value=Ee(j),S(t.name,j)):j===""&&(y.target.value="",S(t.name,""))}}};if(f&&t.isPercentage){const y=i(t.name);y&&(D.value=Ee(y))}const I=o.jsxs("div",{className:"",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...a(t.name,N),...D})}),c[t.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:c[t.name].message})]}),ce=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:t.label})});return o.jsx("div",{className:"purchase-custom-grid",children:n?o.jsxs(o.Fragment,{children:[I,ce]}):o.jsxs(o.Fragment,{children:[ce,I]})})},J=(t,a,c)=>{const n=F(i("no_of_dwelling"));if(t.fields.length===1&&t.fields[0].name==="average_rent_per_unit"&&n===1)return null;const l=(t.highlight,"my-4");return t.columns===2?o.jsx("div",{className:l,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.fields.map(h=>o.jsx("div",{className:"purchase-price-group-wrap",children:O(h,a,c)},h.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:t.fields.map(h=>O(h,a,c))})},z=(t,a,c)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:t.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:t.fields.map(n=>n.rows.map((l,h)=>o.jsx(Ne.Fragment,{children:J(l,a,c)},h)))})]})})});return o.jsxs(o.Fragment,{children:[b&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:Re(L),children:[Nt.map(t=>o.jsx(Ne.Fragment,{children:z(t,je,G)},t.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case2 px-4 pb-4",children:[o.jsxs("button",{type:"button",onClick:()=>_("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"button",onClick:Re(L),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:b,children:["Next",o.jsx(_t,{})]})]})]})]})},wt="",Qt="cursor-not-allowed",x=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},Xt=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","stamp_duty_amount","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),_=parseFloat(g);return isNaN(_)||_<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},jt=(e,s,r,g,_,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!at(e,s,r,g,_,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(_(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},at=(e,s,r,g,_,C,H)=>{if(!e||e==="")return{isValid:!0};const se=String(e).replace(/[,%]/g,""),b=parseFloat(se),K={isValid:!0},v=ie=>({isValid:!1,message:ie});if(isNaN(b)&&r!=="payback_period")return _(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(b<0||b===0)return _(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(b<=0)return _(r,{type:"manual",message:"Stamp duty must be a valid percentage"}),v("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return _(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(b>=101)return _(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return _(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(b<=0||b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage."}),v("Interest rate must be a valid percentage.");if(b>101)return _(r,{type:"manual",message:"Interest rate must be a valid percentage.h"}),v("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(b<0||b===0)return _(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return _(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return _(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return _(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return _(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return _(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;case"maintenance_fee_percentage":if(b<0)return _(r,{type:"manual",message:"Maintenance cost cannot be negative."}),v("Maintenance cost cannot be negative.");break;case"insurance":if(b<0)return _(r,{type:"manual",message:"Insurance cost cannot be negative."}),v("Insurance cost cannot be negative.");break;case"other_expenses":if(b<0)return _(r,{type:"manual",message:"Other expenses cannot be negative."}),v("Other expenses cannot be negative.");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},te=e=>{const s=x(e);return s===0||s===null||s===void 0?"":Math.round(s).toLocaleString("en-US")},Yt=e=>e?String(e).replace(/[,%]/g,""):"0",en=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":s==="maintenance_fee_percentage"?!0:"Percentage must be between 0% and 100%";const _=r.split(".");return _.length===2&&_[1].length>2?"Maximum 2 decimal places allowed":!0},tn=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},$e=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const _=g[0],C=g[1].substring(0,2);return`${_}.${C}%`}},et=e=>{if(e<=0)return"0";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const _=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${_} ${C}`}},Rt=()=>{const e=we(t=>{var a;return(a=t==null?void 0:t.deal)==null?void 0:a.deal}),s=Ue();we(t=>{var a;return(a=t==null?void 0:t.deal)==null?void 0:a.currentStep});const r=rt(),g=st(),[_,C]=V.useState(null),{handleApiCall:H,loading:se}=ot(),[b,K]=V.useState(!1),[v,ie]=V.useState(!1),[Ge,Be]=V.useState([]),[ue,Fe]=V.useState(!1);s.pathname.includes("/summary");const je=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Re=e?Ye(e):{},{register:ke,handleSubmit:U,reset:S,control:G,setValue:i,formState:{errors:pe},getValues:w,setError:W,clearErrors:B}=ct({defaultValues:Re,mode:"onChange"});V.useEffect(()=>{if(e&&!v){const t=Ye(e);S(t),ie(!0)}},[e,S,v]),V.useEffect(()=>{if(e&&v){const t=Ye(e);Object.entries(t).forEach(([c,n])=>{n!==""&&n!==null&&n!==void 0&&i(c,n)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(c=>{const n=w(c);if(n&&!String(n).includes("%")){const l=document.querySelector(`input[name="${c}"]`);l&&!l.readOnly&&(l.value=$e(n))}})}},[e,i,v]);const Z=q({control:G,name:"purchase_price"}),fe=q({control:G,name:"effective_rate_percentage"}),_e=x(w("stamp_duty_amount"));V.useEffect(()=>{if(Z&&x(Z)>0&&(e!=null&&e.country_id)){K(!1);const t=setTimeout(()=>{Q(e.country_id,e.property_type_id,Z,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(t)}},[Z,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const Q=async(t,a,c,n)=>{try{const l=await it({countryId:t,propertyTypeId:a,price:c,tenure_type:n});if(l&&l.data&&l.data.stamp_duty_amount!==void 0){const h=x(c),u=l.data.stamp_duty_amount;C(u),K(!0);const f=w("stamp_duty_amount");if(!f||f==="0"||Z!==c){i("stamp_duty_amount",te(u)),B("stamp_duty_amount");const d=h>0?u/h*100:0;i("effective_rate_percentage",te(d))}}else C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}catch{C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}},le=q({control:G,name:"stamp_duty_amount"});V.useEffect(()=>{if(!ue||!le||!Z)return;const t=x(le),a=x(Z),c=a>0?t/a*100:0,n=Number(c.toFixed(4));i("effective_rate_percentage",n),B("effective_rate_percentage")},[le,Z,ue,i,B]);const $=t=>{const a=x(t.target.value);i("purchase_price",t.target.value),K(!1),a>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?Q(e.country_id,e.property_type_id,a,e==null?void 0:e.tenure_type):a<=0&&(C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0"))},R=q({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","other_expenses","insurance","stamp_duty_amount"]}),[oe,be]=V.useState({payloadROI:0,payloadPaybackPeriod:0});V.useEffect(()=>{if(!R||!R[0])return;const t=setTimeout(()=>{const a=x(R[0]),c=x(R[1])/100,n=x(R[2])/100,l=x(R[3]),h=x(R[4]),u=x(R[5]),f=x(R[6]),d=x(R[7]),N=x(R[8]),D=x(R[9]),I=x(R[10])/100,ce=x(R[11])/100,y=x(R[12]),j=x(R[13]),M=x(R[14]),X=x(R[15])/100;x(R[16]);const me=x(R[17]),ve=x(R[18]),He=x(R[19]),Ke=w("monthly_rental_income"),De=a*c,Ie=a*c*n/12;let Ve=x(_);const Y=x(w("stamp_duty_amount"));Ve=Y>0?Y:Ve,x(w("effective_rate_percentage")),b===!1&&a>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)&&Q(e.country_id,e.property_type_id,a,e==null?void 0:e.tenure_type);const E=c>0?a*(1-c):0;100-x(R[1]);const ge=f>0?u*(f/100):0,Me=Ie+E+l+h+Ve,de=Ve+E+l+h+u+ge+d+N+y,We=D*I,pt=We*ce/12,Je=We-De,Le=de-Je,kt=de>0?Math.round(Le/de*100):0,Dt=de>0?Math.max(0,parseFloat((Je/de*100).toFixed(2))):0;let xe=0;if((e==null?void 0:e.deal_type_id)==3)xe=Ke;else if((e==null?void 0:e.deal_type_id)!==3&&j===1){const A=x(w("monthly_rental_income"));xe=A>0?A:M}else xe=j*M;(e==null?void 0:e.deal_type_id)!==5&&(xe=Number(xe.replace(/,/g,"")));const Mt=xe*12,ft=xe*X,dt=Math.round(xe-(ft+(pt+me+He+ve))),Oe=dt*12,Ae=Number(Le),bt=Number(Oe),Ze=Ae>0?Math.round(bt/Ae*100):0,Ct=Number(Le),ht=Number(Oe),yt=ht!==0?Ct/ht:0;be(A=>({...A,payloadROI:Ze,payloadPaybackPeriod:yt}));const ee=(A,Pe)=>{if(A==="return_on_cash_investment_percentage"){let Se;Ae<=0&&bt>0||Ae<=0?Se="Infinite":Se=`${Ze.toLocaleString("en-US")}%`,i(A,Se)}else if(A==="payback_period"){const Se=Number(Le)<=0?"Pays Immediately":et(Pe);i(A,Se)}else if((A==="deposit_amount_required"||A==="deposit_percentage")&&c===0)i(A,"0");else{if((A==="stamp_duty_amount"||A==="effective_rate_percentage")&&b&&(R[1]!==void 0||R[2]!==void 0))return;if(Pe<0&&(A==="after_refurb_money_left_in"||A==="profit_amount"||A==="annual_profit_amount"||A==="money_in_cash_invested_percentage"||A==="payback_period")){const Se=Pe.toLocaleString("en-US");i(A,Se)}else if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(A))if(Pe>0&&A!=="money_in_cash_invested_percentage"){const qe=te(Pe)+"%";i(A,qe)}else if(Pe<0&&A==="money_in_cash_invested_percentage"){const qe=Pe.toLocaleString("en-US")+"%";i(A,qe)}else i(A,"");else if(Pe){const qe=te(Pe);i(A,qe)}else i(A,"")}},Tt=Oe>0;ee("before_refurb_mortgage_value",De),ee("before_refurb_mortage_cost",Ie),ee("stamp_duty_amount",Ve),ee("deposit_amount_required",E),ee("contigency_amount",ge),ee("total_investment",Me),ee("total_cash_investment",de),ee("after_refurb_mortgage_value",We),ee("after_refurb_mortage_cost",pt),ee("after_refurb_money_out",Je),ee("after_refurb_money_left_in",Le),i("money_in_cash_invested_percentage",`${Math.round(kt)}%`),Tt?i("profitable","Profitable"):i("profitable","Not Profitable"),ee("money_out_cash_invested_percentage",Dt),ee("monthly_rental_income",xe),ee("annual_rental_income",Mt),ee("management_fees",ft),ee("profit_amount",dt),ee("annual_profit_amount",Oe),ee("return_on_cash_investment_percentage",Ze),ee("payback_period",yt)},300);return()=>clearTimeout(t)},[R,_e,_,b,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,fe]);const ae=q({control:G,name:"monthly_rental_income"}),re=q({control:G,name:"management_fee_percentage"});V.useEffect(()=>{if(!ae||((e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling")))!==1)return;const a=setTimeout(()=>{const c=x(ae),n=x(re)/100,l=x(w("after_refurb_mortage_cost")),h=c*n,u=x(R[17])/100,f=x(R[18]),d=x(R[19]),N=c-(h+(l+u+d+f)),D=N*12,I=x(w("after_refurb_money_left_in")),ce=D!==0?I/D:0;i("management_fees",te(h)),i("profit_amount",te(N)),i("annual_profit_amount",te(D)),i("payback_period",et(ce));const y=c*12;i("annual_rental_income",te(y))},300);return()=>clearTimeout(a)},[ae,re]),V.useEffect(()=>{if(!re)return;const t=setTimeout(()=>{const a=x(re)/100,c=x(w("monthly_rental_income")),n=x(R[17])/100,l=x(R[18]),h=x(R[19]);if(c>0&&a>0){const u=c*a;i("management_fees",te(u));const f=x(w("after_refurb_mortage_cost")),d=Math.round(c-(u+(f+n+h+l))),N=d*12;i("profit_amount",te(d)),i("annual_profit_amount",te(N));const D=x(w("after_refurb_money_left_in"));if(D>0){const I=N>0?Math.max(0,D/N):0;i("payback_period",et(I))}}},300);return()=>clearTimeout(t)},[re]);const he=q({control:G,name:"average_rent_per_unit"});V.useEffect(()=>{if(!he)return;if(((e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling")))===1){const a=x(he);i("monthly_rental_income",te(a))}},[he]);const ye=q({control:G,name:"no_of_dwelling"});V.useEffect(()=>{if(!ye)return;const t=x(ye),a=x(w("average_rent_per_unit"));if(t===1&&a>0)i("monthly_rental_income",te(a));else if(t>1&&a>0){const c=t*a;i("monthly_rental_income",te(c))}},[ye]);const m=(t,a)=>{let c=t.target.value;const n=t.target,l=n.selectionStart,h=c.includes("%");let u=c.replace(/%/g,""),f=tn(u);const d=u.length-f.length;if(parseFloat(f)>100&&(f="100"),at(f,i,a,pe,W,B,w).isValid){if(!jt(f,i,a,pe,W,B,w))return}else return;i(a,f);const D=$e(f);if(t.target.value=D,setTimeout(()=>{if(h)d>0&&l>f.length?n.setSelectionRange(Math.max(0,l-d),Math.max(0,l-d)):l<u.length?n.setSelectionRange(l,l):n.setSelectionRange(D.length-1,D.length-1);else if(l===c.length)n.setSelectionRange(D.length-1,D.length-1);else{const I=Math.max(0,l-d);n.setSelectionRange(I,I)}},0),a==="after_refurb_interest_rate_percentage"){const I=x(w("after_refurb_loan_to_value_percentage"))/100,ce=x(w("gross_domestic_value")),y=x(f)/100,M=ce*I*y/12,X=M>0?te(M):"";i("after_refurb_mortage_cost",X)}},p=t=>{let a=!0,c=[];const n=[{name:"purchase_price",label:"Purchase Price"},{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage"},{name:"gross_domestic_value",label:"Gross Domestic Value"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage"},{name:"no_of_dwelling",label:"Number of Dwellings"}];let l=!0;for(const d of n){const N=x(t[d.name]);if(!N||N<=0){l=!1;break}}if(l)for(const d of je)x(t[d]),d!=="payback_period"&&(d==="effective_rate_percentage"&&x(t.stamp_duty_amount)<=0||d==="annual_profit_amount"&&x(t.profit_amount)<=0||d==="monthly_rental_income"&&x(t.no_of_dwelling)<=0||d==="annual_rental_income"&&x(t.monthly_rental_income)<=0||d==="management_fees"&&x(t.monthly_rental_income)<=0||d==="profit_amount"&&(x(t.monthly_rental_income)<=0||x(t.after_refurb_mortage_cost)<=0));for(const d of n){const N=x(t[d.name]);if(!N||N<=0){let D=`${d.label} is required and must be greater than 0`;d.name==="purchase_price"?D="Purchase price must be greater than zero":d.name==="gross_domestic_value"?D="GDV must be greater than zero":d.name==="no_of_dwelling"&&(D="At least one unit is required"),W(d.name,{type:"manual",message:D}),c.push(d.label),a=!1}}const h=[{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage",message:"LTV must be between 0% and 100%"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage",message:"Post-refurb LTV must be between 0% and 100%"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"contigency_percentage",label:"Contingency Percentage"},{name:"management_fee_percentage",label:"Management Fee Percentage"},{name:"deposit_percentage",label:"Deposit (%)",message:"Deposit must be between 0% and 100%"}];for(const d of h){const N=x(t[d.name]);(N<=0||N>100)&&d.name!=="contigency_percentage"&&(W(d.name,{type:"manual",message:d.message}),c.push(d.label),a=!1)}const u=[{name:"gross_domestic_value",label:"Gross Domestic Value",message:"GDV must be greater than zero"},{name:"refurbishment_cost",label:"Refurbishment Cost"},{name:"before_refurb_professional_fees",label:"Professional Fees"},{name:"after_refurb_professional_fees",label:"After Refurb Professional Fees"},{name:"deal_sourcing_fees",label:"Deal Sourcing Fees",message:"Sourcing fee cannot be negative or zero."}];for(const d of u)x(t[d.name])<=0&&(W(d.name,{type:"manual",message:d.message}),c.push(d.label),a=!1);(e==null?void 0:e.deal_type_id)==3||x(t.no_of_dwelling);const f=(e==null?void 0:e.deal_type_id)==3?1:x(t.no_of_dwelling);if((!Number.isInteger(f)||f<1)&&(W("no_of_dwelling",{type:"manual",message:"At least one unit is required"}),c.push("Number of Dwellings"),a=!1),f>1){const d=x(t.average_rent_per_unit);(!d||d<=0)&&(W("average_rent_per_unit",{type:"manual",message:"Average rent per unit is required when there are multiple dwellings"}),c.push("Average Rent per Unit"),a=!1)}return{isValid:a,errorFields:c}},k=t=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const{isValid:a,errorFields:c}=p(t);if(!a){console.warn("Validation failed. These fields are missing or invalid:",c);return}const n={};Object.keys(t).forEach(h=>{n[h]=typeof t[h]=="string"?Yt(t[h]):t[h]}),je.forEach(h=>{(!n[h]||n[h]==="")&&(n[h]="0")});const l={step:2,_method:"PATCH",purchase_price:n.purchase_price||0,before_refurb_loan_to_value_percentage:n.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:n.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:n.before_refurb_mortgage_value||0,before_refurb_mortage_cost:n.before_refurb_mortage_cost||0,stamp_duty_amount:n.stamp_duty_amount||0,effective_rate_percentage:n.effective_rate_percentage||0,deposit_percentage:n.deposit_percentage||0,deposit_amount_required:n.deposit_amount_required||0,before_refurb_professional_fees:n.before_refurb_professional_fees||0,deal_sourcing_fees:n.deal_sourcing_fees||0,total_investment:n.total_investment||0,refurbishment_cost:n.refurbishment_cost||0,contigency_percentage:n.contigency_percentage||0,contigency_amount:n.contigency_amount||0,furnishing_cost:n.furnishing_cost||0,project_management_fees:n.project_management_fees||0,total_cash_investment:n.total_cash_investment||0,gross_domestic_value:n.gross_domestic_value||0,after_refurb_loan_to_value_percentage:n.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:n.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:n.after_refurb_mortgage_value||0,after_refurb_mortage_cost:n.after_refurb_mortage_cost||0,after_refurb_professional_fees:n.after_refurb_professional_fees||0,after_refurb_money_left_in:n.after_refurb_money_left_in||0,money_in_cash_invested_percentage:n.money_in_cash_invested_percentage||0,after_refurb_money_out:n.after_refurb_money_out||0,money_out_cash_invested_percentage:n.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:n.no_of_dwelling||0,average_rent_per_unit:n.average_rent_per_unit||0,monthly_rental_income:n.monthly_rental_income||0,annual_rental_income:n.annual_rental_income||0,management_fee_percentage:n.management_fee_percentage||0,management_fees:n.management_fees||0,maintenance_fee_percentage:n.maintenance_fee_percentage||0,insurance:n.insurance||0,other_expenses:n.other_expenses||0,profit_amount:n.profit_amount||0,annual_profit_amount:n.annual_profit_amount||0,return_on_cash_investment_percentage:oe==null?void 0:oe.payloadROI,payback_period:(oe==null?void 0:oe.payloadPaybackPeriod)||0,investment_type:n.investment_type||"others"};t.property_type_id,H({apiFn:()=>lt(e.id,l),onSuccess:h=>{var f;r(mt(!0));const u={step:"2",...h==null?void 0:h.deal,id:(f=h==null?void 0:h.deal)==null?void 0:f.id,management_fee_percentage:n.management_fee_percentage||"",mortgage_payment:n.mortgage_payment||"",contigency_percentage:n.contigency_percentage||""};r(gt(u)),g("/create-deal/description")},onError:h=>{console.error("Error updating deal:",h)}})},P=(t,a,c)=>{const n=["profitable"].includes(t.name),l=t.reversed,h=t.name==="payback_period",u=(e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling"));if(t.name==="average_rent_per_unit"&&u===1)return null;const f=(t==null?void 0:t.name)==="stamp_duty_amount"?!ue:t.name==="monthly_rental_income"&&u===1?!1:t.calculated,d=t.name==="monthly_rental_income"&&u===1?!1:t.calculated,N={required:d||n?!1:`${t.label} is required`,...h||d?{}:{pattern:{value:t.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...t.isPercentage?{percentage:y=>en(y,t.name)}:{},maxValue:y=>Xt(y,t.name)}}},D={placeholder:d?"0":t.isPercentage?"0%":"Enter Amount",className:(t==null?void 0:t.name)==="stamp_duty_amount"?wt:f?Qt:wt,onKeyPress:y=>{if(!h&&!["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight"].includes(y.key)){if(t.isPercentage){if(y.key==="."&&!y.target.value.includes("."))return;if(y.key==="."&&y.target.value.includes(".")){y.preventDefault();return}/[0-9]/.test(y.key)||y.preventDefault();return}/[0-9,]/.test(y.key)||y.preventDefault()}},readOnly:f,onFocus:y=>{if(t.isPercentage&&!f){const j=y.target.value;j&&j.includes("%")&&setTimeout(()=>{const M=j.length-1;y.target.setSelectionRange(M,M)},0)}},onChange:y=>{let j=y.target.value;if(t.isPercentage){m(y,t.name);return}let M=j.replace(/[^0-9,]/g,"");const X=M.split(",");if(X.length>2&&(M=X[0]+","+X.slice(1).join("")),i(t.name,M),M&&!isNaN(parseFloat(M.replace(/,/g,"")))){const me=Math.round(parseFloat(M.replace(/,/g,"")));y.target.value=me.toLocaleString("en-US")}else M===""&&(y.target.value="");at(M,i,t.name,c,W,B,w),jt(M,i,t.name,c,W,B,w)},onBlur:y=>{if(t.name==="purchase_price")$(y);else if(t.isPercentage&&!f){const j=y.target.value;j&&!j.includes("%")?(y.target.value=$e(j),i(t.name,j)):j===""&&(y.target.value="",i(t.name,""))}}};if(f&&t.isPercentage){const y=w(t.name);y&&(D.value=$e(y))}const I=o.jsxs("div",{className:"",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...a(t.name,N),...D})}),c[t.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:c[t.name].message})]}),ce=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:((e==null?void 0:e.deal_type_id)===3||(e==null?void 0:e.deal_type_id)===5)&&(t==null?void 0:t.name)==="no_of_dwelling"?"Number of bedrooms":(e==null?void 0:e.deal_type_id)===5&&(t==null?void 0:t.name)==="maintenance_fee_percentage"?"Bills":t.label})});return o.jsx("div",{className:"purchase-custom-grid",children:l?o.jsxs(o.Fragment,{children:[I,ce]}):o.jsxs(o.Fragment,{children:[ce,I]})})},L=(t,a,c)=>{const n=(e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling"));if(t.fields.length===1&&t.fields[0].name==="average_rent_per_unit"&&n===1)return null;const l=(t.highlight,"my-4"),h=t.fields.filter(u=>!(u.name==="no_of_dwelling"&&((e==null?void 0:e.deal_type_id)===2||(e==null?void 0:e.deal_type_id)===3)||(u.name==="insurance"||u.name==="other_expenses")&&(e==null?void 0:e.deal_type_id)===5));return h.length===0?null:t.columns===2?o.jsx("div",{className:l,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:h.map(u=>o.jsx("div",{className:"purchase-price-group-wrap relative",children:u.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[P(u,a,c),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ue?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(f=>!f),children:o.jsx(ze,{className:"w-4 h-4"})})]}):P(u,a,c)},u.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:h.map(u=>o.jsx("div",{className:"relative",children:u.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[P(u,a,c),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ue?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(f=>!f),children:o.jsx(ze,{className:"w-4 h-4"})})]}):P(u,a,c)},u.name))})},O=(t,a,c)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:t.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:t.fields.map(n=>n.rows.map((l,h)=>o.jsx(Ne.Fragment,{children:L(l,a,c)},h)))})]})})}),J=q({control:G,name:"before_refurb_loan_to_value_percentage"}),z=q({control:G,name:"deposit_percentage"});return V.useEffect(()=>{if(!J)return;const t=x(J),a=100-t;i("deposit_percentage",a.toString()),B("deposit_percentage");const c=document.querySelector('input[name="deposit_percentage"]');c&&!c.readOnly&&(c.value=$e(a));const n=x(w("purchase_price"));if(n>0&&t>0){const l=n*(a/100);i("deposit_amount_required",te(l))}},[J]),V.useEffect(()=>{if(!z)return;const t=x(z),a=100-t;i("before_refurb_loan_to_value_percentage",a.toString());const c=document.querySelector('input[name="before_refurb_loan_to_value_percentage"]');c&&!c.readOnly&&(c.value=$e(a));const n=x(w("purchase_price"));if(n>0&&a>0){const l=n*(a/100);i("before_refurb_mortgage_value",te(l));const h=x(w("before_refurb_interest_rate_percentage"))/100,u=l*h/12;i("before_refurb_mortage_cost",te(u));const f=n*(t/100);i("deposit_amount_required",te(f))}},[z]),o.jsxs(o.Fragment,{children:[se&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:U(k),children:[Lt.map(t=>o.jsx(Ne.Fragment,{children:O(t,ke,pe)},t.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case3 px-4 pb-4",children:[o.jsxs("button",{type:"button",onClick:()=>g("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"submit",style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center kkkk",children:["Next",o.jsx(_t,{})]})]})]})]})},rn=()=>{const e=Ue(),s=we(_=>_.deal.deal),r=e.pathname.includes("/summary"),{currentCase:g}=qt({deal_type_id:s==null?void 0:s.deal_type_id});return o.jsxs("div",{className:"min-h-screen financial-page-main-div-wrap",children:[o.jsx("div",{className:"financial-details-step-heading",children:o.jsx("h4",{className:"font-semibold heading-color2 dark:text-white",children:"Financial details"})}),o.jsx("div",{className:"financial-page-inner-div-wrap",children:r?o.jsx(It,{currentCase:g}):o.jsxs(o.Fragment,{children:[g==="CASE_1"&&o.jsx(Pt,{}),g==="CASE_2"&&o.jsx(Zt,{}),g==="CASE_3"&&((s==null?void 0:s.exit_type_id)===1?o.jsx(Rt,{}):o.jsx(Pt,{})),g==="CASE_4"&&o.jsx(Rt,{})]})})]})};export{rn as default};
