import{V as te,av as re,a8 as W,aJ as le,v as oe,u as k,aK as ue,r as l,w as ne,m as e,z as me,aL as he,aM as xe,aN as fe,aO as be,aP as ge,aQ as ye,aR as _e,Q as je,aH as Ne,a3 as Ce,am as we}from"./index-CgNjIY1j.js";import{M as ke}from"./ManualAddComperable-DJye_5BB.js";import"./DragAndDrop-BulizbfI.js";import"./index-DyKnPmNM.js";const Fe="/empty-comparebles.png",Se=({onCloseFirst:x,aiComparableData:a=[],loading:L,dealTypeId:F,handleManualcomparableModel:T,onClose:Q})=>{const{register:S,watch:j,defaultValues:ce,setValue:ie,formState:{errors:R}}=te({mode:"onChange",defaultValues:{property_radius_id:"3.0",year:"2024",tenure_type:"Freehold"}}),J=[2020,2022,2023,2024],{handleApiCall:K}=re(),{data:E}=W(le),v=oe(),r=k(s=>{var o;return(o=s==null?void 0:s.deal)==null?void 0:o.deal}),{property_types:de,property_radiuses:D}=(E==null?void 0:E.data)||{},[n,I]=ue.useState([]),[P,pe]=l.useState(!1),[A,X]=l.useState(a),f=k(s=>s.deal.manualComperable||[]),u=[...Array.isArray(f)?f:[],...A||[]],Z=j("property_radius_id"),z=j("bedrooms"),V=j("year"),ee=j("sub_category"),Y=j("tenure_type"),[O,$]=l.useState(!1),[g,N]=l.useState(!1),[U,y]=l.useState(!1),h=async()=>{var o,c,m,d;if(!(r!=null&&r.id))return;const s={address1:(r==null?void 0:r.address_line_1)||"",address2:(r==null?void 0:r.address_line_2)||"",city:(r==null?void 0:r.city)||"",postCode:(r==null?void 0:r.post_code)||"",country:((o=r==null?void 0:r.country)==null?void 0:o.name)||"",no_of_bedroom:z,no_of_dwellings:(r==null?void 0:r.no_of_dwelling)||1,year_of_sale:V||"2024",distance:Z||"3.0",type:"ai",property_type:i(ee||((c=r==null?void 0:r.sub_category)==null?void 0:c.title)||((m=r==null?void 0:r.property_type_category)==null?void 0:m.title)||"Other"),tenure_type:Y||"Freehold"};try{w(!0);const p=await be(r.id,1,s),_=((d=p==null?void 0:p.data)==null?void 0:d.dealComparables)||[];X(_),!(_.length>0||Array.isArray(f)&&f.length>0)&&!U&&(N(!0),y(!0))}catch(p){console.error("API error:",p),Array.isArray(f)&&f.length===0&&!U&&(N(!0),y(!0))}finally{w(!1)}};l.useEffect(()=>{r!=null&&r.id&&h()},[]);const b=l.useRef();l.useEffect(()=>{if(!b.current)return;const s=u.length,o=n.length;b.current.indeterminate=!1,b.current.checked=s>0&&o===s},[n,u.length]);const q=ne(),[se,ae]=l.useState(!1),[C,w]=l.useState(!1),[B,H]=l.useState([]),G=async()=>{var s,o;try{w(!0);const c=await ge(r==null?void 0:r.id,1,B,z);v(ye(((s=c==null?void 0:c.data)==null?void 0:s.dealComparables)||[])),v(_e()),ae(((o=c==null?void 0:c.data)==null?void 0:o.data)||[]);const m={_method:"PATCH"};await K({apiFn:()=>Ne(r==null?void 0:r.id,m),onSuccess:d=>{var _;const p={...d==null?void 0:d.deal,id:(_=d==null?void 0:d.deal)==null?void 0:_.id};v(je(p))},onError:d=>{console.error("Error updating deal:",d)}})}catch(c){console.error("Error fetching comparables:",c)}finally{w(!1)}};l.useEffect(()=>{const s=u.filter((o,c)=>n.includes(c));H(s)},[n]);const M={Flat:"Apartments/Flat",Detached:"Detached",Semi_Detached:"Semi Detached",Terraced:"Terraced",Other:"Other"},i=s=>{const o=d=>d.toLowerCase().replace(/[^a-z0-9]+/g,""),c=o(s),m=Object.entries(M).find(([d,p])=>o(p)===c);return m?m[0]:"Other"},t={property_radiuses:[{id:"0.0",title:"0.0 miles"},{id:"0.25",title:"0.25 miles"},{id:"0.5",title:"0.5 miles"},{id:"1.0",title:"1.0 miles"},{id:"3.0",title:"3.0 miles"},{id:"5.0",title:"5.0 miles"},{id:"10.0",title:"10.0 miles"},{id:"15.0",title:"15.0 miles"}]};return e.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:[e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-5xl relative mx-5 mobile-view-adjust dark:bg-[#181818]",children:[C&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(me,{})}),e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:x,children:"✕"}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-0 md:mb-2 dark:text-[#F8F8F8]",children:"Add comparable from database"})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("h4",{className:"dark:text-[#F8F8F8]",children:"Filters"}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-2 mb-5 items-end",children:[e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Distance"}),e.jsxs("select",{...S("property_radius_id"),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select distance"}),t.property_radiuses.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Year of sale"}),e.jsxs("select",{...S("year"),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Option"}),J.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Sub Category"}),e.jsx("div",{className:"",children:e.jsx("select",{...S("sub_category"),className:"form-select focus:outline-none",children:Object.entries(M).map(([s,o])=>e.jsx("option",{value:s,children:o},s))})})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"Tenure Type"}),e.jsx("div",{children:e.jsxs("select",{...S("tenure_type",{defaultValue:"Freehold"}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Option"}),e.jsx("option",{value:"Freehold",children:"Freehold"}),e.jsx("option",{value:"Leasehold",children:"Leasehold"})]})})]}),e.jsx("div",{className:"purple-btn mb-1",style:{width:"fit-content"},children:e.jsxs("button",{className:"flex items-center gap-2 whitespace-nowrap",onClick:h,children:[e.jsx(he,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})]}),e.jsx("div",{className:"max-h-[50vh] overflow-y-auto border rounded-xl dark:border-[#333333]",children:e.jsxs("table",{className:"w-full text-left border-collapse  ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-white text-[12px] border-t border-b border rounded-xl dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:e.jsx("input",{type:"checkbox",ref:b,onChange:s=>{const o=s.target.checked;I(o?u.map((c,m)=>m):[])},checked:u.length>0&&n.length===u.length})}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-4 text-center text-gray-500",children:"Loading comparables..."})}):(u==null?void 0:u.length)>0?u==null?void 0:u.map((s,o)=>{var c,m,d;return e.jsxs("tr",{className:"border-b dark:border-b-[#333333]",children:[e.jsx("td",{className:"p-4",children:e.jsx("input",{type:"checkbox",checked:n.includes(o),onChange:()=>{I(p=>p.includes(o)?p.filter(_=>_!==o):[...p,o])}})}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:s!=null&&s.image_url?s.image_url:(s==null?void 0:s.image)||xe,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px] dark:text-[#F8F8F8]",children:s==null?void 0:s.address}),s!=null&&s.linked_search_url?e.jsx("a",{href:s.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(s==null?void 0:s.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:fe,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:(d=(m=(c=(s==null?void 0:s.property_type_string)||(s==null?void 0:s.sub_category))==null?void 0:c.toLowerCase())==null?void 0:m.replace(/_/g," "))==null?void 0:d.replace(/\b\w/g,p=>p.toUpperCase())}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:s.no_of_bedroom}),e.jsxs("td",{className:"p-4 dark:text-[#F8F8F8]",children:["£",Number(s.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:s.year}),e.jsx("td",{className:"p-4 dark:text-[#F8F8F8]",children:(s==null?void 0:s.distance)!=null?`${parseFloat(s==null?void 0:s.distance).toFixed(2)} Mile${(s==null?void 0:s.distance)>1?"s":""}`:"-"})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"p-4 text-center text-gray-500",children:"No comparables found."})})})]})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex-row md:flex justify-between px-4 mx-5",children:[e.jsx("div",{children:e.jsx("button",{className:"purple-btn my-4",onClick:()=>{N(!1),y(!0),T(!0)},children:"+ Add Manually"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 mt-3 justify-around sm:justify-start",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 dark:text-[#F8F8F8] rounded-lg",onClick:x,children:"Cancel"}),e.jsx("button",{onClick:()=>{if(u.length===0&&n.length===0){$(!0);return}Q(),(n==null?void 0:n.length)>0&&G(),q("/create-deal/comparable-table")},className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${(n==null?void 0:n.length)>0?"purple-btn cursor-pointer":"bg-gray-200 cursor-not-allowed"}`,style:{display:"flex"},disabled:(n==null?void 0:n.length)===0,children:`Import ${(n==null?void 0:n.length)||""} item${(n==null?void 0:n.length)===1?"":"s"}`})]})})]})})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-center",children:"No comparables found"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Do you want to add a manual comparable or continue without adding any?"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{className:"px-4 py-2 border rounded-lg",onClick:()=>{N(!1),y(!0),T(!0)},children:"Add Manually"}),e.jsx("button",{className:"px-4 py-2 rounded-lg purple-btn",onClick:()=>{N(!1),x(),q("/create-deal/comparable-table")},children:"Continue"})]})]})})]})},ve="/assets/empty-comparebles-dark-DlqepoD1.png",De=x=>{const a=parseFloat(x.replace(/[^0-9.]/g,""));return isNaN(a)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(a)},Te=()=>{const{data:x}=W(le),a=k(i=>{var t;return(t=i==null?void 0:i.deal)==null?void 0:t.deal}),{comparableDealId:L}=k(i=>i==null?void 0:i.deal),{data:F}=W(L||null,a==null?void 0:a.deal_type_id),[T,Q]=l.useState("description"),[S,j]=l.useState(!1),[ce,ie]=l.useState([]);oe();const R=ne();Ce();const[J,K]=l.useState(null),[E,v]=l.useState(null),[r,de]=l.useState(!1);re();const[D,n]=l.useState(null),[I,P]=l.useState(null),[pe,A]=l.useState(!1),{property_types:X,property_radiuses:f}=(x==null?void 0:x.data)||{},u={property_radiuses:f};k(i=>i.deal.currentStep),k(i=>i.deal.comparableMode);const[Z,z]=l.useState(!1),[V,ee]=l.useState([]),[Y,O]=l.useState(!1),[$,g]=l.useState(!1),{register:N,handleSubmit:U,reset:y,setValue:h,watch:b,formState:{errors:q}}=te({mode:"onChange"}),[se,ae]=l.useState(!1);b("property_radius_id");const C=b("price");l.useEffect(()=>{if(C&&!C.includes("$")){const i=De(C);h("price",i)}},[C,h]);const w=new Date().getFullYear();Array.from(new Array(w-2021),(i,t)=>2022+t);const B=i=>{i&&(g(!1),O(!0))},H=()=>{O(!1)},G=()=>{g(!0),O(!1)};l.useEffect(()=>{var o,c,m;const i=((c=(o=u.property_radiuses)==null?void 0:o[0])==null?void 0:c.id)??"",t=(m=F==null?void 0:F.data)==null?void 0:m.dealComparable,s={property_type_id:(t==null?void 0:t.property_type_id)??(a==null?void 0:a.property_type_id)??"",no_of_bedroom:(t==null?void 0:t.no_of_bedroom)??((a==null?void 0:a.deal_type_id)===2?"":(a==null?void 0:a.no_of_bedroom)??(a==null?void 0:a.no_of_dwelling)??""),no_of_dwelling:(t==null?void 0:t.no_of_dwelling)??((a==null?void 0:a.deal_type_id)===2?(a==null?void 0:a.no_of_dwelling)??"":""),size_in_sqm:(t==null?void 0:t.size_in_sqm)??"",price:(t==null?void 0:t.price)??"",year:(t==null?void 0:t.year)??"",property_radius_id:(t==null?void 0:t.property_radius_id)??i,linked_search_url:(t==null?void 0:t.linked_search_url)??"",link:(t==null?void 0:t.link)??""};if(y(s),t!=null&&t.image_url){P({url:t.image_url,path:t.image}),n(t.image_url),A(!1);const d=t.image_url.split(".").pop().toLowerCase(),p=["mp4","mov","avi","webm"].includes(d);v(p?"video":"image")}else P(null),n(null),A(!1)},[F,a,y,u.property_radiuses]),l.useEffect(()=>()=>{D&&D.startsWith("blob:")&&URL.revokeObjectURL(D)},[D]),b("property_type_id"),l.useEffect(()=>{a!=null&&a.property_type_id&&h("property_type_id",String(a.property_type_id))},[a==null?void 0:a.property_type_id,h]),h("no_of_dwelling",Number(a==null?void 0:a.no_of_dwelling)),l.useEffect(()=>{a&&(a.no_of_dwelling!=null&&h("no_of_dwelling",Number(a.no_of_dwelling)),a.no_of_dwelling!=null&&h("no_of_bedroom",Number(a.no_of_dwelling)))},[a,h]);const M=()=>{g(!1)};return e.jsx("div",{className:"",children:e.jsxs("div",{className:"border rounded-xl p-5 mx-0 lg:mx-20 dark:border-[#454545]",children:[e.jsx("h4",{children:"Comparable"}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:Fe,className:"h-[400px] block dark:hidden",alt:""}),e.jsx("img",{src:ve,className:"h-[400px] hidden dark:block",alt:""}),e.jsx("h4",{children:"No data available"}),e.jsx("p",{className:"my-1 light-black dark:text-[#C5C5C5]",children:"To add properties to compare, click “Add comparable” to compare"}),e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>{(a==null?void 0:a.deal_type_id)===2?R("/create-deal/sa-api-comparable"):g(!0)},children:"+ Add Comparable"}),$&&e.jsx(Se,{handleManualcomparableModel:B,dealTypeId:a==null?void 0:a.deal_type_id,aiComparableData:V,loading:se,onClose:()=>g(!1),onCloseFirst:M}),Y&&e.jsx(ke,{handleCloseManualComparable:H,handleFinishManualComparable:G})]}),e.jsx("div",{className:"flex items-center justify-between mt-10",children:e.jsxs("button",{onClick:()=>R("/create-deal/description"),className:"w-fit items-center gap-5 justify-center flex",children:[e.jsx(we,{}),"Back"]})})]})})};export{Te as default};
