import{v as W,u as f,r as n,t as A,w as G,bw as Y,m as e,bz as q,bx as H,by as h,z as J,bC as K,bA as O}from"./index-C1xI0dPE.js";import{u as Q}from"./useRefreshUser-CS87UnPr.js";import{u as V}from"./useFetchData-yRMqlthQ.js";const re=()=>{var y,S,k,P,_;const r=W(),E=Q(),a=f(t=>{var l;return(l=t.user)==null?void 0:l.user}),L=f(t=>{var l;return(l=t.user)==null?void 0:l.role}),s=f(t=>{var l;return(l=t.plan)==null?void 0:l.plan}),[R,o]=n.useState(null),[i,m]=n.useState(null),[b,g]=n.useState(null),[d,j]=n.useState(!1),[X,N]=n.useState(!1),[Z,ee]=n.useState(!1),[se,T]=n.useState(!1),[te,B]=n.useState(!1),[ae,U]=n.useState(null),[u,C]=n.useState(""),[$,v]=n.useState(!1),{showSnackbar:x}=A(),w=G();V({fetchFn:O,onSuccess:t=>{r(setPlan({plan:t}))},shouldFetch:s===null});const z=()=>{w("/cancel-subscription")},I=async()=>{var t,l,F;if(a!=null&&a.user_subscription){if(!u.trim()){x("Please provide a reason for cancellation","error");return}j(!0),T(!1),v(!0);try{const p=await K(a.user_subscription.id,L,{cancelReason:u});if(x(((t=p.data)==null?void 0:t.message)||"Subscription cancelled successfully","success"),await E(),g(null),s){const D=s.find(M=>parseFloat(M.price)===0);D&&(o(D),N(!1))}}catch(p){x(((F=(l=p.response)==null?void 0:l.data)==null?void 0:F.error)||"Failed to cancel subscription","error")}finally{j(!1),v(!1),C("")}}};n.useEffect(()=>{if(!(!s||!a)){if(a!=null&&a.user_subscription){const t=s.find(l=>l.id===(a==null?void 0:a.user_subscription.product_id));t&&g(t)}else if(!R){const t=s.find(l=>parseFloat(l.price)===0);t&&o(t)}}},[s,a]),n.useEffect(()=>{r(Y())},[r]);const c=t=>(a==null?void 0:a.user_subscription)&&a.user_subscription.product_id===t;return e.jsxs("div",{children:[e.jsx("h3",{children:"Cancel subscription"}),e.jsx("p",{children:"Manage subscription"}),$&&e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-4",children:[e.jsxs("div",{className:"",children:[e.jsx("p",{className:"my-3",children:"Type “Cancel” to confirm "}),e.jsx("input",{id:"cancelReason",value:u,onChange:t=>C(t.target.value),className:"form-control focus:outline-none",rows:"3",placeholder:"Enter text"}),e.jsxs("div",{className:"flex flex-col items-center justify-center w-full my-5",children:[e.jsx("button",{onClick:I,className:"bg-[#6C5DD3] w-full p-3 rounded-xl mb-4 text-sm text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Yes, cancel subscription"}),e.jsx("button",{onClick:()=>w("/settings/subscription"),className:"gray-btn w-full p-3 rounded-xl text-sm",children:"Go back"})]})]}),e.jsx("div",{className:"",children:e.jsx("div",{className:"",children:(s==null?void 0:s.length)>0&&e.jsxs("div",{className:`subscription-plans-container rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-all duration-300 border-2 bg-white ${c(s[0].id)?"border border-[#6C5DD3] !bg-[#E4E7FB]":parseFloat(s[0].price)===0?"border-[#6C5DD3] bg-[#E4E7FB]":"border border-[#F4F4F4]"} relative flex justify-between flex-col h-full`,children:[c(s[0].id)&&e.jsx("div",{className:"absolute text-[#7E22CE] text-[10px] font-light bg-white rounded-xl py-1 px-2  right-[60px] top-[20px]",children:e.jsx("p",{children:"Current plan"})}),c(s[0].id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(H,{className:"text-[#6C5DD3] text-xl"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-black",children:[s[0].title," Package"]}),e.jsx("p",{className:"text-sm text-black mt-1",children:s[0].description})]}),e.jsxs("div",{className:"p-6 text-gray-300",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("span",{className:"text-3xl font-bold dark:text-[#fff] text-[#000]",children:["£",parseFloat(s[0].price).toFixed(2)]}),e.jsxs("span",{className:"text-sm dark:text-[#fff] text-[#000]",children:[" "," / ",(y=s[0].plan_type)==null?void 0:y.interval]})]}),e.jsx("p",{className:"text-black font-medium text-lg my-3",children:"What’s included:"}),e.jsxs("ul",{className:"text-sm space-y-2",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"text-black"}),e.jsx("span",{className:"font-semibold text-[#6C5DD3]",children:"Plan Type:"}),e.jsx("span",{className:"dark:text-[#fff] text-[#000]",children:(S=s[0].plan_type)==null?void 0:S.interval})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"text-black"}),e.jsxs("span",{className:"dark:text-[#fff] text-[#000]",children:[(k=s[0].plan_type)==null?void 0:k.interval_count," ",(P=s[0].plan_type)==null?void 0:P.interval]})," ",e.jsx("span",{className:"dark:text-[#fff] text-[#000]",children:"Billing Cycle"})]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"text-black"}),e.jsx("span",{className:"dark:text-[#fff] text-[#000] font-semibold",children:"Deal Limit:"})," ",e.jsxs("span",{className:"dark:text-[#fff] text-[#000]",children:[(_=s[0])==null?void 0:_.deal_limit," active deals"]})]}),s[0].trial_period_days>0&&e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold text-[#6C5DD3]",children:"Trial:"})," ",e.jsxs("span",{className:"dark:text-[#fff] text-[#000]",children:[s[0].trial_period_days," days free"]})]})]})]}),e.jsx("div",{className:"p-4 text-center",children:c(s[0].id)?e.jsx("button",{className:`w-full py-3 rounded-lg font-semibold transition-colors duration-200 ${d&&i===s[0].id?"bg-gray-600 cursor-not-allowed":"bg-white border text-[#DE2424]"}`,onClick:z,disabled:d&&i===s[0].id,children:d&&i===s[0].id?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(J,{size:20})}):"Cancel Subscription"}):e.jsx("button",{className:`w-full py-3 rounded-lg transition-colors duration-200 ${i===s[0].id?"bg-white border cursor-not-allowed":"bg-white border text-black"}`,onClick:()=>{m(s[0].id);const t=(a==null?void 0:a.user_subscription)&&parseFloat(a.user_subscription.price||0)>0;if(b&&t)U(s[0]),B(!0);else{const l={...s[0],savedCards:[]};o(l),N(!0)}setTimeout(()=>{m(null)},1e3)},disabled:i!==null&&i!==s[0].id,children:i===s[0].id?e.jsx("div",{className:"flex items-center justify-center",children:"Processing..."}):b?`Upgrade to ${s[0].title} Package`:"Subscribe Now"})})]},s[0].id)})})]})]})};export{re as default};
