import{r as t,au as X,q as ee,t as se,a2 as re,V as ne,cv as de,m as e,x as te,bu as ie,Y as oe,cw as ce,cx as me,cy as ue,ay as he,u as ge,y as je,n as ve,o as we,p as Ne,c4 as ye,cz as Ce}from"./index-9ac5ZXnL.js";import{l as ke}from"./lodash-BdQSrI4-.js";import{D as Fe}from"./DeleteConfirmationModal-C5JEySSV.js";import{P as Ee}from"./PaginationNew-BSabwqku.js";import{I as xe}from"./ImportContactsModal-CVW1PWZX.js";const Se=({isOpen:p,onClose:k,onSuccess:r})=>{var f;const[j,L]=t.useState(!1),{handleApiCall:M,loading:F}=X(),[E,v]=t.useState(!1),[q,w]=t.useState(!1);t.useRef(null);const[O,H]=t.useState(!1),[W,z]=t.useState(!1),[$,K]=t.useState([]),{showSnackbar:B}=ee(),U=se(),x=(f=re().state)==null?void 0:f.contactId,N=!!x,{register:_,handleSubmit:T,reset:A,setValue:o,formState:{errors:D}}=ne({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",phone:""}}),[J,G]=t.useState({news:!1,deals:!1,investment:!1});t.useEffect(()=>{p&&x&&!E&&(v(!0),R()),p||(P(),v(!1))},[p,x,E]);const R=async()=>{var d,n,y,i,I,V,m,C;L(!0);try{const g=await de(x),S=(n=(d=g==null?void 0:g.data)==null?void 0:d.data)==null?void 0:n.contact;S&&(o("first_name",S.first_name),o("last_name",S.last_name),o("email",S.email),o("password",S.password),o("phone",S.phone))}catch(g){if(console.error("Error fetching contact:",g),((y=g.response)==null?void 0:y.status)===404||(V=(I=(i=g.response)==null?void 0:i.data)==null?void 0:I.message)!=null&&V.includes("could not be found")){B("Contact not found. Creating a new contact instead.","warning"),P();return}B(((C=(m=g==null?void 0:g.response)==null?void 0:m.data)==null?void 0:C.message)||"Failed to fetch contact details. Please try again.","error")}finally{L(!1)}},P=()=>{A({first_name:"",last_name:"",email:"",password:"",phone:""}),v(!1)},Z=d=>{const n={...d};N&&!n.password&&delete n.password,M({apiFn:()=>N?ce(x,n):me(n),data:n,onSuccess:y=>{var i;B(((i=y==null?void 0:y.data)==null?void 0:i.message)||(N?"Contact updated successfully":"Contact added successfully"),"success"),k(),r&&r(),U("/all-contacts")}})},c=()=>{H(!0),M({apiFn:()=>ue($),onSuccess:()=>{z(!1),K([]),k(),r&&r()}})};return p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-xs z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl min-h-[40vh] md:min-h-[70vh] mx-5 relative dark:bg-[#181818]",children:[(F||j)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 z-10 flex items-center justify-center",children:j?e.jsx(te,{}):e.jsx(ie,{})}),e.jsxs("div",{className:"flex justify-between items-center p-4 py-5 px-5 border-b border-gray-300",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl text-black font-semibold mb-1 dark:text-[#ECECEC]",children:N?"Edit Contact":"Add New Contact"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:k,className:"text-gray-700 transition-colors p-1 dark:text-[#F8F8F8]",disabled:F||j,children:e.jsx(oe,{size:20})})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsx("div",{className:"add-contact-form-wrap",children:e.jsxs("form",{onSubmit:T(Z),children:[e.jsxs("div",{className:"bg-[#FDFDFD] dark:bg-[#181818]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Full Name"}),e.jsx("input",{type:"text",..._("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),D.first_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:D.first_name.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Email Address"}),e.jsx("input",{type:"email",..._("email",{required:"Email address is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter email address"}),D.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:D.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Phone Number"}),e.jsx("input",{type:"number",min:0,onWheel:d=>d.target.blur(),onKeyDown:d=>{(d.key==="ArrowUp"||d.key==="ArrowDown"||["e","E","+","-"].includes(d.key))&&d.preventDefault()},..._("phone",{required:"Phone number is required",pattern:{value:/^[0-9\s\-\+\(\)]{10,11}$/,message:"Invalid phone number format"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter phone number"}),D.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:D.phone.message})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-10 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>k(),className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",disabled:F,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F,className:`purple-btn ${F?"opacity-70 cursor-not-allowed":""}`,children:e.jsx("span",{className:"flex items-center gap-2",children:N?"Update Contact":"Add Contact"})})]})]})})})]})}),e.jsx(xe,{isOpen:W,onClose:()=>z(!1),onConfirm:c,contacts:$,isLoading:O})]}):null},_e=({isOpen:p,onClose:k,onSuccess:r,contactId:j})=>{const[L,M]=t.useState(!1),{handleApiCall:F,loading:E}=X(),[v,q]=t.useState(!1),[w,O]=t.useState(!1);t.useRef(null);const[H,W]=t.useState(!1),[z,$]=t.useState(!1),[K,B]=t.useState([]),{showSnackbar:U}=ee(),Y=se();re();const x=!!j,{register:N,handleSubmit:_,reset:T,setValue:A,formState:{errors:o}}=ne({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",phone:""}}),[D,J]=t.useState({news:!1,deals:!1,investment:!1});t.useEffect(()=>{p&&j&&!v&&(q(!0),G()),p||(R(),q(!1))},[p,j,v]);const G=async()=>{var c,f,d,n,y,i,I,V;M(!0);try{const m=await de(j),C=(f=(c=m==null?void 0:m.data)==null?void 0:c.data)==null?void 0:f.contact;C&&(A("first_name",C.first_name),A("last_name",C.last_name),A("email",C.email),A("password",C.password),A("phone",C.phone))}catch(m){if(console.error("Error fetching contact:",m),((d=m.response)==null?void 0:d.status)===404||(i=(y=(n=m.response)==null?void 0:n.data)==null?void 0:y.message)!=null&&i.includes("could not be found")){U("Contact not found. Creating a new contact instead.","warning"),R();return}U(((V=(I=m==null?void 0:m.response)==null?void 0:I.data)==null?void 0:V.message)||"Failed to fetch contact details. Please try again.","error")}finally{M(!1)}},R=()=>{T({first_name:"",last_name:"",email:"",password:"",phone:""}),q(!1)},P=c=>{const f={...c};x&&!f.password&&delete f.password,F({apiFn:()=>x?ce(j,f):me(f),data:f,onSuccess:d=>{var n;U(((n=d==null?void 0:d.data)==null?void 0:n.message)||(x?"Contact updated successfully":"Contact added successfully"),"success"),k(),r&&r(),Y("/all-contacts")}})},Z=()=>{W(!0),F({apiFn:()=>ue(K),onSuccess:()=>{$(!1),B([]),k(),r&&r()}})};return p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-xs z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl min-h-[40vh] md:min-h-[70vh] mx-5 relative dark:bg-[#181818]",children:[(E||L)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 z-10 flex items-center justify-center",children:L?e.jsx(te,{}):e.jsx(ie,{})}),e.jsxs("div",{className:"flex justify-between items-center p-4 py-5 px-5 border-b border-gray-300",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl text-black font-semibold mb-1 dark:text-[#ECECEC]",children:x?"Edit Contact":"Add New Contact"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:k,className:"text-gray-700 transition-colors p-1 dark:text-[#ECECEC]",disabled:E||L,children:e.jsx(oe,{size:20})})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsx("div",{className:"add-contact-form-wrap",children:e.jsxs("form",{onSubmit:_(P),children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Full Name"}),e.jsx("input",{type:"text",...N("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),o.first_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.first_name.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Email Address"}),e.jsx("input",{type:"email",...N("email",{required:"Email address is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),className:"form-control",placeholder:"Enter email address"}),o.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Phone Number"}),e.jsx("input",{type:"number",min:0,onWheel:c=>c.target.blur(),onKeyDown:c=>{(c.key==="ArrowUp"||c.key==="ArrowDown"||["e","E","+","-"].includes(c.key))&&c.preventDefault()},...N("phone",{required:"Phone number is required",pattern:{value:/^[0-9\s\-\+\(\)]{10,11}$/,message:"Invalid phone number format"}}),className:"form-control",placeholder:"Enter phone number"}),o.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.phone.message})]})]}),e.jsxs("div",{className:"flex justify-end mt-10 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>k(),className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",disabled:E,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:E,className:`purple-btn ${E?"opacity-70 cursor-not-allowed":""}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[x?"":e.jsx(he,{}),x?"Update Contact":"Add Contact"]})})]})]})})})]})}),e.jsx(xe,{isOpen:z,onClose:()=>$(!1),onConfirm:Z,contacts:K,isLoading:H})]}):null},Me=()=>{const{role:p,user:k}=ge(s=>s.user);se();const[r,j]=t.useState([]),[L,M]=t.useState(!0),[F,E]=t.useState(""),[v,q]=t.useState([]),[w,O]=t.useState(null),[H,W]=t.useState({top:0,left:0}),[z,$]=t.useState(!1),[K,B]=t.useState(!1),[U,Y]=t.useState(!1),[x,N]=t.useState(null),_=t.useRef(null),T=t.useRef({}),A=t.useRef(null),{showSnackbar:o}=ee(),{handleApiCall:D}=X(),[J,G]=t.useState(0),[R,P]=t.useState({isOpen:!1,contactId:null,isLoading:!1}),Z=()=>{B(!0)},c=()=>{B(!1)},f=s=>{N(s),Y(!0)},d=()=>{Y(!1)},[n,y]=t.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[i,I]=t.useState({page:1,per_page:(n==null?void 0:n.total)>=5?5:(n==null?void 0:n.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""});t.useEffect(()=>{function s(u){_.current&&!_.current.contains(u.target)&&O(null)}function a(){w!==null&&O(null)}function b(){if(w!==null&&T.current[w]){const h=T.current[w].getBoundingClientRect(),Q=window.innerHeight-h.bottom,l=h.top;$(Q<200&&l>200),W({top:z?h.top-10:h.bottom+5,left:h.right-160})}}return b(),document.addEventListener("mousedown",s),document.addEventListener("scroll",a,!0),window.addEventListener("resize",b),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("scroll",a,!0),window.removeEventListener("resize",b)}},[w,z]);const V=ke.debounce(s=>{I(a=>({...a,search:s,page:1}))},1e3),m=s=>{const a=s.target.value;E(a),V(a)},C=s=>{q(a=>a.includes(s)?a.filter(b=>b!==s):[...a,s])},g=s=>{const{name:a,value:b}=s.target;I({...i,[a]:b,page:1})},S=async()=>{var s,a,b;M(!0);try{const u=await ye({...i,perPage:i.per_page||10,status:i.status==="all"?null:i.status}),{data:h}=u==null?void 0:u.data;j((h==null?void 0:h.contacts)||[]);const Q=(s=h==null?void 0:h.user_subscriptions)==null?void 0:s.user_limit;G(Q);const l=u.data.data.page_context;l&&y({currentPage:parseInt(l==null?void 0:l.page)||1,totalPages:Math.ceil(parseInt((l==null?void 0:l.total_records)||0)/parseInt((l==null?void 0:l.per_page)||10)),from:(parseInt(l.page)-1)*parseInt(l.per_page)+1,to:Math.min(parseInt(l==null?void 0:l.page)*parseInt(l==null?void 0:l.per_page),parseInt((l==null?void 0:l.total_records)||0)),total:parseInt((l==null?void 0:l.total_records)||0),hasMorePages:(l==null?void 0:l.has_more_page)==="true"})}catch(u){console.error("Error fetching contacts:",u),o(((b=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:b.message)||"Failed to fetch contacts. Please try again.","error")}finally{M(!1)}},pe=s=>{P({isOpen:!0,contactId:s,isLoading:!1})},ae=()=>{P({isOpen:!1,contactId:null,isLoading:!1})},fe=()=>{P(s=>({...s,isLoading:!0})),D({apiFn:()=>Ce(R.contactId),onSuccess:()=>{S(),ae(),o("Contact deleted successfully","success")},onError:s=>{P(a=>({...a,isLoading:!1}))}})},le=()=>{S()};t.useEffect(()=>{S()},[i]);const be=s=>{var a,b,u,h,Q;return!(s!=null&&s.user_id)||((a=s==null?void 0:s.user)==null?void 0:a.deleted_at)!==null?"Inactive":((b=s==null?void 0:s.user)==null?void 0:b.deleted_at)===null&&((u=s==null?void 0:s.user)==null?void 0:u.is_active)===1?"Active":((h=s==null?void 0:s.user)==null?void 0:h.deleted_at)===null&&((Q=s==null?void 0:s.user)==null?void 0:Q.is_active)===0?"Disabled":"Inactive"};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center  md:mb-8 flex-wrap mb-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Contacts"}),e.jsx("p",{className:"text-[#333333] dark:text-[#ECECEC]",children:"Manage your investor contacts"})]}),p!=="team"&&e.jsx("div",{className:"flex space-x-4 flex-wrap gap-3 mt-4 md:mt-0",children:e.jsxs("button",{className:`flex items-center gap-2 px-4 py-3 rounded-md transition-colors
                  ${J===0?"bg-gray-400 cursor-not-allowed opacity-70":"bg-[#6C5DD3] text-white hover:bg-[#5a4bb2]"}`,onClick:Z,children:[e.jsx(he,{size:14}),e.jsx("span",{children:"Add Contact"})]})})]}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md-gap-0 space-x-4 items-start justify-between px-4 py-4",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for contacts",className:"form-control",value:F,onChange:m,style:{paddingLeft:"40px"}}),e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(s=>e.jsx("button",{onClick:()=>g({target:{name:"status",value:s.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${i.status===s.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:s.label},s.value))})})]}),e.jsx("div",{ref:A,className:"dark:bg-[#222632] bg-[#EBEBEC] rounded-lg overflow-hidden text-dark dark:text-white comparable-listing-table-wrap",children:L?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(te,{})}):r.length===0?e.jsx("div",{className:"text-center p-12 text-dark dark:text-white",children:e.jsx("p",{children:"No contacts found. Add some contacts to see them here."})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",onChange:s=>q(s.target.checked?r==null?void 0:r.map(a=>a.id):[]),checked:v.length===(r==null?void 0:r.length)&&(r==null?void 0:r.length)>0})}),e.jsx("th",{children:"NAME"}),e.jsx("th",{children:"EMAIL"}),e.jsx("th",{children:"PHONE NUMBER"}),e.jsx("th",{children:"STATUS"}),e.jsx("th",{children:"CREATED AT"}),p!=="team"&&e.jsx("th",{children:"ACTIONS"})]})}),e.jsx("tbody",{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:v==null?void 0:v.includes(s==null?void 0:s.id),onChange:()=>C(s==null?void 0:s.id)})}),e.jsx("td",{children:e.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:s==null?void 0:s.first_name})}),e.jsx("td",{children:s==null?void 0:s.email}),e.jsx("td",{children:s==null?void 0:s.phone}),e.jsx("td",{className:"p-4",children:(()=>{const a=be(s);return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
                                  ${a==="Active"?"bg-[#ECFDF3] text-[#054F31] border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":a==="Disabled"?"bg-red-100 text-red-700 border border-red-300":"bg-[#FFF8E1] text-[#FB6E0A] border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:a})})()}),e.jsx("td",{children:s!=null&&s.created_at?new Date(s==null?void 0:s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"-"}),p!=="team"&&e.jsx("td",{className:"",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:a=>T.current[s.id]=a,onClick:()=>O(w===(s==null?void 0:s.id)?null:s==null?void 0:s.id),className:"text-lg",children:e.jsx(ve,{className:"text-[#595959]"})})})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No deals available"})})})]}),w!==null&&e.jsxs("div",{ref:_,style:{position:"fixed",top:`${H.top}px`,left:`${H.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsx("button",{onClick:()=>{const s=r.find(a=>a.id===w);f(s==null?void 0:s.id),O(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(we,{className:"mr-2"})," Edit details"]})}),e.jsxs("button",{onClick:()=>{pe(w),O(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(Ne,{className:"mr-2"})," Delete"]})]})]})})]}),e.jsx(Ee,{pagination:{total:n.total,currentPage:i.page,perPage:n.total>=5?5:n.total,totalPages:Math.ceil(n.total/i.per_page)},setFilters:I})]}),e.jsx(Fe,{isOpen:R.isOpen,onClose:ae,onConfirm:fe,isLoading:R.isLoading,title:"Delete Contact"}),e.jsx(Se,{isOpen:K,onClose:c,onSuccess:le}),e.jsx(_e,{contactId:x,isOpen:U,onClose:d,onSuccess:le})]})};export{Me as default};
