import{r as n,m as e,T as Ce,U as Se,u as De,v as Pe,t as $e,w as Ee,V as me,W as Fe,X as de,o as ue,Y as Ie,Z as Me,z as pe,_ as xe,$ as Le,a0 as Ue,a1 as Re,a2 as Te}from"./index-_rvvEIkh.js";import{u as ze}from"./useRefreshUser-nfMunSd0.js";import{c as Oe,X as We}from"./x-BzyMvqkg.js";const Ae="/assets/company-logo-baJq8U9U.png";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ye=Oe("check",qe),He=({isOpen:s,onClose:w,imageSrc:C,onCropComplete:S,aspectRatio:d=1})=>{const[g,M]=n.useState({x:0,y:0}),[b,v]=n.useState(1),[u,D]=n.useState(!1),[r,W]=n.useState({x:0,y:0}),L=n.useRef(null),P=n.useRef(null),U=n.useRef(null);n.useEffect(()=>{s&&C&&(v(1),M({x:0,y:0}),D(!1))},[s,C]),n.useEffect(()=>{if(!s||!C)return;const a=new Image;a.onload=()=>{U.current=a,R()},a.src=C},[s,C]),n.useEffect(()=>{s&&R()},[g,b,s]);const R=()=>{const a=L.current,p=U.current;if(!a||!p)return;const o=a.getContext("2d"),y=P.current;if(!y)return;const i=y.offsetWidth,x=y.offsetHeight;a.width=i,a.height=x,o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(0,0,i,x);const $=Math.min(i/p.width,x/p.height)*b,E=p.width*$,k=p.height*$,c=(i-E)/2+g.x,z=(x-k)/2+g.y;o.save(),o.globalCompositeOperation="destination-out";const h=Math.min(i,x)*.7,m=(i-h)/2,j=(x-h)/2;d===1?(o.beginPath(),o.arc(i/2,x/2,h/2,0,Math.PI*2),o.fill()):o.fillRect(m,j,h,h/d),o.restore(),o.globalCompositeOperation="destination-over",o.drawImage(p,c,z,E,k),o.globalCompositeOperation="source-over",o.strokeStyle="#fff",o.lineWidth=2,d===1?(o.beginPath(),o.arc(i/2,x/2,h/2,0,Math.PI*2),o.stroke()):o.strokeRect(m,j,h,h/d)},A=a=>{D(!0),W({x:a.clientX-g.x,y:a.clientY-g.y})},q=a=>{u&&M({x:a.clientX-r.x,y:a.clientY-r.y})},T=()=>{D(!1)},Y=n.useCallback(async()=>{const a=U.current,p=P.current;if(!a||!p)return;const o=p.offsetWidth,y=p.offsetHeight,i=Math.min(o/a.width,y/a.height)*b,x=a.width*i,$=a.height*i,E=(o-x)/2+g.x,k=(y-$)/2+g.y,c=Math.min(o,y)*.7,z=(o-c)/2,h=(y-c)/2,m=document.createElement("canvas");m.width=c,m.height=c/d;const j=m.getContext("2d"),B=(z-E)/i,Z=(h-k)/i,K=c/i,H=c/d/i;j.drawImage(a,B,Z,K,H,0,0,c,c/d),m.toBlob(Q=>{S(Q),w()},"image/jpeg",.95)},[g,b,d,S,w]);if(!s)return null;const G=()=>{v(1),M({x:0,y:0}),w()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Crop Image"}),e.jsx("div",{ref:P,className:"relative h-96 bg-gray-100 dark:bg-gray-700 rounded-lg mb-4 overflow-hidden cursor-move",onMouseDown:A,onMouseMove:q,onMouseUp:T,onMouseLeave:T,children:e.jsx("canvas",{ref:L,className:"w-full h-full"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Zoom"}),e.jsx("input",{type:"range",min:.5,max:3,step:.05,value:b,onChange:a=>v(parseFloat(a.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[e.jsx(We,{size:16})," Cancel"]}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-lg",children:[e.jsx(Ye,{size:16}),"  Save"]})]})]})})})},Xe=Se("pk_test_51SkhC3RFrqOLQadKtGogmFPAHqpk6OXbj1KBfaSc0lbA1c1nJn2fBLmXmsUs20PM7LFqfaPQJ3EvtEbPZzHqcUqz00iuwxVFYm"),Je=()=>{const{user:s,role:w,token:C}=De(t=>t.user),S=Pe(),{showSnackbar:d}=$e(),g=ze(),M="https://phplaravel-1547671-6035260.cloudwaysapps.com/storage",[b,v]=n.useState(!1),[u,D]=n.useState(!1),[r,W]=n.useState(!(s!=null&&s.company_name)||!(s!=null&&s.sub_domain)),[L,P]=n.useState(null),[U,R]=n.useState(null),[A,q]=n.useState(null),[T,Y]=n.useState(null),[G,a]=n.useState(!1),[p,o]=n.useState(null),[y,i]=n.useState(null),[x,$]=n.useState(!1),[E,k]=n.useState(!1);Ee();const{register:c,handleSubmit:z,reset:h,formState:{errors:m}}=me({defaultValues:{first_name:"",last_name:"",email:"",phone:""}}),{register:j,handleSubmit:B,reset:Z,control:K,watch:H,setValue:Q,setError:Ve,clearErrors:Ge,formState:{errors:f}}=me({defaultValues:{company_name:"",sub_domain:"",company_email:"",company_phone:"",company_website:""}}),ee=H("company_name");H("sub_domain");const[he,fe]=n.useState(!1);n.useEffect(()=>{if(!he&&ee){const t=ke(ee);Q("sub_domain",t,{shouldValidate:!0})}},[ee]),n.useEffect(()=>{s&&(h({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||""}),Z({company_name:s.company_name||"",sub_domain:s.sub_domain||"",company_email:s.company_email||"",company_phone:s.company_phone||"",company_website:s.company_website||""}),s.profile_image&&P(s.profile_image),s.company_logo_url&&R(s.company_logo_url))},[s]);const ae=(t,l)=>{const _=t.target.files[0];if(!_)return;const F=new FileReader;F.onload=()=>{o(F.result),i(l),a(!0)},F.readAsDataURL(_),t.target.value=""},ge=t=>{const l=new File([t],"image.jpg",{type:"image/jpeg"}),_=URL.createObjectURL(t);y==="profile"?(q(l),P(_)):(Y(l),R(_))},X=Fe({control:K,name:"sub_domain"}),be=async t=>{try{v(!0);const l=new FormData;l.append("_method","PATCH"),l.append("first_name",t.first_name),l.append("last_name",t.last_name),l.append("phone",t.phone),A&&l.append("profile_image",A),await xe(l),d("Profile updated successfully","success"),await g(),D(!1),q(null)}catch{d("Failed to update profile","error")}finally{v(!1)}},ye=async t=>{var l,_,F,ne,oe,re;try{v(!0);const N=new FormData;N.append("_method","PATCH"),Object.entries(t).forEach(([I,V])=>{V&&N.append(I,V)}),T&&N.append("company_logo",T);const O=await xe(N);d("Company updated successfully","success"),await g(),W(!1),Y(null);const J=(_=(l=O==null?void 0:O.data)==null?void 0:l.data)==null?void 0:_.user;if(J){const I=window.location.hostname.split(".").slice(-2).join("."),V=(F=document.cookie.split("; ").find(se=>se.startsWith("token=")))==null?void 0:F.split("=")[1],le=C||V,ie=w;document.cookie=`token=${le}; Path=/; Domain=.${I}; Secure; SameSite=None`,document.cookie=`user=${encodeURIComponent(JSON.stringify(J))}; Path=/; Domain=.${I}; Secure; SameSite=None`,document.cookie=`role=${ie}; Path=/; Domain=.${I}; Secure; SameSite=None`,S(Le({user:J,token:le})),S(Ue(ie));const ce=(ne=J.sub_domain)==null?void 0:ne.trim();if(ce){const se=`https://${ce.toLowerCase()}.${I}`;window.location.href=se;return}}}catch(N){console.error(N);const O=((re=(oe=N==null?void 0:N.response)==null?void 0:oe.data)==null?void 0:re.message)||"Failed to update company";d(O,"error")}finally{v(!1)}},je=t=>t!=null&&t.startsWith("http")||t!=null&&t.startsWith("blob:")?t:`${M}/${t}`,we=t=>t?t.split("-").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"Not Assigned";function Ne(){if(typeof window>"u")return"visionvivante.in";const t=window.location.hostname.split(".");return t.length>2?t.slice(1).join("."):window.location.hostname}const te=Ne(),ve=X!=null&&X.trim()?`https://${X.toLowerCase()}.${te}`:`https://your-company.${te}`,ke=(t="")=>t.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),_e=async()=>{try{localStorage.setItem("account_deleting","true"),await Re();const t=window.location.hostname.split(".").slice(-2).join(".");document.cookie=`role=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,document.cookie=`token=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,document.cookie=`user=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,S(Te()),$(!0),setTimeout(()=>{localStorage.removeItem("account_deleting"),window.location.replace("/signin")},2e3)}catch(t){console.error("Delete account failed:",t),d("Failed to delete account","error")}};return e.jsx("div",{className:"min-h-screen my-5",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333]",children:[e.jsx("h1",{className:"text-3xl text-black dark:text-white",children:"My Profile"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("button",{onClick:()=>k(!0),className:"text-red-600",children:"Delete Account"}),e.jsx("button",{onClick:()=>D(t=>!t),className:"flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(de,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{})," ",e.jsx("span",{children:"Edit Profile"})]})})]})]}),e.jsx("div",{className:"flex justify-start mt-8 ml-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:L?e.jsx("img",{src:je(L),alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(Ie,{className:"w-full h-full text-[#6C5DD3]"})}),u&&e.jsxs("label",{htmlFor:"profileImage",className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Image",e.jsx("input",{type:"file",id:"profileImage",className:"hidden",accept:"image/*",onChange:t=>ae(t,"profile")})]})]})}),e.jsx("form",{onSubmit:z(be),children:e.jsx("div",{className:"profile-detail-form-container-main-div",children:e.jsxs("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:[e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"First Name"}),e.jsx("input",{type:"text",...c("first_name",{required:"First name is required"}),readOnly:!u,className:`form-control w-full ${m.first_name?"border border-red-500":""} ${u?"":"opacity-75 cursor-not-allowed"}`}),m.first_name&&u&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Last Name"}),e.jsx("input",{type:"text",...c("last_name"),readOnly:!u,className:`form-control w-full ${m.last_name?"border border-red-500":""} ${u?"":"opacity-75 cursor-not-allowed"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Email"}),e.jsx("input",{type:"email",...c("email"),disabled:!0,className:"form-control w-full opacity-75 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Phone Number"}),e.jsx("input",{type:"tel",...c("phone",{validate:t=>t?/^0\d{9,10}$/.test(t)||"Phone number must start with 0 and be 10 or 11 digits long":!0}),readOnly:!u,className:`form-control w-full ${m.phone?"border border-red-500":""} ${u?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),m.phone&&u&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.phone.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 mt-5 inline-block",children:"Role:"}),e.jsxs("div",{className:"relative opacity-75 cursor-not-allowed",children:[e.jsx("input",{type:"text",className:"form-control w-full cursor-not-allowed",value:we(w),readOnly:!0,style:{paddingLeft:"40px"}}),e.jsx("span",{className:"inline-block absolute left-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",children:e.jsx(Me,{})})]})]})]}),u&&e.jsx("div",{className:"text-right mb-8 mt-5",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:b,children:b?e.jsx(pe,{size:20}):e.jsx(e.Fragment,{children:" Save Profile Changes"})})})]})})}),w!=="investor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333] mt-10",children:[e.jsx("h1",{className:"text-xl text-black dark:text-[#F8F8F8]",children:"Company Details"}),w!=="team"&&w!=="team-lead"&&e.jsx("button",{onClick:()=>W(t=>!t),className:"flex items-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(de,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{})," ",e.jsx("span",{children:"Edit Company"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-5",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:e.jsx("img",{src:U||Ae,alt:"Company Logo",className:"w-full h-full object-cover"})}),r&&e.jsxs("label",{className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Logo",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>ae(t,"company")})]})]}),e.jsxs("form",{onSubmit:B(ye),children:[e.jsx("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Name"}),e.jsx("input",{type:"text",...j("company_name",{required:"Company name is required"}),readOnly:!r,placeholder:"Enter company name",className:`form-control w-full ${f.company_name?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),f.company_name&&r&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.company_name.message})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] my-2 inline-block",children:"Sub Domain"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"your-company",...j("sub_domain",{required:"Sub domain is required",pattern:{value:/^(?!-)[a-z0-9]+(-[a-z0-9]+)*$/,message:"Only lowercase letters, numbers, and hyphens are allowed."},onChange:()=>fe(!0)}),readOnly:!r,className:`form-control w-full pr-48 ${f.sub_domain?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("span",{className:"absolute inset-y-0 right-3 flex items-center text-gray-500 text-sm font-medium pointer-events-none",children:[".",te]})]}),f.sub_domain&&r&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.sub_domain.message}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Your app will be available at:"," ",e.jsx("strong",{className:"text-[#6C5DD3]",children:ve})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Email"}),e.jsx("input",{type:"email",...j("company_email",{pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Enter a valid email address"}}),readOnly:!r,placeholder:"Enter company email",className:`form-control w-full ${f.company_email?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Phone"}),e.jsx("input",{type:"tel",...j("company_phone",{pattern:{value:/^0\d{9,10}$/,message:"Phone number must start with 0 and be 10 or 11 digits long"}}),readOnly:!r,placeholder:"Enter phone number",className:`form-control w-full ${f.company_phone?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),(f==null?void 0:f.company_phone)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:f.company_phone.message})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Website"}),e.jsx("input",{type:"text",...j("company_website"),readOnly:!r,placeholder:"Enter Company website",className:`form-control w-full ${r?"":"opacity-75 cursor-not-allowed"}`})]})]})}),r&&e.jsx("div",{className:"text-right mb-8",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:b,children:b?e.jsx(pe,{size:20}):e.jsx(e.Fragment,{children:" Save Company Changes"})})})]})]}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-[400px] text-center animate-scaleIn",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3 text-gray-800",children:"Delete Account?"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to delete your account? ",e.jsx("br",{}),e.jsx("span",{className:"text-red-500 font-medium",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 border rounded-md text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:()=>{k(!1),_e()},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Yes, Delete"})]})]})}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 w-[320px] text-center animate-scaleIn",children:[e.jsx("div",{className:"mx-auto mb-4 w-20 h-20 rounded-full border-4 border-green-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-green-500 animate-tick",fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Account Deleted"}),e.jsx("p",{className:"text-gray-600",children:"Your account and data have been deleted successfully."})]})}),e.jsx("style",{children:`
        @keyframes scaleIn {
          0% {
            transform: scale(0.8);
            opacity: 0;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        .animate-scaleIn {
          animation: scaleIn 0.3s ease-out;
        }

        @keyframes tick {
          0% {
            stroke-dasharray: 0 100;
          }
          100% {
            stroke-dasharray: 100 0;
          }
        }

        .animate-tick {
          stroke-dasharray: 100;
          animation: tick 0.6s ease-in-out forwards;
        }
      `})]}),e.jsx(He,{isOpen:G,onClose:()=>a(!1),imageSrc:p,onCropComplete:ge,aspectRatio:1})]})})},Qe=()=>e.jsx(Ce,{stripe:Xe,children:e.jsx(Je,{})});export{Qe as default};
