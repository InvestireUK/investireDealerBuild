import{r as o,m as e,T as Ce,U as Se,u as De,v as $e,t as Pe,w as Ie,V as me,W as Ee,X as de,o as pe,Y as Me,Z as Fe,z as ue,_ as Le,$ as Ue,a0 as xe,a1 as Re,a2 as Te}from"./index-CqGVojfI.js";import{u as We}from"./useRefreshUser-VyFRMzsO.js";import{c as Oe,X as ze}from"./x-BDsqgvGV.js";const Ae="/assets/company-logo-baJq8U9U.png";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ye=Oe("check",Xe),He=({isOpen:s,onClose:j,imageSrc:C,onCropComplete:S,aspectRatio:m=1})=>{const[f,L]=o.useState({x:0,y:0}),[b,k]=o.useState(1),[d,D]=o.useState(!1),[r,z]=o.useState({x:0,y:0}),U=o.useRef(null),$=o.useRef(null),R=o.useRef(null);o.useEffect(()=>{s&&C&&(k(1),L({x:0,y:0}),D(!1))},[s,C]),o.useEffect(()=>{if(!s||!C)return;const a=new Image;a.onload=()=>{R.current=a,T()},a.src=C},[s,C]),o.useEffect(()=>{s&&T()},[f,b,s]);const T=()=>{const a=U.current,p=R.current;if(!a||!p)return;const n=a.getContext("2d"),y=$.current;if(!y)return;const i=y.offsetWidth,u=y.offsetHeight;a.width=i,a.height=u,n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(0,0,i,u);const P=Math.min(i/p.width,u/p.height)*b,w=p.width*P,I=p.height*P,x=(i-w)/2+f.x,g=(u-I)/2+f.y;n.save(),n.globalCompositeOperation="destination-out";const c=Math.min(i,u)*.7,N=(i-c)/2,E=(u-c)/2;m===1?(n.beginPath(),n.arc(i/2,u/2,c/2,0,Math.PI*2),n.fill()):n.fillRect(N,E,c,c/m),n.restore(),n.globalCompositeOperation="destination-over",n.drawImage(p,x,g,w,I),n.globalCompositeOperation="source-over",n.strokeStyle="#fff",n.lineWidth=2,m===1?(n.beginPath(),n.arc(i/2,u/2,c/2,0,Math.PI*2),n.stroke()):n.strokeRect(N,E,c,c/m)},A=a=>{D(!0),z({x:a.clientX-f.x,y:a.clientY-f.y})},X=a=>{d&&L({x:a.clientX-r.x,y:a.clientY-r.y})},W=()=>{D(!1)},Y=o.useCallback(async()=>{const a=R.current,p=$.current;if(!a||!p)return;const n=p.offsetWidth,y=p.offsetHeight,i=Math.min(n/a.width,y/a.height)*b,u=a.width*i,P=a.height*i,w=(n-u)/2+f.x,I=(y-P)/2+f.y,x=Math.min(n,y)*.7,g=(n-x)/2,c=(y-x)/2,N=document.createElement("canvas");N.width=x,N.height=x/m;const E=N.getContext("2d"),V=(g-w)/i,H=(c-I)/i,Z=x/i,te=x/m/i;E.drawImage(a,V,H,Z,te,0,0,x,x/m),N.toBlob(se=>{S(se),j()},"image/jpeg",.95)},[f,b,m,S,j]);if(!s)return null;const J=()=>{k(1),L({x:0,y:0}),j()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Crop Image"}),e.jsx("div",{ref:$,className:"relative h-96 bg-gray-100 dark:bg-gray-700 rounded-lg mb-4 overflow-hidden cursor-move",onMouseDown:A,onMouseMove:X,onMouseUp:W,onMouseLeave:W,children:e.jsx("canvas",{ref:U,className:"w-full h-full"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Zoom"}),e.jsx("input",{type:"range",min:.5,max:3,step:.05,value:b,onChange:a=>k(parseFloat(a.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[e.jsx(ze,{size:16})," Cancel"]}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-lg",children:[e.jsx(Ye,{size:16}),"  Save"]})]})]})})})},qe=Se("pk_test_51R6uLuGhmABE4SukbmgqsLITna4D57Ittag620AxGwm1ckI0oeYBXvNUBO9w4WhygDlp3sWd7ldWiZlGbR8jzxXk00N3jUSXPv"),Ge=()=>{const{user:s,role:j,token:C}=De(t=>t.user),S=$e(),{showSnackbar:m}=Pe(),f=We(),L="https://phplaravel-1547671-6035260.cloudwaysapps.com/storage",[b,k]=o.useState(!1),[d,D]=o.useState(!1),[r,z]=o.useState(!(s!=null&&s.company_name)||!(s!=null&&s.sub_domain)),[U,$]=o.useState(null),[R,T]=o.useState(null),[A,X]=o.useState(null),[W,Y]=o.useState(null),[J,a]=o.useState(!1),[p,n]=o.useState(null),[y,i]=o.useState(null),[u,P]=o.useState(!1);Ie();const{register:w,handleSubmit:I,reset:x,formState:{errors:g}}=me({defaultValues:{first_name:"",last_name:"",email:"",phone:""}}),{register:c,handleSubmit:N,reset:E,control:V,watch:H,setValue:Z,setError:te,clearErrors:se,formState:{errors:h}}=me({defaultValues:{company_name:"",sub_domain:"",company_email:"",company_phone:"",company_website:""}}),K=H("company_name");H("sub_domain");const[he,fe]=o.useState(!1);o.useEffect(()=>{if(!he&&K){const t=ke(K);Z("sub_domain",t,{shouldValidate:!0})}},[K]),o.useEffect(()=>{s&&(x({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||""}),E({company_name:s.company_name||"",sub_domain:s.sub_domain||"",company_email:s.company_email||"",company_phone:s.company_phone||"",company_website:s.company_website||""}),s.profile_image&&$(s.profile_image),s.company_logo_url&&T(s.company_logo_url))},[s]);const ae=(t,l)=>{const _=t.target.files[0];if(!_)return;const M=new FileReader;M.onload=()=>{n(M.result),i(l),a(!0)},M.readAsDataURL(_),t.target.value=""},ge=t=>{const l=new File([t],"image.jpg",{type:"image/jpeg"}),_=URL.createObjectURL(t);y==="profile"?(X(l),$(_)):(Y(l),T(_))},q=Ee({control:V,name:"sub_domain"}),be=async t=>{try{k(!0);const l=new FormData;l.append("_method","PATCH"),l.append("first_name",t.first_name),l.append("last_name",t.last_name),l.append("phone",t.phone),A&&l.append("profile_image",A),await xe(l),m("Profile updated successfully","success"),await f(),D(!1),X(null)}catch{m("Failed to update profile","error")}finally{k(!1)}},ye=async t=>{var l,_,M,ne,oe,re;try{k(!0);const v=new FormData;v.append("_method","PATCH"),Object.entries(t).forEach(([F,B])=>{B&&v.append(F,B)}),W&&v.append("company_logo",W);const O=await xe(v);m("Company updated successfully","success"),await f(),z(!1),Y(null);const G=(_=(l=O==null?void 0:O.data)==null?void 0:l.data)==null?void 0:_.user;if(G){const F=window.location.hostname.split(".").slice(-2).join("."),B=(M=document.cookie.split("; ").find(ee=>ee.startsWith("token=")))==null?void 0:M.split("=")[1],le=C||B,ie=j;document.cookie=`token=${le}; Path=/; Domain=.${F}; Secure; SameSite=None`,document.cookie=`user=${encodeURIComponent(JSON.stringify(G))}; Path=/; Domain=.${F}; Secure; SameSite=None`,document.cookie=`role=${ie}; Path=/; Domain=.${F}; Secure; SameSite=None`,S(Re({user:G,token:le})),S(Te(ie));const ce=(ne=G.sub_domain)==null?void 0:ne.trim();if(ce){const ee=`https://${ce.toLowerCase()}.${F}`;window.location.href=ee;return}}}catch(v){console.error(v);const O=((re=(oe=v==null?void 0:v.response)==null?void 0:oe.data)==null?void 0:re.message)||"Failed to update company";m(O,"error")}finally{k(!1)}},je=t=>t!=null&&t.startsWith("http")||t!=null&&t.startsWith("blob:")?t:`${L}/${t}`,we=t=>t?t.split("-").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"Not Assigned";function Ne(){if(typeof window>"u")return"visionvivante.in";const t=window.location.hostname.split(".");return t.length>2?t.slice(1).join("."):window.location.hostname}const Q=Ne(),ve=q!=null&&q.trim()?`https://${q.toLowerCase()}.${Q}`:`https://your-company.${Q}`,ke=(t="")=>t.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),_e=async()=>{try{localStorage.setItem("account_deleting","true"),await Le();const t=window.location.hostname.split(".").slice(-2).join(".");document.cookie=`role=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,document.cookie=`token=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,document.cookie=`user=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT`,S(Ue()),P(!0),setTimeout(()=>{localStorage.removeItem("account_deleting"),window.location.replace("/signin")},2e3)}catch(t){console.error("Delete account failed:",t),m("Failed to delete account","error")}};return e.jsx("div",{className:"min-h-screen my-5",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333]",children:[e.jsx("h1",{className:"text-3xl text-black dark:text-white",children:"My Profile"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("button",{onClick:_e,className:"text-red-600",children:"Delete Account"}),e.jsx("button",{onClick:()=>D(t=>!t),className:"flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(de,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{})," ",e.jsx("span",{children:"Edit Profile"})]})})]})]}),e.jsx("div",{className:"flex justify-start mt-8 ml-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:U?e.jsx("img",{src:je(U),alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(Me,{className:"w-full h-full text-[#6C5DD3]"})}),d&&e.jsxs("label",{htmlFor:"profileImage",className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Image",e.jsx("input",{type:"file",id:"profileImage",className:"hidden",accept:"image/*",onChange:t=>ae(t,"profile")})]})]})}),e.jsx("form",{onSubmit:I(be),children:e.jsx("div",{className:"profile-detail-form-container-main-div",children:e.jsxs("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:[e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"First Name"}),e.jsx("input",{type:"text",...w("first_name",{required:"First name is required"}),readOnly:!d,className:`form-control w-full ${g.first_name?"border border-red-500":""} ${d?"":"opacity-75 cursor-not-allowed"}`}),g.first_name&&d&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Last Name"}),e.jsx("input",{type:"text",...w("last_name"),readOnly:!d,className:`form-control w-full ${g.last_name?"border border-red-500":""} ${d?"":"opacity-75 cursor-not-allowed"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Email"}),e.jsx("input",{type:"email",...w("email"),disabled:!0,className:"form-control w-full opacity-75 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Phone Number"}),e.jsx("input",{type:"tel",...w("phone",{validate:t=>t?/^0\d{9,10}$/.test(t)||"Phone number must start with 0 and be 10 or 11 digits long":!0}),readOnly:!d,className:`form-control w-full ${g.phone?"border border-red-500":""} ${d?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),g.phone&&d&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.phone.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 mt-5 inline-block",children:"Role:"}),e.jsxs("div",{className:"relative opacity-75 cursor-not-allowed",children:[e.jsx("input",{type:"text",className:"form-control w-full cursor-not-allowed",value:we(j),readOnly:!0,style:{paddingLeft:"40px"}}),e.jsx("span",{className:"inline-block absolute left-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",children:e.jsx(Fe,{})})]})]})]}),d&&e.jsx("div",{className:"text-right mb-8 mt-5",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:b,children:b?e.jsx(ue,{size:20}):e.jsx(e.Fragment,{children:" Save Profile Changes"})})})]})})}),j!=="investor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333] mt-10",children:[e.jsx("h1",{className:"text-xl text-black dark:text-[#F8F8F8]",children:"Company Details"}),j!=="team"&&j!=="team-lead"&&e.jsx("button",{onClick:()=>z(t=>!t),className:"flex items-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(de,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{})," ",e.jsx("span",{children:"Edit Company"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-5",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:e.jsx("img",{src:R||Ae,alt:"Company Logo",className:"w-full h-full object-cover"})}),r&&e.jsxs("label",{className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Logo",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>ae(t,"company")})]})]}),e.jsxs("form",{onSubmit:N(ye),children:[e.jsx("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Name"}),e.jsx("input",{type:"text",...c("company_name",{required:"Company name is required"}),readOnly:!r,placeholder:"Enter company name",className:`form-control w-full ${h.company_name?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),h.company_name&&r&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:h.company_name.message})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] my-2 inline-block",children:"Sub Domain"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"your-company",...c("sub_domain",{required:"Sub domain is required",pattern:{value:/^(?!-)[a-z0-9]+(-[a-z0-9]+)*$/,message:"Only lowercase letters, numbers, and hyphens are allowed."},onChange:()=>fe(!0)}),readOnly:!r,className:`form-control w-full pr-48 ${h.sub_domain?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("span",{className:"absolute inset-y-0 right-3 flex items-center text-gray-500 text-sm font-medium pointer-events-none",children:[".",Q]})]}),h.sub_domain&&r&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:h.sub_domain.message}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Your app will be available at:"," ",e.jsx("strong",{className:"text-[#6C5DD3]",children:ve})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Email"}),e.jsx("input",{type:"email",...c("company_email",{pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Enter a valid email address"}}),readOnly:!r,placeholder:"Enter company email",className:`form-control w-full ${h.company_email?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Phone"}),e.jsx("input",{type:"tel",...c("company_phone",{pattern:{value:/^0\d{9,10}$/,message:"Phone number must start with 0 and be 10 or 11 digits long"}}),readOnly:!r,placeholder:"Enter phone number",className:`form-control w-full ${h.company_phone?"border border-red-500":""} ${r?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),(h==null?void 0:h.company_phone)&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:h.company_phone.message})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Website"}),e.jsx("input",{type:"text",...c("company_website"),readOnly:!r,placeholder:"Enter Company website",className:`form-control w-full ${r?"":"opacity-75 cursor-not-allowed"}`})]})]})}),r&&e.jsx("div",{className:"text-right mb-8",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:b,children:b?e.jsx(ue,{size:20}):e.jsx(e.Fragment,{children:" Save Company Changes"})})})]})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 w-[320px] text-center animate-scaleIn",children:[e.jsx("div",{className:"mx-auto mb-4 w-20 h-20 rounded-full border-4 border-green-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-green-500 animate-tick",fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Account Deleted"}),e.jsx("p",{className:"text-gray-600",children:"Your account and data have been deleted successfully."})]})}),e.jsx("style",{children:`
        @keyframes scaleIn {
          0% {
            transform: scale(0.8);
            opacity: 0;
          }
          100% {
            transform: scale(1);
            opacity: 1;
          }
        }

        .animate-scaleIn {
          animation: scaleIn 0.3s ease-out;
        }

        @keyframes tick {
          0% {
            stroke-dasharray: 0 100;
          }
          100% {
            stroke-dasharray: 100 0;
          }
        }

        .animate-tick {
          stroke-dasharray: 100;
          animation: tick 0.6s ease-in-out forwards;
        }
      `})]}),e.jsx(He,{isOpen:J,onClose:()=>a(!1),imageSrc:p,onCropComplete:ge,aspectRatio:1})]})})},Ze=()=>e.jsx(Ce,{stripe:qe,children:e.jsx(Ge,{})});export{Ze as default};
