import{T as L,s as R,u as C,r as i,t as z,ar as P,m as e,x as v,cl as T,aI as G,cm as Y,cn as H,co as K,cp as Q,cq as w,cr as U,aK as V,aL as J,cs as W,N as X,aD as Z,aN as ee}from"./index-dQ9ulDrK.js";import{S as se}from"./SAManualComparables-By2ofr0K.js";import{S as ae}from"./SAComparablesMaps-Bi3i_DZC.js";import"./DragAndDrop-BVD3AXSJ.js";import"./index-BNip8Xss.js";import"./ModifiedAutoAddressInput-Z5rw7mrK.js";const ie=()=>{const{register:g,watch:h}=L({defaultValues:{bedrooms:1,no_of_beds:1}}),u=R(),A="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",a=C(s=>{var l;return(l=s==null?void 0:s.deal)==null?void 0:l.deal}),d=C(s=>s.deal.manualComperable),[E,m]=i.useState(!1),[b,I]=i.useState([]),N=z(),[f,p]=i.useState(!1),[c,j]=i.useState([]),{handleApiCall:S}=P(),x=i.useRef(null),y=h("bedrooms"),k=h("no_of_beds"),D=h("type_of_space"),o=i.useMemo(()=>[...Array.isArray(d)?d:[],...Array.isArray(a==null?void 0:a.property_deal_sa_comparables)?a==null?void 0:a.property_deal_sa_comparables:[],...Array.isArray(b)?b:[]].map((l,t)=>{const r=l.uniqueId||l.id||l.listing_url||l.temp_id||`stable-${t}-${l.title||"item"}-${l.lat||""}-${l.lng||""}`;return{...l,uniqueId:r}}),[d,a==null?void 0:a.property_deal_sa_comparables,b]);i.useEffect(()=>{const s=(a==null?void 0:a.property_deal_sa_comparables)||[],l=d||[],t=new Set(s.map(n=>n.uniqueId||n.id||n.listing_url||n.temp_id).filter(Boolean)),r=new Set(l.map(n=>n.uniqueId||n.id||n.listing_url||n.temp_id).filter(Boolean));j(n=>{const M=n.filter(O=>r.has(O));return[...new Set([...M,...Array.from(t)])]})},[a==null?void 0:a.property_deal_sa_comparables,d]),i.useEffect(()=>{if(!x.current)return;const s=o.length,l=c.length;x.current.checked=l===s&&s>0,x.current.indeterminate=l>0&&l<s},[c.length,o.length]);const B=()=>{j(s=>s.length===o.length?[]:o.map(l=>l.uniqueId))},_=async()=>{var s,l;p(!0);try{const t={address1:(a==null?void 0:a.address_line_1)||"",address2:(a==null?void 0:a.address_line_2)||"",city:(a==null?void 0:a.city)||"",postCode:(a==null?void 0:a.post_code)||"",country:((s=a==null?void 0:a.country)==null?void 0:s.name)||"",no_of_bedroom:y||1,no_of_beds:k||1,type_of_space:D||"",no_of_dwellings:(a==null?void 0:a.no_of_dwelling)||1,type:"ai"},r=await V(a.id,1,t);I(((l=r==null?void 0:r.data)==null?void 0:l.dealComparables)||[])}catch(t){console.error("Error fetching AI comparables:",t)}finally{p(!1)}},F=()=>{m(!0)},q=()=>{m(!1)},$=async()=>{var s;try{p(!0);const l=o.filter(r=>c.includes(r.uniqueId)),t=await J(a==null?void 0:a.id,1,l,y);u(W(((s=t==null?void 0:t.data)==null?void 0:s.dealComparables)||[])),await S({apiFn:()=>Z(a==null?void 0:a.id,{_method:"PATCH"}),onSuccess:r=>{var n;u(X({...r==null?void 0:r.deal,id:(n=r==null?void 0:r.deal)==null?void 0:n.id}))}}),N("/create-deal/sa-comparable-table",{replace:!0}),u(ee())}catch(l){console.error("Error:",l)}finally{p(!1)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"sa-api-comparables-map-wrap",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h5",{children:"Comparables"})}),E&&e.jsx(se,{handleFinishSAManualComparable:F,handleCloseManualComparable:q,onClose:()=>m(!1)}),e.jsx("div",{className:"map-generated-sec mb-10",children:e.jsx("div",{className:"bg-[#EBEBEC] dark:bg-[#222632] flex items-center justify-center relative create-deal-upload-document-wrap",children:e.jsx(ae,{locations:o,apiKey:A})})}),e.jsxs("div",{className:"sa-api-comparables-data-wrap relative",children:[f&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(v,{})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h5",{className:"font-semibold",children:"Nearby listings"}),e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>m(!0),children:"+ Add Comparable"})]}),e.jsx("div",{className:"filters my-5",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-2 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Bedrooms"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...g("bedrooms"),className:"form-control focus:outline-none"})})]}),e.jsxs("div",{className:"",children:[e.jsx("label",{className:"block form-label",children:"No. of beds"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...g("no_of_beds"),className:"form-control focus:outline-none"})})]}),e.jsx("div",{className:"",children:e.jsx("div",{className:"purple-btn mt-7",children:e.jsxs("button",{className:"flex items-center gap-2 whitespace-nowrap",onClick:_,children:[e.jsx(T,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})}),e.jsx("div",{className:"mb-5 flex items-center justify-center mt-3"})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",ref:x,onChange:B,className:"sr-only",id:"select-all-checkbox"}),e.jsx("label",{htmlFor:"select-all-checkbox",className:"purple-btn px-4 py-2 cursor-pointer select-none inline-block",children:c.length===o.length&&o.length>0?"Unselect All":"Select All"})]}),e.jsx("button",{type:"button",className:"purple-btn my-4 flex items-center gap-2",onClick:_,disabled:f,children:f?e.jsx(v,{size:"sm"}):"Refresh AI"})]}),o.map(s=>{const l=s.uniqueId;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-[15px_1fr_2fr_10%] gap-5 my-10 items-center",children:[e.jsx("input",{type:"checkbox",checked:c.includes(l),onChange:()=>{j(t=>t.includes(l)?t.filter(r=>r!==l):[...t,l])}}),e.jsx("div",{className:"w-full h-[200px]",children:e.jsx("img",{src:(s==null?void 0:s.image_url)||(s==null?void 0:s.image)||G,alt:"Image",className:"w-full h-full object-cover rounded-[20px]"})}),e.jsxs("div",{className:"ai-api-data flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"ai-title",children:e.jsxs("p",{className:"font-semibold text-[20px]",children:[s.title," ",e.jsxs("span",{className:"text-sm text-[#595959]",children:[s.distance_meters,"ml"]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"ai-information flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bedroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bathroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{}),e.jsxs("span",{className:"font-semibold text-base",children:[s.beds," Guests"]})]})]}),e.jsxs("div",{className:"reviews flex items-center gap-1",children:[e.jsx(Q,{className:"text-[#FB6E0A]"}),e.jsx("p",{children:s.rating||0}),e.jsxs("p",{children:["(",s.reviews||0," reviews)"]})]})]}),e.jsxs("div",{className:"ai-percentage flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s.days_available||"-"}),e.jsx("h6",{className:"text-sm",children:"Days available"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s.occupancy||"-"}),e.jsx("h6",{className:"text-sm",children:"Occupancy"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsxs("p",{className:"text-2xl",children:["£",s.adr||"-"]}),e.jsx("h6",{className:"text-sm",children:"ADR"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s!=null&&s.revenue?`£${s.revenue}`:"-"}),e.jsx("h6",{className:"text-sm",children:"Revenue"})]})]})]}),e.jsxs("div",{className:"links flex flex-col items-center gap-5 border-l border-[#ECECEC]",children:[s.listing_url?e.jsx("a",{href:s.listing_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(w,{className:"w-7 h-7 text-[#6C5DD3] cursor-pointer"})}):e.jsx(w,{className:"w-7 h-7 text-gray-400 cursor-not-allowed"}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(U,{className:"w-7 h-7 text-[#6C5DD3]"})}),e.jsx("p",{className:"w-6 h-6",children:"-"})]})]},l)})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-5",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:()=>N("/create-deal/description"),children:"Cancel"}),e.jsx("button",{onClick:()=>c.length>0&&$(),className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${c.length>0?"purple-btn cursor-pointer":"bg-[#ECECEC] text-[#AFAFAF] cursor-not-allowed"}`,style:{display:"flex"},disabled:c.length===0,children:`Import ${c.length||""} item${c.length===1?"":"s"}`})]})]})})};export{ie as default};
