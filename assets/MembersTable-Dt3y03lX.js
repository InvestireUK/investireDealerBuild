import{t as X,q as ee,au as te,u as H,V as me,r as a,bh as ue,m as e,x as se,bi as xe,bj as he,bk as pe,ay as be,y as fe,n as ge,o as je,p as ve,bl as Ne,bm as we}from"./index-CDC7isqe.js";import{D as ke}from"./DeleteConfirmationModal-O3IZH432.js";import{l as ye}from"./lodash-YZXyPAyp.js";import Fe from"./AddMemberForm-BS9cWNhK.js";import{P as Ee}from"./PaginationNew-BnP_s6Ki.js";const Me=({isOpen:f,onClose:y,memberId:x,onSuccess:F})=>{const B=X(),{showSnackbar:E}=ee(),{handleApiCall:D,loading:b}=te(),{role:_}=H(m=>m.user),{register:g,handleSubmit:T,reset:R,setValue:j,watch:o,formState:{errors:c}}=me({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",role:""}}),[C,A]=a.useState(!1),[P,z]=a.useState(!1),[$,Q]=a.useState([null,null]);a.useRef(null);const[I,M]=a.useState("");a.useEffect(()=>{f&&x&&(P||i())},[f,x]);const i=async()=>{var m,p,L,O;if(x){A(!0);try{const h=await ue(x),N=(p=(m=h==null?void 0:h.data)==null?void 0:m.data)==null?void 0:p.user;N&&(j("first_name",N.first_name||""),j("last_name",N.last_name||""),j("email",N.email||""),j("role",((O=(L=N.roles)==null?void 0:L[0])==null?void 0:O.name)||"teamki"),j("password","")),z(!0)}catch(h){console.error("Failed to fetch member details",h),E("Failed to fetch member details","error")}finally{A(!1)}}},q=m=>{if(!x){E("Missing member ID. Cannot update.","error");return}const p={...m};p.password||delete p.password,D({apiFn:()=>pe(x,p),data:p,onSuccess:()=>{E("Member updated","success"),F&&F(),y(),B("/all-members")}})},d=()=>{R(),y()};if(!f)return null;if(!x)return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg p-6 w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"No Member Selected"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Cannot open edit form without a member ID."}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",onClick:y,children:"Close"})]})});const[v,S]=a.useState(!1);return o("role"),e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl relative dark:bg-[#181818]",children:[(b||C)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(se,{})}),e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:y,children:"✕"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-[#F8F8F8]",children:"Edit Team Member"})]}),e.jsxs("form",{onSubmit:T(q),className:"space-y-4 p-5 bg-[#FDFDFD] rounded-xl dark:bg-[#181818]",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Full Name"}),e.jsx("input",{type:"text",...g("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),c.first_name&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:c.first_name.message}),e.jsx("input",{type:"hidden",...g("last_name")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Email"}),e.jsx("input",{type:"email",...g("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),className:"w-full border px-3 py-2 rounded-xl mb-4 dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Email"}),c.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Password (leave blank to keep current)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:v?"text":"password",...g("password",{minLength:{value:8,message:"Password must be at least 8 characters"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*\.]).*$/,message:"Password must contain at least one uppercase letter, one lowercase letter, and one symbol"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter New Password (optional)"}),e.jsx("span",{className:"absolute right-3 top-[38%] -translate-y-1/2 cursor-pointer text-purple",onClick:()=>S(m=>!m),children:v?e.jsx(xe,{}):e.jsx(he,{})})]}),c.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.password.message})]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-white",children:"Select Role"}),e.jsxs("select",{...g("role",{required:"Role is required"}),disabled:_!=="deal-sourcer",className:`w-full border p-3 rounded-xl mb-4 text-sm 
      dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]
      ${_!=="deal-sourcer"?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"team-lead",children:"Team Lead"}),e.jsx("option",{value:"team",children:"Team Member"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",onClick:d,disabled:b,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",disabled:b,children:"Update Member"})]})]})]})})},Le=()=>{var J,K,W;const{role:f,user:y}=H(t=>t.user),x=X();H(t=>t.deal.deal);const{showSnackbar:F}=ee(),{handleApiCall:B}=te(),[E,D]=a.useState(!1),[b,_]=a.useState([]),[g,T]=a.useState(),[R,j]=a.useState(""),[o,c]=a.useState(null),[C,A]=a.useState({top:0,left:0}),[P,z]=a.useState(!1),[$,Q]=a.useState(0),[I,M]=a.useState({isOpen:!1,memberId:null,isLoading:!1}),[i,q]=a.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[d,v]=a.useState({page:1,per_page:(i==null?void 0:i.total)>=5?5:(i==null?void 0:i.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""}),S=a.useRef(null),m=a.useRef({});a.useEffect(()=>{function t(l){S.current&&!S.current.contains(l.target)&&c(null)}function r(){o!==null&&c(null)}function u(){if(o!==null&&m.current[o]){const n=m.current[o].getBoundingClientRect(),w=window.innerHeight-n.bottom,k=n.top;z(w<200&&k>200),A({top:P?n.top-10:n.bottom+5,left:n.right-160})}}return u(),document.addEventListener("mousedown",t),document.addEventListener("scroll",r,!0),window.addEventListener("resize",u),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("scroll",r,!0),window.removeEventListener("resize",u)}},[o,P]);const p=ye.debounce(t=>{v(r=>({...r,search:t,page:1}))},500),L=t=>{const r=t.target.value;j(r),p(r)},O=t=>{const{name:r,value:u}=t.target;v({...d,[r]:u,page:1})},h=async()=>{var t,r,u;D(!0);try{const l=await Ne({...d,perPage:d.per_page||10,status:d.status==="all"?null:d.status}),n=l==null?void 0:l.data,w=(n==null?void 0:n.users)||[];_(w);const k=((t=n==null?void 0:n.user_subscription)==null?void 0:t.user_limit)||0;Q(k);const s=l.data.page_context;s&&q({currentPage:parseInt(s==null?void 0:s.page)||1,totalPages:Math.ceil(parseInt((s==null?void 0:s.total_records)||0)/parseInt((s==null?void 0:s.per_page)||10)),from:(parseInt(s.page)-1)*parseInt(s.per_page)+1,to:Math.min(parseInt(s==null?void 0:s.page)*parseInt(s==null?void 0:s.per_page),parseInt((s==null?void 0:s.total_records)||0)),total:parseInt((s==null?void 0:s.total_records)||0),hasMorePages:(s==null?void 0:s.has_more_page)==="true"})}catch(l){console.error("Error fetching members:",l),F(((u=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:u.message)||"Failed to fetch team members. Please try again.","error")}finally{D(!1)}};a.useEffect(()=>{h()},[d]);const N=t=>{M({isOpen:!0,memberId:t,isLoading:!1})},Z=()=>{M({isOpen:!1,memberId:null,isLoading:!1})},ae=()=>{M(t=>({...t,isLoading:!0})),B({apiFn:()=>we(I.memberId),onSuccess:()=>{h(),Z(),F("Team member deleted successfully","success")},onError:t=>{M(r=>({...r,isLoading:!1}))}})},re=t=>{T(t),U(!0)},le=()=>{V(!0)},ne=()=>{V(!1)},de=()=>{U(!1)};a.useEffect(()=>{var t;(t=location.state)!=null&&t.openModal&&(setIsModalOpen(!0),x(location.pathname,{replace:!0,state:{}}))},[location.state,x,location.pathname]);const oe=t=>{v(r=>({...r,sortColumn:t,sortOrder:r.sortColumn===t&&r.sortOrder==="asc"?"desc":"asc",page:1}))},ce=()=>b,[Se,De]=a.useState(null),[Y,V]=a.useState(!1),[G,U]=a.useState(!1);return e.jsxs("div",{className:"min-h-screen dark:bg[#111827]",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col items-start justify-center  md:flex-row md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Team Members"}),e.jsx("p",{className:"text-[#333333] dark:text-white",children:"Manage your team members and their access"})]}),f!=="team"&&e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:le,disabled:$===0,className:`flex items-center gap-2 px-4 py-3 rounded-md transition-colors
    ${$===0?"bg-gray-400 cursor-not-allowed opacity-70":"bg-[#6C5DD3] text-white hover:bg-[#5a4bb2]"}`,children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Add Member"})]})})]})}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:gap-0 md:flex-row space-x-4 justify-between px-4 py-4 items-start",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for team members",className:"form-control",value:R,onChange:L,style:{paddingLeft:"40px"}}),e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(t=>e.jsx("button",{onClick:()=>O({target:{name:"status",value:t.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${d.status===t.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:t.label},t.value))})})]}),e.jsx("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] overflow-hidden comparable-listing-table-wrap",children:E?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(se,{})}):b.length===0?e.jsx("div",{className:"text-center p-12 dark:text-white text-dark",children:e.jsx("p",{children:"No team members found. Add some members to see them here."})}):e.jsx("div",{className:"whitespace-nowrap",children:e.jsxs("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-[#F8F8F8] border dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SN NO."}),e.jsx("th",{className:"p-4",children:"TEAM MEMBER"}),e.jsx("th",{className:"p-4",children:"EMAIL"}),e.jsx("th",{className:"p-4",children:"Role"}),e.jsx("th",{className:"p-4",children:"STATUS"}),e.jsxs("th",{className:"p-4 cursor-pointer",onClick:()=>oe("created_at"),children:["CREATED AT",d.sortColumn==="created_at"&&e.jsx("span",{className:"ml-1",children:d.sortOrder==="asc"?"↑":"↓"})]}),f!=="team"&&e.jsx("th",{className:"p-4 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{children:ce().map((t,r)=>{var u,l,n,w,k,s;return e.jsxs("tr",{className:r%2===0?"text-dark dark:text-white":"dark:bg-[#191D27] bg-[#DEDEE0] text-dark dark:text-white",children:[e.jsx("td",{className:"p-4",children:r+1}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 dark:bg-purple-800 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-purple-800 dark:text-purple-100",children:[((u=t.first_name)==null?void 0:u[0])||"",((l=t.last_name)==null?void 0:l[0])||""]})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium",children:t.first_name||t.last_name?`${t.first_name||""} ${t.last_name||""}`:"-"})})]})}),e.jsx("td",{className:"p-4",children:t.email||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm inline-block ${t.roles&&t.roles.length>0&&((n=t.roles[0])==null?void 0:n.name)==="team"||t.roles&&t.roles.length>0&&((w=t.roles[0])==null?void 0:w.name)==="deal-sourcer-team","text-dark"}`,children:t.roles&&t.roles.length>0&&((k=t.roles[0])==null?void 0:k.name)==="team"?"Team Member":t.roles&&t.roles.length>0&&((s=t.roles[0])==null?void 0:s.name)==="team-lead"?"Team Lead":"No Role"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.is_active?"bg-[#ECFDF3] text-[#054F31] border border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":"bg-[#FFF8E1] text-[#FB6E0A] border border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"p-4",children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"}),f!=="team"&&e.jsx("td",{className:"relative",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:ie=>m.current[t.id]=ie,onClick:()=>c(o===t.id?null:t.id),className:"text-lg",children:e.jsx(ge,{className:"text-[#595959]"})})})})]},t.id)})})]}),o!==null&&e.jsxs("div",{ref:S,style:{position:"fixed",top:`${C.top}px`,left:`${C.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsxs("button",{onClick:()=>{const t=b.find(r=>r.id===o);re(t.id),c(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(je,{className:"mr-2"})," Edit"]}),((W=(K=(J=b.find(t=>t.id===o))==null?void 0:J.roles)==null?void 0:K[0])==null?void 0:W.name)!=="deal-sourcer-team"&&e.jsxs("button",{onClick:()=>{N(o),c(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(ve,{className:"mr-2"})," Delete"]})]})]})})}),e.jsx(Ee,{pagination:{total:i.total,currentPage:d.page,perPage:i.total>=5?5:i.total,totalPages:Math.ceil(i.total/d.per_page)},setFilters:v})]})]}),e.jsx(ke,{isOpen:I.isOpen,onClose:Z,onConfirm:ae,isLoading:I.isLoading,title:"Delete Team Member"}),Y&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:ne,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Fe,{isOpen:Y,onSuccess:h,onClose:()=>V(!1)})]})}),G&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:de,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Me,{memberId:g,onSuccess:h,isOpen:G,onClose:()=>U(!1)})]})})]})};export{Le as default};
