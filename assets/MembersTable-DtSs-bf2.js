import{w as te,t as se,av as ae,u as re,V as be,r as s,bl as fe,m as e,z as le,bm as ge,bn as je,bo as ve,az as we,A as Ne,n as ke,o as ye,q as Fe,bp as Ee,bq as Me}from"./index-MiPrx3ME.js";import{D as Se}from"./DeleteConfirmationModal-DMeIqHIn.js";import{l as _e}from"./lodash-G4LMV4Fw.js";import De from"./AddMemberForm-CMDYppCi.js";import{P as Ce}from"./PaginationNew-CRBpj-CF.js";import{u as Ae}from"./useRefreshUser-Mjy4k_3S.js";const Pe=({isOpen:x,onClose:g,memberId:h,onSuccess:b})=>{const T=te(),{showSnackbar:_}=se(),{handleApiCall:C,loading:j}=ae(),{role:A}=re(p=>p.user),{register:w,handleSubmit:$,reset:z,setValue:N,watch:d,formState:{errors:i}}=be({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",role:""}}),[P,L]=s.useState(!1),[q,I]=s.useState(!1),[Q,m]=s.useState([null,null]);s.useRef(null);const[Z,M]=s.useState("");s.useEffect(()=>{x&&h&&(q||U())},[x,h]);const U=async()=>{var p,l,y,S;if(h){L(!0);try{const f=await fe(h),F=(l=(p=f==null?void 0:f.data)==null?void 0:p.data)==null?void 0:l.user;F&&(N("first_name",F.first_name||""),N("last_name",F.last_name||""),N("email",F.email||""),N("role",((S=(y=F.roles)==null?void 0:y[0])==null?void 0:S.name)||"teamki"),N("password","")),I(!0)}catch(f){console.error("Failed to fetch member details",f),_("Failed to fetch member details","error")}finally{L(!1)}}},O=p=>{if(!h){_("Missing member ID. Cannot update.","error");return}const l={...p};l.password||delete l.password,C({apiFn:()=>ve(h,l),data:l,onSuccess:()=>{_("Member updated","success"),b&&b(),g(),T("/all-members")}})},D=()=>{z(),g()};if(!x)return null;if(!h)return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg p-6 w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"No Member Selected"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Cannot open edit form without a member ID."}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",onClick:g,children:"Close"})]})});const[k,c]=s.useState(!1);return d("role"),e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl relative dark:bg-[#181818]",children:[(j||P)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(le,{})}),e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:g,children:"✕"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-[#F8F8F8]",children:"Edit Team Member"})]}),e.jsxs("form",{onSubmit:$(O),className:"space-y-4 p-5 bg-[#FDFDFD] rounded-xl dark:bg-[#181818]",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Full Name"}),e.jsx("input",{type:"text",...w("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),i.first_name&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:i.first_name.message}),e.jsx("input",{type:"hidden",...w("last_name")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Email"}),e.jsx("input",{type:"email",...w("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),className:"w-full border px-3 py-2 rounded-xl mb-4 dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Email"}),i.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Password (leave blank to keep current)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:k?"text":"password",...w("password",{minLength:{value:8,message:"Password must be at least 8 characters"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*\.]).*$/,message:"Password must contain at least one uppercase letter, one lowercase letter, and one symbol"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter New Password (optional)"}),e.jsx("span",{className:"absolute right-3 top-[38%] -translate-y-1/2 cursor-pointer text-purple",onClick:()=>c(p=>!p),children:k?e.jsx(ge,{}):e.jsx(je,{})})]}),i.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.password.message})]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-white",children:"Select Role"}),e.jsxs("select",{...w("role",{required:"Role is required"}),disabled:A!=="deal-sourcer",className:`w-full border p-3 rounded-xl mb-4 text-sm 
      dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]
      ${A!=="deal-sourcer"?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"team-lead",children:"Team Lead"}),e.jsx("option",{value:"team",children:"Team Member"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",onClick:D,disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",disabled:j,children:"Update Member"})]})]})]})})},qe=()=>{var W,X,ee;const{role:x,user:g}=re(t=>t.user),h=te(),{showSnackbar:b}=se(),{handleApiCall:T}=ae(),[_,C]=s.useState(!1),[j,A]=s.useState([]),[w,$]=s.useState(),[z,N]=s.useState(""),[d,i]=s.useState(null),[P,L]=s.useState({top:0,left:0}),q=Ae(),[I,Q]=s.useState(!1),[m,Z]=s.useState(0),[M,U]=s.useState(0),O=m>0&&M>m,[D,k]=s.useState({isOpen:!1,memberId:null,isLoading:!1}),[c,p]=s.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[l,y]=s.useState({page:1,per_page:(c==null?void 0:c.total)>=5?5:(c==null?void 0:c.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""}),S=s.useRef(null),f=s.useRef({});s.useEffect(()=>{function t(v){S.current&&!S.current.contains(v.target)&&i(null)}function r(){d!==null&&i(null)}function u(){if(d!==null&&f.current[d]){const n=f.current[d].getBoundingClientRect(),o=window.innerHeight-n.bottom,E=n.top;Q(o<200&&E>200),L({top:I?n.top-10:n.bottom+5,left:n.right-160})}}return u(),document.addEventListener("mousedown",t),document.addEventListener("scroll",r,!0),window.addEventListener("resize",u),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("scroll",r,!0),window.removeEventListener("resize",u)}},[d,I]),s.useEffect(()=>{O&&x!=="team"&&b(`Your plan allows only ${m} team members.
Please delete ${M-m} member(s) to continue.`,"error")},[O,M,m,x]);const F=_e.debounce(t=>{y(r=>({...r,search:t,page:1}))},500),ne=t=>{const r=t.target.value;N(r),F(r)},oe=t=>{const{name:r,value:u}=t.target;y({...l,[r]:u,page:1})},B=async()=>{var t,r,u,v;C(!0);try{const n=await Ee({...l,perPage:l.per_page||10,status:l.status==="all"?null:l.status}),o=n==null?void 0:n.data,E=(o==null?void 0:o.users)||[];A(E);const R=((t=o==null?void 0:o.user_subscription)==null?void 0:t.user_limit)??0;Z(R);const H=((r=o==null?void 0:o.page_context)==null?void 0:r.total_records)??E.length;U(Number(H));const a=n.data.page_context;a&&(p({currentPage:parseInt(a==null?void 0:a.page)||1,totalPages:Math.ceil(parseInt((a==null?void 0:a.total_records)||0)/parseInt((a==null?void 0:a.per_page)||10)),from:(parseInt(a.page)-1)*parseInt(a.per_page)+1,to:Math.min(parseInt(a==null?void 0:a.page)*parseInt(a==null?void 0:a.per_page),parseInt((a==null?void 0:a.total_records)||0)),total:parseInt((a==null?void 0:a.total_records)||0),hasMorePages:(a==null?void 0:a.has_more_page)==="true"}),await q())}catch(n){console.error("Error fetching members:",n),b(((v=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:v.message)||"Failed to fetch team members. Please try again.","error")}finally{C(!1)}};s.useEffect(()=>{B()},[l]);const de=t=>{k({isOpen:!0,memberId:t,isLoading:!1})},G=()=>{k({isOpen:!1,memberId:null,isLoading:!1})},ie=()=>{k(t=>({...t,isLoading:!0})),T({apiFn:()=>Me(D.memberId),onSuccess:()=>{B(),G(),b("Team member deleted successfully","success")},onError:t=>{k(r=>({...r,isLoading:!1}))}})},ce=t=>{$(t),Y(!0)},me=()=>{var t;if(x==="team"){b("You do not have permission to add team members","warning");return}if(!m||m===0){b("Your current plan does not allow adding team members. Please upgrade.","warning");return}if(M>=m){b(`Your ${((t=g==null?void 0:g.user_subscription)==null?void 0:t.title)||"current"} plan allows only ${m} team members.
Please delete ${M-m+1} member(s) to add a new one.`,"error");return}V(!0)},ue=()=>{V(!1)},xe=()=>{Y(!1)};s.useEffect(()=>{var t;(t=location.state)!=null&&t.openModal&&(setIsModalOpen(!0),h(location.pathname,{replace:!0,state:{}}))},[location.state,h,location.pathname]);const he=t=>{y(r=>({...r,sortColumn:t,sortOrder:r.sortColumn===t&&r.sortOrder==="asc"?"desc":"asc",page:1}))},pe=()=>j,[Le,Ie]=s.useState(null),[J,V]=s.useState(!1),[K,Y]=s.useState(!1);return e.jsxs("div",{className:"min-h-screen dark:bg[#111827]",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col items-start justify-center  md:flex-row md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Team Members"}),e.jsx("p",{className:"text-[#333333] dark:text-white",children:"Manage your team members and their access"})]}),x!=="team"&&e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:me,className:"flex items-center gap-2 px-4 py-3 rounded-md bg-[#6C5DD3] text-white hover:bg-[#5a4bb2] transition-colors",children:[e.jsx(we,{size:14}),e.jsx("span",{children:"Add Member"})]})})]})}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:gap-0 md:flex-row space-x-4 justify-between px-4 py-4 items-start",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for team members",className:"form-control",value:z,onChange:ne,style:{paddingLeft:"40px"}}),e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(t=>e.jsx("button",{onClick:()=>oe({target:{name:"status",value:t.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${l.status===t.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:t.label},t.value))})})]}),e.jsx("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] overflow-hidden comparable-listing-table-wrap",children:_?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(le,{})}):j.length===0?e.jsx("div",{className:"text-center p-12 dark:text-white text-dark",children:e.jsx("p",{children:"No team members found. Add some members to see them here."})}):e.jsx("div",{className:"whitespace-nowrap",children:e.jsxs("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-[#F8F8F8] border dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SN NO."}),e.jsx("th",{className:"p-4",children:"TEAM MEMBER"}),e.jsx("th",{className:"p-4",children:"EMAIL"}),e.jsx("th",{className:"p-4",children:"Role"}),e.jsx("th",{className:"p-4",children:"STATUS"}),e.jsxs("th",{className:"p-4 cursor-pointer",onClick:()=>he("created_at"),children:["CREATED AT",l.sortColumn==="created_at"&&e.jsx("span",{className:"ml-1",children:l.sortOrder==="asc"?"↑":"↓"})]}),x!=="team"&&e.jsx("th",{className:"p-4 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{children:pe().map((t,r)=>{var u,v,n,o,E,R;return e.jsxs("tr",{className:r%2===0?"text-dark dark:text-white":"dark:bg-[#191D27] bg-[#DEDEE0] text-dark dark:text-white",children:[e.jsx("td",{className:"p-4",children:r+1}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 dark:bg-purple-800 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-purple-800 dark:text-purple-100",children:[((u=t.first_name)==null?void 0:u[0])||"",((v=t.last_name)==null?void 0:v[0])||""]})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium",children:t.first_name||t.last_name?`${t.first_name||""} ${t.last_name||""}`:"-"})})]})}),e.jsx("td",{className:"p-4",children:t.email||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm inline-block ${t.roles&&t.roles.length>0&&((n=t.roles[0])==null?void 0:n.name)==="team"||t.roles&&t.roles.length>0&&((o=t.roles[0])==null?void 0:o.name)==="deal-sourcer-team","text-dark"}`,children:t.roles&&t.roles.length>0&&((E=t.roles[0])==null?void 0:E.name)==="team"?"Team Member":t.roles&&t.roles.length>0&&((R=t.roles[0])==null?void 0:R.name)==="team-lead"?"Team Lead":"No Role"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.is_active?"bg-[#ECFDF3] text-[#054F31] border border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":"bg-[#FFF8E1] text-[#FB6E0A] border border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:t.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"p-4",children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"}),x!=="team"&&e.jsx("td",{className:"relative",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:H=>f.current[t.id]=H,onClick:()=>i(d===t.id?null:t.id),className:"text-lg",children:e.jsx(ke,{className:"text-[#595959]"})})})})]},t.id)})})]}),d!==null&&e.jsxs("div",{ref:S,style:{position:"fixed",top:`${P.top}px`,left:`${P.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsxs("button",{onClick:()=>{const t=j.find(r=>r.id===d);ce(t.id),i(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(ye,{className:"mr-2"})," Edit"]}),((ee=(X=(W=j.find(t=>t.id===d))==null?void 0:W.roles)==null?void 0:X[0])==null?void 0:ee.name)!=="deal-sourcer-team"&&e.jsxs("button",{onClick:()=>{de(d),i(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(Fe,{className:"mr-2"})," Delete"]})]})]})})}),e.jsx(Ce,{pagination:{total:c.total,currentPage:l.page,perPage:c.total>=5?5:c.total,totalPages:Math.ceil(c.total/l.per_page)},setFilters:y})]})]}),e.jsx(Se,{isOpen:D.isOpen,onClose:G,onConfirm:ie,isLoading:D.isLoading,title:"Delete Team Member"}),J&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:ue,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(De,{isOpen:J,onSuccess:B,onClose:()=>V(!1)})]})}),K&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:xe,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Pe,{memberId:w,onSuccess:B,isOpen:K,onClose:()=>Y(!1)})]})})]})};export{qe as default};
