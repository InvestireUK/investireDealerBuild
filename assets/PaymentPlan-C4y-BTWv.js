import{T as Y,U as H,u as I,s as J,q as K,r,V,X as Q,m as e,x as ee,cM as se,bi as w,bj as h,bo as q,cN as ae,c6 as re,S as te}from"./index-BU7qlyvS.js";import{u as oe}from"./useRefreshUser-DuzYAq7W.js";import{M as O}from"./Modal-CVyfocZ-.js";te("pk_test_51R6uLuGhmABE4SukbmgqsLITna4D57Ittag620AxGwm1ckI0oeYBXvNUBO9w4WhygDlp3sWd7ldWiZlGbR8jzxXk00N3jUSXPv");const Ce=()=>{var L,M,E,U,F;const b=Y(),y=H(),{user:s,role:m}=I(a=>a.user),{darkMode:g}=I(a=>a.theme);J();const{showSnackbar:n}=K();oe();const[ne,le]=r.useState(!1),[_,j]=r.useState(!1),[$,N]=r.useState(!1),[de,ie]=r.useState(null),[ce,D]=r.useState(null),[me,pe]=r.useState(null),[ue,z]=r.useState(null),[i,fe]=r.useState({current:!1,new:!1,confirm:!1}),[A,f]=r.useState(!1),[v,B]=r.useState([]),[xe,we]=r.useState(!1),[R,p]=r.useState(!1),[C,P]=r.useState(!1),{register:he,handleSubmit:be,formState:{errors:ye},reset:S,setValue:ge}=V({defaultValues:{first_name:(s==null?void 0:s.first_name)||"",last_name:(s==null?void 0:s.last_name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",role:m||"",company_name:(s==null?void 0:s.company_name)||"",registration_number:(s==null?void 0:s.registration_number)||"",company_website:(s==null?void 0:s.company_website)||"",company_email:(s==null?void 0:s.company_email)||"",company_phone:(s==null?void 0:s.company_phone)||""}}),{register:x,handleSubmit:X,formState:{errors:l},reset:G}=V({defaultValues:{current_password:"",new_password:"",confirm_password:""}});r.useEffect(()=>{s&&(S({first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",role:m||"",company_name:s.company_name||"",registration_number:s.registration_number||"",company_website:s.company_website||"",company_email:s.company_email||"",company_phone:s.company_phone||""}),s.profile_image&&D(s.profile_image),s.company_logo_url&&z(s.company_logo_url),s.stripe_customer_id&&k(s.stripe_customer_id))},[s,S,m]);const k=async a=>{try{N(!0);const t=await Q(a);t&&t.data&&B(t.data)}catch(t){console.error("Error fetching cards:",t),n("Failed to load payment methods","error")}finally{N(!1)}},W=async a=>{var t,o;try{if(j(!0),a.new_password!==a.confirm_password){n("New passwords don't match","error");return}const c={current_password:a.current_password,password:a.new_password,password_confirmation:a.confirm_password};(await ae(c)).data&&(n("Password updated successfully","success"),G(),f(!1))}catch(c){console.error("Password update error:",c);const u=((o=(t=c.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to update password";n(u,"error")}finally{j(!1)}},T=async a=>{if(a.preventDefault(),!b||!y){n("Stripe not loaded yet","error");return}const t=y.getElement(q);if(!t){n("Card element not found","error");return}P(!0);try{const{error:o,paymentMethod:c}=await b.createPaymentMethod({type:"card",card:t});if(o)n(o.message||"Invalid card details","error");else{const u="https://phplaravel-1547671-6035260.cloudwaysapps.com/api/v1",Z=localStorage.getItem("token"),_e=await re.put(`${u}/payment-method/update`,{payment_method_id:c.id},{headers:{Authorization:`Bearer ${Z}`}});n("Card collected successfully","success"),await k(s.stripe_customer_id),p(!1)}}catch(o){n("Failed to update card","error"),console.error("Full error while updating card:",(o==null?void 0:o.response)||o)}finally{P(!1)}},d=v.length>0?v[0]:null;return s.company_logo_url,e.jsxs("div",{className:"min-h-screen my-5",children:[e.jsx("div",{className:"max-w-7xl mx-auto",children:m==="investor"?"":e.jsxs("div",{className:"profile-detail-form-container-main-div",children:[e.jsx("h2",{className:"text-xl text-black  dark:text-[#F8F8F8]",children:"Payment Method"}),e.jsx("div",{className:"profile-detail-form-container-wrap",children:$?e.jsx(ee,{size:20}):d?e.jsx("div",{className:"p-4 rounded mb-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:e.jsxs("div",{className:"p-7 border rounded-xl",children:[e.jsxs("div",{className:"flex gap-4 ",children:[((L=d.card)==null?void 0:L.brand)&&e.jsx("div",{children:e.jsx("p",{className:"dark:text-white text-black uppercase font-semibold border p-1",children:d.card.brand})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(se,{className:"text-purple-500"}),e.jsx("p",{className:"dark:text-white text-black font-medium",children:((M=d.billing_details)==null?void 0:M.name)||"Card"})]}),e.jsxs("p",{className:"text-gray-400",children:["**** **** **** ",(E=d.card)==null?void 0:E.last4]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Expires ",(U=d.card)==null?void 0:U.exp_month,"/",(F=d.card)==null?void 0:F.exp_year]})]})]}),e.jsx("div",{className:"mt-5 text-center border py-2 px-3 rounded-xl text-sm",children:e.jsx("button",{onClick:()=>p(!0),children:"Add a new payment method"})})]})})}):e.jsx("p",{className:"text-center py-4",children:"No payment methods found."})})]})}),e.jsx(O,{isOpen:A,onClose:()=>f(!1),title:"Change Password",children:e.jsxs("form",{onSubmit:X(W),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i.current?"text":"password",placeholder:"Current Password",className:`form-control w-full ${l.current_password?"border border-red-500":""}`,...x("current_password",{required:"Current password is required"})}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",onClick:()=>togglePasswordVisibility("current"),children:i.current?e.jsx(w,{}):e.jsx(h,{})})]}),l.current_password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.current_password.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i.new?"text":"password",placeholder:"New Password",className:`form-control w-full ${l.new_password?"border border-red-500":""}`,...x("new_password",{required:"New password is required",minLength:{value:6,message:"Password must be at least 6 characters"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*\.]).*$/,message:"Password must contain at least one uppercase letter, one lowercase letter, and one symbol"}})}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",onClick:()=>togglePasswordVisibility("new"),children:i.new?e.jsx(w,{}):e.jsx(h,{})})]}),l.new_password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.new_password.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i.confirm?"text":"password",placeholder:"Confirm New Password",className:`form-control w-full ${l.confirm_password?"border border-red-500":""}`,...x("confirm_password",{required:"Confirm password is required",validate:(a,t)=>a===t.new_password||"Passwords do not match"})}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",onClick:()=>togglePasswordVisibility("confirm"),children:i.confirm?e.jsx(w,{}):e.jsx(h,{})})]}),l.confirm_password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.confirm_password.message})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[e.jsx("button",{type:"button",className:"red-btn",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"purple-btn",disabled:_,children:_?"Updating...":"Update Password"})]})]})}),e.jsx(O,{isOpen:R,onClose:()=>p(!1),title:"Update Payment Method",children:e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Card Details"}),e.jsx("div",{className:"p-3 dark:bg-[#15172b] bg-[#ffff] rounded",children:e.jsx(q,{options:{style:{base:{fontSize:"16px",color:g?"#fff":"#000000","::placeholder":{color:g?"#cccccc":"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[e.jsx("button",{type:"button",className:"red-btn",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"purple-btn",disabled:C,children:C?"Updating...":"Update Card"})]})]})})]})};export{Ce as default};
