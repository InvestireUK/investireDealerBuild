import{w as ye,v as fe,u as N,av as je,a8 as Ne,bF as _e,r,bI as X,m as e,aU as we,c6 as _,bL as p,bM as ve,ay as Ce,c7 as F,bV as ke,bW as Fe,bX as Pe,bZ as Se,aM as Ae,aN as Ie,aH as De,as as Le,Q as Ee,c8 as Re}from"./index-usOavGx3.js";import{u as He}from"./useRefreshUser-pr_9e626.js";import{F as Te}from"./FinancialSummaryView-CakrnwDd.js";import{P as Me}from"./PaginationNew-3CY3ppBQ.js";const Ke=()=>{var M,B,V,z,$,G,U,Y,O,K,W;const g=ye(),d=fe(),q=He(),s=N(t=>t.deal.deal),{user:w,role:Be}=N(t=>t.user);console.log("deal in summary page =>>",s);const P=N(t=>t.deal.currentStep),Q=N(t=>t.deal.comparableMode),Z="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",{handleApiCall:J,loading:ee}=je(),{data:v}=Ne(_e,s==null?void 0:s.id,{type:Q});(M=v==null?void 0:v.data)!=null&&M.dealComparables;const u=((...t)=>t.find(a=>Array.isArray(a)&&a.length>0)||[])(s==null?void 0:s.newcomperable,s==null?void 0:s.property_deal_comparables,s==null?void 0:s.property_deal_sa_comparables),l=(s==null?void 0:s.deal_type_id)===2?s.property_deal_sa_comparables||[]:s.property_deal_comparables||[],[x,se]=r.useState({page:1,per_page:(l==null?void 0:l.length)>=5?5:l==null?void 0:l.length}),S=(x.page-1)*x.per_page,h=l.slice(S,S+x.per_page),te={currentPage:x.page,perPage:x.per_page,total:l.length,totalPages:Math.ceil(l.length/x.per_page)};s!=null&&s.address_line_1,s!=null&&s.address_line_2,s!=null&&s.post_code,(B=s==null?void 0:s.country)!=null&&B.name;const A=(s==null?void 0:s.image_url)||null,ae=(s==null?void 0:s.map_image_url)||null,re=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const a={lat:t.coords.latitude,lng:t.coords.longitude};setUserLocation(a),setAddressCoordinates(a)},()=>{alert("Location access denied or unavailable.")}):alert("Geolocation is not supported by this browser.")},le=async()=>{var t;try{const i=await(await fetch("https://api.heygen.com/v2/templates",{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"sk_V2_hgu_kKqknA6ytKH_2KwO3bxcX62IB12c285JDCoAIdiiuduk"}})).json();d(Re((t=i==null?void 0:i.data)==null?void 0:t.templates)),g("/deal-view-ai-video-generator")}catch(a){console.error("API error:",a)}},ie=t=>{var n,o,c,j;const a=[];if(t!=null&&t.no_of_dwelling){const m=(t==null?void 0:t.deal_type_id)===2?t.no_of_dwelling>1?" Beds":" Bed":t.no_of_dwelling>1?" Bedrooms":" Bedroom";a.push(t.no_of_dwelling+m)}if(t.deal_type&&a.push(t.deal_type.title),(n=t==null?void 0:t.sub_category)!=null&&n.title&&a.push(t.sub_category.title),(o=t==null?void 0:t.property_type_category)!=null&&o.title&&a.push((c=t.property_type_category)==null?void 0:c.title),(j=t==null?void 0:t.exit_type)!=null&&j.title){let m=t.exit_type.title.toLowerCase();m==="sell"?m="Flip":m==="refinance"&&(m="BRRR"),a.push(m)}return a.join(",")},y={description:(s==null?void 0:s.description_type)==="ai"?(s==null?void 0:s.description_ai)||"No AI description available":(s==null?void 0:s.description)||"No description available"},ne={location:(s==null?void 0:s.description_type)==="ai"?(s==null?void 0:s.location_ai)||"No AI location available":(s==null?void 0:s.location)||"No location available"},[I,oe]=r.useState(!1),[ze,ce]=r.useState(!1),[pe,de]=r.useState(!1),[$e,me]=r.useState(!1),f=r.useRef(null),C=r.useRef(null);r.useEffect(()=>{if(f.current){const a=parseFloat(getComputedStyle(f.current).lineHeight)*3;de(f.current.scrollHeight>a)}if(C.current){const a=parseFloat(getComputedStyle(C.current).lineHeight)*3;me(C.current.scrollHeight>a)}},[y,ne]);const ue=()=>{oe(t=>{const a=!t;return a&&ce(!1),a})},xe=()=>{const t={_method:"PATCH",status:"publish",step:5};J({apiFn:()=>De(s.id,t),data:t,successMessage:"Deal uploaded successfully",errorMessage:"Failed to upload Deal",onSuccess:async a=>{const i={step:5,...a==null?void 0:a.deal};d(Le(!0)),d(Ee(i)),await q(),g("/deals/deal-view/"+s.id)}})};r.useEffect(()=>(d(X(!0)),d({type:"deal/setCurrentStep",payload:Math.max(P,5)}),()=>{d(X(!1))}),[d,P]);const[he,D]=r.useState(!1),[L,k]=r.useState(0),b=((V=s==null?void 0:s.property_deal_media)==null?void 0:V.map(t=>{var a;return(a=t==null?void 0:t.media)==null?void 0:a.media_url}))||[],E=t=>{k(t),D(!0)},R=t=>{t.stopPropagation(),D(!1)},H=t=>{t.stopPropagation(),k(a=>(a+1)%b.length)},T=t=>{t.stopPropagation(),k(a=>(a-1+b.length)%b.length)},ge=((z=w==null?void 0:w.user_subscription)==null?void 0:z.ai_video_limit)===0,be=()=>{if(ge){showSnackbar("Video Generation credit limit has been reached","warning");return}le()};return e.jsxs("div",{className:"create-deal-summary-page-wrap",children:[e.jsxs("div",{className:"flex items-center justify-center m-5",children:[e.jsx("h4",{className:"text-[#333333] font-bold light-black dark:text-[#F8F8F8]",children:"Summary"}),(s==null?void 0:s.step_completed)===5&&e.jsxs("button",{onClick:be,className:"ai-description-tab transition flex items-center gap-2 md:ms-auto purple-gradient-btn",children:[e.jsx(we,{}),e.jsx("span",{className:"hidden md:inline",children:s!=null&&s.ai_video_id?"Re-generate AI Video":"AI Video Generator"})]})]}),ee?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-add-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Title"}),e.jsxs("button",{type:"button",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>g("/create-deal/address"),children:[e.jsx(_,{className:"text-lg"}),"Edit details"]})]}),e.jsxs("div",{className:"summary-property-map-wrap",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between purchased-price-with-location",children:[e.jsx("p",{className:"text-[#242424] font-medium property-location-text mb-4 dark:text-[#F8F8F8]",children:ie(s)}),(s==null?void 0:s.deal_type_id)===2?e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Rent: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:($=s==null?void 0:s.property_deal_sa_investment)!=null&&$.rent?`£${parseFloat((G=s==null?void 0:s.property_deal_sa_investment)==null?void 0:G.rent).toLocaleString()}`:"0"})]}):e.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right dark:text-[#C5C5C5]",children:["Purchased Price: ",e.jsx("span",{className:"text-[#242424] dark:text-[#F8F8F8]",children:(U=s==null?void 0:s.property_deal_investment)!=null&&U.purchase_price?`£${parseFloat((Y=s==null?void 0:s.property_deal_investment)==null?void 0:Y.purchase_price).toLocaleString()}`:"0"})]})]}),e.jsxs("div",{className:"summary-property-map-grid-wrap",children:[e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${((O=s==null?void 0:s.property_deal_media)==null?void 0:O.length)>0?"summary-property-col":""}`,children:[e.jsx("div",{className:"summary-property-subimages-div",children:(K=s==null?void 0:s.property_deal_media)==null?void 0:K.slice(0,4).map((t,a)=>{var o,c;const n=(((o=s==null?void 0:s.property_deal_media)==null?void 0:o.length)||0)-4;return e.jsx("div",{className:"summary-property-subimages relative",children:t?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:(c=t==null?void 0:t.media)==null?void 0:c.media_url,alt:"Property",className:"w-full h-full object-cover cursor-pointer",onClick:()=>E(a)}),a===3&&n>0&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white text-lg font-semibold cursor-pointer",onClick:()=>E(a),children:["+",n]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:p.noImageAvailable})},a)})}),e.jsx("div",{className:"summary-property-main-images-div h-full",children:e.jsx("div",{className:"w-full bg-gray-700 summary-property-div",children:A?e.jsx("img",{src:A,alt:"Property",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:p.noImageAvailable})})})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:R,children:e.jsxs("div",{className:"relative max-w-4xl w-full p-4 flex items-center justify-center",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:b[L],alt:"Large view",className:"max-h-[80vh] max-w-full object-contain mx-auto rounded-lg shadow-lg"}),e.jsx("div",{className:"absolute inset-y-0 left-0 w-1/2 cursor-pointer",onClick:t=>{t.stopPropagation(),T(t)}}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-1/2 cursor-pointer",onClick:t=>{t.stopPropagation(),H(t)}}),e.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:t=>{t.stopPropagation(),T(t)},children:"❮"}),e.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white text-3xl bg-black bg-opacity-40 px-3 py-2 rounded-full z-50",onClick:t=>{t.stopPropagation(),H(t)},children:"❯"}),e.jsx("button",{className:"fixed top-4 right-4 text-white text-3xl z-50",onClick:R,children:e.jsx(ve,{})}),e.jsxs("div",{className:"absolute bottom-4 text-white text-center w-full",children:[L+1," / ",b.length]})]})})]}),e.jsx("div",{className:"summary-map-loaction-col",children:e.jsx("div",{className:"w-full bg-gray-700 summary-map-wrapper",children:ae?e.jsxs(e.Fragment,{children:[e.jsx("iframe",{width:"600",height:"358",className:"rounded-lg w-full",style:{border:0,borderRadius:"12px"},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:`https://www.google.com/maps/embed/v1/place?key=${Z}&q=${s==null?void 0:s.lat},${s==null?void 0:s.lng}&zoom=16`,title:"Google Map"}),e.jsx("button",{type:"button",className:"absolute bottom-[-20px] right-[50px] bg-black text-white px-2 py-2 rounded-full border border-white text-sm shadow transition",onClick:re,children:e.jsx(Ce,{})})]}):e.jsx("div",{className:"w-full flex items-center justify-center text-gray-500",children:p.noMapImageAvailable})})})]})]})]}),e.jsxs("div",{className:"deal-summart-description-wrap mt-6",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Description"}),e.jsxs(F,{to:"/create-deal/description",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(_,{className:"text-lg"}),p.editDetails]})]}),e.jsx("div",{className:"summary-description-text",children:e.jsxs("div",{className:"summary-description-heading-wrap",children:[e.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2 dark:text-[#ECECEC]",children:"Property description:"}),e.jsx("p",{ref:f,className:`text-[#595959] whitespace-pre-line overflow-hidden transition-all duration-300 dark:text-[#C5C5C5] ${I?"":"line-clamp-3"}`,dangerouslySetInnerHTML:{__html:ke(y==null?void 0:y.description)}}),pe&&e.jsx("button",{onClick:ue,className:"mt-2 text-sm text-[#6C5DD3] font-semibold",children:I?"Read less":"Read more"})]})})]}),e.jsx("div",{className:"mt-5",children:(s==null?void 0:s.deal_type_id)===2?e.jsx(Fe,{deal:s}):e.jsx(Pe,{deal:s})}),e.jsxs("div",{className:"mt-6 DealsDetails-page-wrapper summary-financials-details-wrap",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:p.financials}),e.jsxs(F,{to:"/create-deal/financials",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},children:[e.jsx(_,{className:"text-lg"}),p.editDetails]})]}),e.jsx("div",{className:"min-h-screen financial-page-main-div-wrap",children:e.jsx("div",{className:"financial-page-inner-div-wrap",children:e.jsx(Te,{})})})]}),e.jsxs("div",{className:"summary-page-comparables-sec",children:[e.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between",children:[e.jsx("h5",{className:"text-lg font-semibold",children:p.comparables}),e.jsxs(F,{to:(u==null?void 0:u.length)>0?(s==null?void 0:s.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables",className:"edit-address-detail-btn purple-outline-btn items-center gap-3",style:{display:"flex"},onClick:()=>g("/create-deal/comparable-table"),children:[e.jsx(_,{className:"text-lg"}),p.editDetails]})]}),e.jsxs("div",{children:[(s==null?void 0:s.deal_type_id)===2?h.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"summary-page-comapare-table-main-div",children:e.jsx("div",{className:"overflow-x-auto comparable-listing-table-wrap",children:h.map((t,a)=>e.jsx(Se,{comp:t},a))})}):h.length===0?e.jsx("p",{className:"p-1",children:"No comparables available"}):e.jsx("div",{className:"border dark:border-[#454545]",children:e.jsx("div",{className:"overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark text-[12px] border-b dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SL NO."}),e.jsx("th",{className:"p-4",children:"PROPERTY"}),e.jsx("th",{className:"p-4",children:"CATEGORY"}),e.jsx("th",{className:"p-4",children:"BEDROOMS"}),e.jsx("th",{className:"p-4",children:"PRICE"}),e.jsx("th",{className:"p-4",children:"YEAR"}),e.jsx("th",{className:"p-4",children:"DISTANCE"})]})}),e.jsx("tbody",{children:h==null?void 0:h.map((t,a)=>{var i,n,o,c;return e.jsxs("tr",{className:"border-b dark:border-[#333333]",children:[e.jsx("td",{className:"p-4",children:a+1}),e.jsxs("td",{className:"p-4 flex items-normal gap-2",children:[e.jsx("img",{src:(t==null?void 0:t.image_url)||Ae,alt:"Image",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate max-w-[100px]",children:t==null?void 0:t.address}),t!=null&&t.linked_search_url?e.jsx("a",{href:t.linked_search_url,target:"_blank",rel:"noopener noreferrer",className:"text-[#3673D5] font-bold text-sm cursor-pointer",children:"Website"}):e.jsx("span",{className:"text-gray-400 font-bold text-sm",children:"Website"})]}),(t==null?void 0:t.type)==="ai"&&e.jsx("span",{className:"mr-1 inline-block w-4 h-4 align-top",children:e.jsx("img",{src:Ie,alt:"AI",className:"w-full h-full object-contain"})})]}),e.jsx("td",{className:"p-4",children:(o=(n=(i=(t==null?void 0:t.property_type_string)||(t==null?void 0:t.sub_category))==null?void 0:i.toLowerCase())==null?void 0:n.replace(/_/g," "))==null?void 0:o.replace(/\b\w/g,j=>j.toUpperCase())}),e.jsx("td",{className:"p-4",children:t.no_of_bedroom}),e.jsxs("td",{className:"p-4",children:["£",Number(t.price).toLocaleString("en-GB",{maximumFractionDigits:0})]}),e.jsx("td",{className:"p-4",children:t.year}),e.jsx("td",{className:"p-4",children:(t==null?void 0:t.distance)!=null?`${(c=parseInt(t==null?void 0:t.distance))==null?void 0:c.toFixed(2)} Mile${(t==null?void 0:t.distance)>1?"s":""}`:"-"})]},t.id||a)})})]})})}),l.length>0&&e.jsx(Me,{pagination:te,setFilters:se})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between text-lg text-gray-600 my-2",children:[e.jsxs("span",{className:"dark:text-[#F8F8F8]",children:["Last updated by: ",e.jsx("strong",{children:((W=s==null?void 0:s.last_updated_by)==null?void 0:W.name)||"-"})]}),e.jsx("span",{className:"dark:text-[#F8F8F8]",children:s!=null&&s.updated_at?new Date(s.updated_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):""})]}),e.jsxs("div",{className:"flex justify-end items-center mt-5 gap-4",children:[e.jsx("button",{className:"w-fit flex items-center gap-5 justify-center gray-outline-btn",onClick:()=>{const t=(u==null?void 0:u.length)>0?(s==null?void 0:s.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables";g(t)},children:"Back"}),e.jsx("button",{onClick:xe,className:"w-fit purple-btn items-center justify-center",children:"Publish"})]})]})]})};export{Ke as default};
