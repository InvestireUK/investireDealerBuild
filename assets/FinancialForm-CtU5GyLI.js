import{u as je,a2 as Ue,s as tt,t as nt,r as k,aw as at,aZ as We,V as rt,W as q,a_ as st,m as c,a$ as kt,aL as Ne,an as ot,ao as ct,aI as it,aq as ut,N as _t,o as ze,b0 as Ze,b1 as Dt,b2 as Je,b3 as Mt,b4 as Ct}from"./index-BU7qlyvS.js";import{F as Tt}from"./FinancialSummaryView-CbYzfYjq.js";const ft="",$t="cursor-not-allowed",$=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),a=parseFloat(s);return isNaN(a)?0:a},Nt=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const f=String(e).replace(/[,%]/g,""),g=parseFloat(f);return isNaN(g)||g<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},dt=(e,s,a,f,g,T,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(a))return!0;if(!Xe(e,s,a,f,g,T,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),h=parseFloat(K);return isNaN(h)?!0:h>999999999999e-2?(g(a,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(f[a]&&T(a),!0)},Xe=(e,s,a,f,g,T,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),b=parseFloat(re),K={isValid:!0},h=oe=>({isValid:!1,message:oe});if(isNaN(b)&&a!=="payback_period")return g(a,{type:"manual",message:"Please enter a valid number"}),h("Please enter a valid number");switch(a){case"purchase_price":if(b<0||b===0)return g(a,{type:"manual",message:"Purchase price must be greater than zero"}),h("Purchase price must be greater than zero");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"LTV must be between 0% and 100%"}),h("LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),h("Post-refurb LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage"}),h("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return g(a,{type:"manual",message:"Sourcing fee cannot be negative"}),h("Sourcing fee cannot be negative");break;case"refurbishment_cost":if(b<=0)return g(a,{type:"manual",message:"Refurbishment cost cannot be negative"}),h("Refurbishment cost cannot be negative");break;case"gross_domestic_value":if(b<0||b===0)return g(a,{type:"manual",message:"GDV must be greater than zero"}),h("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return g(a,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),h("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return g(a,{type:"manual",message:"Deposit cannot be negative"}),h("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return g(a,{type:"manual",message:"At least one unit is required"}),h("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return g(a,{type:"manual",message:"Rent must be greater than zero"}),h("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return g(a,{type:"manual",message:"Monthly rental income must be greater than zero"}),h("Monthly rental income must be greater than zero");break;default:f[a]&&T(a);break}return f[a]&&T(a),K},Ce=e=>{const s=$(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},Lt=e=>e?String(e).replace(/[,%]/g,""):"0",qt=(e,s)=>{const a=String(e).replace(/[,%]/g,""),f=parseFloat(a);if(isNaN(f)||f<0||f>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":"Percentage must be between 0% and 100%";const g=a.split(".");return g.length===2&&g[1].length>2?"Maximum 2 decimal places allowed":!0},It=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const a=s.split(".");a.length>2&&(s=a[0]+"."+a.slice(1).join("")),a.length===2&&a[1].length>2&&(s=a[0]+"."+a[1].substring(0,2));const f=parseFloat(s);return isNaN(f)?"":f<0?"0":f>100?"100":s},Te=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const a=parseFloat(s);if(isNaN(a))return s+"%";const f=s.split(".");if(f.length===1||f.length===2&&f[1]==="")return s+"%";{const g=f[0],T=f[1].substring(0,2);return`${g}.${T}%`}},Ot=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),a=(e-s)*12,f=Math.round(a);if(s===0)return f===1?"1 month":`${f} months`;if(f===0)return s===1?"1 year":`${s} years`;{const g=s===1?"1 year":`${s} years`,T=f===1?"1 month":`${f} months`;return`${g} ${T}`}},bt=()=>{const e=je(p=>{var d;return(d=p==null?void 0:p.deal)==null?void 0:d.deal}),s=Ue();je(p=>{var d;return(d=p==null?void 0:p.deal)==null?void 0:d.currentStep});const a=tt(),f=nt(),[g,T]=k.useState(null),{handleApiCall:H,loading:re}=at(),[b,K]=k.useState(!1),[h,oe]=k.useState(!1),[Ge,Be]=k.useState([]),[_e,Fe]=k.useState(!1);s.pathname.includes("/summary");const Re=["before_refurb_mortgage_value","before_refurb_mortage_cost","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],ke=e?We(e):{},{register:De,handleSubmit:U,reset:F,control:G,setValue:u,formState:{errors:le},getValues:R,setError:W,clearErrors:X}=rt({defaultValues:ke,mode:"onChange"});k.useEffect(()=>{if(e&&!h){const p=We(e);F(p),oe(!0)}},[e,F,h]),k.useEffect(()=>{if(e&&h){const p=We(e);Object.entries(p).forEach(([D,V])=>{V!==""&&V!==null&&V!==void 0&&u(D,V)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(D=>{const V=R(D);if(V&&!String(V).includes("%")){const N=document.querySelector(`input[name="${D}"]`);N&&!N.readOnly&&(N.value=Te(V))}})}},[e,u,h]);const ae=q({control:G,name:"purchase_price"}),me=q({control:G,name:"effective_rate_percentage"});k.useEffect(()=>{if(ae&&$(ae)>0&&(e!=null&&e.country_id)){K(!1);const p=setTimeout(()=>{ce(e.country_id,e.property_type_id,ae,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(p)}},[ae,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const ce=async(p,d,D,V)=>{try{const N=await st({countryId:p,propertyTypeId:d,price:D,tenure_type:V});if(N&&N.data&&N.data.stamp_duty_amount!==void 0){const I=$(D),J=N.data.stamp_duty_amount;T(J),K(!0);const o=R("stamp_duty_amount");if(!o||o==="0"||ae!==D){u("stamp_duty_amount",Ce(J)),X("stamp_duty_amount");const t=I>0?J/I*100:0,n=Number(t.toFixed(4));u("effective_rate_percentage",n),X("effective_rate_percentage")}}else T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0")}catch{T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0")}},Y=q({control:G,name:"stamp_duty_amount"});k.useEffect(()=>{if(!_e||!Y||!ae)return;const p=$(Y),d=$(ae),D=d>0?p/d*100:0,V=Number(D.toFixed(4));u("effective_rate_percentage",V),X("effective_rate_percentage")},[Y,ae,_e,u,X]);const ge=p=>{const d=$(p.target.value);u("purchase_price",p.target.value),K(!1),d>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?ce(e.country_id,e.property_type_id,d,e==null?void 0:e.tenure_type):d<=0&&(T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0"))},x=q({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","insurance","other_expenses","monthly_rental_income"]});k.useEffect(()=>{if(!x||!x[0])return;const p=setTimeout(()=>{const d=$(x[0]),D=$(x[1])/100,V=$(x[3]),N=$(x[4]),I=$(x[5]),J=$(x[6]),o=$(x[7]),t=$(x[8]),n=$(x[9]),r=$(x[10])/100,i=$(x[11])/100,m=$(x[12]),y=$(x[13]);$(x[14]),$(x[15])/100,$(x[16]),$(x[17])/100,$(x[18]),$(x[19]);const l=d*D,_=l*$(x[2])/100/12;let P=$(g);const C=$(R("stamp_duty_amount"));P=C>0?C:P,$(R("effective_rate_percentage"));const L=D>0?d*(1-D):0,A=J>0?I*(J/100):0,M=100-$(x[1]),S=_+L+V+N+P,j=P+L+V+N+I+A+o+t+m,O=n*r,se=O*i/12,de=O-l,xe=j-de,He=j>0?Math.round(xe/j*100):0,Oe=j>0?parseFloat((de/j*100).toFixed(2)):0;y===1&&$(R("monthly_rental_income"));const Me=parseFloat((n-j-l).toFixed(2)),Ve=Me>0,Ae=xe!==0?Math.round(Me/j*100):0,Q=(z,pe)=>{if(z==="return_on_cash_investment_percentage"){const be=pe.toLocaleString("en-US")+"%";u(z,be)}else if(z==="payback_period")u(z,Ot(pe));else if((z==="deposit_amount_required"||z==="deposit_percentage")&&D===0)u(z,"0");else if(pe<0&&(z==="after_refurb_money_left_in"||z==="profit_amount")){const be=pe.toLocaleString("en-US");u(z,be)}else{if((z==="stamp_duty_amount"||z==="effective_rate_percentage")&&b&&(x[1]!==void 0||x[2]!==void 0))return;if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(z))if(pe>0&&z!=="money_in_cash_invested_percentage"){const Pe=Te(pe);u(z,Pe)}else if(pe<0&&z==="money_in_cash_invested_percentage"){const Pe=pe.toLocaleString("en-US")+"%";u(z,Pe)}else u(z,"");else if(pe>0){const Pe=Ce(pe);u(z,Pe)}else u(z,"");if((z==="stamp_duty_amount"||z==="effective_rate_percentage")&&b&&!_e&&(x[1]!==void 0||x[2]!==void 0))return}};Q("before_refurb_mortgage_value",l),Q("before_refurb_mortage_cost",_),Q("stamp_duty_amount",P),Q("deposit_amount_required",L),Q("deposit_percentage",M),Q("contigency_amount",A),Q("total_investment",S),Q("total_cash_investment",j),Q("after_refurb_mortgage_value",O),Q("after_refurb_mortage_cost",se),Q("after_refurb_money_out",de),Q("after_refurb_money_left_in",xe),Q("money_in_cash_invested_percentage",He),Q("money_out_cash_invested_percentage",Oe),Q("profit_amount",Me),Ve?u("profitable","Profitable"):u("profitable","Not Profitable"),Q("return_on_cash_investment_percentage",Ae)},300);return()=>clearTimeout(p)},[x,g,b,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,me]);const Z=q({control:G,name:"no_of_dwelling"});k.useEffect(()=>{if(!Z)return;const p=$(Z),d=$(R("average_rent_per_unit"));if(p===1&&d>0)u("monthly_rental_income",Ce(d));else if(p>1&&d>0){const D=p*d;u("monthly_rental_income",Ce(D))}},[Z]);const he=(p,d)=>{let D=p.target.value;const V=p.target,N=V.selectionStart,I=D.includes("%");let J=D.replace(/%/g,""),o=It(J);const t=J.length-o.length;if(parseFloat(o)>100&&(o="100"),Xe(o,u,d,le,W,X,R).isValid){if(!dt(o,u,d,le,W,X,R))return}else return;u(d,o);const r=Te(o);if(p.target.value=r,setTimeout(()=>{if(I)t>0&&N>o.length?V.setSelectionRange(Math.max(0,N-t),Math.max(0,N-t)):N<J.length?V.setSelectionRange(N,N):V.setSelectionRange(r.length-1,r.length-1);else if(N===D.length)V.setSelectionRange(r.length-1,r.length-1);else{const i=Math.max(0,N-t);V.setSelectionRange(i,i)}},0),d==="after_refurb_interest_rate_percentage"){const i=$(R("after_refurb_loan_to_value_percentage"))/100,m=$(R("gross_domestic_value")),y=$(o)/100,_=m*i*y/12,P=_>0?Ce(_):"";u("after_refurb_mortage_cost",P)}},ue=p=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const d={};Object.keys(p).forEach(V=>{d[V]=typeof p[V]=="string"?Lt(p[V]):p[V]}),Re.forEach(V=>{(!d[V]||d[V]==="")&&(d[V]="0")});const D={step:2,_method:"PATCH",purchase_price:d.purchase_price||0,before_refurb_loan_to_value_percentage:d.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:d.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:d.before_refurb_mortgage_value||0,before_refurb_mortage_cost:d.before_refurb_mortage_cost||0,stamp_duty_amount:d.stamp_duty_amount||0,effective_rate_percentage:d.effective_rate_percentage||0,deposit_percentage:d.deposit_percentage||0,deposit_amount_required:d.deposit_amount_required||0,before_refurb_professional_fees:d.before_refurb_professional_fees||0,deal_sourcing_fees:d.deal_sourcing_fees||0,total_investment:d.total_investment||0,refurbishment_cost:d.refurbishment_cost||0,contigency_percentage:d.contigency_percentage||0,contigency_amount:d.contigency_amount||0,furnishing_cost:d.furnishing_cost||0,project_management_fees:d.project_management_fees||0,total_cash_investment:d.total_cash_investment||0,gross_domestic_value:d.gross_domestic_value||0,after_refurb_loan_to_value_percentage:d.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:d.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:d.after_refurb_mortgage_value||0,after_refurb_mortage_cost:d.after_refurb_mortage_cost||0,after_refurb_professional_fees:d.after_refurb_professional_fees||0,after_refurb_money_left_in:d.after_refurb_money_left_in||0,money_in_cash_invested_percentage:d.money_in_cash_invested_percentage||0,after_refurb_money_out:d.after_refurb_money_out||0,money_out_cash_invested_percentage:d.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:d.no_of_dwelling||0,average_rent_per_unit:d.average_rent_per_unit||0,monthly_rental_income:d.monthly_rental_income||0,annual_rental_income:d.annual_rental_income||0,management_fee_percentage:d.management_fee_percentage||0,management_fees:d.management_fees||0,maintenance_fee_percentage:d.maintenance_fee_percentage||0,insurance:d.insurance||0,other_expenses:d.other_expenses||0,profit_amount:d.profit_amount||0,annual_profit_amount:d.annual_profit_amount||0,return_on_cash_investment_percentage:d.return_on_cash_investment_percentage||0,payback_period:d.payback_period||0};H({apiFn:()=>it(e.id,D),onSuccess:V=>{var I;a(ut(!0));const N={step:"2",...V.deal,id:(I=V==null?void 0:V.deal)==null?void 0:I.id,management_fee_percentage:d.management_fee_percentage||"",mortgage_payment:d.mortgage_payment||"",contigency_percentage:d.contigency_percentage||""};a(_t(N)),f("/create-deal/description")},onError:V=>{console.error("Error updating deal:",V)}})},te=(p,d,D)=>{const V=p.reversed,N=p.name==="payback_period",J=["profitable"].includes(p.name),o=$(R("no_of_dwelling"));if(p.name==="average_rent_per_unit"&&o===1)return null;const t=(p==null?void 0:p.name)==="stamp_duty_amount"?!_e:p.name==="monthly_rental_income"&&o===1?!1:p.calculated,n=p.name==="monthly_rental_income"&&o===1?!1:p.calculated,r=J?{}:{required:!n&&`${p.label} is required`,...N||n?{}:{pattern:{value:p.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...p.isPercentage?{percentage:l=>qt(l,p.name)}:{},maxValue:l=>Nt(l,p.name)}}},i={placeholder:n?"0":p.isPercentage?"0%":"Enter Amount",className:(p==null?void 0:p.name)==="stamp_duty_amount"?ft:t?$t:ft,onKeyPress:l=>{if(!N&&!(l.key==="Backspace"||l.key==="Delete"||l.key==="Tab"||l.key==="Escape"||l.key==="Enter"||l.key==="."||l.key===","||p.isPercentage&&l.key==="%")){if(!/[0-9]/.test(l.key)){l.preventDefault();return}if(p.isPercentage){const _=l.target.value.replace(/%/g,""),P=l.target.selectionStart;if(l.target.selectionStart!==l.target.selectionEnd)return;const C=_.split(".");if(C.length===2&&P>C[0].length&&C[1].length>=2){l.preventDefault();return}const L=_.indexOf(".");if(L===-1){if(parseFloat(_+l.key)>100){l.preventDefault();return}}else if(P<=L){const A=_.substring(0,P)+l.key+_.substring(P);if(parseFloat(A)>100){l.preventDefault();return}}}}},readOnly:t,onFocus:l=>{if(p.isPercentage&&!t){const _=l.target.value;_&&_.includes("%")&&setTimeout(()=>{const P=_.length-1;l.target.setSelectionRange(P,P)},0)}},onChange:l=>{let _=l.target.value;if(p.isPercentage){he(l,p.name);return}const P=_.replace(/[,%]/g,"");if(!N&&!n&&!p.readOnly){if(P.match(/\.\d{3,}$/)){const A=parseFloat(P);_=Math.round(A).toString(),l.target.value=_}Xe(_,u,p.name,D,W,X,R).isValid&&dt(_,u,p.name,D,W,X,R)}if(!n&&(u(p.name,P),P&&!isNaN(parseFloat(P))&&P.trim()!=="")){const C=parseFloat(P);if(!isNaN(C)){const L=Math.round(C);l.target.value=L.toLocaleString("en-US")}}},onBlur:l=>{if(p.name==="purchase_price")ge(l);else if(p.isPercentage&&!t){const _=l.target.value;_&&!_.includes("%")?(l.target.value=Te(_),u(p.name,_)):_===""&&(l.target.value="",u(p.name,""))}}};if(t&&p.isPercentage){const l=R(p.name);l&&(i.value=Te(l))}const m=c.jsxs("div",{children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"purchase-price-input-wrap form-control",children:c.jsx("input",{type:"text",...d(p.name,r),...i})}),p.name==="stamp_duty_amount"&&c.jsx("button",{type:"button",className:`absolute right-3 top-[50%] ${_e?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(l=>!l),children:c.jsx(ze,{className:"w-4 h-4"})})]}),D[p.name]&&c.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:D[p.name].message})]}),y=c.jsx("div",{className:"purchase-price-label-wrap",children:c.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:p.label})});return c.jsx("div",{className:"purchase-custom-grid",children:V?c.jsxs(c.Fragment,{children:[m,y]}):c.jsxs(c.Fragment,{children:[y,m]})})},ie=(p,d,D)=>{const V=$(R("no_of_dwelling"));if(p.fields.length===1&&p.fields[0].name==="average_rent_per_unit"&&V===1)return null;const N=(p.highlight,"my-4");return p.columns===2?c.jsx("div",{className:N,children:c.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:p.fields.map(I=>c.jsx("div",{className:"purchase-price-group-wrap relative",children:I.name==="stamp_duty_amount"?c.jsx("div",{className:"relative",children:c.jsx("div",{children:te(I,d,D)})}):te(I,d,D)},I.name))})}):c.jsx("div",{className:"purchase-price-group-wrap",children:p.fields.map(I=>I.name==="stamp_duty_amount"?c.jsxs("div",{className:"relative",children:[te(I,d,D),c.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${_e?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(J=>!J),children:c.jsx(ze,{className:"w-4 h-4"})})]},I.name):c.jsx("div",{children:te(I,d,D)},I.name))})},fe=(p,d,D)=>c.jsx("div",{className:"financial-form-main-container-wrapper",children:c.jsx("div",{className:"financial-form-container-wrapper",children:c.jsxs("div",{className:"",children:[c.jsx("div",{className:"financial-form-heading-col mb-3",children:c.jsx("h4",{className:"font-bold text-purple dark:text-white",children:p.title})}),c.jsx("div",{className:"financial-form-col-wrap relative",children:p.fields.map(V=>V.rows.map((N,I)=>c.jsx(Ne.Fragment,{children:ie(N,d,D)},I)))})]})})}),ve=q({control:G,name:"before_refurb_loan_to_value_percentage"});return q({control:G,name:"deposit_percentage"}),k.useEffect(()=>{if(!ve)return;const p=$(ve),d=100-p;u("deposit_percentage",d.toString()),X("deposit_percentage");const D=document.querySelector('input[name="deposit_percentage"]');D&&!D.readOnly&&(D.value=Te(d));const V=$(R("purchase_price"));if(V>0&&p>0){const N=V*(d/100);u("deposit_amount_required",Ce(N))}},[ve]),c.jsxs(c.Fragment,{children:[re&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:c.jsx("div",{children:c.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),c.jsxs("form",{onSubmit:U(ue),children:[kt.map(p=>c.jsx(Ne.Fragment,{children:fe(p,De,le)},p.id)),s.pathname==="/create-deal/financials"&&c.jsxs("div",{className:"flex items-center justify-between mt-2 case1 m-5",children:[c.jsxs("button",{type:"button",onClick:()=>f("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[c.jsx(ot,{}),"Back"]}),c.jsxs("button",{type:"button",onClick:U(ue),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:re,children:["Next",c.jsx(ct,{})]})]})]})]})},ht="",At="cursor-not-allowed",w=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),a=parseFloat(s);return isNaN(a)?0:a},Et=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const f=String(e).replace(/[,%]/g,""),g=parseFloat(f);return isNaN(g)||g<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},yt=(e,s,a,f,g,T,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(a))return!0;if(!Ye(e,s,a,f,g,T,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),h=parseFloat(K);return isNaN(h)?!0:h>999999999999e-2?(g(a,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(f[a]&&T(a),!0)},Ye=(e,s,a,f,g,T,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),b=parseFloat(re),K={isValid:!0},h=oe=>({isValid:!1,message:oe});if(isNaN(b)&&a!=="payback_period")return g(a,{type:"manual",message:"Please enter a valid number"}),h("Please enter a valid number");switch(a){case"purchase_price":if(b<0||b===0)return g(a,{type:"manual",message:"Purchase price must be greater than zero"}),h("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(b<=0)return g(a,{type:"manual",message:"Stamp duty must be a valid percentage"}),h("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"LTV must be between 0% and 100%"}),h("LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),h("Post-refurb LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage"}),h("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return g(a,{type:"manual",message:"Sourcing fee cannot be negative"}),h("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(b<=0||b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage."}),h("Interest rate must be a valid percentage.");if(b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage.h"}),h("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(b<0||b===0)return g(a,{type:"manual",message:"GDV must be greater than zero"}),h("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return g(a,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),h("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return g(a,{type:"manual",message:"Deposit cannot be negative"}),h("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return g(a,{type:"manual",message:"At least one unit is required"}),h("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return g(a,{type:"manual",message:"Rent must be greater than zero"}),h("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return g(a,{type:"manual",message:"Monthly rental income must be greater than zero"}),h("Monthly rental income must be greater than zero");break;default:f[a]&&T(a);break}return f[a]&&T(a),K},ne=e=>{const s=w(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},zt=e=>e?String(e).replace(/[,%]/g,""):"0",Ut=(e,s)=>{const a=String(e).replace(/[,%]/g,""),f=parseFloat(a);if(isNaN(f)||f<0||f>100){if(s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage")return"Occupancy Rate between 0% and 100%";if(s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage")return"Interest rate must be a valid percentage";if(s==="occupancy_rate_monthly")return"Occupancy Rate between 0% and 100%"}const g=a.split(".");return g.length===2&&g[1].length>2?"Maximum 2 decimal places allowed":!0},Gt=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const a=s.split(".");a.length>2&&(s=a[0]+"."+a.slice(1).join("")),a.length===2&&a[1].length>2&&(s=a[0]+"."+a[1].substring(0,2));const f=parseFloat(s);return isNaN(f)?"":f<0?"0":f>100?"100":s},Ee=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const a=parseFloat(s);if(isNaN(a))return s+"%";const f=s.split(".");if(f.length===1||f.length===2&&f[1]==="")return s+"%";{const g=f[0],T=f[1].substring(0,2);return`${g}.${T}%`}},vt=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),a=(e-s)*12,f=Math.round(a);if(s===0)return f===1?"1 month":`${f} months`;if(f===0)return s===1?"1 year":`${s} years`;{const g=s===1?"1 year":`${s} years`,T=f===1?"1 month":`${f} months`;return`${g} ${T}`}},Bt=()=>{const e=je(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.deal}),s=Ue(),a=je(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.currentStep}),f=tt(),g=nt(),[T,H]=k.useState(null),{handleApiCall:re,loading:b}=at(),[K,h]=k.useState(!1),[oe,Ge]=k.useState(!1),Be=s.pathname.includes("/summary"),_e=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Fe=e?Ze(e):{},{register:Re,handleSubmit:ke,reset:De,control:U,setValue:F,formState:{errors:G},getValues:u,setError:le,clearErrors:R}=rt({defaultValues:Fe,mode:"onChange"});k.useEffect(()=>{if(e&&!oe){const t=Ze(e);De(t),Ge(!0)}},[e,De,oe]),k.useEffect(()=>{if(e&&oe){const t=Ze(e);Object.entries(t).forEach(([r,i])=>{i!==""&&i!==null&&i!==void 0&&F(r,i)}),["occupancy_rate_monthly"].forEach(r=>{const i=u(r);if(i&&!String(i).includes("%")){const m=document.querySelector(`input[name="${r}"]`);m&&!m.readOnly&&(m.value=Ee(i))}})}},[e,F,oe]);const W=q({control:U,name:"purchase_price"});q({control:U,name:"effective_rate_percentage"}),k.useEffect(()=>{if(W&&w(W)>0&&(e!=null&&e.country_id)){h(!1);const t=setTimeout(()=>{X(e.country_id,e.property_type_id,W,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(t)}},[W,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const X=async(t,n,r,i)=>{try{const m=await st({countryId:t,propertyTypeId:n,price:r,tenure_type:i});if(m&&m.data&&m.data.stamp_duty_amount!==void 0){const y=w(r),l=m.data.stamp_duty_amount;H(l),h(!0);const _=u("stamp_duty_amount");if(!_||_==="0"||W!==r){F("stamp_duty_amount",ne(l));const P=y>0?l/y*100:0;F("effective_rate_percentage",ne(P))}}else H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0")}catch{H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0")}},ae=t=>{const n=w(t.target.value);F("purchase_price",t.target.value),h(!1),n>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?X(e.country_id,e.property_type_id,n,e==null?void 0:e.tenure_type):n<=0&&(H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0"))},me=q({control:U,name:["rent","administration","deal_sourcing_fees"]});k.useEffect(()=>{if(!me||(me==null?void 0:me.length)<3)return;const t=setTimeout(()=>{const n=w(me[0]),r=w(me[1]),i=w(me[2]),m=n+r+i;F("aquisition_cost",m.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[me]);const ce=q({control:U,name:["furnishing","refurbishment","ota_setup_fee","channel_manager_setup"]});k.useEffect(()=>{if(!ce||(ce==null?void 0:ce.length)<4)return;const t=setTimeout(()=>{const n=w(ce[0]),r=w(ce[1]),i=w(ce[2]),m=w(ce[3]),y=n+r+i+m;F("setup_cost",y.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[ce]);const Y=q({control:U,name:["council_tax_or_business_rates","water_gas_electric_and_broadband","insurance","cleaning","laundry","other"]});k.useEffect(()=>{if(!Y||(Y==null?void 0:Y.length)<6)return;const t=setTimeout(()=>{const n=w(Y[0]),r=w(Y[1]),i=w(Y[2]),m=w(Y[3]),y=w(Y[4]),l=w(Y[5]),_=n+r+i+m+y+l;F("monthly_expense",_.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[Y]);const ge=q({control:U,name:["aquisition_cost","expected_daily_rate","occupancy_rate_monthly","rent"]});k.useEffect(()=>{if(!ge||(ge==null?void 0:ge.length)<3)return;const t=setTimeout(()=>{w(ge[0]);const n=w(ge[1]),r=w(ge[3]);let i=String(x[1]).replace(/[%\\s]/g,""),m=parseFloat(i);isNaN(m)?m=0:m=m/100;const y=n*30*m-r;F("monthly_revenue",y.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[ge]);const x=q({control:U,name:["expected_daily_rate","occupancy_rate_monthly"]});k.useEffect(()=>{if(!x||(x==null?void 0:x.length)<2)return;const t=setTimeout(()=>{const n=w(x[0]);let r=String(x[1]).replace(/[%\\s]/g,""),i=parseFloat(r);isNaN(i)?i=0:i=i/100;const m=n*i*30;F("total_monthly_income",m.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[x]);const Z=q({control:U,name:["rent","total_monthly_income","monthly_expense"]});k.useEffect(()=>{if(!Z||(Z==null?void 0:Z.length)<3)return;const t=setTimeout(()=>{const n=w(Z[0]),r=w(Z[1]),i=w(Z[2]),m=r-n-i;F("net_income_monthly",m.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[Z]);const he=q({control:U,name:["net_income_monthly"]});k.useEffect(()=>{if(!he||(he==null?void 0:he.length)<1)return;const t=setTimeout(()=>{const r=w(he[0])*12;F("net_income_per_year",r.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[he]);const ue=q({control:U,name:["total_monthly_income"]});k.useEffect(()=>{if(!ue||(ue==null?void 0:ue.length)<1)return;const t=setTimeout(()=>{const r=w(ue[0])*12;F("gross_income_per_year",r.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[ue]);const te=q({control:U,name:["gross_income_per_year","setup_cost"]});k.useEffect(()=>{if(!te||(te==null?void 0:te.length)<2)return;const t=setTimeout(()=>{const n=w(te[0]),r=w(te[1]),i=r>0?n/r*100:0;F("gross_ROI",`${Math.round(i)}%`)},300);return()=>clearTimeout(t)},[te]);const ie=q({control:U,name:["setup_cost","net_income_per_year","aquisition_cost"]});k.useEffect(()=>{if(!ie||(ie==null?void 0:ie.length)<2)return;const t=setTimeout(()=>{const n=w(ie[0]),r=w(ie[1]),i=w(ie[2]),m=n>0?r/(n+i)*100:0;F("net_ROI",ne(m)+"%")},300);return()=>clearTimeout(t)},[ie]);const fe=q({control:U,name:["net_income_monthly","setup_cost"]});k.useEffect(()=>{if(!fe||fe.length<2)return;const t=setTimeout(()=>{const n=w(fe[0]),r=w(fe[1]),i=n!==0?r/n:0,m=i===0?0:i>0?Math.ceil(i):Math.floor(i);F("months_until_break_even",m.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[fe]);const ve=q({control:U,name:"monthly_rental_income"}),p=q({control:U,name:"management_fee_percentage"});k.useEffect(()=>{if(!ve||w(u("no_of_dwelling"))!==1)return;const n=setTimeout(()=>{const r=w(ve),i=w(p)/100,m=w(u("after_refurb_mortage_cost")),y=r*i,l=parseFloat((r-(m+y)).toFixed(2)),_=l*12,P=w(u("after_refurb_money_left_in")),C=P>0?Math.round(Math.max(0,_/P*100)):0,L=_>0?Math.max(0,P/_):0;F("management_fees",ne(y)),F("profit_amount",ne(l)),F("annual_profit_amount",ne(_)),F("return_on_cash_investment_percentage",ne(C)+"%"),F("payback_period",vt(L));const A=r*12;F("annual_rental_income",ne(A))},300);return()=>clearTimeout(n)},[ve,p]),k.useEffect(()=>{if(!p)return;const t=setTimeout(()=>{const n=w(p)/100,r=w(u("monthly_rental_income"));if(r>0&&n>0){const i=r*n;F("management_fees",ne(i));const m=w(u("after_refurb_mortage_cost")),y=parseFloat((r-(m+i)).toFixed(2)),l=y*12;F("profit_amount",ne(y)),F("annual_profit_amount",ne(l));const _=w(u("after_refurb_money_left_in"));if(_>0){const P=Math.max(0,l/_*100),C=l>0?Math.max(0,_/l):0;F("return_on_cash_investment_percentage",ne(P)+"%"),F("payback_period",vt(C))}}},300);return()=>clearTimeout(t)},[p]);const d=q({control:U,name:"average_rent_per_unit"});k.useEffect(()=>{if(!d)return;if(w(u("no_of_dwelling"))===1){const n=w(d);F("monthly_rental_income",ne(n))}},[d]);const D=q({control:U,name:"no_of_dwelling"});k.useEffect(()=>{if(!D)return;const t=w(D),n=w(u("average_rent_per_unit"));if(t===1&&n>0)F("monthly_rental_income",ne(n));else if(t>1&&n>0){const r=t*n;F("monthly_rental_income",ne(r))}},[D]);const V=(t,n)=>{let r=t.target.value;const i=t.target,m=i.selectionStart,y=r.includes("%");let l=r.replace(/%/g,""),_=Gt(l);const P=l.length-_.length;if(parseFloat(_)>100&&(_="100"),Ye(_,F,n,G,le,R,u).isValid){if(!yt(_,F,n,G,le,R,u))return}else return;F(n,_);const L=Ee(_);if(t.target.value=L,setTimeout(()=>{if(y)P>0&&m>_.length?i.setSelectionRange(Math.max(0,m-P),Math.max(0,m-P)):m<l.length?i.setSelectionRange(m,m):i.setSelectionRange(L.length-1,L.length-1);else if(m===r.length)i.setSelectionRange(L.length-1,L.length-1);else{const A=Math.max(0,m-P);i.setSelectionRange(A,A)}},0),n==="after_refurb_interest_rate_percentage"){const A=w(u("after_refurb_loan_to_value_percentage"))/100,M=w(u("gross_domestic_value")),S=w(_)/100,O=M*A*S/12,se=O>0?ne(O):"";F("after_refurb_mortage_cost",se)}},N=t=>{if(!(e!=null&&e.id))return;const n={};Object.keys(t).forEach(i=>{n[i]=typeof t[i]=="string"?zt(t[i]):t[i]}),_e.forEach(i=>{(!n[i]||n[i]==="")&&(n[i]="0")});const r={step:2,_method:"PATCH",rent:n.rent||0,administration_amount:n.administration||0,sourcing_fees:n.deal_sourcing_fees||0,aquisition_cost:n.aquisition_cost||0,expected_daily_rate:n.expected_daily_rate||0,occupancy_rate_monthly_percentage:n.occupancy_rate_monthly||0,furnishing_fees:n.furnishing||0,refurbishment_fees:n.refurbishment||0,ota_setup_fees:n.ota_setup_fee||0,channel_manager_setup_fees:n.channel_manager_setup||0,setup_cost:n.setup_cost||0,council_tax_or_business_rates_expense:n.council_tax_or_business_rates||0,water_gas_electric_broadband_expense:n.water_gas_electric_and_broadband||0,insurance_expense:n.insurance||0,cleaning_expense:n.cleaning||0,laundry_expense:n.laundry||0,other_expense:n.other||0,monthly_expense:n.monthly_expense||0,monthly_revenue:n.monthly_revenue||0,total_monthly_income:n.total_monthly_income||0,net_income_monthly:n.net_income_monthly||0,net_income_per_year:n.net_income_per_year||0,gross_income_per_year:n.gross_income_per_year||0,gross_roi_percentage:n.gross_ROI||0,net_roi_percentage:n.net_ROI||0,months_until_break_even:n.months_until_break_even||0};re({apiFn:()=>it(e.id,r),onSuccess:i=>{var y;f(ut(!0));const m={step:"3",...i==null?void 0:i.deal,id:(y=i==null?void 0:i.deal)==null?void 0:y.id,management_fee_percentage:n.management_fee_percentage||"",mortgage_payment:n.mortgage_payment||"",contigency_percentage:n.contigency_percentage||""};f(_t(m)),f({type:"deal/setCurrentStep",payload:Math.max(a,3)}),g("/create-deal/description")},onError:i=>{console.error("Error updating deal:",i)}})},I=(t,n,r)=>{const i=t.reversed,m=t.name==="payback_period",y=w(u("no_of_dwelling")),l=Be;if(t.name==="average_rent_per_unit"&&y===1)return null;const _=l||(t.name==="monthly_rental_income"&&y===1?!1:t.calculated),P=t.name==="monthly_rental_income"&&y===1?!1:t.calculated,C={required:!P&&!["Maintenance Fee","Other Expenses","Occupancy Rate (Monthly)"].includes(t.label)&&`${t.label} is required`,...m||P?{}:{pattern:{value:t.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...t.isPercentage?{percentage:S=>Ut(S,t.name)}:{},maxValue:S=>Et(S,t.name)}}},L={placeholder:P?"0":t.isPercentage?"0%":"Enter Amount",className:(t==null?void 0:t.name)==="stamp_duty_amount"?ht:_?At:ht,onKeyPress:S=>{if(!m&&!(S.key==="Backspace"||S.key==="Delete"||S.key==="Tab"||S.key==="Escape"||S.key==="Enter"||S.key==="."||S.key===","||t.isPercentage&&S.key==="%")){if(!/[0-9]/.test(S.key)){S.preventDefault();return}if(t.isPercentage){const j=S.target.value.replace(/%/g,""),O=S.target.selectionStart;if(S.target.selectionStart!==S.target.selectionEnd)return;const se=j.split(".");if(se.length===2&&O>se[0].length&&se[1].length>=2){S.preventDefault();return}const de=j.indexOf(".");if(de===-1){if(parseFloat(j+S.key)>100){S.preventDefault();return}}else if(O<=de){const xe=j.substring(0,O)+S.key+j.substring(O);if(parseFloat(xe)>100){S.preventDefault();return}}}}},readOnly:_,onFocus:S=>{if(t.isPercentage&&!_){const j=S.target.value;j&&j.includes("%")&&setTimeout(()=>{const O=j.length-1;S.target.setSelectionRange(O,O)},0)}},onChange:S=>{let j=S.target.value;if(t.isPercentage){V(S,t.name);return}const O=j.replace(/[,%]/g,"");if(!m&&!P&&!t.readOnly){if(O.match(/\.\d{3,}$/)){const xe=parseFloat(O);j=Math.round(xe).toString(),S.target.value=j}Ye(j,F,t.name,r,le,R,u).isValid&&yt(j,F,t.name,r,le,R,u)}if(!P&&(F(t.name,O),O&&!isNaN(parseFloat(O))&&O.trim()!=="")){const se=parseFloat(O);if(!isNaN(se)){const de=Math.round(se);S.target.value=de.toLocaleString("en-US")}}},onBlur:S=>{if(t.name==="purchase_price")ae(S);else if(t.isPercentage&&!_){const j=S.target.value;j&&!j.includes("%")?(S.target.value=Ee(j),F(t.name,j)):j===""&&(S.target.value="",F(t.name,""))}}};if(_&&t.isPercentage){const S=u(t.name);S&&(L.value=Ee(S))}const A=c.jsxs("div",{className:"",children:[c.jsx("div",{className:"purchase-price-input-wrap form-control",children:c.jsx("input",{type:"text",...n(t.name,C),...L})}),r[t.name]&&c.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:r[t.name].message})]}),M=c.jsx("div",{className:"purchase-price-label-wrap",children:c.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:t.label})});return c.jsx("div",{className:"purchase-custom-grid",children:i?c.jsxs(c.Fragment,{children:[A,M]}):c.jsxs(c.Fragment,{children:[M,A]})})},J=(t,n,r)=>{const i=w(u("no_of_dwelling"));if(t.fields.length===1&&t.fields[0].name==="average_rent_per_unit"&&i===1)return null;const m=(t.highlight,"my-4");return t.columns===2?c.jsx("div",{className:m,children:c.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.fields.map(y=>c.jsx("div",{className:"purchase-price-group-wrap",children:I(y,n,r)},y.name))})}):c.jsx("div",{className:"purchase-price-group-wrap",children:t.fields.map(y=>I(y,n,r))})},o=(t,n,r)=>c.jsx("div",{className:"financial-form-main-container-wrapper",children:c.jsx("div",{className:"financial-form-container-wrapper",children:c.jsxs("div",{className:"",children:[c.jsx("div",{className:"financial-form-heading-col mb-3",children:c.jsx("h4",{className:"font-bold text-purple dark:text-white",children:t.title})}),c.jsx("div",{className:"financial-form-col-wrap relative",children:t.fields.map(i=>i.rows.map((m,y)=>c.jsx(Ne.Fragment,{children:J(m,n,r)},y)))})]})})});return c.jsxs(c.Fragment,{children:[b&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:c.jsx("div",{children:c.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),c.jsxs("form",{onSubmit:ke(N),children:[Dt.map(t=>c.jsx(Ne.Fragment,{children:o(t,Re,G)},t.id)),s.pathname==="/create-deal/financials"&&c.jsxs("div",{className:"flex items-center justify-between mt-2 case2 px-4 pb-4",children:[c.jsxs("button",{type:"button",onClick:()=>g("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[c.jsx(ot,{}),"Back"]}),c.jsxs("button",{type:"button",onClick:ke(N),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:b,children:["Next",c.jsx(ct,{})]})]})]})]})},xt="",Ht="cursor-not-allowed",v=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),a=parseFloat(s);return isNaN(a)?0:a},Kt=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","stamp_duty_amount","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const f=String(e).replace(/[,%]/g,""),g=parseFloat(f);return isNaN(g)||g<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},Pt=(e,s,a,f,g,T,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(a))return!0;if(!et(e,s,a,f,g,T,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),h=parseFloat(K);return isNaN(h)?!0:h>999999999999e-2?(g(a,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(f[a]&&T(a),!0)},et=(e,s,a,f,g,T,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),b=parseFloat(re),K={isValid:!0},h=oe=>({isValid:!1,message:oe});if(isNaN(b)&&a!=="payback_period")return g(a,{type:"manual",message:"Please enter a valid number"}),h("Please enter a valid number");switch(a){case"purchase_price":if(b<0||b===0)return g(a,{type:"manual",message:"Purchase price must be greater than zero"}),h("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(b<=0)return g(a,{type:"manual",message:"Stamp duty must be a valid percentage"}),h("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"LTV must be between 0% and 100%"}),h("LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(b<=0||b>=101)return g(a,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),h("Post-refurb LTV must be between 0% and 100%");if(b>=101)return g(a,{type:"manual",message:"Loan to value percentage is unusually high"}),h("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(b<=0||b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage"}),h("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(b<=0)return g(a,{type:"manual",message:"Sourcing fee cannot be negative"}),h("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(b<=0||b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage."}),h("Interest rate must be a valid percentage.");if(b>101)return g(a,{type:"manual",message:"Interest rate must be a valid percentage.h"}),h("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(b<0||b===0)return g(a,{type:"manual",message:"GDV must be greater than zero"}),h("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(b<H("gross_domestic_value"))return g(a,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),h("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(b<0||b===0)return g(a,{type:"manual",message:"Deposit cannot be negative"}),h("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(b)||b<1)return g(a,{type:"manual",message:"At least one unit is required"}),h("At least one unit is required");break;case"average_rent_per_unit":if(b<=0)return g(a,{type:"manual",message:"Rent must be greater than zero"}),h("Rent must be greater than zero");break;case"monthly_rental_income":if(b<=0)return g(a,{type:"manual",message:"Monthly rental income must be greater than zero"}),h("Monthly rental income must be greater than zero");break;case"maintenance_fee_percentage":if(b<0)return g(a,{type:"manual",message:"Maintenance cost cannot be negative."}),h("Maintenance cost cannot be negative.");break;case"insurance":if(b<0)return g(a,{type:"manual",message:"Insurance cost cannot be negative."}),h("Insurance cost cannot be negative.");break;case"other_expenses":if(b<0)return g(a,{type:"manual",message:"Other expenses cannot be negative."}),h("Other expenses cannot be negative.");break;default:f[a]&&T(a);break}return f[a]&&T(a),K},B=e=>{const s=v(e);return s===0||s===null||s===void 0?"":Math.round(s).toLocaleString("en-US")},Wt=e=>e?String(e).replace(/[,%]/g,""):"0",Zt=(e,s)=>{const a=String(e).replace(/[,%]/g,""),f=parseFloat(a);if(isNaN(f)||f<0||f>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":s==="maintenance_fee_percentage"?!0:"Percentage must be between 0% and 100%";const g=a.split(".");return g.length===2&&g[1].length>2?"Maximum 2 decimal places allowed":!0},Jt=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const a=s.split(".");a.length>2&&(s=a[0]+"."+a.slice(1).join("")),a.length===2&&a[1].length>2&&(s=a[0]+"."+a[1].substring(0,2));const f=parseFloat(s);return isNaN(f)?"":f<0?"0":f>100?"100":s},$e=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const a=parseFloat(s);if(isNaN(a))return s+"%";const f=s.split(".");if(f.length===1||f.length===2&&f[1]==="")return s+"%";{const g=f[0],T=f[1].substring(0,2);return`${g}.${T}%`}},Qe=e=>{if(e<=0)return"0";const s=Math.floor(e),a=(e-s)*12,f=Math.round(a);if(s===0)return f===1?"1 month":`${f} months`;if(f===0)return s===1?"1 year":`${s} years`;{const g=s===1?"1 year":`${s} years`,T=f===1?"1 month":`${f} months`;return`${g} ${T}`}},St=()=>{const e=je(o=>{var t;return(t=o==null?void 0:o.deal)==null?void 0:t.deal}),s=Ue();je(o=>{var t;return(t=o==null?void 0:o.deal)==null?void 0:t.currentStep});const a=tt(),f=nt(),[g,T]=k.useState(null),{handleApiCall:H,loading:re}=at(),[b,K]=k.useState(!1),[h,oe]=k.useState(!1),[Ge,Be]=k.useState([]),[_e,Fe]=k.useState(!1);s.pathname.includes("/summary");const Re=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],ke=e?Je(e):{},{register:De,handleSubmit:U,reset:F,control:G,setValue:u,formState:{errors:le},getValues:R,setError:W,clearErrors:X}=rt({defaultValues:ke,mode:"onChange"});k.useEffect(()=>{if(e&&!h){const o=Je(e);F(o),oe(!0)}},[e,F,h]),k.useEffect(()=>{if(e&&h){const o=Je(e);Object.entries(o).forEach(([n,r])=>{r!==""&&r!==null&&r!==void 0&&u(n,r)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(n=>{const r=R(n);if(r&&!String(r).includes("%")){const i=document.querySelector(`input[name="${n}"]`);i&&!i.readOnly&&(i.value=$e(r))}})}},[e,u,h]);const ae=q({control:G,name:"purchase_price"}),me=q({control:G,name:"effective_rate_percentage"}),ce=v(R("stamp_duty_amount"));k.useEffect(()=>{if(ae&&v(ae)>0&&(e!=null&&e.country_id)){K(!1);const o=setTimeout(()=>{Y(e.country_id,e.property_type_id,ae,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(o)}},[ae,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const Y=async(o,t,n,r)=>{try{const i=await st({countryId:o,propertyTypeId:t,price:n,tenure_type:r});if(i&&i.data&&i.data.stamp_duty_amount!==void 0){const m=v(n),y=i.data.stamp_duty_amount;T(y),K(!0);const l=R("stamp_duty_amount");if(!l||l==="0"||ae!==n){u("stamp_duty_amount",B(y)),X("stamp_duty_amount");const _=m>0?y/m*100:0;u("effective_rate_percentage",B(_))}}else T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0")}catch{T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0")}},ge=o=>{const t=v(o.target.value);u("purchase_price",o.target.value),K(!1),t>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?Y(e.country_id,e.property_type_id,t,e==null?void 0:e.tenure_type):t<=0&&(T(0),u("stamp_duty_amount","0"),u("effective_rate_percentage","0"))},x=q({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","other_expenses","insurance","stamp_duty_amount"]}),[Z,he]=k.useState({payloadROI:0});k.useEffect(()=>{if(!x||!x[0])return;const o=setTimeout(()=>{const t=v(x[0]),n=v(x[1])/100,r=v(x[2])/100,i=v(x[3]),m=v(x[4]),y=v(x[5]),l=v(x[6]),_=v(x[7]),P=v(x[8]),C=v(x[9]),L=v(x[10])/100,A=v(x[11])/100,M=v(x[12]);console.log("refinanceProfessionalFees",M);const S=v(x[13]),j=v(x[14]),O=v(x[15])/100;v(x[16]);const se=v(x[17]),de=v(x[18]),xe=v(x[19]),He=R("monthly_rental_income"),Oe=t*n,Me=t*n*r/12;let Ve=v(g);const Ae=v(R("stamp_duty_amount"));Ve=Ae>0?Ae:Ve,v(R("effective_rate_percentage")),b===!1&&t>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)&&Y(e.country_id,e.property_type_id,t,e==null?void 0:e.tenure_type);const Q=n>0?t*(1-n):0;100-v(x[1]);const z=l>0?y*(l/100):0,pe=Me+Q+i+m+Ve,be=Ve+Q+i+m+y+z+_+P+M,Pe=C*L,lt=Pe*A/12,Le=Pe-Oe,Ke=be-Le,Ft=be>0?Math.round(Ke/be*100):0,Vt=be>0?Math.max(0,parseFloat((Le/be*100).toFixed(2))):0;let Se=0;if((e==null?void 0:e.deal_type_id)==3)Se=He;else if((e==null?void 0:e.deal_type_id)!==3&&S===1){const E=v(R("monthly_rental_income"));Se=E>0?E:j}else Se=S*j;(e==null?void 0:e.deal_type_id)!==5&&(Se=Number(Se.replace(/,/g,"")));const wt=Se*12,mt=Se*O,gt=Math.round(Se-(mt+(lt+se+xe+de))),qe=gt*12,pt=Number(Le)>0?Math.round(Number(qe)/Number(Le)*100):Z==null?void 0:Z.payloadROI;he({...Z,payloadROI:pt});const jt=qe!==0?Ke/qe:0,ee=(E,ye)=>{if(E==="return_on_cash_investment_percentage"){const Ie=parseFloat(ye),we=Ie<0?"Infinite":Ie.toLocaleString("en-US")+"%";u(E,we)}else if(E==="payback_period")u(E,Qe(ye));else if((E==="deposit_amount_required"||E==="deposit_percentage")&&n===0)u(E,"0");else{if((E==="stamp_duty_amount"||E==="effective_rate_percentage")&&b&&(x[1]!==void 0||x[2]!==void 0))return;if(ye<0&&(E==="after_refurb_money_left_in"||E==="profit_amount"||E==="annual_profit_amount"||E==="money_in_cash_invested_percentage"||E==="payback_period")){const Ie=ye.toLocaleString("en-US");u(E,Ie)}else if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(E))if(ye>0&&E!=="money_in_cash_invested_percentage"){const we=B(ye)+"%";u(E,we)}else if(ye<0&&E==="money_in_cash_invested_percentage"){const we=ye.toLocaleString("en-US")+"%";u(E,we)}else u(E,"");else if(ye){const we=B(ye);u(E,we)}else u(E,"")}},Rt=qe>0;ee("before_refurb_mortgage_value",Oe),ee("before_refurb_mortage_cost",Me),ee("stamp_duty_amount",Ve),ee("deposit_amount_required",Q),ee("contigency_amount",z),ee("total_investment",pe),ee("total_cash_investment",be),ee("after_refurb_mortgage_value",Pe),ee("after_refurb_mortage_cost",lt),ee("after_refurb_money_out",Le),ee("after_refurb_money_left_in",Ke),u("money_in_cash_invested_percentage",`${Math.round(Ft)}%`),Rt?u("profitable","Profitable"):u("profitable","Not Profitable"),ee("money_out_cash_invested_percentage",Vt),ee("monthly_rental_income",Se),ee("annual_rental_income",wt),ee("management_fees",mt),ee("profit_amount",gt),ee("annual_profit_amount",qe),ee("return_on_cash_investment_percentage",pt),ee("payback_period",jt)},300);return()=>clearTimeout(o)},[x,ce,g,b,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,me]);const ue=q({control:G,name:"monthly_rental_income"}),te=q({control:G,name:"management_fee_percentage"});k.useEffect(()=>{if(!ue||((e==null?void 0:e.deal_type_id)==3?1:v(R("no_of_dwelling")))!==1)return;const t=setTimeout(()=>{const n=v(ue),r=v(te)/100,i=v(R("after_refurb_mortage_cost")),m=n*r,y=v(x[17])/100,l=v(x[18]),_=v(x[19]),P=n-(m+(i+y+_+l)),C=P*12,L=v(R("after_refurb_money_left_in")),A=L?Number(C)/Number(L)*100:0,M=C!==0?L/C:0;u("management_fees",B(m)),u("profit_amount",B(P)),u("annual_profit_amount",B(C)),u("return_on_cash_investment_percentage",B(A)+"%"),u("payback_period",Qe(M));const S=n*12;u("annual_rental_income",B(S))},300);return()=>clearTimeout(t)},[ue,te]),k.useEffect(()=>{if(!te)return;const o=setTimeout(()=>{const t=v(te)/100,n=v(R("monthly_rental_income")),r=v(x[17])/100,i=v(x[18]),m=v(x[19]);if(n>0&&t>0){const y=n*t;u("management_fees",B(y));const l=v(R("after_refurb_mortage_cost")),_=Math.round(n-(y+(l+r+m+i))),P=_*12;u("profit_amount",B(_)),u("annual_profit_amount",B(P));const C=v(R("after_refurb_money_left_in"));if(C>0){const L=P/moneyLeftAfterRefinance*100,A=P>0?Math.max(0,C/P):0;u("return_on_cash_investment_percentage",B(L)+"%"),u("payback_period",Qe(A))}}},300);return()=>clearTimeout(o)},[te]);const ie=q({control:G,name:"average_rent_per_unit"});k.useEffect(()=>{if(!ie)return;if(((e==null?void 0:e.deal_type_id)==3?1:v(R("no_of_dwelling")))===1){const t=v(ie);u("monthly_rental_income",B(t))}},[ie]);const fe=q({control:G,name:"no_of_dwelling"});k.useEffect(()=>{if(!fe)return;const o=v(fe),t=v(R("average_rent_per_unit"));if(o===1&&t>0)u("monthly_rental_income",B(t));else if(o>1&&t>0){const n=o*t;u("monthly_rental_income",B(n))}},[fe]);const ve=(o,t)=>{let n=o.target.value;const r=o.target,i=r.selectionStart,m=n.includes("%");let y=n.replace(/%/g,""),l=Jt(y);const _=y.length-l.length;if(parseFloat(l)>100&&(l="100"),et(l,u,t,le,W,X,R).isValid){if(!Pt(l,u,t,le,W,X,R))return}else return;u(t,l);const C=$e(l);if(o.target.value=C,setTimeout(()=>{if(m)_>0&&i>l.length?r.setSelectionRange(Math.max(0,i-_),Math.max(0,i-_)):i<y.length?r.setSelectionRange(i,i):r.setSelectionRange(C.length-1,C.length-1);else if(i===n.length)r.setSelectionRange(C.length-1,C.length-1);else{const L=Math.max(0,i-_);r.setSelectionRange(L,L)}},0),t==="after_refurb_interest_rate_percentage"){const L=v(R("after_refurb_loan_to_value_percentage"))/100,A=v(R("gross_domestic_value")),M=v(l)/100,j=A*L*M/12,O=j>0?B(j):"";u("after_refurb_mortage_cost",O)}},p=o=>{let t=!0,n=[];const r=[{name:"purchase_price",label:"Purchase Price"},{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage"},{name:"gross_domestic_value",label:"Gross Domestic Value"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage"},{name:"no_of_dwelling",label:"Number of Dwellings"}];let i=!0;for(const _ of r){const P=v(o[_.name]);if(!P||P<=0){i=!1;break}}if(i)for(const _ of Re)v(o[_]),_!=="payback_period"&&(_==="effective_rate_percentage"&&v(o.stamp_duty_amount)<=0||_==="annual_profit_amount"&&v(o.profit_amount)<=0||_==="monthly_rental_income"&&v(o.no_of_dwelling)<=0||_==="annual_rental_income"&&v(o.monthly_rental_income)<=0||_==="management_fees"&&v(o.monthly_rental_income)<=0||_==="profit_amount"&&(v(o.monthly_rental_income)<=0||v(o.after_refurb_mortage_cost)<=0));for(const _ of r){const P=v(o[_.name]);if(!P||P<=0){let C=`${_.label} is required and must be greater than 0`;_.name==="purchase_price"?C="Purchase price must be greater than zero":_.name==="gross_domestic_value"?C="GDV must be greater than zero":_.name==="no_of_dwelling"&&(C="At least one unit is required"),W(_.name,{type:"manual",message:C}),n.push(_.label),t=!1}}const m=[{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage",message:"LTV must be between 0% and 100%"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage",message:"Post-refurb LTV must be between 0% and 100%"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"contigency_percentage",label:"Contingency Percentage"},{name:"management_fee_percentage",label:"Management Fee Percentage"},{name:"deposit_percentage",label:"Deposit (%)",message:"Deposit must be between 0% and 100%"}];for(const _ of m){const P=v(o[_.name]);(P<=0||P>100)&&_.name!=="contigency_percentage"&&(W(_.name,{type:"manual",message:_.message}),n.push(_.label),t=!1)}const y=[{name:"gross_domestic_value",label:"Gross Domestic Value",message:"GDV must be greater than zero"},{name:"refurbishment_cost",label:"Refurbishment Cost"},{name:"before_refurb_professional_fees",label:"Professional Fees"},{name:"after_refurb_professional_fees",label:"After Refurb Professional Fees"},{name:"deal_sourcing_fees",label:"Deal Sourcing Fees",message:"Sourcing fee cannot be negative or zero."}];for(const _ of y)v(o[_.name])<=0&&(W(_.name,{type:"manual",message:_.message}),n.push(_.label),t=!1);(e==null?void 0:e.deal_type_id)==3||v(o.no_of_dwelling);const l=(e==null?void 0:e.deal_type_id)==3?1:v(o.no_of_dwelling);if((!Number.isInteger(l)||l<1)&&(W("no_of_dwelling",{type:"manual",message:"At least one unit is required"}),n.push("Number of Dwellings"),t=!1),l>1){const _=v(o.average_rent_per_unit);(!_||_<=0)&&(W("average_rent_per_unit",{type:"manual",message:"Average rent per unit is required when there are multiple dwellings"}),n.push("Average Rent per Unit"),t=!1)}return{isValid:t,errorFields:n}},d=o=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const{isValid:t,errorFields:n}=p(o);if(!t){console.warn("Validation failed. These fields are missing or invalid:",n);return}const r={};Object.keys(o).forEach(m=>{r[m]=typeof o[m]=="string"?Wt(o[m]):o[m]}),Re.forEach(m=>{(!r[m]||r[m]==="")&&(r[m]="0")});const i={step:2,_method:"PATCH",purchase_price:r.purchase_price||0,before_refurb_loan_to_value_percentage:r.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:r.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:r.before_refurb_mortgage_value||0,before_refurb_mortage_cost:r.before_refurb_mortage_cost||0,stamp_duty_amount:r.stamp_duty_amount||0,effective_rate_percentage:r.effective_rate_percentage||0,deposit_percentage:r.deposit_percentage||0,deposit_amount_required:r.deposit_amount_required||0,before_refurb_professional_fees:r.before_refurb_professional_fees||0,deal_sourcing_fees:r.deal_sourcing_fees||0,total_investment:r.total_investment||0,refurbishment_cost:r.refurbishment_cost||0,contigency_percentage:r.contigency_percentage||0,contigency_amount:r.contigency_amount||0,furnishing_cost:r.furnishing_cost||0,project_management_fees:r.project_management_fees||0,total_cash_investment:r.total_cash_investment||0,gross_domestic_value:r.gross_domestic_value||0,after_refurb_loan_to_value_percentage:r.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:r.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:r.after_refurb_mortgage_value||0,after_refurb_mortage_cost:r.after_refurb_mortage_cost||0,after_refurb_professional_fees:r.after_refurb_professional_fees||0,after_refurb_money_left_in:r.after_refurb_money_left_in||0,money_in_cash_invested_percentage:r.money_in_cash_invested_percentage||0,after_refurb_money_out:r.after_refurb_money_out||0,money_out_cash_invested_percentage:r.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:r.no_of_dwelling||0,average_rent_per_unit:r.average_rent_per_unit||0,monthly_rental_income:r.monthly_rental_income||0,annual_rental_income:r.annual_rental_income||0,management_fee_percentage:r.management_fee_percentage||0,management_fees:r.management_fees||0,maintenance_fee_percentage:r.maintenance_fee_percentage||0,insurance:r.insurance||0,other_expenses:r.other_expenses||0,profit_amount:r.profit_amount||0,annual_profit_amount:r.annual_profit_amount||0,return_on_cash_investment_percentage:Z==null?void 0:Z.payloadROI,payback_period:r.payback_period||0,investment_type:r.investment_type||"others"};o.property_type_id,H({apiFn:()=>it(e.id,i),onSuccess:m=>{var l;a(ut(!0));const y={step:"2",...m==null?void 0:m.deal,id:(l=m==null?void 0:m.deal)==null?void 0:l.id,management_fee_percentage:r.management_fee_percentage||"",mortgage_payment:r.mortgage_payment||"",contigency_percentage:r.contigency_percentage||""};a(_t(y)),f("/create-deal/description")},onError:m=>{console.error("Error updating deal:",m)}})},D=(o,t,n)=>{const r=["profitable"].includes(o.name),i=o.reversed,m=o.name==="payback_period",y=(e==null?void 0:e.deal_type_id)==3?1:v(R("no_of_dwelling"));if(o.name==="average_rent_per_unit"&&y===1)return null;const l=(o==null?void 0:o.name)==="stamp_duty_amount"?!_e:o.name==="monthly_rental_income"&&y===1?!1:o.calculated,_=o.name==="monthly_rental_income"&&y===1?!1:o.calculated,P={required:_||r?!1:`${o.label} is required`,...m||_?{}:{pattern:{value:o.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...o.isPercentage?{percentage:M=>Zt(M,o.name)}:{},maxValue:M=>Kt(M,o.name)}}},C={placeholder:_?"0":o.isPercentage?"0%":"Enter Amount",className:(o==null?void 0:o.name)==="stamp_duty_amount"?xt:l?Ht:xt,onKeyPress:M=>{if(!m&&!["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight"].includes(M.key)){if(o.isPercentage){if(M.key==="."&&!M.target.value.includes("."))return;if(M.key==="."&&M.target.value.includes(".")){M.preventDefault();return}/[0-9]/.test(M.key)||M.preventDefault();return}/[0-9,]/.test(M.key)||M.preventDefault()}},readOnly:l,onFocus:M=>{if(o.isPercentage&&!l){const S=M.target.value;S&&S.includes("%")&&setTimeout(()=>{const j=S.length-1;M.target.setSelectionRange(j,j)},0)}},onChange:M=>{let S=M.target.value;if(o.isPercentage){ve(M,o.name);return}let j=S.replace(/[^0-9,]/g,"");const O=j.split(",");if(O.length>2&&(j=O[0]+","+O.slice(1).join("")),u(o.name,j),j&&!isNaN(parseFloat(j.replace(/,/g,"")))){const se=Math.round(parseFloat(j.replace(/,/g,"")));M.target.value=se.toLocaleString("en-US")}else j===""&&(M.target.value="");et(j,u,o.name,n,W,X,R),Pt(j,u,o.name,n,W,X,R)},onBlur:M=>{if(o.name==="purchase_price")ge(M);else if(o.isPercentage&&!l){const S=M.target.value;S&&!S.includes("%")?(M.target.value=$e(S),u(o.name,S)):S===""&&(M.target.value="",u(o.name,""))}}};if(l&&o.isPercentage){const M=R(o.name);M&&(C.value=$e(M))}const L=c.jsxs("div",{className:"",children:[c.jsx("div",{className:"purchase-price-input-wrap form-control",children:c.jsx("input",{type:"text",...t(o.name,P),...C})}),n[o.name]&&c.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:n[o.name].message})]}),A=c.jsx("div",{className:"purchase-price-label-wrap",children:c.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:((e==null?void 0:e.deal_type_id)===3||(e==null?void 0:e.deal_type_id)===5)&&(o==null?void 0:o.name)==="no_of_dwelling"?"Number of bedrooms":(e==null?void 0:e.deal_type_id)===5&&(o==null?void 0:o.name)==="maintenance_fee_percentage"?"Bills":o.label})});return c.jsx("div",{className:"purchase-custom-grid",children:i?c.jsxs(c.Fragment,{children:[L,A]}):c.jsxs(c.Fragment,{children:[A,L]})})},V=(o,t,n)=>{const r=(e==null?void 0:e.deal_type_id)==3?1:v(R("no_of_dwelling"));if(o.fields.length===1&&o.fields[0].name==="average_rent_per_unit"&&r===1)return null;const i=(o.highlight,"my-4"),m=o.fields.filter(y=>!(y.name==="no_of_dwelling"&&((e==null?void 0:e.deal_type_id)===2||(e==null?void 0:e.deal_type_id)===3)||(y.name==="insurance"||y.name==="other_expenses")&&(e==null?void 0:e.deal_type_id)===5));return m.length===0?null:o.columns===2?c.jsx("div",{className:i,children:c.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.map(y=>c.jsx("div",{className:"purchase-price-group-wrap relative",children:y.name==="stamp_duty_amount"?c.jsxs("div",{className:"relative",children:[D(y,t,n),c.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${_e?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(l=>!l),children:c.jsx(ze,{className:"w-4 h-4"})})]}):D(y,t,n)},y.name))})}):c.jsx("div",{className:"purchase-price-group-wrap",children:m.map(y=>c.jsx("div",{className:"relative",children:y.name==="stamp_duty_amount"?c.jsxs("div",{className:"relative",children:[D(y,t,n),c.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${_e?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(l=>!l),children:c.jsx(ze,{className:"w-4 h-4"})})]}):D(y,t,n)},y.name))})},N=(o,t,n)=>c.jsx("div",{className:"financial-form-main-container-wrapper",children:c.jsx("div",{className:"financial-form-container-wrapper",children:c.jsxs("div",{className:"",children:[c.jsx("div",{className:"financial-form-heading-col mb-3",children:c.jsx("h4",{className:"font-bold text-purple dark:text-white",children:o.title})}),c.jsx("div",{className:"financial-form-col-wrap relative",children:o.fields.map(r=>r.rows.map((i,m)=>c.jsx(Ne.Fragment,{children:V(i,t,n)},m)))})]})})}),I=q({control:G,name:"before_refurb_loan_to_value_percentage"}),J=q({control:G,name:"deposit_percentage"});return k.useEffect(()=>{if(!I)return;const o=v(I),t=100-o;u("deposit_percentage",t.toString()),X("deposit_percentage");const n=document.querySelector('input[name="deposit_percentage"]');n&&!n.readOnly&&(n.value=$e(t));const r=v(R("purchase_price"));if(r>0&&o>0){const i=r*(t/100);u("deposit_amount_required",B(i))}},[I]),k.useEffect(()=>{if(!J)return;const o=v(J),t=100-o;u("before_refurb_loan_to_value_percentage",t.toString());const n=document.querySelector('input[name="before_refurb_loan_to_value_percentage"]');n&&!n.readOnly&&(n.value=$e(t));const r=v(R("purchase_price"));if(r>0&&t>0){const i=r*(t/100);u("before_refurb_mortgage_value",B(i));const m=v(R("before_refurb_interest_rate_percentage"))/100,y=i*m/12;u("before_refurb_mortage_cost",B(y));const l=r*(o/100);u("deposit_amount_required",B(l))}},[J]),c.jsxs(c.Fragment,{children:[re&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:c.jsx("div",{children:c.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),c.jsxs("form",{onSubmit:U(d),children:[Mt.map(o=>c.jsx(Ne.Fragment,{children:N(o,De,le)},o.id)),s.pathname==="/create-deal/financials"&&c.jsxs("div",{className:"flex items-center justify-between mt-2 case3 px-4 pb-4",children:[c.jsxs("button",{type:"button",onClick:()=>f("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[c.jsx(ot,{}),"Back"]}),c.jsxs("button",{type:"submit",style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center kkkk",children:["Next",c.jsx(ct,{})]})]})]})]})},Yt=()=>{const e=Ue(),s=je(g=>g.deal.deal),a=e.pathname.includes("/summary"),{currentCase:f}=Ct({deal_type_id:s==null?void 0:s.deal_type_id});return c.jsxs("div",{className:"min-h-screen financial-page-main-div-wrap",children:[c.jsx("div",{className:"financial-details-step-heading",children:c.jsx("h4",{className:"font-semibold heading-color2 dark:text-white",children:"Financial details"})}),c.jsx("div",{className:"financial-page-inner-div-wrap",children:a?c.jsx(Tt,{currentCase:f}):c.jsxs(c.Fragment,{children:[f==="CASE_1"&&c.jsx(bt,{}),f==="CASE_2"&&c.jsx(Bt,{}),f==="CASE_3"&&((s==null?void 0:s.exit_type_id)===1?c.jsx(St,{}):c.jsx(bt,{})),f==="CASE_4"&&c.jsx(St,{})]})})]})};export{Yt as default};
