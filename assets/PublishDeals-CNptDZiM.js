import{a5 as ne,t as ie,r as i,u as O,q as oe,a4 as ce,s as de,m as s,ad as pe,x as he,ag as me,ah as ue,p as ge,ai as xe,aj as fe,A as ye,a7 as je,C as _e,E as Ne,ak as be,al as De,am as ve,an as Se,ao as we,a8 as Pe,N as Ie,O as Ce}from"./index-ylv6dO9O.js";import{S as ke}from"./SendContactDealModal-Zrcg8Ct3.js";import{D as Fe}from"./DeleteConfirmationModal-CFczyeFF.js";import"./lodash-DaxULG_T.js";const Le=()=>{const{slug:D}=ne(),j=ie(),[c,T]=i.useState([]);O(e=>e.deal.currentStep);const g=O(e=>e.deal.dealsTypes),[x,_]=i.useState([]),{showSnackbar:u}=oe(),[v,S]=i.useState(!1),[A,f]=i.useState(!1),[E,N]=i.useState(!1),[w,P]=i.useState(null),[L,I]=i.useState(!1),[n,$]=i.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1});i.useEffect(()=>{var a;const e=(a=g==null?void 0:g.deal_types)==null?void 0:a.find(l=>l.slug===D),t=(e==null?void 0:e.id)??null;h(l=>({...l,dealTypeId:t,page:1}))},[D,g]);const[r,h]=i.useState({per_page:10,page:1,status:"publish",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc"}),{data:b,loading:R}=ce(je),p=de(),C=async()=>{try{f(!0);const e=await ye({page:r.page,perPage:r.per_page,status:r.status===""?null:r.status,year:r.year===""?null:r.year,propertyTypeId:r.propertyTypeId===""?null:r.propertyTypeId,dealTypeId:r.dealTypeId,sortColumn:r.sortColumn,sortOrder:r.sortOrder});if(e&&e.data){T(e.data.data.deals||[]);const t=e.data.data.page_context;t&&$({currentPage:parseInt(t==null?void 0:t.page)||1,totalPages:Math.ceil(parseInt((t==null?void 0:t.total_records)||0)/parseInt((t==null?void 0:t.per_page)||10)),from:(parseInt(t.page)-1)*parseInt(t.per_page)+1,to:Math.min(parseInt(t==null?void 0:t.page)*parseInt(t==null?void 0:t.per_page),parseInt((t==null?void 0:t.total_records)||0)),total:parseInt((t==null?void 0:t.total_records)||0),hasMorePages:(t==null?void 0:t.has_more_page)==="true"})}}catch{u("Failed to fetch deals. Please try again.","error")}finally{f(!1)}},q=e=>{var t,a;return e?e.description_type==="ai"?((t=e.description_ai)==null?void 0:t.trim())||"No AI description available":((a=e.description)==null?void 0:a.trim())||"No description available":"No description available"};i.useEffect(()=>{C()},[r]);const B=e=>{_(t=>t.includes(e)?t.filter(a=>a!==e):[...t,e])},Y=()=>{if(x.length===0){u("Please select at least one deal.","error");return}S(!0)},z=()=>{S(!1)},k=e=>{const{name:t,value:a}=e.target;h({...r,[t]:a,page:1})},G=e=>{h(t=>({...t,sortColumn:e,sortOrder:t.sortColumn===e&&t.sortOrder==="asc"?"desc":"asc",page:1}))},V=()=>{n.hasMorePages&&h(e=>({...e,page:e.page+1}))},W=()=>{r.page>1&&h(e=>({...e,page:e.page-1}))},H=e=>{e>=1&&e<=n.totalPages&&h(t=>({...t,page:e}))},J=e=>{e.deal_type_id==2?j(`/deal-view-sa/${e.id}`):j(`/deal-view/${e.id}`)},K=e=>{P(e),N(!0)},Q=async()=>{if(w)try{I(!0);const e=await _e(w);e&&e.data?(u("Deal deleted successfully","success"),C()):u("Failed to delete deal","error"),N(!1),P(null)}catch(e){console.error("Error deleting deal:",e),u("Failed to delete deal","error")}finally{I(!1)}},U=e=>{const t=[];e.address_line_1&&t.push(e.address_line_1),e.address_line_2&&t.push(e.address_line_2),e.city&&t.push(e.city),e.post_code&&t.push(e.post_code);const a=t.join(", "),l=120;return a.length>l?a.substring(0,l)+"...":a},X=(b==null?void 0:b.data)||{property_types:[]},Z=new Date().getFullYear(),ee=Array.from({length:4},(e,t)=>Z-t),se=()=>{const e=n.totalPages,t=n.currentPage;if(e<=5)return Array.from({length:e},(m,y)=>y+1);const a=[1];let l=Math.max(2,t-1),d=Math.min(e-1,t+1);t<=3?d=Math.min(4,e-1):t>=e-2&&(l=Math.max(e-3,2)),l>2&&a.push("...");for(let m=l;m<=d;m++)a.push(m);return d<e-1&&a.push("..."),e>1&&a.push(e),a},te=async e=>{var t,a,l,d,m,y;if(e)try{f(!0);const o=await Ne(e);p(be(!0)),p(De(!0)),p(ve(!0)),p(Se(!0)),p(we(!0)),p(Pe());const F=((t=o==null?void 0:o.data)==null?void 0:t.data)||{},ae=F.propertyDealSaInvestment||F.propertyDealInvestment||{},{id:Me,...re}=ae||{},M=((d=(l=(a=o==null?void 0:o.data)==null?void 0:a.data)==null?void 0:l.deal)==null?void 0:d.step_completed)||1,le={...(y=(m=o==null?void 0:o.data)==null?void 0:m.data)==null?void 0:y.deal,...re,step:M};p(Ie(le)),p(Ce(M)),j("/create-deal/address")}catch{u("Failed to edit deal. Please try again.","error")}finally{f(!1)}};return s.jsxs("div",{className:"overflow-x-auto p-4",children:[s.jsx(Fe,{isOpen:E,onClose:()=>N(!1),onConfirm:Q,title:"Delete Deal",isLoading:L}),s.jsxs("div",{className:"flex justify-between items-center mb-5",children:[s.jsx("h1",{className:"text-3xl font-semibold text-dark dark:text-white",children:"Our Deals SA"}),s.jsxs("button",{onClick:Y,className:"purple-btn items-center gap-2",style:{display:"flex"},children:["Send Deals",s.jsx(pe,{className:"text-lg"})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-4 md:grid-cols-2 gap-4 mb-4",children:[s.jsxs("select",{name:"year",value:r.year,onChange:k,className:"form-select",children:[s.jsx("option",{value:"",children:"All Years"}),ee.map(e=>s.jsx("option",{value:e.toString(),children:e},e))]}),s.jsxs("select",{name:"propertyTypeId",value:r.propertyTypeId,onChange:k,className:"form-select",children:[s.jsx("option",{value:"",children:"All Property Types"}),X.property_types.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]})]}),A||R?s.jsx(he,{}):s.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-[#6C5DD3] text-white",children:[s.jsx("th",{className:"",children:s.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?_(c.map(t=>t.id)):_([])},checked:x.length===c.length&&c.length>0})}),s.jsx("th",{className:"",children:"Sl No"}),s.jsx("th",{className:"",children:"Property Address"}),s.jsx("th",{className:"",children:"Description"}),s.jsx("th",{className:"",children:"Monthly Revenue"}),s.jsx("th",{className:"",children:"Aquisition Cost"}),s.jsx("th",{className:"",children:"Gross ROI"}),s.jsx("th",{className:"",children:"Status"}),s.jsxs("th",{className:"cursor-pointer",onClick:()=>G("created_at"),children:["Created Date",r.sortColumn==="created_at"&&s.jsx("span",{className:"ml-1",children:r.sortOrder==="asc"?"↑":"↓"})]}),s.jsx("th",{className:"",children:"Actions"})]})}),s.jsx("tbody",{children:(c==null?void 0:c.length)>0?c==null?void 0:c.filter(e=>(e==null?void 0:e.deal_type_id)==2).map((e,t)=>{var a,l,d;return s.jsxs("tr",{className:"",children:[s.jsx("td",{className:"",children:s.jsx("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>B(e.id)})}),s.jsx("td",{className:"",children:n.from+t}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:U(e)})}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:q(e)||"No description"})}),s.jsx("td",{className:"",children:(a=e.property_deal_sa_investment)!=null&&a.monthly_revenue?`£${parseFloat(e.property_deal_sa_investment.monthly_revenue).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(l=e==null?void 0:e.property_deal_sa_investment)!=null&&l.aquisition_cost?`£${parseFloat(e==null?void 0:e.property_deal_sa_investment.aquisition_cost).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(d=e==null?void 0:e.property_deal_sa_investment)!=null&&d.gross_roi_percentage?`${new Intl.NumberFormat("en-IN",{maximumFractionDigits:0}).format(parseFloat(e==null?void 0:e.property_deal_sa_investment.gross_roi_percentage))}%`:"0%"}),s.jsx("td",{className:"",children:s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e.status==="publish"?"bg-green-500 text-white":"bg-gray-500 text-white"}`,children:e.status==="publish"?"Published":"Draft"})}),s.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),s.jsx("td",{className:"",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>J(e),className:"text-lg",children:s.jsx(me,{})}),s.jsx("button",{onClick:()=>te(e.id),className:"text-lg",children:s.jsx(ue,{})}),s.jsx("button",{onClick:()=>K(e.id),className:"text-lg",children:s.jsx(ge,{})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No deals available"})})})]})}),n.total>0&&s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm",children:["Showing ",n.from,"-",n.to," of ",n.total," ","deals"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:W,className:"p-2 rounded-l-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r.page<=1,children:s.jsx(xe,{size:14})}),s.jsx("div",{className:"flex space-x-2",children:se().map((e,t)=>e==="..."?s.jsx("span",{className:"p-2  bg-gray-700 text-white",children:"..."},`ellipsis-${t}`):s.jsx("button",{onClick:()=>H(e),className:`px-2 py-1 min-w-[40px]  text-center ${e===n.currentPage?"bg-[#6C5DD3] text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e},`page-${e}`))}),s.jsx("button",{onClick:V,className:"p-2 rounded-r-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n.hasMorePages,children:s.jsx(fe,{size:14})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{value:r.per_page,onChange:e=>h({...r,per_page:parseInt(e.target.value),page:1}),className:"form-select",children:[s.jsx("option",{value:"10",children:"10 / 10"}),s.jsx("option",{value:"20",children:"20 / 20"}),s.jsx("option",{value:"50",children:"50 / 50"}),s.jsx("option",{value:"100",children:"100 / 100"})]})})]}),v&&s.jsx(ke,{isOpen:v,onClose:z,selectedDeals:x})]})};export{Le as default};
