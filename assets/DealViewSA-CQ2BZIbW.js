import{bi as ce,a8 as de,u as d,r as n,t as me,s as pe,au as ue,a7 as xe,bB as he,q as ye,E as be,cu as ge,bE as H,m as s,aT as fe,G as je,bF as h,bG as y,bH as p,bT as U,ax as ve,bK as Ne,bL as we,bU as _e,bV as Ce,cv as De,c0 as Se}from"./index-JxPWaWp1.js";import{u as Fe}from"./useRefreshUser-B8O110go.js";import{S as Ae}from"./SendContactDealModal-DHkwqqtt.js";import"./lodash-BhcHC9AR.js";function Ie(o){return ce({attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M7.50005 1.04999C7.74858 1.04999 7.95005 1.25146 7.95005 1.49999V8.41359L10.1819 6.18179C10.3576 6.00605 10.6425 6.00605 10.8182 6.18179C10.994 6.35753 10.994 6.64245 10.8182 6.81819L7.81825 9.81819C7.64251 9.99392 7.35759 9.99392 7.18185 9.81819L4.18185 6.81819C4.00611 6.64245 4.00611 6.35753 4.18185 6.18179C4.35759 6.00605 4.64251 6.00605 4.81825 6.18179L7.05005 8.41359V1.49999C7.05005 1.25146 7.25152 1.04999 7.50005 1.04999ZM2.5 10C2.77614 10 3 10.2239 3 10.5V12C3 12.5539 3.44565 13 3.99635 13H11.0012C11.5529 13 12 12.5528 12 12V10.5C12 10.2239 12.2239 10 12.5 10C12.7761 10 13 10.2239 13 10.5V12C13 13.1041 12.1062 14 11.0012 14H3.99635C2.89019 14 2 13.103 2 12V10.5C2 10.2239 2.22386 10 2.5 10Z",fill:"currentColor"},child:[]}]})(o)}const Le="/assets/aiImageDummy-DpTjEgam.png",Re=()=>{var L,k,P,E,M,z,T,V,R,$,O;const{id:o}=de(),{user:b}=d(a=>a.user),[ke,u]=n.useState(!0),[Pe,Y]=n.useState(null),[B,w]=n.useState(!1),_=me(),c=pe();Fe();const e=d(a=>a.deal.deal),C=d(a=>a.deal.currentStep),q=d(a=>a.deal.comparableMode);d(a=>a.deal.newComperableData),d(a=>a.deal.SAnewComperableData);const K="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",{loading:Q}=ue(),{data:g}=xe(he,e!=null&&e.id?e==null?void 0:e.id:o,{type:q});(L=g==null?void 0:g.data)!=null&&L.dealComparables;const[Z,D]=n.useState(!1),[W,S]=n.useState([]),F=n.useRef(null),{showSnackbar:m}=ye();((...a)=>a.find(t=>Array.isArray(t)&&t.length>0)||[])(e==null?void 0:e.newcomperable,e==null?void 0:e.property_deal_comparables,e==null?void 0:e.property_deal_sa_comparables);const[f,X]=n.useState(!0),[j,J]=n.useState(!0),[x,ee]=n.useState(!0),[v,se]=n.useState(!0),A=n.useCallback(async()=>{var a;u(!0);try{const t=await be(o);t&&t.data&&c(ge((a=t.data.data)==null?void 0:a.deal))}catch{Y("Failed to load deal details")}finally{u(!1)}},[o]);n.useEffect(()=>{o&&A()},[A,o]),e!=null&&e.address_line_1,e!=null&&e.address_line_2,e!=null&&e.post_code,(k=e==null?void 0:e.country)!=null&&k.name;const I=(e==null?void 0:e.image_url)||null,ae=(e==null?void 0:e.map_image_url)||null,te=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{const t={lat:a.coords.latitude,lng:a.coords.longitude};setUserLocation(t),setAddressCoordinates(t)},()=>{alert("Location access denied or unavailable.")}):alert("Geolocation is not supported by this browser.")},re=a=>{const t=[];a!=null&&a.address_line_1&&t.push(a.address_line_1),a!=null&&a.address_line_2&&t.push(a.address_line_2),a!=null&&a.city&&t.push(a.city),a!=null&&a.post_code&&t.push(a.post_code);const r=t.join(", "),i=120;return r.length>i?r.substring(0,i)+"...":r},N={description:(e==null?void 0:e.description_type)==="ai"?(e==null?void 0:e.description_ai)||"No AI description available":(e==null?void 0:e.description)||"No description available"},ie={location:(e==null?void 0:e.description_type)==="ai"?(e==null?void 0:e.location_ai)||"No AI location available":(e==null?void 0:e.location)||"No location available"};n.useEffect(()=>(c(H(!0)),c({type:"deal/setCurrentStep",payload:Math.max(C,5)}),()=>{c(H(!1))}),[c,C]);const ne=()=>{o&&(S([o]),w(!0))},oe=async()=>{if(!o){m("Deal ID not available","error");return}D(!0);try{const a=await Se(e.unique_id),t=a.headers["content-type"];if(t&&t.includes("application/json")){const r=a.data;if(r.data&&r.data.pdf_url){const i=document.createElement("a");i.href=r.data.pdf_url,i.setAttribute("download",`deal-${o}.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i),m("PDF downloaded successfully","success")}else m(r.message||"Failed to generate PDF","error")}else{const r=new Blob([a.data],{type:"application/pdf"}),i=window.URL.createObjectURL(r),l=document.createElement("a");l.href=i,l.setAttribute("download",`deal-${o}.pdf`),document.body.appendChild(l),l.click(),document.body.removeChild(l),m("PDF downloaded successfully","success")}}catch(a){console.error("Failed to download PDF: ",a),m(a.message||"Failed to download PDF","error")}finally{D(!1)}},le=async()=>{var a;u(!0);try{const r=await(await fetch("https://api.heygen.com/v2/templates",{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":"NmFhN2IxYTRkM2I0NDg5YThjOWExZDcwNjQ5NjdhMmMtMTc1Mzk5NzExNQ=="}})).json();c(De((a=r==null?void 0:r.data)==null?void 0:a.templates)),_("/deal-view-ai-video-generator")}catch(t){console.error("API error:",t)}finally{u(!1)}};return s.jsxs("div",{className:"create-deal-summary-page-wrap",children:[s.jsx(Ae,{isOpen:B,onClose:()=>{w(!1),S([])},selectedDeals:W}),s.jsxs("div",{className:"flex items-end justify-between my-5",children:[s.jsxs("div",{className:"",children:[s.jsx("h4",{className:"text-[#333333] font-bold light-black",children:"Deal View"}),s.jsx("p",{className:"text-[#333333]",children:"Preview deal before sending to your investors"})]}),s.jsx("div",{className:"buttons",children:s.jsxs("div",{className:"deals-share-btn-wrap flex items-center gap-3",children:[s.jsxs("button",{onClick:()=>{var a;((a=b==null?void 0:b.user_subscription)==null?void 0:a.status)==="active"?le():_("/subscription")},className:`ai-description-tab transition flex items-center gap-2 ms-auto 
                             ${e!=null&&e.ai_video_id,"purple-gradient-btn"}`,children:[s.jsx(fe,{}),s.jsx("span",{children:e!=null&&e.ai_video_id?"Re-generate AI Video":"AI Generated Video"})]}),s.jsxs("button",{type:"button",className:"share-btn",onClick:a=>{a.preventDefault(),ne()},children:[s.jsx(je,{className:"text-2xl"})," Share"]}),s.jsx("button",{type:"button",className:"!bg-[#ECECEC] !text-[black] remove-gradient-class",onClick:oe,disabled:Z,children:s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx(Ie,{className:"text-2xl"}),s.jsx("span",{children:"Export PDF"})]})})]})})]}),Q?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:s.jsx("div",{children:s.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"summary-add-details-wrap",children:[s.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between cursor-pointer",onClick:()=>X(!f),children:[s.jsx("h5",{className:"text-lg font-semibold",children:"Title"}),f?s.jsx(h,{className:"text-gray-600",size:20}):s.jsx(y,{className:"text-gray-600",size:20})]}),s.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden ${f?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"summary-property-map-wrap",children:[s.jsxs("div",{className:"flex items-center justify-between purchased-price-with-location",children:[s.jsx("p",{className:"text-[#242424] font-medium property-location-text mb-4",children:re(e)}),(e==null?void 0:e.deal_type_id)===2?s.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right",children:["Rent:"," ",s.jsx("span",{className:"text-[#242424]",children:(P=e==null?void 0:e.property_deal_sa_investment)!=null&&P.rent?`£${parseFloat((E=e==null?void 0:e.property_deal_sa_investment)==null?void 0:E.rent).toLocaleString()}`:"0"})]}):s.jsxs("p",{className:"text-[#595959] font-medium summary-map-price-label mb-4 text-right",children:["Purchased Price:"," ",s.jsx("span",{className:"text-[#242424]",children:(M=e==null?void 0:e.property_deal_investment)!=null&&M.purchase_price?`£${parseFloat((z=e==null?void 0:e.property_deal_investment)==null?void 0:z.purchase_price).toLocaleString()}`:"0"})]})]}),s.jsxs("div",{className:"summary-property-map-grid-wrap",children:[s.jsxs("div",{className:`${(e==null?void 0:e.property_deal_media.length)>0?"summary-property-col":""}`,children:[s.jsx("div",{className:"summary-property-subimages-div",children:(T=e==null?void 0:e.property_deal_media)==null?void 0:T.slice(0,4).map((a,t)=>{var l,G;const i=(((l=e==null?void 0:e.property_deal_media)==null?void 0:l.length)||0)-4;return s.jsx("div",{className:"summary-property-subimages relative",children:a?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:(G=a==null?void 0:a.media)==null?void 0:G.media_url,alt:"Property",className:"w-full h-full object-cover"}),t===3&&i>0&&s.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white text-lg font-semibold",children:["+",i]})]}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:p.noImageAvailable})},t)})}),s.jsx("div",{className:"summary-property-main-images-div h-full",children:s.jsx("div",{className:"w-full bg-gray-700 summary-property-div",children:I?s.jsx("img",{src:I,alt:"Property",className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:p.noImageAvailable})})})]}),s.jsx("div",{className:"summary-map-loaction-col",children:s.jsx("div",{className:"w-full bg-gray-400 summary-map-wrapper",children:s.jsx("img",{src:Le,alt:"Map location"})})})]})]})})]}),s.jsxs("div",{className:"deal-summart-description-wrap mt-6",children:[s.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between cursor-pointer",onClick:()=>J(!j),children:[s.jsx("h5",{className:"text-lg font-semibold",children:"Description"}),j?s.jsx(h,{className:"text-gray-600",size:20}):s.jsx(y,{className:"text-gray-600",size:20})]}),s.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden ${j?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"summary-description-text flex gap-6",children:[s.jsxs("div",{className:"w-[60%]",children:[s.jsxs("div",{className:"summary-description-heading-wrap",children:[s.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2",children:"Property description:"}),s.jsx("p",{className:"text-[#595959] line-clamp-3 overflow-hidden whitespace-pre-line",dangerouslySetInnerHTML:{__html:U(N==null?void 0:N.description)}})]}),s.jsxs("div",{className:"summary-description-heading-wrap mt-6",children:[s.jsx("h4",{className:"text-lg text-[#333333] font-normal mb-2",children:"Location description:"}),s.jsx("p",{className:"text-[#595959] line-clamp-3 overflow-hidden whitespace-pre-line",dangerouslySetInnerHTML:{__html:U(ie.location)}})]})]}),s.jsx("div",{className:"w-[40%] relative bg-gray-700 summary-map-wrapper",children:ae?s.jsxs(s.Fragment,{children:[s.jsx("iframe",{width:"600",height:"358",className:"rounded-lg w-full",style:{border:0,borderRadius:"12px"},loading:"lazy",allowFullScreen:!0,referrerPolicy:"no-referrer-when-downgrade",src:`https://www.google.com/maps/embed/v1/place?key=${K}&q=${e==null?void 0:e.lat},${e==null?void 0:e.lng}&zoom=16`,title:"Google Map"}),s.jsx("button",{type:"button",className:"absolute bottom-[30px] right-[60px] bg-black text-white px-2 py-2 rounded-full border border-white text-sm shadow transition",onClick:te,children:s.jsx(ve,{})})]}):s.jsx("div",{className:"w-full flex items-center justify-center text-gray-500",children:p.noMapImageAvailable})})]})})]}),s.jsxs("div",{className:"mt-6 DealsDetails-page-wrapper summary-financials-details-wrap",children:[s.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between cursor-pointer",onClick:()=>se(!v),children:[s.jsx("h5",{className:"text-lg font-semibold",children:p.financials}),v?s.jsx(h,{className:"text-gray-500 transition-transform duration-300",size:20}):s.jsx(y,{className:"text-gray-500 transition-transform duration-300",size:20})]}),s.jsx("div",{className:`transition-all duration-300 ${v?"max-h-[2094px] opacity-100 mt-4":"max-h-0 opacity-0"}`,children:s.jsx("div",{className:"min-h-screen financial-page-main-div-wrap",children:s.jsxs("div",{className:"financial-page-inner-div-wrap",children:[(e==null?void 0:e.deal_type_id)===2?s.jsx(Ne,{deal:e}):s.jsx(we,{deal:e}),s.jsx(_e,{deal:e})]})})})]}),s.jsxs("div",{className:(e==null?void 0:e.deal_type_id)===2?"summary-page-comparables-sec mt-6 border border-gray-200 rounded-lg overflow-hidden":"deal-page-comparables-sec mt-6 border border-gray-200 rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"deal-summary-header-wrap flex items-center justify-between px-4 py-2 bg-[#F8F8F8] cursor-pointer",onClick:()=>ee(!x),children:[s.jsx("h5",{className:"text-lg font-semibold",children:p.comparables}),x?s.jsx(h,{className:"text-gray-600",size:20}):s.jsx(y,{className:"text-gray-600",size:20})]}),s.jsx("div",{ref:F,style:{maxHeight:x?`${(V=F.current)==null?void 0:V.scrollHeight}px`:"0px",opacity:x?1:0,transition:"all 0.4s ease-in-out",overflow:"hidden"},children:s.jsx("div",{className:"p-4",children:(e==null?void 0:e.deal_type_id)===2&&(((R=e==null?void 0:e.property_deal_sa_comparables)==null?void 0:R.length)===0?s.jsx("p",{children:"No comparables available"}):s.jsx("div",{className:"summary-page-comapare-table-main-div",children:s.jsx("div",{className:"overflow-x-auto comparable-listing-table-wrap",children:($=e==null?void 0:e.property_deal_sa_comparables)==null?void 0:$.map((a,t)=>s.jsx(Ce,{comp:a},t))})}))})})]})]}),s.jsxs("div",{className:"flex items-center justify-between text-lg text-gray-600 my-2",children:[s.jsxs("span",{children:["Last updated by: ",s.jsx("strong",{children:((O=e==null?void 0:e.last_updated_by)==null?void 0:O.name)||"-"})]}),s.jsx("span",{children:e!=null&&e.updated_at?new Date(e.updated_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):""})]})]})};export{Re as default};
