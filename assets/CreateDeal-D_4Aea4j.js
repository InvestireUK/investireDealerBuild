import{a2 as j,r as n,q as _,m as t,ad as A,ae as P,af as R,a3 as O,ag as q,t as U,s as $,ah as T,u as m,ab as w,O as N}from"./index-Bbk-TWcL.js";const W=(r,c)=>{const s=j(),u=n.useRef(s.pathname.includes(r));n.useEffect(()=>{u.current=s.pathname.includes(r)},[r]),n.useEffect(()=>{const g=s.pathname.includes(r);u.current&&!g&&c(),u.current=g},[s.pathname,r,c])},B=({steps:r,currentStep:c,activeStep:s,navigationAllow:u,onStepClick:g,isComparablesRoute:D,deal:i})=>{const{showSnackbar:x}=_(),v=j().pathname.endsWith("/summary"),[a,y]=n.useState(!1);n.useEffect(()=>{const o=document.querySelector("nav.create-deals-tabs-wrap::after");if(o){const l=(s-1)/(r.length-1)*80+10;o.style.width=`${l}%`}},[s,r.length]),n.useEffect(()=>{const o=document.querySelector("nav.create-deals-tabs-wrap .nav-tab.active");o&&window.innerWidth<=1024&&o.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[s,c]);const C=async()=>{if(!(i!=null&&i.id)){x("Deal ID not available","error");return}y(!0);try{const o=await q(i==null?void 0:i.unique_id),l=new Blob([o.data],{type:"application/pdf"}),b=window.URL.createObjectURL(l),d=document.createElement("a");d.href=b,d.setAttribute("download",`deal-${i.id}.pdf`),document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(b),x("PDF downloaded successfully","success")}catch(o){x(o.message||"Failed to download PDF","error")}finally{y(!1)}};return t.jsxs("div",{className:"create-deal-page-wrap",children:[t.jsxs(A,{children:[t.jsxs("div",{className:"Create-new-deal-heading-wrap flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-[#333333] font-medium dark:text-white",children:[5].includes(i==null?void 0:i.step_completed)?"Edit deal":"Create new deal"}),v&&t.jsx("div",{className:"flex items-center gap-4",children:t.jsx("button",{type:"button",className:"summary-export-pdf-btn !text-black",onClick:C,disabled:a,children:a?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"loader mr-1"})," Exporting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(P,{})," Export PDF"]})})})]}),t.jsx("nav",{className:"create-deals-tabs-wrap",children:r.map(({text:o,step:l,path:b,dealSteps:d})=>{const S=l===s||l===1&&D,h=u||l<=c;return t.jsxs("div",{className:`nav-tab ${S?"active":""} ${d?"step-checked":""}`,onClick:()=>h&&g(l,b),style:{pointerEvents:h?"auto":"none",opacity:S||h?1:.5,cursor:h?"pointer":"not-allowed"},children:[t.jsx("span",{className:"create-deals-step-num",children:d?t.jsx(R,{}):l}),t.jsx("span",{className:"create-deals-step-heading",children:o})]},l)})})]}),t.jsx("div",{className:"create-deal-address-form-outer-div-wrap",children:t.jsx(O,{})})]})},V=()=>{var k;const r=U(),c=j(),s=$(),[u]=T();u.get("mode");const[g,D]=n.useState([]),[i,x]=n.useState([]),f=m(e=>e.deal.currentStep),v=m(e=>e.deal.navigationAllow),a=m(e=>e.deal.deal);m(e=>e.deal.comparableMode);const y=m(e=>e.deal.dealSteps1),C=m(e=>e.deal.dealSteps2),o=m(e=>e.deal.dealSteps3),l=m(e=>e.deal.dealSteps4),b=m(e=>e.deal.dealSteps5),S=((...e)=>e.find(p=>Array.isArray(p)&&p.length>0)||[])(a==null?void 0:a.newcomperable,a==null?void 0:a.property_deal_comparables,a==null?void 0:a.property_deal_sa_comparables),h=[{text:"Address details",step:"01",path:"/create-deal/address",dealSteps:y},{text:"Financial details",step:"02",path:"/create-deal/financials",dealSteps:C},{text:"Description details",step:"03",path:"/create-deal/description",dealSteps:o},{text:"Comparable",step:"04",path:(S==null?void 0:S.length)>0?(a==null?void 0:a.deal_type_id)===2?"/create-deal/sa-comparable-table":"/create-deal/comparable-table":"/create-deal/comparables",dealSteps:l},{text:"Summary",step:"05",path:"/create-deal/summary",dealSteps:b}],E=c.pathname.includes("/create-deal/comparables")||c.pathname.includes("/create-deal/all-comparable"),F=E?4:(k=h.find(e=>c.pathname.includes(e.path)))==null?void 0:k.step,I=n.useCallback(()=>{s(w()),console.log("handle create deal down 92",w),sessionStorage.removeItem("inCreateDealFlow"),sessionStorage.removeItem("currentStep")},[s]);W("/create-deal",I),n.useEffect(()=>{window.scrollTo(0,0)},[c.pathname]),n.useEffect(()=>{const e=sessionStorage.getItem("currentStep");if(e){const p=Number(e);isNaN(p)||s(N(p))}},[]),n.useEffect(()=>{sessionStorage.setItem("currentStep",f.toString())},[f]),n.useEffect(()=>{const e=sessionStorage.getItem("inCreateDealFlow"),p=c.pathname.startsWith("/create-deal");!a&&(!e||!p)&&(console.log("useeffect reset up 122",w),s(w()),console.log("useefect doen reset 124",w),r("/create-deal/address",{replace:!0}))},[a,r,s,c.pathname]),n.useEffect(()=>(sessionStorage.setItem("inCreateDealFlow","true"),()=>{window.location.pathname.includes("/create-deal")||(sessionStorage.removeItem("inCreateDealFlow"),sessionStorage.removeItem("currentStep"))}),[s]);const L=(e,p)=>{(v||e<=f)&&(e>f&&s(N(e)),r(p))};return t.jsx(B,{steps:h,currentStep:f,navigationAllow:v,activeStep:F,isComparablesRoute:E,onStepClick:L,deal:a})};export{V as default};
