import{r as t,av as G,t as J,w as ee,a3 as re,V as ne,cy as de,m as e,z as se,bx as ie,X as oe,cz as ce,cA as me,cB as ue,az as xe,u as je,A as ve,n as Ne,o as we,q as ye,c9 as Ce,cC as ke}from"./index-C3MMOsYh.js";import{l as Ee}from"./lodash-CZ5tP1lH.js";import{D as Fe}from"./DeleteConfirmationModal-Dkf_8j3q.js";import{P as Se}from"./PaginationNew-BdQaBuKr.js";import{I as he}from"./ImportContactsModal-ClYw3bFe.js";const Ae=({isOpen:h,onClose:y,onSuccess:r})=>{var f;const[g,I]=t.useState(!1),{handleApiCall:L,loading:C}=G(),[k,j]=t.useState(!1),[z,v]=t.useState(!1);t.useRef(null);const[M,V]=t.useState(!1),[K,$]=t.useState(!1),[q,H]=t.useState([]),{showSnackbar:O}=J(),U=ee(),x=(f=re().state)==null?void 0:f.contactId,N=!!x,{register:F,handleSubmit:T,reset:S,setValue:c,formState:{errors:A}}=ne({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",phone:""}}),[te,X]=t.useState({news:!1,deals:!1,investment:!1});t.useEffect(()=>{h&&x&&!k&&(j(!0),B()),h||(_(),j(!1))},[h,x,k]);const B=async()=>{var i,o,n,E,m,D,u,w;I(!0);try{const b=await de(x),R=(o=(i=b==null?void 0:b.data)==null?void 0:i.data)==null?void 0:o.contact;R&&(c("first_name",R.first_name),c("last_name",R.last_name),c("email",R.email),c("password",R.password),c("phone",R.phone))}catch(b){if(console.error("Error fetching contact:",b),((n=b.response)==null?void 0:n.status)===404||(D=(m=(E=b.response)==null?void 0:E.data)==null?void 0:m.message)!=null&&D.includes("could not be found")){O("Contact not found. Creating a new contact instead.","warning"),_();return}O(((w=(u=b==null?void 0:b.response)==null?void 0:u.data)==null?void 0:w.message)||"Failed to fetch contact details. Please try again.","error")}finally{I(!1)}},_=()=>{S({first_name:"",last_name:"",email:"",password:"",phone:""}),j(!1)},Z=i=>{const o={...i};N&&!o.password&&delete o.password,L({apiFn:()=>N?ce(x,o):me(o),data:o,onSuccess:n=>{var E;O(((E=n==null?void 0:n.data)==null?void 0:E.message)||(N?"Contact updated successfully":"Contact added successfully"),"success"),y(),r&&r(),U("/all-contacts")}})},p=()=>{V(!0),L({apiFn:()=>ue(q),onSuccess:()=>{$(!1),H([]),y(),r&&r()}})};return h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-xs z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl min-h-[40vh] md:min-h-[70vh] mx-5 relative dark:bg-[#181818]",children:[(C||g)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 z-10 flex items-center justify-center",children:g?e.jsx(se,{}):e.jsx(ie,{})}),e.jsxs("div",{className:"flex justify-between items-center p-4 py-5 px-5 border-b border-gray-300",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl text-black font-semibold mb-1 dark:text-[#ECECEC]",children:N?"Edit Contact":"Add New Contact"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:y,className:"text-gray-700 transition-colors p-1 dark:text-[#F8F8F8]",disabled:C||g,children:e.jsx(oe,{size:20})})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsx("div",{className:"add-contact-form-wrap",children:e.jsxs("form",{onSubmit:T(Z),children:[e.jsxs("div",{className:"bg-[#FDFDFD] dark:bg-[#181818]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Full Name"}),e.jsx("input",{type:"text",...F("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),A.first_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.first_name.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Email Address"}),e.jsx("input",{type:"email",...F("email",{required:"Email address is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter email address"}),A.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Phone Number"}),e.jsx("input",{type:"tel",inputMode:"numeric",onKeyDown:i=>{["e","E","+","-"].includes(i.key)&&i.preventDefault()},...F("phone",{validate:i=>i?/^0\d{9,10}$/.test(i)||"Phone number must start with 0 and be 10 or 11 digits long":!0}),className:"w-full border p-3 rounded-xl mb-1 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter phone number"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),A.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:A.phone.message})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-10 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y(),className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",disabled:C,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C,className:`purple-btn ${C?"opacity-70 cursor-not-allowed":""}`,children:e.jsx("span",{className:"flex items-center gap-2",children:N?"Update Contact":"Add Contact"})})]})]})})})]})}),e.jsx(he,{isOpen:K,onClose:()=>$(!1),onConfirm:p,contacts:q,isLoading:M})]}):null},_e=({isOpen:h,onClose:y,onSuccess:r,contactId:g})=>{const[I,L]=t.useState(!1),{handleApiCall:C,loading:k}=G(),[j,z]=t.useState(!1),[v,M]=t.useState(!1);t.useRef(null);const[V,K]=t.useState(!1),[$,q]=t.useState(!1),[H,O]=t.useState([]),{showSnackbar:U}=J(),Q=ee();re();const x=!!g,{register:N,handleSubmit:F,reset:T,setValue:S,formState:{errors:c}}=ne({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",phone:""}}),[A,te]=t.useState({news:!1,deals:!1,investment:!1});t.useEffect(()=>{h&&g&&!j&&(z(!0),X()),h||(B(),z(!1))},[h,g,j]);const X=async()=>{var p,f,i,o,n,E,m,D;L(!0);try{const u=await de(g),w=(f=(p=u==null?void 0:u.data)==null?void 0:p.data)==null?void 0:f.contact;w&&(S("first_name",w.first_name),S("last_name",w.last_name),S("email",w.email),S("password",w.password),S("phone",w.phone))}catch(u){if(console.error("Error fetching contact:",u),((i=u.response)==null?void 0:i.status)===404||(E=(n=(o=u.response)==null?void 0:o.data)==null?void 0:n.message)!=null&&E.includes("could not be found")){U("Contact not found. Creating a new contact instead.","warning"),B();return}U(((D=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:D.message)||"Failed to fetch contact details. Please try again.","error")}finally{L(!1)}},B=()=>{T({first_name:"",last_name:"",email:"",password:"",phone:""}),z(!1)},_=p=>{const f={...p};x&&!f.password&&delete f.password,C({apiFn:()=>x?ce(g,f):me(f),data:f,onSuccess:i=>{var o;U(((o=i==null?void 0:i.data)==null?void 0:o.message)||(x?"Contact updated successfully":"Contact added successfully"),"success"),y(),r&&r(),Q("/all-contacts")}})},Z=()=>{K(!0),C({apiFn:()=>ue(H),onSuccess:()=>{q(!1),O([]),y(),r&&r()}})};return h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-xs z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl min-h-[40vh] md:min-h-[70vh] mx-5 relative dark:bg-[#181818]",children:[(k||I)&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 z-10 flex items-center justify-center",children:I?e.jsx(se,{}):e.jsx(ie,{})}),e.jsxs("div",{className:"flex justify-between items-center p-4 py-5 px-5 border-b border-gray-300",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl text-black font-semibold mb-1 dark:text-[#ECECEC]",children:x?"Edit Contact":"Add New Contact"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:y,className:"text-gray-700 transition-colors p-1 dark:text-[#ECECEC]",disabled:k||I,children:e.jsx(oe,{size:20})})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:e.jsx("div",{className:"add-contact-form-wrap",children:e.jsxs("form",{onSubmit:F(_),children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Full Name"}),e.jsx("input",{type:"text",...N("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),c.first_name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.first_name.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Email Address"}),e.jsx("input",{type:"email",...N("email",{required:"Email address is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),className:"form-control",placeholder:"Enter email address"}),c.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"Phone Number"}),e.jsx("input",{type:"tel",inputMode:"numeric",onWheel:p=>p.target.blur(),onKeyDown:p=>{["e","E","+","-","ArrowUp","ArrowDown"].includes(p.key)&&p.preventDefault()},...N("phone",{required:"Phone number is required",pattern:{value:/^0\d{9,10}$/,message:"Phone number must start with 0 and be 10 or 11 digits long"}}),className:"form-control",placeholder:"Enter phone number"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),c.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.phone.message})]})]}),e.jsxs("div",{className:"flex justify-end mt-10 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y(),className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k,className:`purple-btn ${k?"opacity-70 cursor-not-allowed":""}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[x?"":e.jsx(xe,{}),x?"Update Contact":"Add Contact"]})})]})]})})})]})}),e.jsx(he,{isOpen:$,onClose:()=>q(!1),onConfirm:Z,contacts:H,isLoading:V})]}):null},Oe=()=>{const{role:h,user:y}=je(s=>s.user);ee();const[r,g]=t.useState([]),[I,L]=t.useState(!0),[C,k]=t.useState(""),[j,z]=t.useState([]),[v,M]=t.useState(null),[V,K]=t.useState({top:0,left:0}),[$,q]=t.useState(!1),[H,O]=t.useState(!1),[U,Q]=t.useState(!1),[x,N]=t.useState(null),F=t.useRef(null),T=t.useRef({}),S=t.useRef(null),{showSnackbar:c}=J(),{handleApiCall:A}=G(),[te,X]=t.useState(0),[B,_]=t.useState({isOpen:!1,contactId:null,isLoading:!1}),Z=()=>{O(!0)},p=()=>{Z()},f=()=>{O(!1)},i=s=>{N(s),Q(!0)},o=()=>{Q(!1)},[n,E]=t.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[m,D]=t.useState({page:1,per_page:(n==null?void 0:n.total)>=5?5:(n==null?void 0:n.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""});t.useEffect(()=>{function s(P){F.current&&!F.current.contains(P.target)&&M(null)}function l(){v!==null&&M(null)}function d(){if(v!==null&&T.current[v]){const a=T.current[v].getBoundingClientRect(),W=window.innerHeight-a.bottom,ge=a.top;q(W<200&&ge>200),K({top:$?a.top-10:a.bottom+5,left:a.right-160})}}return d(),document.addEventListener("mousedown",s),document.addEventListener("scroll",l,!0),window.addEventListener("resize",d),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("scroll",l,!0),window.removeEventListener("resize",d)}},[v,$]);const u=Ee.debounce(s=>{D(l=>({...l,search:s,page:1}))},1e3),w=s=>{const l=s.target.value;k(l),u(l)},b=s=>{z(l=>l.includes(s)?l.filter(d=>d!==s):[...l,s])},R=s=>{const{name:l,value:d}=s.target;D({...m,[l]:d,page:1})},Y=async()=>{var s,l;L(!0);try{const d=await Ce({...m,perPage:m.per_page||10,status:m.status==="all"?null:m.status}),{data:P}=d==null?void 0:d.data;g((P==null?void 0:P.contacts)||[]);const a=d.data.data.page_context;a&&E({currentPage:parseInt(a==null?void 0:a.page)||1,totalPages:Math.ceil(parseInt((a==null?void 0:a.total_records)||0)/parseInt((a==null?void 0:a.per_page)||10)),from:(parseInt(a.page)-1)*parseInt(a.per_page)+1,to:Math.min(parseInt(a==null?void 0:a.page)*parseInt(a==null?void 0:a.per_page),parseInt((a==null?void 0:a.total_records)||0)),total:parseInt((a==null?void 0:a.total_records)||0),hasMorePages:(a==null?void 0:a.has_more_page)==="true"})}catch(d){console.error("Error fetching contacts:",d),c(((l=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch contacts. Please try again.","error")}finally{L(!1)}},pe=s=>{_({isOpen:!0,contactId:s,isLoading:!1})},ae=()=>{_({isOpen:!1,contactId:null,isLoading:!1})},fe=()=>{_(s=>({...s,isLoading:!0})),A({apiFn:()=>ke(B.contactId),onSuccess:()=>{Y(),ae(),c("Contact deleted successfully","success")},onError:s=>{_(l=>({...l,isLoading:!1}))}})},le=()=>{Y()};t.useEffect(()=>{Y()},[m]);const be=s=>{var l,d,P,a,W;return!(s!=null&&s.user_id)||((l=s==null?void 0:s.user)==null?void 0:l.deleted_at)!==null?"Inactive":((d=s==null?void 0:s.user)==null?void 0:d.deleted_at)===null&&((P=s==null?void 0:s.user)==null?void 0:P.is_active)===1?"Active":((a=s==null?void 0:s.user)==null?void 0:a.deleted_at)===null&&((W=s==null?void 0:s.user)==null?void 0:W.is_active)===0?"Disabled":"Inactive"};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center  md:mb-8 flex-wrap mb-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Contacts"}),e.jsx("p",{className:"text-[#333333] dark:text-[#ECECEC]",children:"Manage your investor contacts"})]}),h!=="team"&&e.jsx("div",{className:"flex space-x-4 flex-wrap gap-3 mt-4 md:mt-0",children:e.jsxs("button",{className:"flex items-center gap-2 px-4 py-3 rounded-md bg-[#6C5DD3] text-white hover:bg-[#5a4bb2] transition-colors",onClick:p,children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Add Contact"})]})})]}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md-gap-0 space-x-4 items-start justify-between px-4 py-4",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for contacts",className:"form-control",value:C,onChange:w,style:{paddingLeft:"40px"}}),e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(s=>e.jsx("button",{onClick:()=>R({target:{name:"status",value:s.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${m.status===s.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:s.label},s.value))})})]}),e.jsx("div",{ref:S,className:"dark:bg-[#222632] bg-[#EBEBEC] rounded-lg overflow-hidden text-dark dark:text-white comparable-listing-table-wrap",children:I?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(se,{})}):r.length===0?e.jsx("div",{className:"text-center p-12 text-dark dark:text-white",children:e.jsx("p",{children:"No contacts found. Add some contacts to see them here."})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",onChange:s=>z(s.target.checked?r==null?void 0:r.map(l=>l.id):[]),checked:j.length===(r==null?void 0:r.length)&&(r==null?void 0:r.length)>0})}),e.jsx("th",{children:"NAME"}),e.jsx("th",{children:"EMAIL"}),e.jsx("th",{children:"PHONE NUMBER"}),e.jsx("th",{children:"STATUS"}),e.jsx("th",{children:"CREATED AT"}),h!=="team"&&e.jsx("th",{children:"ACTIONS"})]})}),e.jsx("tbody",{children:(r==null?void 0:r.length)>0?r==null?void 0:r.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"checkbox",checked:j==null?void 0:j.includes(s==null?void 0:s.id),onChange:()=>b(s==null?void 0:s.id)})}),e.jsx("td",{children:e.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:s==null?void 0:s.first_name})}),e.jsx("td",{children:s==null?void 0:s.email}),e.jsx("td",{children:s==null?void 0:s.phone}),e.jsx("td",{className:"p-4",children:(()=>{const l=be(s);return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
                                  ${l==="Active"?"bg-[#ECFDF3] text-[#054F31] border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":l==="Disabled"?"bg-red-100 text-red-700 border border-red-300":"bg-[#FFF8E1] text-[#FB6E0A] border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:l})})()}),e.jsx("td",{children:s!=null&&s.created_at?new Date(s==null?void 0:s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"-"}),h!=="team"&&e.jsx("td",{className:"",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:l=>T.current[s.id]=l,onClick:()=>M(v===(s==null?void 0:s.id)?null:s==null?void 0:s.id),className:"text-lg",children:e.jsx(Ne,{className:"text-[#595959]"})})})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No deals available"})})})]}),v!==null&&e.jsxs("div",{ref:F,style:{position:"fixed",top:`${V.top}px`,left:`${V.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsx("button",{onClick:()=>{const s=r.find(l=>l.id===v);i(s==null?void 0:s.id),M(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(we,{className:"mr-2"})," Edit details"]})}),e.jsxs("button",{onClick:()=>{pe(v),M(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(ye,{className:"mr-2"})," Delete"]})]})]})})]}),e.jsx(Se,{pagination:{total:n.total,currentPage:m.page,perPage:n.total>=5?5:n.total,totalPages:Math.ceil(n.total/m.per_page)},setFilters:D})]}),e.jsx(Fe,{isOpen:B.isOpen,onClose:ae,onConfirm:fe,isLoading:B.isLoading,title:"Delete Contact"}),e.jsx(Ae,{isOpen:H,onClose:f,onSuccess:le}),e.jsx(_e,{contactId:x,isOpen:U,onClose:o,onSuccess:le})]})};export{Oe as default};
