import{t as Z,a8 as ee,r as l,u as D,q as te,a7 as se,s as ae,m as s,x as re,n as ne,p as le,al as oe,am as ie,c1 as ce,aa as de,C as pe,D as he}from"./index-DNQPOinU.js";import{S as ue}from"./SendContactDealModal-5KJZgxCL.js";import{D as me}from"./DeleteConfirmationModal-D75d7qDr.js";import{A as ge}from"./index-Bhhc97K6.js";import{A as xe,m as fe}from"./proxy-CDMvFpeM.js";import"./lodash-BM0l7oV_.js";const Ie=()=>{const T=Z(),{slug:j}=ee(),[d,M]=l.useState([]),[v,E]=l.useState([]),u=D(e=>e.deal.dealsTypes),{showSnackbar:m}=te(),[w,O]=l.useState(!1),[A,N]=l.useState(!1),[L,f]=l.useState(!1),[b,I]=l.useState(null),[R,P]=l.useState(!1),[c,_]=l.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1});l.useEffect(()=>{var t;const e=(t=u==null?void 0:u.deal_types)==null?void 0:t.find(n=>n.slug===j),a=(e==null?void 0:e.id)??null;p(n=>({...n,dealTypeId:a,page:1}))},[j,u]);const[r,p]=l.useState({per_page:10,page:1,status:"all",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc"}),{data:y,loading:F}=se(de);ae();const S=async()=>{try{N(!0);const e=await ce({page:r.page,perPage:r.per_page,status:r.status,year:r.year===""?null:r.year,propertyTypeId:r.propertyTypeId===""?null:r.propertyTypeId,dealTypeId:r.dealTypeId===""?null:r.dealTypeId,sortColumn:r.sortColumn,sortOrder:r.sortOrder});if(e&&e.data){const a=e.data.data.propertyDealShares||[];M(a);const t=e.data.data.page_context;if(t)_({currentPage:parseInt(t==null?void 0:t.page)||1,totalPages:Math.ceil(parseInt((t==null?void 0:t.total_records)||0)/parseInt((t==null?void 0:t.per_page)||10)),from:(parseInt(t.page)-1)*parseInt(t.per_page)+1,to:Math.min(parseInt(t==null?void 0:t.page)*parseInt(t==null?void 0:t.per_page),parseInt((t==null?void 0:t.total_records)||0)),total:parseInt((t==null?void 0:t.total_records)||0),hasMorePages:(t==null?void 0:t.has_more_page)==="true"});else if(e.data.data.total!==void 0){const n=parseInt(e.data.data.total||0),o=parseInt(r.per_page),i=parseInt(r.page);_({currentPage:i,totalPages:Math.ceil(n/o),from:(i-1)*o+1,to:Math.min(i*o,n),total:n,hasMorePages:i*o<n})}else _({currentPage:1,totalPages:1,from:a.length>0?1:0,to:a.length,total:a.length,hasMorePages:!1})}}catch{m("Failed to fetch shared deals. Please try again.","error")}finally{N(!1)}},k=e=>{var a,t;return e?e.description_type==="ai"?((a=e.description_ai)==null?void 0:a.trim())||"No AI description available":((t=e.description)==null?void 0:t.trim())||"No description available":"No description available"};l.useEffect(()=>{r.dealTypeId&&S()},[r]);const C=()=>{O(!1)},$=()=>{c.hasMorePages&&p(e=>({...e,page:e.page+1}))},Y=()=>{r.page>1&&p(e=>({...e,page:e.page-1}))},U=e=>{e>=1&&e<=c.totalPages&&p(a=>({...a,page:e}))},V=async e=>{const a={user_id:e==null?void 0:e.user_id,property_deal_id:e==null?void 0:e.id};await he(a),T(`/deal-detail/${e.unique_id}`)},z=e=>{switch(e){case 1:return s.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-green-500 text-white",children:"Interested"});case 2:return s.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-red-500 text-white",children:"Not Interested"});default:return s.jsx("span",{className:"px-2 py-1  text-xs  text-white",children:"-"})}},B=e=>{I(e),f(!0)},q=async()=>{if(b)try{P(!0);const e=await pe(b);e&&e.data?(m("Deal deleted successfully","success"),S()):m("Failed to delete deal","error"),f(!1),I(null)}catch(e){console.error("Error deleting deal:",e),m("Failed to delete deal","error")}finally{P(!1)}},G=e=>{const a=e==null?void 0:e.property_deal,t=[];a!=null&&a.address_line_1&&(t==null||t.push(a==null?void 0:a.address_line_1)),a!=null&&a.address_line_2&&(t==null||t.push(a==null?void 0:a.address_line_2)),a!=null&&a.city&&(t==null||t.push(a==null?void 0:a.city)),a!=null&&a.post_code&&(t==null||t.push(a==null?void 0:a.post_code));const n=t.join(", "),o=120;return n.length>o?n.substring(0,o)+"...":n};y!=null&&y.data;const H=new Date().getFullYear();Array.from({length:4},(e,a)=>H-a);const J=()=>{const e=c.totalPages,a=c.currentPage;if(e<=5)return Array.from({length:e},(i,X)=>X+1);const t=[1];let n=Math.max(2,a-1),o=Math.min(e-1,a+1);a<=3?o=Math.min(4,e-1):a>=e-2&&(n=Math.max(e-3,2)),n>2&&t.push("...");for(let i=n;i<=o;i++)t.push(i);return o<e-1&&t.push("..."),e>1&&t.push(e),t},[g,x]=l.useState(null),[K,Q]=l.useState(!1),h=l.useRef(null),{user:_e,role:W}=D(e=>e.user);return l.useEffect(()=>{function e(a){h.current&&!h.current.contains(a.target)&&x(null)}if(g!==null&&h.current){const a=h.current.getBoundingClientRect(),t=window.innerHeight-a.bottom;Q(t<150)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[g]),s.jsxs("div",{className:"",children:[s.jsx(me,{isOpen:L,onClose:()=>f(!1),onConfirm:q,title:"Delete Deal",isLoading:R}),A||F?s.jsx(re,{}):s.jsx("div",{className:"",children:s.jsxs("table",{className:`${d.length<3?"overflow-dropdown-issue":""}  w-full text-left border-collapse`,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx("input",{type:"checkbox",onChange:e=>E(e.target.checked?d.map(a=>a.id):[]),checked:v.length===d.length&&d.length>0})}),s.jsx("th",{children:"PROPERTY ADDRESS"}),s.jsx("th",{children:"PROPERTY CATEGORY"}),s.jsx("th",{children:"SETUP FEE"}),s.jsx("th",{children:"RENT"}),s.jsx("th",{children:"ROI"}),s.jsx("th",{children:"DEAL CREATED"}),s.jsx("th",{children:"STATUS"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:d.length>0?d.map((e,a)=>{var n,o,i;const t=e.property_deal;return s.jsxs("tr",{className:"",children:[s.jsx("td",{className:"",children:a+1}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:G(t)})}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:k(t)||"No description"})}),s.jsx("td",{className:"",children:(n=t.property_deal_investment)!=null&&n.gross_domestic_value?`£${parseFloat(t.property_deal_investment.gross_domestic_value).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(o=t==null?void 0:t.property_deal_investment)!=null&&o.purchase_price?`£${parseFloat(t==null?void 0:t.property_deal_investment.purchase_price).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(i=t==null?void 0:t.property_deal_investment)!=null&&i.return_on_cash_investment_percentage?`${parseFloat(t==null?void 0:t.property_deal_investment.return_on_cash_investment_percentage).toFixed(2)}%`:"0%"}),s.jsx("td",{className:"",children:z(e.intrust_status)}),s.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),s.jsx("td",{className:"relative",children:s.jsxs("div",{id:`dropdown-${t.id}`,className:"flex justify-center relative",children:[s.jsx("button",{onClick:()=>x(g===t.id?null:t.id),className:"text-lg",children:s.jsx(ne,{className:"text-[#595959]"})}),s.jsx(xe,{children:g===t.id&&s.jsxs(fe.div,{ref:h,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:`absolute right-0 w-40 bg-white border rounded shadow-lg z-10 ${K?"bottom-full mb-2":"bottom-full mt-2"}`,children:[archive!=="archive"&&s.jsxs("button",{onClick:()=>{V(t),x(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-sm",children:[s.jsx(ge,{className:"mr-2"})," View"]}),W!=="team"&&s.jsxs("button",{onClick:()=>{B(t.id),x(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-sm text-red-600",children:[s.jsx(le,{className:"mr-2"})," Delete"]})]})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No shared deals available"})})})]})}),d.length>0&&s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm text-sm",children:["Showing ",c.from,"-",c.to," of ",c.total," ","deals"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:Y,className:"p-2 rounded-l-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:r.page<=1,children:s.jsx(oe,{size:14})}),s.jsx("div",{className:"flex space-x-2",children:J().map((e,a)=>e==="..."?s.jsx("span",{className:"p-2  bg-gray-700 text-white",children:"..."},`ellipsis-${a}`):s.jsx("button",{onClick:()=>U(e),className:`px-2 py-1 min-w-[40px]  text-center ${e===c.currentPage?"bg-[#6C5DD3] text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e},`page-${e}`))}),s.jsx("button",{onClick:$,className:"p-2 rounded-r-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!c.hasMorePages,children:s.jsx(ie,{size:14})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{value:r.per_page,onChange:e=>p({...r,per_page:parseInt(e.target.value),page:1}),className:"form-select",children:[s.jsx("option",{value:"10",children:"10 / 10"}),s.jsx("option",{value:"20",children:"20 / 20"}),s.jsx("option",{value:"50",children:"50 / 50"}),s.jsx("option",{value:"100",children:"100 / 100"})]})})]}),w&&s.jsx(ue,{isOpen:w,onClose:C,selectedDeals:v})]})};export{Ie as default};
