import{t as O,a2 as Y,s as $,q as G,u as g,r as l,cg as x,bE as H,m as e,c3 as W,bY as J,ak as K,p as Q,x as U,al as V,am as X,aq as Z,E as ee,bB as ae,aN as se,ch as te,ci as le,cj as re}from"./index-DNQPOinU.js";const oe=()=>{var _;const u=O(),n=Y(),c=$(),{showSnackbar:j}=G(),t=g(a=>a.deal.deal),f=g(a=>a.deal.currentStep),[A,h]=l.useState(!1),[L,E]=l.useState([]),[T,C]=l.useState(!1),[w,k]=l.useState(null),[y,N]=l.useState(!1),[F,I]=l.useState(null),[m,v]=l.useState([]),[ie,D]=l.useState(!1),[i,p]=l.useState("manual");g(a=>a.deal.comparableMode);const[ne,ce]=l.useState(!1),[d,M]=l.useState(null);l.useEffect(()=>{const a=async()=>{var s;try{const r=await ee(t==null?void 0:t.id);r&&r.data&&M((s=r.data.data)==null?void 0:s.deal)}catch{console.log("Failed to load deal details")}};t!=null&&t.id&&a()},[t]),l.useEffect(()=>{var a,s;(a=n==null?void 0:n.state)!=null&&a.radiusId&&I(n.state.radiusId),((s=n==null?void 0:n.state)==null?void 0:s.activesetDescriptionTabTab)==="aiDescription"&&(p("ai"),c(x("ai")))},[n.state]),l.useEffect(()=>{var a;(a=n==null?void 0:n.state)!=null&&a.activesetDescriptionTabTab||(d!=null&&d.is_ai_type?(p("ai"),c(x("ai"))):d!=null&&d.is_manual_type?(p("manual"),c(x("manual"))):(p("manual"),c(x("manual"))))},[d,(_=n.state)==null?void 0:_.activesetDescriptionTabTab]),l.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{try{h(!0);const s=await ae(t.id,{type:i});s&&s.data&&E(s.data.data.dealComparables||[])}catch{j("Failed to load comparables","error")}finally{h(!1)}})()},[t==null?void 0:t.id,i]);const B=async()=>{var a;try{h(!0);const s=await se(t==null?void 0:t.id,F,{type:i});v(((a=s==null?void 0:s.data)==null?void 0:a.dealComparables)||[])}catch(s){console.log(s,"error")}finally{h(!1)}};l.useEffect(()=>{i==="ai"&&B()},[i]);const R=async()=>{var s;const a=i==="manual"?"ai":"manual";try{const r=await re({property_deal_id:t==null?void 0:t.id,type:a});v((s=r==null?void 0:r.data)==null?void 0:s.dealComparables)}catch(r){console.log(r,"error")}};l.useEffect(()=>(c({type:"deal/setCurrentStep",payload:Math.max(f,4)}),()=>{f<4&&c(H(!1))}),[c,f]);const P=a=>{a&&(c(te(a)),u("/create-deal/comparables"))},q=a=>{k(a),C(!0)},S=()=>{C(!1),k(null),N(!1)},z=async()=>{var a,s,r;if(w)try{N(!0);const o=await le(w);j(((a=o==null?void 0:o.data)==null?void 0:a.message)||"Comparable deleted successfully","success"),S()}catch(o){j(((r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.error)||"Failed to delete the comparable. Please try again.","error")}finally{N(!1)}},b=i==="manual"?L||[]:(m==null?void 0:m.length)>0?m:(d==null?void 0:d.property_deal_comparables)||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"description-ai-description-tabs-wrap mb-5",children:[e.jsx("button",{className:`px-5 py-2 rounded-md description-tab transition ${i==="manual"?"bg-white text-black":"text-white"}`,onClick:()=>{p("manual"),c(x("manual")),D(!1)},children:"Manual"}),e.jsx("button",{className:`px-5 py-2 rounded-md ai-description-tab transition ${i==="ai"?"bg-white text-black":"text-white"}`,onClick:()=>{p("ai"),D(!0),c(x("ai"))},children:"AI"})]}),i==="manual"&&e.jsx(W,{className:"flex mb-5",to:"/create-deal/comparables",style:{marginLeft:"auto",width:"max-content"},children:e.jsx("button",{className:"purple-btn",style:{display:"flex"},children:"+ Add Comparable"})}),i==="ai"&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"This area only"}),e.jsx("option",{children:"Nearby areas"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"All years"}),e.jsx("option",{children:"2023"}),e.jsx("option",{children:"2024"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"All Property types"}),e.jsx("option",{children:"Flat"}),e.jsx("option",{children:"House"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"Listing"}),e.jsx("option",{children:"Sold"})]})]}),A?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})}):b.length===0?i==="ai"?e.jsx("p",{className:"text-center",children:"Loading AI comparables"}):e.jsx("p",{className:"text-center",children:"No manual comparables available"}):e.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#6C5DD3] text-white",children:[e.jsx("th",{className:"px-6 py-3",children:"Sl No"}),e.jsx("th",{className:"px-6 py-3",children:"Image"}),e.jsx("th",{className:"px-6 py-3",children:"No of Bedrooms"}),e.jsx("th",{className:"px-6 py-3",children:"Sold Price"}),e.jsx("th",{className:"px-6 py-3",children:"Year"}),e.jsx("th",{className:"px-6 py-3",children:"Within"}),e.jsx("th",{className:"px-6 py-3",children:"Links"}),i==="manual"&&e.jsx("th",{className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:b&&b.length>0?b.map((a,s)=>{var r;return e.jsxs("tr",{className:"border-b dark:border-gray-700 border-gray-200",children:[e.jsx("td",{className:"px-6 py-4",children:s+1}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"comparables-table-img-wrap",children:[e.jsx("img",{src:a.image_url,alt:"comparable image"}),e.jsx("span",{className:"comparables-table-img-icon-wrap",children:e.jsx(J,{})})]})}),e.jsx("td",{className:"px-6 py-4",children:a.no_of_bedroom||"-"}),e.jsxs("td",{className:"px-6 py-4",children:["Â£",parseFloat(a.price).toLocaleString()||"-"]}),e.jsx("td",{className:"px-6 py-4",children:a.year||"-"}),e.jsx("td",{className:"px-6 py-4",children:((r=a.property_radius)==null?void 0:r.title)||a.property_radius_id||"-"}),e.jsx("td",{className:"px-6 py-4",children:a!=null&&a.link||a!=null&&a.url?e.jsxs("div",{className:"relative group inline-block",children:[e.jsx("span",{className:"text-blue-600 cursor-pointer",children:"Link"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block bg-black text-white text-sm px-3 py-1 rounded whitespace-nowrap z-10",children:[a==null?void 0:a.link,(a==null?void 0:a.linked_search_url)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),a==null?void 0:a.linked_search_url]})]})]}):"-"}),i==="manual"&&e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-lg",onClick:()=>P(a==null?void 0:a.id),children:e.jsx(K,{})}),e.jsx("button",{className:"",onClick:()=>q(a==null?void 0:a.id),children:e.jsx(Q,{})})]})})]},a.id||s)}):e.jsx("tr",{className:"border-b dark:border-gray-700 border-gray-200",children:e.jsx("td",{colSpan:"9",className:"px-6 py-4 text-center",children:"No comparables available"})})})]})})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#222632] rounded-lg p-6 w-96",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Confirm Delete"}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this comparable? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{className:"px-4 py-2 border rounded-md",onClick:S,disabled:y,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-red-500 text-white rounded-md flex items-center",onClick:z,disabled:y,children:y?e.jsx(e.Fragment,{children:e.jsx(U,{})}):"Confirm"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-10",children:[e.jsxs("button",{onClick:()=>u("/create-deal/description"),className:"w-fit items-center gap-5 justify-center flex",children:[e.jsx(V,{}),"Back"]}),e.jsxs("button",{onClick:()=>{c(Z(!0)),R(),c(x(i)),u("/create-deal/summary")},className:"w-fit purple-btn items-center gap-5 justify-center",style:{display:"flex"},children:["Next",e.jsx(X,{})]})]})]})};export{oe as default};
