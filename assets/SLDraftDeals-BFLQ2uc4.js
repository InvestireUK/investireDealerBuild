import{a8 as ae,t as re,r as c,u as f,q as le,a7 as ne,s as ce,m as s,x as oe,ak as ie,p as de,al as pe,am as he,A as me,aa as ue,C as ge,E as xe,ab as fe,N as je,O as ye}from"./index-BRKTU8Xq.js";import{S as _e}from"./SendContactDealModal-DYRVYEzI.js";import{D as Ne}from"./DeleteConfirmationModal-zrYAEVWx.js";import"./lodash-D-tg8sYf.js";const Se=()=>{const{slug:b}=ae(),M=re(),[d,T]=c.useState([]);f(e=>e.deal.currentStep),f(e=>e.deal.draftDeals);const u=f(e=>e.deal.dealsTypes);f(e=>e.deal.dealFilters);const[j,y]=c.useState([]),{showSnackbar:m}=le(),[v,O]=c.useState(!1),[L,g]=c.useState(!1),[A,_]=c.useState(!1),[w,P]=c.useState(null),[E,S]=c.useState(!1),[n,$]=c.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[a,p]=c.useState({per_page:10,page:1,status:"draft",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc"});c.useEffect(()=>{var r;const e=(r=u==null?void 0:u.deal_types)==null?void 0:r.find(l=>l.slug===b),t=(e==null?void 0:e.id)??null;p(l=>({...l,dealTypeId:t,page:1}))},[b,u]);const{data:N,loading:R}=ne(ue),D=ce(),I=async()=>{try{g(!0);const e=await me({page:a.page,perPage:a.per_page,status:a.status===""?null:a.status,year:a.year===""?null:a.year,propertyTypeId:a.propertyTypeId===""?null:a.propertyTypeId,dealTypeId:a.dealTypeId,sortColumn:a.sortColumn,sortOrder:a.sortOrder});if(e&&e.data){T(e.data.data.deals||[]);const t=e.data.data.page_context;t&&$({currentPage:parseInt(t==null?void 0:t.page)||1,totalPages:Math.ceil(parseInt((t==null?void 0:t.total_records)||0)/parseInt((t==null?void 0:t.per_page)||10)),from:(parseInt(t.page)-1)*parseInt(t.per_page)+1,to:Math.min(parseInt(t==null?void 0:t.page)*parseInt(t==null?void 0:t.per_page),parseInt((t==null?void 0:t.total_records)||0)),total:parseInt((t==null?void 0:t.total_records)||0),hasMorePages:(t==null?void 0:t.has_more_page)==="true"})}}catch{m("Failed to fetch deals. Please try again.","error")}finally{g(!1)}};c.useEffect(()=>{a.dealTypeId&&I()},[a]);const B=e=>{y(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},Y=()=>{O(!1)},k=e=>{const{name:t,value:r}=e.target;p({...a,[t]:r,page:1})},z=e=>{p(t=>({...t,sortColumn:e,sortOrder:t.sortColumn===e&&t.sortOrder==="asc"?"desc":"asc",page:1}))},G=()=>{n.hasMorePages&&p(e=>({...e,page:e.page+1}))},q=()=>{a.page>1&&p(e=>({...e,page:e.page-1}))},V=e=>{e>=1&&e<=n.totalPages&&p(t=>({...t,page:e}))},W=e=>{P(e),_(!0)},H=async()=>{if(w)try{S(!0);const e=await ge(w);e&&e.data?(m("Deal deleted successfully","success"),I()):m("Failed to delete deal","error"),_(!1),P(null)}catch(e){console.error("Error deleting deal:",e),m("Failed to delete deal","error")}finally{S(!1)}},J=e=>{const t=[];e.address_line_1&&t.push(e.address_line_1),e.address_line_2&&t.push(e.address_line_2),e.city&&t.push(e.city),e.post_code&&t.push(e.post_code);const r=t.join(", "),l=120;return r.length>l?r.substring(0,l)+"...":r},K=(N==null?void 0:N.data)||{property_types:[]},Q=new Date().getFullYear(),U=Array.from({length:4},(e,t)=>Q-t),X=()=>{const e=n.totalPages,t=n.currentPage;if(e<=5)return Array.from({length:e},(h,x)=>x+1);const r=[1];let l=Math.max(2,t-1),i=Math.min(e-1,t+1);t<=3?i=Math.min(4,e-1):t>=e-2&&(l=Math.max(e-3,2)),l>2&&r.push("...");for(let h=l;h<=i;h++)r.push(h);return i<e-1&&r.push("..."),e>1&&r.push(e),r},Z=async e=>{var t,r,l,i,h,x;if(e)try{g(!0);const o=await xe(e);D(fe());const C=((t=o==null?void 0:o.data)==null?void 0:t.data)||{},ee=C.propertyDealSaInvestment||C.propertyDealInvestment||{},{id:De,...se}=ee||{},F=((i=(l=(r=o==null?void 0:o.data)==null?void 0:r.data)==null?void 0:l.deal)==null?void 0:i.step_completed)||1,te={...(x=(h=o==null?void 0:o.data)==null?void 0:h.data)==null?void 0:x.deal,...se,step:F};D(je(te)),D(ye(F)),M("/create-deal/address?mode=edit")}catch{m("Failed to edit deal. Please try again.","error")}finally{g(!1)}};return s.jsxs("div",{className:"overflow-x-auto p-4",children:[s.jsx(Ne,{isOpen:A,onClose:()=>_(!1),onConfirm:H,title:"Delete Deal",isLoading:E}),s.jsx("div",{className:"flex justify-between items-center mb-5",children:s.jsx("h1",{className:"text-3xl font-semibold text-dark dark:text-white",children:"Our Draft Deals"})}),s.jsxs("div",{className:"grid lg:grid-cols-4 md:grid-cols-2 gap-4 mb-4",children:[s.jsxs("select",{name:"year",value:a.year,onChange:k,className:"form-select",children:[s.jsx("option",{value:"",children:"All Years"}),U.map(e=>s.jsx("option",{value:e.toString(),children:e},e))]}),s.jsxs("select",{name:"propertyTypeId",value:a.propertyTypeId,onChange:k,className:"form-select",children:[s.jsx("option",{value:"",children:"All Property Types"}),K.property_types.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]})]}),L||R?s.jsx(oe,{}):s.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-[#6C5DD3] text-white",children:[s.jsx("th",{className:"",children:s.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?y(d.map(t=>t.id)):y([])},checked:j.length===d.length&&d.length>0})}),s.jsx("th",{className:"",children:"Sl No"}),s.jsx("th",{className:"",children:"Property Address"}),s.jsx("th",{className:"",children:"Description"}),s.jsx("th",{className:"",children:"GDV"}),s.jsx("th",{className:"",children:"Purchase Price"}),s.jsx("th",{className:"",children:"ROI"}),s.jsx("th",{className:"",children:"Status"}),s.jsxs("th",{className:"cursor-pointer",onClick:()=>z("created_at"),children:["Created Date",a.sortColumn==="created_at"&&s.jsx("span",{className:"ml-1",children:a.sortOrder==="asc"?"↑":"↓"})]}),s.jsx("th",{className:"",children:"Actions"})]})}),s.jsx("tbody",{children:d.length>0?d==null?void 0:d.filter(e=>(e==null?void 0:e.deal_type_id)===3&&(e==null?void 0:e.status)==="draft").map((e,t)=>{var r,l,i;return s.jsxs("tr",{className:"",children:[s.jsx("td",{className:"",children:s.jsx("input",{type:"checkbox",checked:j.includes(e.id),onChange:()=>B(e.id)})}),s.jsx("td",{className:"",children:n.from+t}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:J(e)})}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:e.description||"No description"})}),s.jsx("td",{className:"",children:(r=e.property_deal_investment)!=null&&r.gross_domestic_value?`£${parseFloat(e.property_deal_investment.gross_domestic_value).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(l=e==null?void 0:e.property_deal_investment)!=null&&l.purchase_price?`£${parseFloat(e==null?void 0:e.property_deal_investment.purchase_price).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(i=e==null?void 0:e.property_deal_investment)!=null&&i.return_on_cash_investment_percentage?`${parseFloat(e==null?void 0:e.property_deal_investment.return_on_cash_investment_percentage).toFixed(2)}%`:"0%"}),s.jsx("td",{className:"",children:s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e.status==="publish"?"bg-green-500 text-white":"bg-gray-500 text-white"}`,children:e.status==="publish"?"Published":"Draft"})}),s.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),s.jsx("td",{className:"",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>Z(e.id),className:"text-lg",children:s.jsx(ie,{})}),s.jsx("button",{onClick:()=>W(e.id),className:"text-lg",children:s.jsx(de,{})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No deals available"})})})]})}),n.total>0&&s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm",children:["Showing ",n.from,"-",n.to," of ",n.total," ","deals"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:q,className:"p-2 rounded-l-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:a.page<=1,children:s.jsx(pe,{size:14})}),s.jsx("div",{className:"flex space-x-2",children:X().map((e,t)=>e==="..."?s.jsx("span",{className:"p-2  bg-gray-700 text-white",children:"..."},`ellipsis-${t}`):s.jsx("button",{onClick:()=>V(e),className:`px-2 py-1 min-w-[40px]  text-center ${e===n.currentPage?"bg-[#6C5DD3] text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e},`page-${e}`))}),s.jsx("button",{onClick:G,className:"p-2 rounded-r-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n.hasMorePages,children:s.jsx(he,{size:14})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{value:a.per_page,onChange:e=>p({...a,per_page:parseInt(e.target.value),page:1}),className:"form-select",children:[s.jsx("option",{value:"10",children:"10 / 10"}),s.jsx("option",{value:"20",children:"20 / 20"}),s.jsx("option",{value:"50",children:"50 / 50"}),s.jsx("option",{value:"100",children:"100 / 100"})]})})]}),v&&s.jsx(_e,{isOpen:v,onClose:Y,selectedDeals:j})]})};export{Se as default};
