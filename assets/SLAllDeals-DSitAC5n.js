import{r as i,a7 as ce,t as de,u as S,q as oe,a6 as he,s as pe,m as s,af as me,a3 as xe,ag as ue,a4 as ge,ah as je,x as fe,ai as Ne,aj as ye,p as be,ak as ve,al as _e,A as De,a9 as Se,C as we,E as Pe,aa as Ie,N as Ce,O as ke}from"./index-iRB_0ci3.js";import{S as Te}from"./SendContactDealModal-Dva2yDbg.js";import{D as Me}from"./DeleteConfirmationModal-BSQMlgow.js";import"./lodash-BLzwDM3w.js";const $e=()=>{const[m,y]=i.useState("Service-accommodation"),{slug:w}=ce(),u=de(),[o,E]=i.useState([]);S(e=>e.deal.currentStep),S(e=>e.deal.dealFilters);const g=S(e=>e.deal.dealsTypes),[j,b]=i.useState([]),{showSnackbar:x}=oe(),[P,I]=i.useState(!1),[L,f]=i.useState(!1),[$,v]=i.useState(!1),[C,k]=i.useState(null),[B,T]=i.useState(!1),[n,H]=i.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1});i.useEffect(()=>{var t;const e=(t=g==null?void 0:g.deal_types)==null?void 0:t.find(r=>r.slug===w),a=(e==null?void 0:e.id)??null;h(r=>({...r,dealTypeId:a,page:1}))},[w,g]);const[l,h]=i.useState({per_page:10,page:1,status:"publish",year:"",propertyTypeId:"",dealTypeId:"",sortColumn:"created_at",sortOrder:"desc"}),{data:_,loading:R}=he(Se),D=pe(),M=async()=>{try{f(!0);const e=await De({page:l.page,perPage:l.per_page,status:l.status===""?null:l.status,year:l.year===""?null:l.year,propertyTypeId:l.propertyTypeId===""?null:l.propertyTypeId,dealTypeId:l.dealTypeId,sortColumn:l.sortColumn,sortOrder:l.sortOrder});if(e&&e.data){E(e.data.data.deals||[]);const a=e.data.data.page_context;a&&H({currentPage:parseInt(a==null?void 0:a.page)||1,totalPages:Math.ceil(parseInt((a==null?void 0:a.total_records)||0)/parseInt((a==null?void 0:a.per_page)||10)),from:(parseInt(a.page)-1)*parseInt(a.per_page)+1,to:Math.min(parseInt(a==null?void 0:a.page)*parseInt(a==null?void 0:a.per_page),parseInt((a==null?void 0:a.total_records)||0)),total:parseInt((a==null?void 0:a.total_records)||0),hasMorePages:(a==null?void 0:a.has_more_page)==="true"})}}catch{x("Failed to fetch deals. Please try again.","error")}finally{f(!1)}},G=e=>{var a,t;return e?e.description_type==="ai"?((a=e.description_ai)==null?void 0:a.trim())||"No AI description available":((t=e.description)==null?void 0:t.trim())||"No description available":"No description available"};i.useEffect(()=>{l.dealTypeId&&M()},[l]);const Y=e=>{b(a=>a.includes(e)?a.filter(t=>t!==e):[...a,e])},z=()=>{if(j.length===0){x("Please select at least one deal.","error");return}I(!0)},V=()=>{I(!1)},F=e=>{const{name:a,value:t}=e.target;h({...l,[a]:t,page:1})},q=e=>{h(a=>({...a,sortColumn:e,sortOrder:a.sortColumn===e&&a.sortOrder==="asc"?"desc":"asc",page:1}))},U=()=>{n.hasMorePages&&h(e=>({...e,page:e.page+1}))},W=()=>{l.page>1&&h(e=>({...e,page:e.page-1}))},J=e=>{e>=1&&e<=n.totalPages&&h(a=>({...a,page:e}))},K=e=>{e.deal_type_id==2?u(`/deal-view-sa/${e.id}`):u(`/deal-view/${e.id}`)},Q=e=>{k(e),v(!0)},X=async()=>{if(C)try{T(!0);const e=await we(C);e&&e.data?(x("Deal deleted successfully","success"),M()):x("Failed to delete deal","error"),v(!1),k(null)}catch(e){console.error("Error deleting deal:",e),x("Failed to delete deal","error")}finally{T(!1)}},Z=e=>{const a=[];e.address_line_1&&a.push(e.address_line_1),e.address_line_2&&a.push(e.address_line_2),e.city&&a.push(e.city),e.post_code&&a.push(e.post_code);const t=a.join(", "),r=120;return t.length>r?t.substring(0,r)+"...":t},ee=(_==null?void 0:_.data)||{property_types:[]},se=new Date().getFullYear(),ae=Array.from({length:4},(e,a)=>se-a),te=()=>{const e=n.totalPages,a=n.currentPage;if(e<=5)return Array.from({length:e},(p,N)=>N+1);const t=[1];let r=Math.max(2,a-1),d=Math.min(e-1,a+1);a<=3?d=Math.min(4,e-1):a>=e-2&&(r=Math.max(e-3,2)),r>2&&t.push("...");for(let p=r;p<=d;p++)t.push(p);return d<e-1&&t.push("..."),e>1&&t.push(e),t},le=async e=>{var a,t,r,d,p,N;if(e)try{f(!0);const c=await Pe(e);D(Ie());const O=((a=c==null?void 0:c.data)==null?void 0:a.data)||{},re=O.propertyDealSaInvestment||O.propertyDealInvestment||{},{id:Fe,...ie}=re||{},A=((d=(r=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:r.deal)==null?void 0:d.step_completed)||1,ne={...(N=(p=c==null?void 0:c.data)==null?void 0:p.data)==null?void 0:N.deal,...ie,step:A};D(Ce(ne)),D(ke(A)),u("/create-deal/address?mode=edit")}catch{x("Failed to edit deal. Please try again.","error")}finally{f(!1)}};return s.jsxs("div",{className:"overflow-x-auto p-4",children:[s.jsx(Me,{isOpen:$,onClose:()=>v(!1),onConfirm:X,title:"Delete Deal",isLoading:B}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-3xl font-semibold text-dark dark:text-white",children:"Our Deals SINGLE LET"}),s.jsxs("button",{onClick:z,className:"purple-btn items-center gap-2",style:{display:"flex"},children:["Send Deals",s.jsx(me,{className:"text-lg"})]})]}),s.jsxs("div",{className:"deals-assets-grid-wrap my-10",children:[s.jsxs("div",{className:"deals-assets-grid-col",children:[s.jsxs("div",{className:"flex justify-between deals-assets-heading mb-7",children:[s.jsx("p",{className:"text-[#595959] font-medium",children:"Total deals"}),s.jsx("span",{children:s.jsx(xe,{className:"text-lg text-[#595959]"})})]}),s.jsx("h2",{className:"font-medium text-[#242424] total-deals-assets",children:"7"})]}),s.jsxs("div",{className:"deals-assets-grid-col cursor-pointer",onClick:()=>u("/draft-deals"),children:[s.jsxs("div",{className:"flex justify-between deals-assets-heading mb-7",children:[s.jsx("p",{className:"text-[#595959] font-medium",children:"Draft deals"}),s.jsx("span",{children:s.jsx(ue,{className:"text-2xl text-[#595959]"})})]}),s.jsx("h2",{className:"font-medium text-[#242424] total-deals-assets",children:"1"})]}),s.jsxs("div",{className:"deals-assets-grid-col cursor-pointer",onClick:()=>u("/publish-deals"),children:[s.jsxs("div",{className:"flex justify-between deals-assets-heading mb-7",children:[s.jsx("p",{className:"text-[#595959] font-medium",children:"Published deals"}),s.jsx("span",{children:s.jsx(ge,{className:"text-2xl text-[#595959]"})})]}),s.jsx("h2",{className:"font-medium text-[#242424] total-deals-assets",children:"4"})]}),s.jsxs("div",{className:"deals-assets-grid-col",children:[s.jsxs("div",{className:"flex justify-between deals-assets-heading mb-7",children:[s.jsx("p",{className:"text-[#595959] font-medium",children:"Archived deals"}),s.jsx("span",{children:s.jsx(je,{className:"text-2xl text-[#595959]"})})]}),s.jsx("h2",{className:"font-medium text-[#242424] total-deals-assets",children:"2"})]})]}),s.jsx("h3",{className:"light-black font-medium mb-4",children:"Total deals"}),s.jsxs("div",{className:"",children:[s.jsxs("ul",{className:"inline-flex flex-wrap deal-types-tabs-wrap gap-6",children:[s.jsx("li",{className:"",children:s.jsx("button",{onClick:()=>y("Service-accommodation"),className:`tab-btn ${m==="Service-accommodation"?"active":""}`,children:"Service accommodation (SA)"})}),s.jsx("li",{className:"",children:s.jsx("button",{onClick:()=>y("HMO-tab"),className:`tab-btn ${m==="HMO-tab"?"active":""}`,children:"House in multiple occupation(HMO)"})}),s.jsx("li",{className:"",children:s.jsx("button",{onClick:()=>y("Single-let"),className:`tab-btn ${m==="Single-let"?"active":""}`,children:"Single let"})})]}),s.jsxs("div",{className:"mt-4",children:[m==="Service-accommodation"&&s.jsx("div",{children:"Tab 1 Content"}),m==="HMO-tab"&&s.jsx("div",{children:"Tab 2 Content"}),m==="Single-let"&&s.jsx("div",{children:"Tab 3 Content"})]})]}),s.jsxs("div",{className:"total-deal-table-wrapper",children:[s.jsxs("div",{className:"grid lg:grid-cols-4 md:grid-cols-2 gap-4 total-deal-filter-wrapper",children:[s.jsxs("select",{name:"year",value:l.year,onChange:F,className:"form-select",children:[s.jsx("option",{value:"",children:"All Years"}),ae.map(e=>s.jsx("option",{value:e.toString(),children:e},e))]}),s.jsxs("select",{name:"propertyTypeId",value:l.propertyTypeId,onChange:F,className:"form-select",children:[s.jsx("option",{value:"",children:"All Property Types"}),ee.property_types.map(e=>s.jsx("option",{value:e.id,children:e.title},e.id))]})]}),L||R?s.jsx(fe,{}):s.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"",children:[s.jsx("th",{className:"",children:s.jsx("input",{type:"checkbox",onChange:e=>{e.target.checked?b(o.map(a=>a.id)):b([])},checked:j.length===o.length&&o.length>0})}),s.jsx("th",{className:"",children:"Sl No"}),s.jsx("th",{className:"",children:"Property Address"}),s.jsx("th",{className:"",children:"Description"}),s.jsx("th",{className:"",children:"GDV"}),s.jsx("th",{className:"",children:"Purchase Price"}),s.jsx("th",{className:"",children:"ROI"}),s.jsx("th",{className:"",children:"Status"}),s.jsxs("th",{className:"cursor-pointer",onClick:()=>q("created_at"),children:["Created Date",l.sortColumn==="created_at"&&s.jsx("span",{className:"ml-1",children:l.sortOrder==="asc"?"↑":"↓"})]}),s.jsx("th",{className:"",children:"Actions"})]})}),s.jsx("tbody",{children:o.length>0?o==null?void 0:o.filter(e=>(e==null?void 0:e.deal_type_id)==3).map((e,a)=>{var t,r,d;return s.jsxs("tr",{className:"",children:[s.jsx("td",{className:"",children:s.jsx("input",{type:"checkbox",checked:j.includes(e.id),onChange:()=>Y(e.id)})}),s.jsx("td",{className:"",children:n.from+a}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:Z(e)})}),s.jsx("td",{className:"",children:s.jsx("div",{className:"line-clamp-3 max-w-[200px] overflow-hidden text-ellipsis",children:G(e)||"No description"})}),s.jsx("td",{className:"",children:(t=e.property_deal_investment)!=null&&t.gross_domestic_value?`£${parseFloat(e.property_deal_investment.gross_domestic_value).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(r=e==null?void 0:e.property_deal_investment)!=null&&r.purchase_price?`£${parseFloat(e==null?void 0:e.property_deal_investment.purchase_price).toLocaleString()}`:"0"}),s.jsx("td",{className:"",children:(d=e==null?void 0:e.property_deal_investment)!=null&&d.return_on_cash_investment_percentage?`${parseFloat(e==null?void 0:e.property_deal_investment.return_on_cash_investment_percentage).toFixed(2)}%`:"0%"}),s.jsx("td",{className:"",children:s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e.status==="publish"?"bg-green-500 text-white":"bg-gray-500 text-white"}`,children:e.status==="publish"?"Published":"Draft"})}),s.jsx("td",{className:"",children:e.created_at?new Date(e.created_at).toLocaleDateString():"-"}),s.jsx("td",{className:"",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>K(e),className:"text-lg",children:s.jsx(Ne,{})}),s.jsx("button",{onClick:()=>le(e.id),className:"text-lg",children:s.jsx(ye,{})}),s.jsx("button",{onClick:()=>Q(e.id),className:"text-lg",children:s.jsx(be,{})})]})})]},e.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:"10",className:"text-center p-4",children:"No deals available"})})})]})})]}),n.total>0&&s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mt-6 gap-4",children:[s.jsxs("div",{className:"dark:text-white  text-[#323130] text-sm",children:["Showing ",n.from,"-",n.to," of ",n.total," ","deals"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:W,className:"p-2 rounded-l-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:l.page<=1,children:s.jsx(ve,{size:14})}),s.jsx("div",{className:"flex space-x-2",children:te().map((e,a)=>e==="..."?s.jsx("span",{className:"p-2  bg-gray-700 text-white",children:"..."},`ellipsis-${a}`):s.jsx("button",{onClick:()=>J(e),className:`px-2 py-1 min-w-[40px]  text-center ${e===n.currentPage?"bg-[#6C5DD3] text-white":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e},`page-${e}`))}),s.jsx("button",{onClick:U,className:"p-2 rounded-r-md bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n.hasMorePages,children:s.jsx(_e,{size:14})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("select",{value:l.per_page,onChange:e=>h({...l,per_page:parseInt(e.target.value),page:1}),className:"form-select",children:[s.jsx("option",{value:"10",children:"10 / 10"}),s.jsx("option",{value:"20",children:"20 / 20"}),s.jsx("option",{value:"50",children:"50 / 50"}),s.jsx("option",{value:"100",children:"100 / 100"})]})})]}),P&&s.jsx(Te,{isOpen:P,onClose:V,selectedDeals:j})]})};export{$e as default};
