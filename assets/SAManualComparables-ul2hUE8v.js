import{V as ve,u as _,a8 as P,aJ as Ne,aK as ye,av as we,r as t,v as Se,w as Ce,cf as ke,m as e,cg as U,ax as qe,at as De,az as Re,ch as Ae}from"./index-DmRGzlRm.js";import{D as Ie}from"./DragAndDrop-CiFqoi8O.js";import{M as Fe}from"./ModifiedAutoAddressInput-Cs3V8lyF.js";const as=({onClose:h,handleCloseManualComparable:T,handleFinishSAManualComparable:O})=>{const{register:c,handleSubmit:V,reset:Ee,setValue:o,watch:v,control:z,clearErrors:p,formState:{errors:l}}=ve({mode:"onChange"}),B=new Date().getFullYear();Array.from(new Array(B-2021),(s,a)=>2022+a);const{user:G,role:Me}=_(s=>s.user),{data:j,loading:W}=P(Ne),{property_types:J,property_radiuses:Le}=(j==null?void 0:j.data)||{},$={property_types:J},[Pe,Ue]=ye.useState([]),{loading:Y}=we(),[Te,Oe]=t.useState("description");v("property_type_id");const r=_(s=>{var a;return(a=s==null?void 0:s.deal)==null?void 0:a.deal}),[H,K]=t.useState(!1),[m,N]=t.useState(null),Q=Se(),[x,y]=t.useState(null),[w,S]=t.useState([null,null]),[Ve,ze]=t.useState(!1),[Be,X]=t.useState(!1);Ce();const[Ge,C]=t.useState(!1),[We,k]=t.useState(null),[Je,q]=t.useState(null),{comparableDealId:Z}=_(s=>s==null?void 0:s.deal),[ee,se]=t.useState([null,null]),[ae,le]=t.useState(),[re,te]=t.useState();P(ke,Z||null,r==null?void 0:r.deal_type_id);const ne=s=>{const a=parseFloat(s.replace(/[^0-9.]/g,""));return isNaN(a)?"":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(a)},g=v("price");t.useEffect(()=>{if(g&&!g.includes("$")){const s=ne(g);o("price",s)}},[g,o]),t.useEffect(()=>{r!=null&&r.property_type_id&&o("property_type_id",String(r.property_type_id))},[r==null?void 0:r.property_type_id,o]),t.useEffect(()=>{r&&(r.no_of_dwelling!=null&&o("no_of_dwelling",Number(r.no_of_dwelling)),r.no_of_dwelling!=null&&o("no_of_bedroom",Number(r.no_of_dwelling)))},[r,o]);const ie=s=>{let a={...s};a.price=parseFloat(String(s.price).replace(/[^0-9.]/g,"")),a.size_in_sqm=parseFloat(String(s.size_in_sqm).replace(/[^0-9.]/g,"")),a.no_of_bedroom=(r==null?void 0:r.deal_type_id)===2?a.no_of_dwelling:a.no_of_bedroom,delete a.no_of_dwelling;const i={...a,type:"manual",user_id:G.id,id:Date.now(),property_deal_id:r==null?void 0:r.id,image_url:x||"",title:s.title||"Untitled Property",lng:re,lat:ae};O(),T(),Q(Ae(i)),h()},D=t.useRef(null);t.useRef(null);const oe=()=>D.current.click(),de=(s,a)=>{const i=[...w];i[a]=URL.createObjectURL(s),S(i);const d=[...ee];d[a]=s,se(d)},ce=s=>new Promise((a,i)=>{const d=new FileReader;d.readAsDataURL(s),d.onload=()=>a(d.result),d.onerror=u=>i(u)}),me=async s=>{const a=s.target.files;if(a&&a.length>0){const i=a[0],d=await ce(i);y(d),C(!0),m&&m.startsWith("blob:")&&URL.revokeObjectURL(m);const u=i.type.split("/")[0];k(u);const b=URL.createObjectURL(i);N(b),X(!1),q(null)}else R()},R=()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),y(null),N(null),k(null),C(!0),q(null)},ue={entire_home:"Entire home",private_room:"Private room",shared_room:"Shared room"},[$e,pe]=t.useState(!1),[Ye,xe]=t.useState(!1),[He,fe]=t.useState(""),[Ke,ge]=t.useState(!1),[Qe,be]=t.useState(null),[Xe,he]=t.useState(null),je=s=>{var F,E,M,L;if(le((E=(F=s==null?void 0:s.geometry)==null?void 0:F.location)==null?void 0:E.lat),te((L=(M=s==null?void 0:s.geometry)==null?void 0:M.location)==null?void 0:L.lng),!s||!s.address_components)return;pe(!1),xe(!1),ge(!1),fe(""),he(null),be(null);const a=[...w];a[0]&&!(r!=null&&r.map_image)&&(a[0]=null,S(a));const i=s.address_components,d=i.find(n=>n.types.includes("postal_code"));i.find(n=>n.types.includes("administrative_area_level_1"));const u=i.find(n=>n.types.includes("street_number")),b=i.find(n=>n.types.includes("administrative_area_level_2")),A=i.find(n=>n.types.includes("route")),I=i.find(n=>n.types.includes("locality")||n.types.includes("postal_town")||n.types.includes("administrative_area_level_2"));if(u&&A){const n=`${u.long_name} ${A.long_name}`;o("manual_address",n)}else if(s.formatted_address){const n=s.formatted_address.split(",").map(f=>f.trim());if(n.length>0){const f=n[0];o("manual_address",f)}}if(I)o("address_line_2",I.long_name),p("address_line_2");else if(s.formatted_address){const n=s.formatted_address.split(",").map(f=>f.trim());n.length>1&&(o("address_line_2",n[1]),p("address_line_2"))}d&&(o("post_code",d.long_name),p("post_code")),b&&(o("city",b.long_name),p("city")),countryMatch&&(o("country_id",countryMatch.id),p("country_id"))},_e=s=>{if(!s||typeof s!="string")return!1;const a=["rd","road","st","street","ln","lane","ave","avenue","blvd","boulevard","ct","court","dr","drive","pl","place","sq","square","way","terrace","ter"],i=s.toLowerCase().split(" "),d=i[i.length-1];return a.includes(d)||d.endsWith(".")&&a.includes(d.slice(0,-1))?(o("manual_address",s),!0):!1};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-5xl relative mx-5",children:[e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:h,children:"âœ•"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Enter details of property"})]}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto rounded-xl",children:[Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsx("div",{children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),e.jsxs("div",{className:"create-comparables-form-wrap",children:[W?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsxs("form",{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Title"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"string",...c("title",{required:"Title is required"}),className:"form-control focus:outline-none"})}),l.title&&e.jsx("p",{className:"text-red-500 text-sm",children:l.title.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"No. of bedrooms"}),e.jsx("div",{children:e.jsx("input",{type:"number",min:0,...c("no_of_bedrooms",{required:"No. of bedrooms is required",min:{value:0,message:"No. of bedrooms cannot be negative"}}),className:"form-control focus:outline-none"})}),l.no_of_bedrooms&&e.jsx("p",{className:"text-red-500 text-sm",children:l.no_of_bedrooms.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"No. of bathrooms"}),e.jsx("div",{children:e.jsx("input",{type:"number",min:0,...c("no_of_bathroom",{required:"No. of bathroom is required",min:{value:0,message:"No. of bathrooms cannot be negative"}}),className:"form-control focus:outline-none"})}),l.no_of_bathrooms&&e.jsx("p",{className:"text-red-500 text-sm",children:l.no_of_bathrooms.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"No. of beds"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("beds",{required:"No. of beds is required",min:{value:0,message:"beds canott be negative"}}),className:"form-control focus:outline-none"})}),l.beds&&e.jsx("p",{className:"text-red-500 text-sm",children:l.beds.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Distance (in miles)"}),e.jsx("div",{children:e.jsx("input",{type:"number",min:0,...c("distance_meters",{required:"Distance is required",min:{value:0,message:"Distance cannot be negative"}}),className:"form-control focus:outline-none"})}),l.distance_meters&&e.jsx("p",{className:"text-red-500 text-sm",children:l.distance_meters.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:U.fields.property_type_id}),e.jsxs("select",{...c("property_type_id",{required:"Property type is required"}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Type"}),$.property_types.map(s=>e.jsx("option",{value:String(s==null?void 0:s.id),children:s==null?void 0:s.title},s==null?void 0:s.id))]}),l.property_type_id&&e.jsx("p",{className:"text-red-500 text-sm",children:l.property_type_id.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Days Available"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("days_available",{required:"Days Available is required",min:{value:0,message:"Days Available cannot be negative"}}),className:"form-control focus:outline-none"})}),l.days_available&&e.jsx("p",{className:"text-red-500 text-sm",children:l.days_available.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Occupancy"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("occupancy",{required:"Occupancy is required",min:{value:0,message:"Occupancy cannot be negative"}}),className:"form-control focus:outline-none"})}),l.occupancy&&e.jsx("p",{className:"text-red-500 text-sm",children:l.occupancy.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Rating"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("rating",{required:"Ratings is required",min:{value:0,message:" Rating cannot be negative"}}),className:"form-control focus:outline-none"})}),l.rating&&e.jsx("p",{className:"text-red-500 text-sm",children:l.rating.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Reviews"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("reviews",{required:"reviews is required",min:{value:0,message:"Reviews cannot be negative"}}),className:"form-control focus:outline-none"})}),l.reviews&&e.jsx("p",{className:"text-red-500 text-sm",children:l.reviews.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Revenue"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("revenue",{required:"Revenue is required",min:{value:0,message:" Revenue cannot be negative"}}),className:"form-control focus:outline-none"})}),l.revenue&&e.jsx("p",{className:"text-red-500 text-sm",children:l.revenue.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"ADR"}),e.jsx("div",{className:"",children:e.jsx("input",{type:"number",min:0,...c("adr",{required:"ADR is required",min:{value:0,message:"ADR canott be negative"}}),className:"form-control focus:outline-none"})}),l.adr&&e.jsx("p",{className:"text-red-500 text-sm",children:l.adr.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-10",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"manual_address",className:"block font-semibold light-black mb-2",children:"Address"}),e.jsx(qe,{name:"manual_address",control:z,defaultValue:"",rules:{required:"Address is required"},render:({field:s})=>e.jsx(Fe,{id:"manual_address",placeholder:"Enter an Address",value:s.value,onChange:a=>{s.onChange(a),_e(a)},onPlaceSelected:je,className:"form-control focus:outline-none"})}),l.manual_address&&e.jsx("p",{className:"text-red-500 text-sm",children:l.manual_address.message})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block form-label",children:"Type of Room"}),e.jsx("div",{children:e.jsxs("select",{...c("type_of_space",{required:"Type of space is required"}),className:"form-select focus:outline-none",children:[e.jsx("option",{value:"",children:"Select Option"}),Object.entries(ue).map(([s,a])=>e.jsx("option",{value:s,children:a},s))]})}),l.type_of_space&&e.jsx("p",{className:"text-red-500 text-sm",children:l.type_of_space.message})]})]})]}),e.jsxs("div",{className:"",children:[e.jsx("div",{children:e.jsx("div",{onClick:oe,className:"bg-[#EBEBEC] dark:bg-[#222632] flex items-center justify-center relative create-deal-upload-document-wrap",children:x?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x,alt:"Property",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 z-10 text-2xl text-red-500",onClick:s=>{s.stopPropagation(),R()},children:e.jsx(De,{})})]}):e.jsxs("p",{className:"text-gray-400 cursor-pointer text-[17px] flex flex-col items-center justify-center mx-5 text-center",children:[e.jsx("span",{children:e.jsx(Re,{size:50})}),e.jsx("span",{className:"text-[#6C5DD3]",children:"Click to upload"})," or drag and drop files PNG, JPEG, JPG (max size 25MB)"]})})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:D,onChange:me,onClick:s=>{s.target.value=null}}),e.jsxs("div",{className:"mb-5 mt-4",children:[e.jsx("label",{className:"block form-label",children:U.fields.link}),e.jsx("input",{type:"text",...c("listing_url",{}),className:"form-control focus:outline-none"}),l.listing_url&&e.jsx("p",{className:"text-red-500 text-sm",children:l.listing_url.message})]})]})]})})}),H&&e.jsx(Ie,{onImagesChange:de,maxFiles:100,initialImages:x?[x]:[],onClose:()=>K(!1),title:"Upload image or video",acceptedFileTypes:"image/*,video/*"})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"flex justify-end px-4",children:e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 my-3 mx-3",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:h,children:"Cancel"}),e.jsx("button",{onClick:()=>{V(ie)()},className:"w-fit purple-btn items-center gap-5 justify-center",style:{display:"flex"},children:"Finish"})]})})})})]})})};export{as as S};
