import{s as M,t as U,u as d,r as u,m as e,cG as G,aL as H,cH as J,cI as O,cJ as Y,cK as V,cL as A,cM as q,cN as Q}from"./index-CDC7isqe.js";const W=()=>{var k,S;const h=M(),j=U(),c=d(s=>s.deal.AiVideoData);d(s=>s.deal.SaveAiData);const y=d(s=>s.deal.VideoScenes),F=d(s=>s.deal.VideoVariables),[T,N]=u.useState(!1),g=d(s=>{var o;return(o=s.deal)==null?void 0:o.deal}),{user:w}=d(s=>s),[m,x]=u.useState(null),b=u.useRef(null),[a,z]=u.useState([]),[t,n]=u.useState(null),[_,p]=u.useState(!1),B=()=>{b.current.scrollBy({left:-200,behavior:"smooth"})},E=()=>{b.current.scrollBy({left:200,behavior:"smooth"})},I=async s=>{try{F&&y&&y.length>0&&(j("/ai-video",{state:{templateId:s}}),p(!1))}catch(o){console.error("API error:",o)}},K=async s=>{var o,i,C,$,L;try{h(V([])),h(A([])),p(!0);const r=(await q({template_id:s,user_id:(o=w.user)==null?void 0:o.id,deal_id:g.id})).data.data.template;z(r),r!=null&&r.video_path&&n({type:"video",src:`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${r.video_path}`}),((i=r==null?void 0:r.image_paths)==null?void 0:i.length)>0&&n({type:"image",src:`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${r.image_paths[0]}`});const v=await Q({template_id:s,user_id:(C=w.user)==null?void 0:C.id,deal_id:g.id}),l=($=v==null?void 0:v.data)==null?void 0:$.data;console.log("Full Popup Response:",l),console.log("User Subscription:",l==null?void 0:l.user_subscriptions);const f=l==null?void 0:l.user_subscriptions;if((f==null?void 0:f.ai_video_limit)===0){p(!1),x(null),n(null),N(!0);return}h(V(((L=l==null?void 0:l.template)==null?void 0:L.scenes)||[])),h(A((l==null?void 0:l.variables)||[])),p(!1)}catch(P){console.error("Error updating preference",P),p(!1)}};return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>j(`/deals/deal-view/${g.id}`),className:"flex items-center gap-2 mb-5",children:[e.jsx(G,{})," Back"]}),e.jsx("h4",{className:"font-bold text-3xl",children:"Select a template"}),e.jsx("p",{className:"mb-2 text-[#333333] dark:text-[#F8F8F8]",children:"Select a template to instantly generate your video content."}),c&&(c==null?void 0:c.length)>0?e.jsx("div",{className:"ai-video-grid m-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:c==null?void 0:c.map((s,o)=>e.jsxs("div",{className:"ai-video-card relative group cursor-pointer rounded-lg overflow-hidden shadow-md",children:[e.jsx("img",{src:(s==null?void 0:s.thumbnail_image_url)||H,alt:s==null?void 0:s.name,className:"w-full h-40 object-cover"}),e.jsx("h6",{className:"p-3 text-center font-medium",children:s==null?void 0:s.name}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("button",{className:`flex gap-1 items-center rounded-xl bg-white dark:bg-[#121212] text-[#6C5DD3] font-medium px-4 py-2 
                       opacity-0 translate-y-10 group-hover:opacity-100 group-hover:translate-y-0 
                       transition-all duration-300 ease-out`,onClick:i=>{i.stopPropagation(),x(s),K(s==null?void 0:s.template_id)},children:[e.jsx(J,{})," Preview"]})}),T&&e.jsx("div",{className:"fixed inset-0 flex justify-center items-center z-[9999]",children:e.jsxs("div",{className:"bg-white dark:bg-[#1e1e1e] p-6 rounded-xl w-[350px] text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600",children:"AI Video Limit Reached"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-300",children:"You have no remaining AI video credits. Please upgrade your plan to continue."}),e.jsx("button",{onClick:()=>N(!1),className:"mt-4 px-4 py-2 rounded-lg bg-[#6C5DD3] text-white hover:bg-[#5948b5]",children:"OK"})]})})]},o))}):e.jsx("p",{children:"No AI video templates available."}),m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 px-5",children:e.jsxs("div",{className:"bg-white dark:bg-[#121212] rounded-lg shadow-lg w-full max-w-4xl relative p-4 sm:p-6",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-600 hover:text-black",onClick:()=>{x(null),n(null)},children:"âœ•"}),e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 sm:px-10",children:e.jsx("div",{className:"w-full sm:w-[640px] h-[200px] sm:h-[360px] mx-auto flex items-center justify-center rounded-md overflow-hidden",children:t?t.type==="video"?e.jsx("video",{src:t.src,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!0,className:"w-full h-full object-contain"},t.src):e.jsx("img",{src:t.src,alt:"Selected preview",className:"w-full h-full object-contain"}):a!=null&&a.video_path?e.jsx("video",{src:`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${a.video_path}`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!0,className:"w-full h-full object-contain"},a.video_path):e.jsx("img",{src:(k=a==null?void 0:a.image_paths)!=null&&k[0]?`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${a.image_paths[0]}`:null,alt:a==null?void 0:a.name,className:"w-full h-full object-contain"})})}),e.jsxs("div",{className:"relative mt-4 max-w-3xl mx-auto px-4 sm:px-10",children:[e.jsx("button",{onClick:B,className:"absolute left-0 top-1/2 -translate-y-1/2 shadow rounded-full p-2 bg-white z-10 hidden sm:block dark:bg-[#121212]",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsxs("div",{ref:b,className:"flex gap-2 overflow-x-auto scrollbar-hide px-2 sm:px-8",children:[(a==null?void 0:a.video_path)&&(()=>{const s=`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${a.video_path}`;return e.jsx("video",{src:s,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:`h-16 w-28 sm:h-20 sm:w-32 object-cover rounded cursor-pointer border-2 ${(t==null?void 0:t.type)==="video"&&(t==null?void 0:t.src)===s?"border-blue-500":"border-transparent"}`,onClick:()=>n({type:"video",src:s})})})(),(S=a==null?void 0:a.image_paths)==null?void 0:S.map((s,o)=>{const i=`https://phplaravel-1547671-6035260.cloudwaysapps.com/storage/${s}`;return e.jsx("img",{src:i,alt:`image-${o}`,className:`h-16 w-28 sm:h-20 sm:w-32 object-cover rounded cursor-pointer border-2 ${(t==null?void 0:t.type)==="image"&&(t==null?void 0:t.src)===i?"border-blue-500":"border-transparent"}`,onClick:()=>n({type:"image",src:i})},o)})]}),e.jsx("button",{onClick:E,className:"absolute right-0 top-1/2 -translate-y-1/2 shadow rounded-full p-2 bg-white z-10 hidden sm:block dark:bg-[#121212]",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-row justify-end sm:gap-3 mt-6 gap-2",children:[e.jsx("button",{className:"border px-4 py-2 rounded-md w-full sm:w-auto",onClick:()=>{x(null),n(null)},children:"Cancel"}),e.jsx("button",{className:"purple-btn w-full sm:w-auto",onClick:()=>I(m==null?void 0:m.template_id),disabled:_,children:_?"Please wait...":"Use Template"})]})]})})]})};export{W as default};
