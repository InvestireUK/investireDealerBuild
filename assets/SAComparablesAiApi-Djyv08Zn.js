import{V as Y,s as H,u as D,r as c,t as Q,au as K,m as e,ck as U,x as J,aL as W,cl as X,cm as Z,cn as ee,co as se,cp as k,cq as ae,aN as le,aO as te,cr as re,aQ as ne,N as ce,aG as oe}from"./index-DNQPOinU.js";import{S as ie}from"./SAManualComparables-YmkRfZkN.js";import{S as de}from"./SAComparablesMaps-xuopG64c.js";import"./DragAndDrop-B_jmKSZj.js";import"./index-DgdvQdAw.js";import"./ModifiedAutoAddressInput-BzuRsOCZ.js";const Se=()=>{const{register:g,handleSubmit:pe,reset:xe,setValue:me,watch:b,formState:{errors:ue}}=Y({defaultValues:{bedrooms:1,no_of_beds:1}}),h=H(),O="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",a=D(s=>{var r;return(r=s==null?void 0:s.deal)==null?void 0:r.deal}),[F,d]=c.useState(!1),[N,M]=c.useState([]),f=Q(),[C,y]=c.useState(!1),[l,p]=c.useState([]),[be,_]=c.useState(!1),j=D(s=>s.deal.manualComperable),[he,fe]=c.useState([]),{handleApiCall:B}=K(),$=()=>{l.length===i.length?p([]):p(i.map(s=>s.id||s.listing_url||s.temp_id))},i=[...Array.isArray(j)?j:[],...N||[]],v=b("bedrooms"),L=b("no_of_beds"),P=b("type_of_space"),w=async()=>{var s,r,t;try{y(!0),p([]);const o={address1:(a==null?void 0:a.address_line_1)||"",address2:(a==null?void 0:a.address_line_2)||"",city:(a==null?void 0:a.city)||"",postCode:(a==null?void 0:a.post_code)||"",country:((s=a==null?void 0:a.country)==null?void 0:s.name)||"",no_of_bedroom:v||1,no_of_beds:L||1,type_of_space:P||"",no_of_dwellings:(a==null?void 0:a.no_of_dwelling)||1,type:"ai"},n=await le(a.id,1,o),u=((r=n==null?void 0:n.data)==null?void 0:r.dealComparables)||[];M(u),u.length===0&&j.length===0&&!A&&(x(!0),m(!0))}catch(o){console.error("Error fetching AI comparables:",((t=o==null?void 0:o.response)==null?void 0:t.data)||o.message),A||(x(!0),m(!0))}finally{y(!1)}};c.useEffect(()=>{a!=null&&a.id&&w()},[]);const I=()=>{d(!0),_(!1),p([])},z=()=>{_(!1)},[je,G]=c.useState(!1),[ge,S]=c.useState(!1),[T,q]=c.useState([]),[R,x]=c.useState(!1),[A,m]=c.useState(!1),V=async()=>{var s,r;try{S(!0);const t=await te(a==null?void 0:a.id,1,T,v);h(re(((s=t==null?void 0:t.data)==null?void 0:s.dealComparables)||[])),h(ne()),G(((r=t==null?void 0:t.data)==null?void 0:r.data)||[]),f("/create-deal/sa-comparable-table");const o={_method:"PATCH"};await B({apiFn:()=>oe(a==null?void 0:a.id,o),onSuccess:n=>{var E;const u={...n==null?void 0:n.deal,id:(E=n==null?void 0:n.deal)==null?void 0:E.id};h(ce(u))},onError:n=>{console.error("Error updating deal:",n)}})}catch(t){console.error("Error fetching comparables:",t)}finally{S(!1)}};return c.useEffect(()=>{const s=i.filter(r=>l.includes(r.id||r.listing_url||r.temp_id));q(s)},[l]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sa-api-comparables-map-wrap",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{children:"Comparables"}),e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>d(!0),children:"+ Add Comparable"})]}),F&&e.jsx(ie,{handleFinishSAManualComparable:I,handleCloseManualComparable:z,onClose:()=>d(!1)}),e.jsx("div",{className:"map-generated-sec mb-10",children:e.jsx("div",{className:"bg-[#EBEBEC] dark:bg-[#222632] flex items-center justify-center relative create-deal-upload-document-wrap",children:e.jsx(de,{locations:i,apiKey:O})})}),e.jsxs("div",{className:"sa-api-comparables-data-wrap",children:[e.jsx("h5",{className:"mb-8 font-semibold",children:"Nearby listings"}),e.jsx("div",{className:"filters my-5",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-2 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"No. of Bedrooms"}),e.jsx("input",{type:"string",...g("bedrooms"),className:"form-control focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"No. of Beds"}),e.jsx("input",{type:"string",...g("no_of_beds"),className:"form-control focus:outline-none"})]}),e.jsx("div",{className:"purple-btn h-[48px] mt-[30px]",children:e.jsxs("button",{className:"flex items-end gap-2 whitespace-nowrap",onClick:w,children:[e.jsx(U,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})]})}),C&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(J,{})}),!C&&i.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center border border-gray-200 rounded-xl bg-gray-50",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-700 mb-3",children:"No comparables found."}),e.jsx("p",{className:"text-gray-500 mb-5",children:"Try adjusting your filters or add a comparable manually."}),e.jsx("button",{className:"purple-btn flex items-center gap-2",onClick:()=>d(!0),children:"+ Add Manual Comparable"})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"purple-btn cursor-pointer mb-5",onClick:$,children:l.length===i.length?"Unselect All":"Select All"}),i.map((s,r)=>{const t=s.id||s.listing_url||s.temp_id||`temp-${r}`;return e.jsxs("div",{className:"grid grid-cols-[15px_1fr_2fr_10%] gap-5 my-10 items-center",children:[e.jsx("input",{type:"checkbox",checked:l.includes(t),onChange:()=>{p(o=>o.includes(t)?o.filter(n=>n!==t):[...o,t])}}),e.jsx("div",{className:"w-full h-[200px]",children:e.jsx("img",{src:(s==null?void 0:s.image_url)||(s==null?void 0:s.image)||W,alt:"Image",className:"w-full h-full object-cover rounded-[20px]"})}),e.jsxs("div",{className:"ai-api-data flex flex-col gap-1",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"font-semibold text-[20px]",children:[s.title," ",e.jsx("span",{className:"text-sm text-[#595959]",children:s.distance_meters?`${Number(s.distance_meters).toFixed(2)} ml`:""})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"ai-information flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bedroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bathroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{}),e.jsxs("span",{className:"font-semibold text-base",children:[s.beds," Guests"]})]})]}),e.jsxs("div",{className:"reviews flex items-center gap-1",children:[e.jsx(se,{className:"text-[#FB6E0A]"}),e.jsx("p",{children:s.rating||0}),e.jsxs("p",{children:["(",s.reviews||0," reviews)"]})]})]}),e.jsxs("div",{className:"ai-percentage flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s.days_available||"-"}),e.jsx("h6",{className:"text-sm",children:"Days available"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s.occupancy||"-"}),e.jsx("h6",{className:"text-sm",children:"Occupancy"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsxs("p",{className:"text-2xl",children:["£",s.adr||"-"]}),e.jsx("h6",{className:"text-sm",children:"ADR"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r border-[#ECECEC] px-5",children:[e.jsx("p",{className:"text-2xl",children:s!=null&&s.revenue?`£${s.revenue}`:"-"}),e.jsx("h6",{className:"text-sm",children:"Revenue"})]})]})]}),e.jsxs("div",{className:"links flex flex-col items-center gap-5 border-l border-[#ECECEC]",children:[s.listing_url?e.jsx("a",{href:s.listing_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(k,{className:"w-7 h-7 text-[#6C5DD3] cursor-pointer"})}):e.jsx(k,{className:"w-7 h-7 text-gray-400 cursor-not-allowed"}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ae,{className:"w-7 h-7 text-[#6C5DD3]"})})]})]},t)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-5",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:()=>f("/create-deal/description"),children:"Cancel"}),e.jsx("button",{onClick:()=>{(l==null?void 0:l.length)>0&&V()},className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${(l==null?void 0:l.length)>0?"purple-btn cursor-pointer":"bg-[#ECECEC] text-[#AFAFAF] cursor-not-allowed"}`,style:{display:"flex"},disabled:(l==null?void 0:l.length)===0,children:`Import ${(l==null?void 0:l.length)||""} item${(l==null?void 0:l.length)===1?"":"s"}`})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-center",children:"No comparables found"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Do you want to add a manual comparable or continue without adding any?"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{className:"px-4 py-2 border rounded-lg",onClick:()=>{x(!1),m(!0),d(!0)},children:"Add Manually"}),e.jsx("button",{className:"px-4 py-2 rounded-lg purple-btn",onClick:()=>{x(!1),m(!0),f("/create-deal/sa-comparable-table")},children:"Continue"})]})]})})]})};export{Se as default};
