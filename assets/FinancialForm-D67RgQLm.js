import{u as we,a3 as Ue,v as rt,w as st,r as V,av as ot,aX as Ze,V as ct,W as L,aY as it,m as o,aZ as Nt,aK as Ie,am as ut,an as _t,aH as lt,ap as mt,Q as gt,o as ze,a_ as Je,a$ as It,b0 as Ye,b1 as $t,b2 as Lt}from"./index-DHjAB_cv.js";import{F as qt}from"./FinancialSummaryView-DCCUPIHs.js";const vt="",At="cursor-not-allowed",T=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},Ot=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),l=parseFloat(g);return isNaN(l)||l<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},xt=(e,s,r,g,l,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!tt(e,s,r,g,l,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(l(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},tt=(e,s,r,g,l,C,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),h=parseFloat(re),K={isValid:!0},v=ce=>({isValid:!1,message:ce});if(isNaN(h)&&r!=="payback_period")return l(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(h<0||h===0)return l(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"before_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(h<=0||h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(h<=0)return l(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"refurbishment_cost":if(h<=0)return l(r,{type:"manual",message:"Refurbishment cost cannot be negative"}),v("Refurbishment cost cannot be negative");break;case"gross_domestic_value":if(h<0||h===0)return l(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(h<H("gross_domestic_value"))return l(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(h<0||h===0)return l(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(h)||h<1)return l(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(h<=0)return l(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(h<=0)return l(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},Ce=e=>{const s=T(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},Et=e=>e?String(e).replace(/[,%]/g,""):"0",zt=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":"Percentage must be between 0% and 100%";const l=r.split(".");return l.length===2&&l[1].length>2?"Maximum 2 decimal places allowed":!0},Ut=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},Te=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const l=g[0],C=g[1].substring(0,2);return`${l}.${C}%`}},Gt=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const l=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${l} ${C}`}},Pt=()=>{const e=we(m=>{var p;return(p=m==null?void 0:m.deal)==null?void 0:p.deal}),s=Ue();we(m=>{var p;return(p=m==null?void 0:m.deal)==null?void 0:p.currentStep});const r=rt(),g=st(),[l,C]=V.useState(null),{handleApiCall:H,loading:re}=ot(),[h,K]=V.useState(!1),[v,ce]=V.useState(!1),[Ge,Be]=V.useState([]),[ie,Fe]=V.useState(!1);s.pathname.includes("/summary");const je=["before_refurb_mortgage_value","before_refurb_mortage_cost","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Re=e?Ze(e):{},{register:ke,handleSubmit:U,reset:F,control:G,setValue:i,formState:{errors:pe},getValues:w,setError:W,clearErrors:B}=ct({defaultValues:Re,mode:"onChange"});V.useEffect(()=>{if(e&&!v){const m=Ze(e);F(m),ce(!0)}},[e,F,v]),V.useEffect(()=>{if(e&&v){const m=Ze(e);Object.entries(m).forEach(([k,P])=>{P!==""&&P!==null&&P!==void 0&&i(k,P)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(k=>{const P=w(k);if(P&&!String(P).includes("%")){const $=document.querySelector(`input[name="${k}"]`);$&&!$.readOnly&&($.value=Te(P))}})}},[e,i,v]);const X=L({control:G,name:"purchase_price"}),fe=L({control:G,name:"effective_rate_percentage"});V.useEffect(()=>{if(X&&T(X)>0&&(e!=null&&e.country_id)){K(!1);const m=setTimeout(()=>{ue(e.country_id,e.property_type_id,X,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(m)}},[X,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const ue=async(m,p,k,P)=>{try{const $=await it({countryId:m,propertyTypeId:p,price:k,tenure_type:P});if($&&$.data&&$.data.stamp_duty_amount!==void 0){const A=T(k),Q=$.data.stamp_duty_amount;C(Q),K(!0);const z=w("stamp_duty_amount");if(!z||z==="0"||X!==k){i("stamp_duty_amount",Ce(Q)),B("stamp_duty_amount");const t=A>0?Q/A*100:0,n=Number(t.toFixed(4));i("effective_rate_percentage",n),B("effective_rate_percentage")}}else C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}catch{C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}},Z=L({control:G,name:"stamp_duty_amount"});V.useEffect(()=>{if(!ie||!Z||!X)return;const m=T(Z),p=T(X),k=p>0?m/p*100:0,P=Number(k.toFixed(4));i("effective_rate_percentage",P),B("effective_rate_percentage")},[Z,X,ie,i,B]);const ne=m=>{const p=T(m.target.value);i("purchase_price",m.target.value),K(!1),p>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?ue(e.country_id,e.property_type_id,p,e==null?void 0:e.tenure_type):p<=0&&(C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0"))},N=L({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","insurance","other_expenses","monthly_rental_income"]});V.useEffect(()=>{if(!N||!N[0])return;const m=setTimeout(()=>{const p=T(N[0]),k=T(N[1])/100,P=T(N[3]),$=T(N[4]),A=T(N[5]),Q=T(N[6]),z=T(N[7]),t=T(N[8]),n=T(N[9]),c=T(N[10])/100,a=T(N[11])/100,_=T(N[12]),b=T(N[13]);T(N[14]),T(N[15])/100,T(N[16]),T(N[17])/100,T(N[18]),T(N[19]);const u=p*k,f=u*T(N[2])/100/12;let d=T(l);const I=T(w("stamp_duty_amount"));d=I>0?I:d,T(w("effective_rate_percentage"));const D=k>0?p*(1-k):0,q=Q>0?A*(Q/100):0,oe=100-T(N[1]),y=f+D+P+$+d,j=d+D+P+$+A+q+z+t+_,M=n*c,J=M*a/12,me=M-u,ve=j-me,He=j>0?Math.round(ve/j*100):0,Ke=j>0?parseFloat((me/j*100).toFixed(2)):0;b===1&&T(w("monthly_rental_income"));const De=parseFloat((n-j-u).toFixed(2)),qe=De>0,Ve=ve!==0?Math.round(De/j*100):0,Y=(E,ge)=>{if(E==="return_on_cash_investment_percentage"){const Me=ge.toLocaleString("en-US")+"%";i(E,Me)}else if(E==="payback_period")i(E,Gt(ge));else if((E==="deposit_amount_required"||E==="deposit_percentage")&&k===0)i(E,"0");else if(ge<0&&(E==="after_refurb_money_left_in"||E==="profit_amount")){const Me=ge.toLocaleString("en-US");i(E,Me)}else{if((E==="stamp_duty_amount"||E==="effective_rate_percentage")&&h&&(N[1]!==void 0||N[2]!==void 0))return;if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(E))if(ge>0&&E!=="money_in_cash_invested_percentage"){const de=Te(ge);i(E,de)}else if(ge<0&&E==="money_in_cash_invested_percentage"){const de=ge.toLocaleString("en-US")+"%";i(E,de)}else i(E,"");else if(ge>0){const de=Ce(ge);i(E,de)}else i(E,"");if((E==="stamp_duty_amount"||E==="effective_rate_percentage")&&h&&!ie&&(N[1]!==void 0||N[2]!==void 0))return}};Y("before_refurb_mortgage_value",u),Y("before_refurb_mortage_cost",f),Y("stamp_duty_amount",d),Y("deposit_amount_required",D),Y("deposit_percentage",oe),Y("contigency_amount",q),Y("total_investment",y),Y("total_cash_investment",j),Y("after_refurb_mortgage_value",M),Y("after_refurb_mortage_cost",J),Y("after_refurb_money_out",me),Y("after_refurb_money_left_in",ve),Y("money_in_cash_invested_percentage",He),Y("money_out_cash_invested_percentage",Ke),Y("profit_amount",De),qe?i("profitable","Profitable"):i("profitable","Not Profitable"),Y("return_on_cash_investment_percentage",Ve)},300);return()=>clearTimeout(m)},[N,l,h,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,fe]);const R=L({control:G,name:"no_of_dwelling"});V.useEffect(()=>{if(!R)return;const m=T(R),p=T(w("average_rent_per_unit"));if(m===1&&p>0)i("monthly_rental_income",Ce(p));else if(m>1&&p>0){const k=m*p;i("monthly_rental_income",Ce(k))}},[R]);const se=(m,p)=>{let k=m.target.value;const P=m.target,$=P.selectionStart,A=k.includes("%");let Q=k.replace(/%/g,""),z=Ut(Q);const t=Q.length-z.length;if(parseFloat(z)>100&&(z="100"),tt(z,i,p,pe,W,B,w).isValid){if(!xt(z,i,p,pe,W,B,w))return}else return;i(p,z);const c=Te(z);if(m.target.value=c,setTimeout(()=>{if(A)t>0&&$>z.length?P.setSelectionRange(Math.max(0,$-t),Math.max(0,$-t)):$<Q.length?P.setSelectionRange($,$):P.setSelectionRange(c.length-1,c.length-1);else if($===k.length)P.setSelectionRange(c.length-1,c.length-1);else{const a=Math.max(0,$-t);P.setSelectionRange(a,a)}},0),p==="after_refurb_interest_rate_percentage"){const a=T(w("after_refurb_loan_to_value_percentage"))/100,_=T(w("gross_domestic_value")),b=T(z)/100,f=_*a*b/12,d=f>0?Ce(f):"";i("after_refurb_mortage_cost",d)}},he=m=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const p={};Object.keys(m).forEach(P=>{p[P]=typeof m[P]=="string"?Et(m[P]):m[P]}),je.forEach(P=>{(!p[P]||p[P]==="")&&(p[P]="0")});const k={step:2,_method:"PATCH",purchase_price:p.purchase_price||0,before_refurb_loan_to_value_percentage:p.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:p.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:p.before_refurb_mortgage_value||0,before_refurb_mortage_cost:p.before_refurb_mortage_cost||0,stamp_duty_amount:p.stamp_duty_amount||0,effective_rate_percentage:p.effective_rate_percentage||0,deposit_percentage:p.deposit_percentage||0,deposit_amount_required:p.deposit_amount_required||0,before_refurb_professional_fees:p.before_refurb_professional_fees||0,deal_sourcing_fees:p.deal_sourcing_fees||0,total_investment:p.total_investment||0,refurbishment_cost:p.refurbishment_cost||0,contigency_percentage:p.contigency_percentage||0,contigency_amount:p.contigency_amount||0,furnishing_cost:p.furnishing_cost||0,project_management_fees:p.project_management_fees||0,total_cash_investment:p.total_cash_investment||0,gross_domestic_value:p.gross_domestic_value||0,after_refurb_loan_to_value_percentage:p.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:p.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:p.after_refurb_mortgage_value||0,after_refurb_mortage_cost:p.after_refurb_mortage_cost||0,after_refurb_professional_fees:p.after_refurb_professional_fees||0,after_refurb_money_left_in:p.after_refurb_money_left_in||0,money_in_cash_invested_percentage:p.money_in_cash_invested_percentage||0,after_refurb_money_out:p.after_refurb_money_out||0,money_out_cash_invested_percentage:p.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:p.no_of_dwelling||0,average_rent_per_unit:p.average_rent_per_unit||0,monthly_rental_income:p.monthly_rental_income||0,annual_rental_income:p.annual_rental_income||0,management_fee_percentage:p.management_fee_percentage||0,management_fees:p.management_fees||0,maintenance_fee_percentage:p.maintenance_fee_percentage||0,insurance:p.insurance||0,other_expenses:p.other_expenses||0,profit_amount:p.profit_amount||0,annual_profit_amount:p.annual_profit_amount||0,return_on_cash_investment_percentage:p.return_on_cash_investment_percentage||0,payback_period:p.payback_period||0};H({apiFn:()=>lt(e.id,k),onSuccess:P=>{var A;r(mt(!0));const $={step:"2",...P.deal,id:(A=P==null?void 0:P.deal)==null?void 0:A.id,management_fee_percentage:p.management_fee_percentage||"",mortgage_payment:p.mortgage_payment||"",contigency_percentage:p.contigency_percentage||""};r(gt($)),g("/create-deal/description")},onError:P=>{console.error("Error updating deal:",P)}})},_e=(m,p,k)=>{const P=m.reversed,$=m.name==="payback_period",Q=["profitable","before_refurb_professional_fees","furnishing_cost","project_management_fees"].includes(m.name),z=T(w("no_of_dwelling"));if(m.name==="average_rent_per_unit"&&z===1)return null;const t=(m==null?void 0:m.name)==="stamp_duty_amount"?!ie:m.name==="monthly_rental_income"&&z===1?!1:m.calculated,n=m.name==="monthly_rental_income"&&z===1?!1:m.calculated,c=Q?{}:{required:!n&&`${m.label} is required`,...$||n?{}:{pattern:{value:m.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...m.isPercentage?{percentage:u=>zt(u,m.name)}:{},maxValue:u=>Ot(u,m.name)}}},a={placeholder:n?"0":m.isPercentage?"0%":"Enter Amount",className:(m==null?void 0:m.name)==="stamp_duty_amount"?vt:t?At:vt,onKeyPress:u=>{if(!$&&!(u.key==="Backspace"||u.key==="Delete"||u.key==="Tab"||u.key==="Escape"||u.key==="Enter"||u.key==="."||u.key===","||m.isPercentage&&u.key==="%")){if(!/[0-9]/.test(u.key)){u.preventDefault();return}if(m.isPercentage){const f=u.target.value.replace(/%/g,""),d=u.target.selectionStart;if(u.target.selectionStart!==u.target.selectionEnd)return;const I=f.split(".");if(I.length===2&&d>I[0].length&&I[1].length>=2){u.preventDefault();return}const D=f.indexOf(".");if(D===-1){if(parseFloat(f+u.key)>100){u.preventDefault();return}}else if(d<=D){const q=f.substring(0,d)+u.key+f.substring(d);if(parseFloat(q)>100){u.preventDefault();return}}}}},readOnly:t,onFocus:u=>{if(m.isPercentage&&!t){const f=u.target.value;f&&f.includes("%")&&setTimeout(()=>{const d=f.length-1;u.target.setSelectionRange(d,d)},0)}},onChange:u=>{let f=u.target.value;if(m.isPercentage){se(u,m.name);return}const d=f.replace(/[,%]/g,"");if(!$&&!n&&!m.readOnly){if(d.match(/\.\d{3,}$/)){const q=parseFloat(d);f=Math.round(q).toString(),u.target.value=f}tt(f,i,m.name,k,W,B,w).isValid&&xt(f,i,m.name,k,W,B,w)}if(!n&&(i(m.name,d),d&&!isNaN(parseFloat(d))&&d.trim()!=="")){const I=parseFloat(d);if(!isNaN(I)){const D=Math.round(I);u.target.value=D.toLocaleString("en-US")}}},onBlur:u=>{if(m.name==="purchase_price")ne(u);else if(m.isPercentage&&!t){const f=u.target.value;f&&!f.includes("%")?(u.target.value=Te(f),i(m.name,f)):f===""&&(u.target.value="",i(m.name,""))}}};if(t&&m.isPercentage){const u=w(m.name);u&&(a.value=Te(u))}const _=o.jsxs("div",{children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...p(m.name,c),...a})}),m.name==="stamp_duty_amount"&&o.jsx("button",{type:"button",className:`absolute right-3 top-[50%] ${ie?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(u=>!u),children:o.jsx(ze,{className:"w-4 h-4"})})]}),k[m.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:k[m.name].message})]}),b=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:m.label})});return o.jsx("div",{className:"purchase-custom-grid",children:P?o.jsxs(o.Fragment,{children:[_,b]}):o.jsxs(o.Fragment,{children:[b,_]})})},le=(m,p,k)=>{const P=T(w("no_of_dwelling"));if(m.fields.length===1&&m.fields[0].name==="average_rent_per_unit"&&P===1)return null;const $=(m.highlight,"my-4");return m.columns===2?o.jsx("div",{className:$,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:m.fields.map(A=>o.jsx("div",{className:"purchase-price-group-wrap relative",children:A.name==="stamp_duty_amount"?o.jsx("div",{className:"relative",children:o.jsx("div",{children:_e(A,p,k)})}):_e(A,p,k)},A.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:m.fields.map(A=>A.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[_e(A,p,k),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ie?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(Q=>!Q),children:o.jsx(ze,{className:"w-4 h-4"})})]},A.name):o.jsx("div",{children:_e(A,p,k)},A.name))})},be=(m,p,k)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:m.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:m.fields.map(P=>P.rows.map(($,A)=>o.jsx(Ie.Fragment,{children:le($,p,k)},A)))})]})})}),ye=L({control:G,name:"before_refurb_loan_to_value_percentage"});return L({control:G,name:"deposit_percentage"}),V.useEffect(()=>{if(!ye)return;const m=T(ye),p=100-m;i("deposit_percentage",p.toString()),B("deposit_percentage");const k=document.querySelector('input[name="deposit_percentage"]');k&&!k.readOnly&&(k.value=Te(p));const P=T(w("purchase_price"));if(P>0&&m>0){const $=P*(p/100);i("deposit_amount_required",Ce($))}},[ye]),o.jsxs(o.Fragment,{children:[re&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:U(he),children:[Nt.map(m=>o.jsx(Ie.Fragment,{children:be(m,ke,pe)},m.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case1 m-5",children:[o.jsxs("button",{type:"button",onClick:()=>g("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"button",onClick:U(he),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:re,children:["Next",o.jsx(_t,{})]})]})]})]})},St="",Bt="cursor-not-allowed",S=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},Ht=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),l=parseFloat(g);return isNaN(l)||l<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},Ft=(e,s,r,g,l,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!nt(e,s,r,g,l,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(l(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},nt=(e,s,r,g,l,C,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),h=parseFloat(re),K={isValid:!0},v=ce=>({isValid:!1,message:ce});if(isNaN(h)&&r!=="payback_period")return l(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(h<0||h===0)return l(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(h<=0)return l(r,{type:"manual",message:"Stamp duty must be a valid percentage"}),v("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(h<=0||h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(h<=0)return l(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(h<=0||h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage."}),v("Interest rate must be a valid percentage.");if(h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage.h"}),v("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(h<0||h===0)return l(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(h<H("gross_domestic_value"))return l(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(h<0||h===0)return l(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(h)||h<1)return l(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(h<=0)return l(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(h<=0)return l(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},ae=e=>{const s=S(e);return s===0||s===null||s===void 0?"":s<0?"0":Math.round(s).toLocaleString("en-US")},Kt=e=>e?String(e).replace(/[,%]/g,""):"0",Wt=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100){if(s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage")return"Occupancy Rate between 0% and 100%";if(s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage")return"Interest rate must be a valid percentage";if(s==="occupancy_rate_monthly")return"Occupancy Rate between 0% and 100%"}const l=r.split(".");return l.length===2&&l[1].length>2?"Maximum 2 decimal places allowed":!0},Qt=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},Ee=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const l=g[0],C=g[1].substring(0,2);return`${l}.${C}%`}},Vt=e=>{if(e<=0)return"Negative Payback";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const l=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${l} ${C}`}},Xt=()=>{const e=we(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.deal}),s=Ue(),r=we(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.currentStep}),g=rt(),l=st(),[C,H]=V.useState(null),{handleApiCall:re,loading:h}=ot(),[K,v]=V.useState(!1),[ce,Ge]=V.useState(!1),Be=s.pathname.includes("/summary"),ie=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Fe=e?Je(e):{},{register:je,handleSubmit:Re,reset:ke,control:U,setValue:F,formState:{errors:G},getValues:i,setError:pe,clearErrors:w}=ct({defaultValues:Fe,mode:"onChange"});V.useEffect(()=>{if(e&&!ce){const t=Je(e);ke(t),Ge(!0)}},[e,ke,ce]),V.useEffect(()=>{if(e&&ce){const t=Je(e);Object.entries(t).forEach(([c,a])=>{a!==""&&a!==null&&a!==void 0&&F(c,a)}),["occupancy_rate_monthly"].forEach(c=>{const a=i(c);if(a&&!String(a).includes("%")){const _=document.querySelector(`input[name="${c}"]`);_&&!_.readOnly&&(_.value=Ee(a))}})}},[e,F,ce]);const W=L({control:U,name:"purchase_price"});L({control:U,name:"effective_rate_percentage"}),V.useEffect(()=>{if(W&&S(W)>0&&(e!=null&&e.country_id)){v(!1);const t=setTimeout(()=>{B(e.country_id,e.property_type_id,W,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(t)}},[W,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const B=async(t,n,c,a)=>{try{const _=await it({countryId:t,propertyTypeId:n,price:c,tenure_type:a});if(_&&_.data&&_.data.stamp_duty_amount!==void 0){const b=S(c),u=_.data.stamp_duty_amount;H(u),v(!0);const f=i("stamp_duty_amount");if(!f||f==="0"||W!==c){F("stamp_duty_amount",ae(u));const d=b>0?u/b*100:0;F("effective_rate_percentage",ae(d))}}else H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0")}catch{H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0")}},X=t=>{const n=S(t.target.value);F("purchase_price",t.target.value),v(!1),n>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?B(e.country_id,e.property_type_id,n,e==null?void 0:e.tenure_type):n<=0&&(H(0),F("stamp_duty_amount","0"),F("effective_rate_percentage","0"))},fe=L({control:U,name:["rent","administration","deal_sourcing_fees"]});V.useEffect(()=>{if(!fe||(fe==null?void 0:fe.length)<3)return;const t=setTimeout(()=>{const n=S(fe[0]),c=S(fe[1]),a=S(fe[2]),_=n+c+a;F("aquisition_cost",_.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[fe]);const ue=L({control:U,name:["furnishing","refurbishment","ota_setup_fee","channel_manager_setup"]});V.useEffect(()=>{if(!ue||(ue==null?void 0:ue.length)<4)return;const t=setTimeout(()=>{const n=S(ue[0]),c=S(ue[1]),a=S(ue[2]),_=S(ue[3]),b=n+c+a+_;F("setup_cost",b.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[ue]);const Z=L({control:U,name:["council_tax_or_business_rates","water_gas_electric_and_broadband","insurance","cleaning","laundry","other"]});V.useEffect(()=>{if(!Z||(Z==null?void 0:Z.length)<6)return;const t=setTimeout(()=>{const n=S(Z[0]),c=S(Z[1]),a=S(Z[2]),_=S(Z[3]),b=S(Z[4]),u=S(Z[5]),f=n+c+a+_+b+u;F("monthly_expense",f.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[Z]);const ne=L({control:U,name:["aquisition_cost","expected_daily_rate","occupancy_rate_monthly","rent"]});V.useEffect(()=>{if(!ne||(ne==null?void 0:ne.length)<3)return;const t=setTimeout(()=>{S(ne[0]);const n=S(ne[1]),c=S(ne[3]);let a=String(N[1]).replace(/[%\\s]/g,""),_=parseFloat(a);isNaN(_)?_=0:_=_/100;const b=n*30*_-c;F("monthly_revenue",ae(b))},300);return()=>clearTimeout(t)},[ne]);const N=L({control:U,name:["expected_daily_rate","occupancy_rate_monthly"]});V.useEffect(()=>{if(!N||(N==null?void 0:N.length)<2)return;const t=setTimeout(()=>{const n=S(N[0]);let c=String(N[1]).replace(/[%\\s]/g,""),a=parseFloat(c);isNaN(a)?a=0:a=a/100;const _=n*a*30;F("total_monthly_income",ae(_))},300);return()=>clearTimeout(t)},[N]);const R=L({control:U,name:["rent","total_monthly_income","monthly_expense"]});V.useEffect(()=>{if(!R||(R==null?void 0:R.length)<3)return;const t=setTimeout(()=>{const n=S(R[0]),c=S(R[1]),a=S(R[2]),_=c-n-a;F("net_income_monthly",_.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[R]);const se=L({control:U,name:["net_income_monthly"]});V.useEffect(()=>{if(!se||(se==null?void 0:se.length)<1)return;const t=setTimeout(()=>{const c=S(se[0])*12;F("net_income_per_year",c.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[se]);const he=L({control:U,name:["total_monthly_income"]});V.useEffect(()=>{if(!he||(he==null?void 0:he.length)<1)return;const t=setTimeout(()=>{const c=S(he[0])*12;F("gross_income_per_year",c.toLocaleString("en-US"))},300);return()=>clearTimeout(t)},[he]);const _e=L({control:U,name:["gross_income_per_year","setup_cost"]});V.useEffect(()=>{if(!_e||_e.length<2||!ne)return;const t=setTimeout(()=>{const n=S(ne[0]),c=S(_e[0]),a=S(_e[1]),_=a+n===0?1:a+n,b=c/_*100;F("gross_ROI",`${b.toFixed(1)}%`)},300);return()=>clearTimeout(t)},[_e]);const le=L({control:U,name:["setup_cost","net_income_per_year","aquisition_cost"]});V.useEffect(()=>{if(!le||le.length<3)return;const t=setTimeout(()=>{const n=S(le[0]),c=S(le[1]),a=S(le[2]),_=n+a;if(_===0)F("net_ROI","INFINITE");else{const b=c/_*100;F("net_ROI",`${b.toFixed(1)}%`)}},300);return()=>clearTimeout(t)},[le]);const be=L({control:U,name:["net_income_monthly","setup_cost"]});V.useEffect(()=>{if(!be||be.length<2)return;const t=setTimeout(()=>{const n=S(be[0]),c=S(be[1]),a=S(ne[0]),_=(c+a)/n;console.log("result_months_until_break_even",_),F("months_until_break_even",Math.round(_))},300);return()=>clearTimeout(t)},[be]);const ye=L({control:U,name:"monthly_rental_income"}),m=L({control:U,name:"management_fee_percentage"});V.useEffect(()=>{if(!ye||S(i("no_of_dwelling"))!==1)return;const n=setTimeout(()=>{const c=S(ye),a=S(m)/100,_=S(i("after_refurb_mortage_cost")),b=c*a,u=parseFloat((c-(_+b)).toFixed(2)),f=u*12,d=S(i("after_refurb_money_left_in")),I=d>0?Math.round(Math.max(0,f/d*100)):0,D=f>0?Math.max(0,d/f):0;F("management_fees",ae(b)),F("profit_amount",ae(u)),F("annual_profit_amount",ae(f)),F("return_on_cash_investment_percentage",ae(I)+"%"),F("payback_period",Vt(D));const q=c*12;F("annual_rental_income",ae(q))},300);return()=>clearTimeout(n)},[ye,m]),V.useEffect(()=>{if(!m)return;const t=setTimeout(()=>{const n=S(m)/100,c=S(i("monthly_rental_income"));if(c>0&&n>0){const a=c*n;F("management_fees",ae(a));const _=S(i("after_refurb_mortage_cost")),b=parseFloat((c-(_+a)).toFixed(2)),u=b*12;F("profit_amount",ae(b)),F("annual_profit_amount",ae(u));const f=S(i("after_refurb_money_left_in"));if(f>0){const d=Math.max(0,u/f*100),I=u>0?Math.max(0,f/u):0;F("return_on_cash_investment_percentage",ae(d)+"%"),F("payback_period",Vt(I))}}},300);return()=>clearTimeout(t)},[m]);const p=L({control:U,name:"average_rent_per_unit"});V.useEffect(()=>{if(!p)return;if(S(i("no_of_dwelling"))===1){const n=S(p);F("monthly_rental_income",ae(n))}},[p]);const k=L({control:U,name:"no_of_dwelling"});V.useEffect(()=>{if(!k)return;const t=S(k),n=S(i("average_rent_per_unit"));if(t===1&&n>0)F("monthly_rental_income",ae(n));else if(t>1&&n>0){const c=t*n;F("monthly_rental_income",ae(c))}},[k]);const P=(t,n)=>{let c=t.target.value;const a=t.target,_=a.selectionStart,b=c.includes("%");let u=c.replace(/%/g,""),f=Qt(u);const d=u.length-f.length;if(parseFloat(f)>100&&(f="100"),nt(f,F,n,G,pe,w,i).isValid){if(!Ft(f,F,n,G,pe,w,i))return}else return;F(n,f);const D=Ee(f);if(t.target.value=D,setTimeout(()=>{if(b)d>0&&_>f.length?a.setSelectionRange(Math.max(0,_-d),Math.max(0,_-d)):_<u.length?a.setSelectionRange(_,_):a.setSelectionRange(D.length-1,D.length-1);else if(_===c.length)a.setSelectionRange(D.length-1,D.length-1);else{const q=Math.max(0,_-d);a.setSelectionRange(q,q)}},0),n==="after_refurb_interest_rate_percentage"){const q=S(i("after_refurb_loan_to_value_percentage"))/100,oe=S(i("gross_domestic_value")),y=S(f)/100,M=oe*q*y/12,J=M>0?ae(M):"";F("after_refurb_mortage_cost",J)}},$=t=>{if(!(e!=null&&e.id))return;const n={};Object.keys(t).forEach(a=>{n[a]=typeof t[a]=="string"?Kt(t[a]):t[a]}),ie.forEach(a=>{(!n[a]||n[a]==="")&&(n[a]="0")});const c={step:2,_method:"PATCH",rent:n.rent||0,administration_amount:n.administration||0,sourcing_fees:n.deal_sourcing_fees||0,aquisition_cost:n.aquisition_cost||0,expected_daily_rate:n.expected_daily_rate||0,occupancy_rate_monthly_percentage:n.occupancy_rate_monthly||0,furnishing_fees:n.furnishing||0,refurbishment_fees:n.refurbishment||0,ota_setup_fees:n.ota_setup_fee||0,channel_manager_setup_fees:n.channel_manager_setup||0,setup_cost:n.setup_cost||0,council_tax_or_business_rates_expense:n.council_tax_or_business_rates||0,water_gas_electric_broadband_expense:n.water_gas_electric_and_broadband||0,insurance_expense:n.insurance||0,cleaning_expense:n.cleaning||0,laundry_expense:n.laundry||0,other_expense:n.other||0,monthly_expense:n.monthly_expense||0,monthly_revenue:n.monthly_revenue||0,total_monthly_income:n.total_monthly_income||0,net_income_monthly:n.net_income_monthly||0,net_income_per_year:n.net_income_per_year||0,gross_income_per_year:n.gross_income_per_year||0,gross_roi_percentage:n.gross_ROI||0,net_roi_percentage:n.net_ROI||0,months_until_break_even:n.months_until_break_even||0};re({apiFn:()=>lt(e.id,c),onSuccess:a=>{var b;g(mt(!0));const _={step:"3",...a==null?void 0:a.deal,id:(b=a==null?void 0:a.deal)==null?void 0:b.id,management_fee_percentage:n.management_fee_percentage||"",mortgage_payment:n.mortgage_payment||"",contigency_percentage:n.contigency_percentage||""};g(gt(_)),g({type:"deal/setCurrentStep",payload:Math.max(r,3)}),l("/create-deal/description")},onError:a=>{console.error("Error updating deal:",a)}})},A=(t,n,c)=>{const a=t.reversed,_=t.name==="payback_period",b=S(i("no_of_dwelling")),u=Be;if(t.name==="average_rent_per_unit"&&b===1)return null;const f=u||(t.name==="monthly_rental_income"&&b===1?!1:t.calculated),d=t.name==="monthly_rental_income"&&b===1?!1:t.calculated;console.log("flied",t);const I={required:!d&&!["Maintenance Fee","Other Expenses","Occupancy Rate (Monthly)","Insurance","Furnishing","Refurbishment","Licensing","Channel Manager Setup","Council Tax / Business Rates","Water, Gas, Electricity & Broadband","Cleaning","Laundry","Other"].includes(t.label)&&`${t.label} is required`,..._||d?{}:{pattern:{value:t.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...t.isPercentage?{percentage:y=>Wt(y,t.name)}:{},maxValue:y=>Ht(y,t.name)}}},D={placeholder:d?"0":t.isPercentage?"0%":"Enter Amount",className:(t==null?void 0:t.name)==="stamp_duty_amount"?St:f?Bt:St,onKeyPress:y=>{if(!_&&!(y.key==="Backspace"||y.key==="Delete"||y.key==="Tab"||y.key==="Escape"||y.key==="Enter"||y.key==="."||y.key===","||t.isPercentage&&y.key==="%")){if(!/[0-9]/.test(y.key)){y.preventDefault();return}if(t.isPercentage){const j=y.target.value.replace(/%/g,""),M=y.target.selectionStart;if(y.target.selectionStart!==y.target.selectionEnd)return;const J=j.split(".");if(J.length===2&&M>J[0].length&&J[1].length>=2){y.preventDefault();return}const me=j.indexOf(".");if(me===-1){if(parseFloat(j+y.key)>100){y.preventDefault();return}}else if(M<=me){const ve=j.substring(0,M)+y.key+j.substring(M);if(parseFloat(ve)>100){y.preventDefault();return}}}}},readOnly:f,onFocus:y=>{if(t.isPercentage&&!f){const j=y.target.value;j&&j.includes("%")&&setTimeout(()=>{const M=j.length-1;y.target.setSelectionRange(M,M)},0)}},onChange:y=>{let j=y.target.value;if(t.isPercentage){P(y,t.name);return}const M=j.replace(/[,%]/g,"");if(!_&&!d&&!t.readOnly){if(M.match(/\.\d{3,}$/)){const ve=parseFloat(M);j=Math.round(ve).toString(),y.target.value=j}nt(j,F,t.name,c,pe,w,i).isValid&&Ft(j,F,t.name,c,pe,w,i)}if(!d&&(F(t.name,M),M&&!isNaN(parseFloat(M))&&M.trim()!=="")){const J=parseFloat(M);if(!isNaN(J)){const me=Math.round(J);y.target.value=me.toLocaleString("en-US")}}},onBlur:y=>{if(t.name==="purchase_price")X(y);else if(t.isPercentage&&!f){const j=y.target.value;j&&!j.includes("%")?(y.target.value=Ee(j),F(t.name,j)):j===""&&(y.target.value="",F(t.name,""))}}};if(f&&t.isPercentage){const y=i(t.name);y&&(D.value=Ee(y))}const q=o.jsxs("div",{className:"",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...n(t.name,I),...D})}),c[t.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:c[t.name].message})]}),oe=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:t.label})});return o.jsx("div",{className:"purchase-custom-grid",children:a?o.jsxs(o.Fragment,{children:[q,oe]}):o.jsxs(o.Fragment,{children:[oe,q]})})},Q=(t,n,c)=>{const a=S(i("no_of_dwelling"));if(t.fields.length===1&&t.fields[0].name==="average_rent_per_unit"&&a===1)return null;const _=(t.highlight,"my-4");return t.columns===2?o.jsx("div",{className:_,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:t.fields.map(b=>o.jsx("div",{className:"purchase-price-group-wrap",children:A(b,n,c)},b.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:t.fields.map(b=>A(b,n,c))})},z=(t,n,c)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:t.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:t.fields.map(a=>a.rows.map((_,b)=>o.jsx(Ie.Fragment,{children:Q(_,n,c)},b)))})]})})});return o.jsxs(o.Fragment,{children:[h&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:Re($),children:[It.map(t=>o.jsx(Ie.Fragment,{children:z(t,je,G)},t.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case2 px-4 pb-4",children:[o.jsxs("button",{type:"button",onClick:()=>l("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"button",onClick:Re($),style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center",disabled:h,children:["Next",o.jsx(_t,{})]})]})]})]})},wt="",Zt="cursor-not-allowed",x=e=>{if(!e||e==="")return 0;const s=String(e).replace(/[,%]/g,""),r=parseFloat(s);return isNaN(r)?0:r},Jt=(e,s)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","stamp_duty_amount","effective_rate_percentage","deposit_amount_required","deposit_percentage","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(s))return!0;const g=String(e).replace(/[,%]/g,""),l=parseFloat(g);return isNaN(l)||l<=999999999999e-2||"Maximum value allowed is 9,999,999,999.99"},jt=(e,s,r,g,l,C,H)=>{if(["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"].includes(r))return!0;if(!at(e,s,r,g,l,C,H).isValid)return!1;const K=String(e).replace(/[,%]/g,""),v=parseFloat(K);return isNaN(v)?!0:v>999999999999e-2?(l(r,{type:"manual",message:"Maximum value allowed is 9,999,999,999.99"}),!1):(g[r]&&C(r),!0)},at=(e,s,r,g,l,C,H)=>{if(!e||e==="")return{isValid:!0};const re=String(e).replace(/[,%]/g,""),h=parseFloat(re),K={isValid:!0},v=ce=>({isValid:!1,message:ce});if(isNaN(h)&&r!=="payback_period")return l(r,{type:"manual",message:"Please enter a valid number"}),v("Please enter a valid number");switch(r){case"purchase_price":if(h<0||h===0)return l(r,{type:"manual",message:"Purchase price must be greater than zero"}),v("Purchase price must be greater than zero");break;case"stamp_duty_amount":if(h<=0)return l(r,{type:"manual",message:"Stamp duty must be a valid percentage"}),v("Stamp duty must be a valid percentage");break;case"before_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"LTV must be between 0% and 100%"}),v("LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"after_refurb_loan_to_value_percentage":if(h<=0||h>=101)return l(r,{type:"manual",message:"Post-refurb LTV must be between 0% and 100%"}),v("Post-refurb LTV must be between 0% and 100%");if(h>=101)return l(r,{type:"manual",message:"Loan to value percentage is unusually high"}),v("Loan to value percentage is unusually high");break;case"before_refurb_interest_rate_percentage":if(h<=0||h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage"}),v("Interest rate must be a valid percentage");case"deal_sourcing_fees":if(h<=0)return l(r,{type:"manual",message:"Sourcing fee cannot be negative"}),v("Sourcing fee cannot be negative");break;case"after_refurb_interest_rate_percentage":if(h<=0||h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage."}),v("Interest rate must be a valid percentage.");if(h>101)return l(r,{type:"manual",message:"Interest rate must be a valid percentage.h"}),v("Interest rate must be a valid percentage.");break;case"gross_domestic_value":if(h<0||h===0)return l(r,{type:"manual",message:"GDV must be greater than zero"}),v("GDV must be greater than zero");break;case"after_refurb_mortgage_value":if(h<H("gross_domestic_value"))return l(r,{type:"manual",message:"Post-refurb mortgage cannot exceed GDV"}),v("Post-refurb mortgage cannot exceed GDV");break;case"deposit_amount_required":if(h<0||h===0)return l(r,{type:"manual",message:"Deposit cannot be negative"}),v("Deposit cannot be negative");break;case"no_of_dwelling":if(!Number.isInteger(h)||h<1)return l(r,{type:"manual",message:"At least one unit is required"}),v("At least one unit is required");break;case"average_rent_per_unit":if(h<=0)return l(r,{type:"manual",message:"Rent must be greater than zero"}),v("Rent must be greater than zero");break;case"monthly_rental_income":if(h<=0)return l(r,{type:"manual",message:"Monthly rental income must be greater than zero"}),v("Monthly rental income must be greater than zero");break;case"maintenance_fee_percentage":if(h<0)return l(r,{type:"manual",message:"Maintenance cost cannot be negative."}),v("Maintenance cost cannot be negative.");break;case"insurance":if(h<0)return l(r,{type:"manual",message:"Insurance cost cannot be negative."}),v("Insurance cost cannot be negative.");break;case"other_expenses":if(h<0)return l(r,{type:"manual",message:"Other expenses cannot be negative."}),v("Other expenses cannot be negative.");break;default:g[r]&&C(r);break}return g[r]&&C(r),K},te=e=>{const s=x(e);return s===0||s===null||s===void 0?"":Math.round(s).toLocaleString("en-US")},Yt=e=>e?String(e).replace(/[,%]/g,""):"0",en=(e,s)=>{const r=String(e).replace(/[,%]/g,""),g=parseFloat(r);if(isNaN(g)||g<0||g>100)return s==="before_refurb_loan_to_value_percentage"||s==="after_refurb_loan_to_value_percentage"?"LTV must be between 0% and 100%":s==="before_refurb_interest_rate_percentage"||s==="after_refurb_interest_rate_percentage"?"Interest rate must be a valid percentage":s==="deposit_percentage"?"Deposit must be between 0% and 100%":s==="maintenance_fee_percentage"?!0:"Percentage must be between 0% and 100%";const l=r.split(".");return l.length===2&&l[1].length>2?"Maximum 2 decimal places allowed":!0},tn=e=>{if(!e)return"";let s=e.replace(/[^0-9.,]/g,"");s=s.replace(/,/g,"");const r=s.split(".");r.length>2&&(s=r[0]+"."+r.slice(1).join("")),r.length===2&&r[1].length>2&&(s=r[0]+"."+r[1].substring(0,2));const g=parseFloat(s);return isNaN(g)?"":g<0?"0":g>100?"100":s},Ne=e=>{if(!e&&e!==0)return"";const s=e.toString().replace(/%/g,"");if(s===""||s==="0")return"0%";const r=parseFloat(s);if(isNaN(r))return s+"%";const g=s.split(".");if(g.length===1||g.length===2&&g[1]==="")return s+"%";{const l=g[0],C=g[1].substring(0,2);return`${l}.${C}%`}},et=e=>{if(e<=0)return"0";const s=Math.floor(e),r=(e-s)*12,g=Math.round(r);if(s===0)return g===1?"1 month":`${g} months`;if(g===0)return s===1?"1 year":`${s} years`;{const l=s===1?"1 year":`${s} years`,C=g===1?"1 month":`${g} months`;return`${l} ${C}`}},Rt=()=>{const e=we(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.deal}),s=Ue();we(t=>{var n;return(n=t==null?void 0:t.deal)==null?void 0:n.currentStep});const r=rt(),g=st(),[l,C]=V.useState(null),{handleApiCall:H,loading:re}=ot(),[h,K]=V.useState(!1),[v,ce]=V.useState(!1),[Ge,Be]=V.useState([]),[ie,Fe]=V.useState(!1);s.pathname.includes("/summary");const je=["before_refurb_mortgage_value","before_refurb_mortage_cost","effective_rate_percentage","deposit_amount_required","total_investment","contigency_amount","total_cash_investment","after_refurb_mortgage_value","after_refurb_mortage_cost","after_refurb_money_left_in","money_in_cash_invested_percentage","after_refurb_money_out","money_out_cash_invested_percentage","monthly_rental_income","annual_rental_income","management_fees","profit_amount","annual_profit_amount","return_on_cash_investment_percentage","payback_period"],Re=e?Ye(e):{},{register:ke,handleSubmit:U,reset:F,control:G,setValue:i,formState:{errors:pe},getValues:w,setError:W,clearErrors:B}=ct({defaultValues:Re,mode:"onChange"});V.useEffect(()=>{if(e&&!v){const t=Ye(e);F(t),ce(!0)}},[e,F,v]),V.useEffect(()=>{if(e&&v){const t=Ye(e);Object.entries(t).forEach(([c,a])=>{a!==""&&a!==null&&a!==void 0&&i(c,a)}),["before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","contigency_percentage","management_fee_percentage","deposit_percentage","effective_rate_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].forEach(c=>{const a=w(c);if(a&&!String(a).includes("%")){const _=document.querySelector(`input[name="${c}"]`);_&&!_.readOnly&&(_.value=Ne(a))}})}},[e,i,v]);const X=L({control:G,name:"purchase_price"}),fe=L({control:G,name:"effective_rate_percentage"}),ue=x(w("stamp_duty_amount"));V.useEffect(()=>{if(X&&x(X)>0&&(e!=null&&e.country_id)){K(!1);const t=setTimeout(()=>{Z(e.country_id,e.property_type_id,X,e==null?void 0:e.tenure_type)},1e3);return()=>clearTimeout(t)}},[X,e==null?void 0:e.country_id,e==null?void 0:e.deal_type_id]);const Z=async(t,n,c,a)=>{try{const _=await it({countryId:t,propertyTypeId:n,price:c,tenure_type:a});if(_&&_.data&&_.data.stamp_duty_amount!==void 0){const b=x(c),u=_.data.stamp_duty_amount;C(u),K(!0);const f=w("stamp_duty_amount");if(!f||f==="0"||X!==c){i("stamp_duty_amount",te(u)),B("stamp_duty_amount");const d=b>0?u/b*100:0;i("effective_rate_percentage",te(d))}}else C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}catch{C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0")}},ne=L({control:G,name:"stamp_duty_amount"});V.useEffect(()=>{if(!ie||!ne||!X)return;const t=x(ne),n=x(X),c=n>0?t/n*100:0,a=Number(c.toFixed(4));i("effective_rate_percentage",a),B("effective_rate_percentage")},[ne,X,ie,i,B]);const N=t=>{const n=x(t.target.value);i("purchase_price",t.target.value),K(!1),n>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)?Z(e.country_id,e.property_type_id,n,e==null?void 0:e.tenure_type):n<=0&&(C(0),i("stamp_duty_amount","0"),i("effective_rate_percentage","0"))},R=L({control:G,name:["purchase_price","before_refurb_loan_to_value_percentage","before_refurb_interest_rate_percentage","before_refurb_professional_fees","deal_sourcing_fees","refurbishment_cost","contigency_percentage","furnishing_cost","project_management_fees","gross_domestic_value","after_refurb_loan_to_value_percentage","after_refurb_interest_rate_percentage","after_refurb_professional_fees","no_of_dwelling","average_rent_per_unit","management_fee_percentage","mortgage_payment","maintenance_fee_percentage","other_expenses","insurance","stamp_duty_amount"]}),[se,he]=V.useState({payloadROI:0,payloadPaybackPeriod:0});V.useEffect(()=>{if(!R||!R[0])return;const t=setTimeout(()=>{const n=x(R[0]),c=x(R[1])/100,a=x(R[2])/100,_=x(R[3]),b=x(R[4]),u=x(R[5]),f=x(R[6]),d=x(R[7]),I=x(R[8]),D=x(R[9]),q=x(R[10])/100,oe=x(R[11])/100,y=x(R[12]),j=x(R[13]),M=x(R[14]),J=x(R[15])/100;x(R[16]);const me=x(R[17]),ve=x(R[18]),He=x(R[19]),Ke=w("monthly_rental_income"),De=n*c,qe=n*c*a/12;let Ve=x(l);const Y=x(w("stamp_duty_amount"));Ve=Y>0?Y:Ve,x(w("effective_rate_percentage")),h===!1&&n>0&&(e!=null&&e.country_id)&&(e!=null&&e.property_type_id)&&Z(e.country_id,e.property_type_id,n,e==null?void 0:e.tenure_type);const E=c>0?n*(1-c):0;100-x(R[1]);const ge=f>0?u*(f/100):0,Me=qe+E+_+b+Ve,de=Ve+E+_+b+u+ge+d+I+y,We=D*q,pt=We*oe/12,Qe=We-De,$e=de-Qe,kt=de>0?Math.round($e/de*100):0,Dt=de>0?Math.max(0,parseFloat((Qe/de*100).toFixed(2))):0;let xe=0;if((e==null?void 0:e.deal_type_id)==3)xe=Ke;else if((e==null?void 0:e.deal_type_id)!==3&&j===1){const O=x(w("monthly_rental_income"));xe=O>0?O:M}else xe=j*M;(e==null?void 0:e.deal_type_id)!==5&&(xe=Number(xe.replace(/,/g,"")));const Mt=xe*12,ft=xe*J,dt=Math.round(xe-(ft+(pt+me+He+ve))),Ae=dt*12,Oe=Number($e),ht=Number(Ae),Xe=Oe>0?Math.round(ht/Oe*100):0,Ct=Number($e),bt=Number(Ae),yt=bt!==0?Ct/bt:0;he(O=>({...O,payloadROI:Xe,payloadPaybackPeriod:yt}));const ee=(O,Pe)=>{if(O==="return_on_cash_investment_percentage"){let Se;Oe<=0&&ht>0||Oe<=0?Se="Infinite":Se=`${Xe.toLocaleString("en-US")}%`,i(O,Se)}else if(O==="payback_period"){const Se=Number($e)<=0?"Pays Immediately":et(Pe);i(O,Se)}else if((O==="deposit_amount_required"||O==="deposit_percentage")&&c===0)i(O,"0");else{if((O==="stamp_duty_amount"||O==="effective_rate_percentage")&&h&&(R[1]!==void 0||R[2]!==void 0))return;if(Pe<0&&(O==="after_refurb_money_left_in"||O==="profit_amount"||O==="annual_profit_amount"||O==="money_in_cash_invested_percentage"||O==="payback_period")){const Se=Pe.toLocaleString("en-US");i(O,Se)}else if(["effective_rate_percentage","deposit_percentage","money_in_cash_invested_percentage","money_out_cash_invested_percentage","return_on_cash_investment_percentage"].includes(O))if(Pe>0&&O!=="money_in_cash_invested_percentage"){const Le=te(Pe)+"%";i(O,Le)}else if(Pe<0&&O==="money_in_cash_invested_percentage"){const Le=Pe.toLocaleString("en-US")+"%";i(O,Le)}else i(O,"");else if(Pe){const Le=te(Pe);i(O,Le)}else i(O,"")}},Tt=Ae>0;ee("before_refurb_mortgage_value",De),ee("before_refurb_mortage_cost",qe),ee("stamp_duty_amount",Ve),ee("deposit_amount_required",E),ee("contigency_amount",ge),ee("total_investment",Me),ee("total_cash_investment",de),ee("after_refurb_mortgage_value",We),ee("after_refurb_mortage_cost",pt),ee("after_refurb_money_out",Qe),ee("after_refurb_money_left_in",$e),i("money_in_cash_invested_percentage",`${Math.round(kt)}%`),Tt?i("profitable","Profitable"):i("profitable","Not Profitable"),ee("money_out_cash_invested_percentage",Dt),ee("monthly_rental_income",xe),ee("annual_rental_income",Mt),ee("management_fees",ft),ee("profit_amount",dt),ee("annual_profit_amount",Ae),ee("return_on_cash_investment_percentage",Xe),ee("payback_period",yt)},300);return()=>clearTimeout(t)},[R,ue,l,h,e==null?void 0:e.country_id,e==null?void 0:e.property_type_id,fe]);const _e=L({control:G,name:"monthly_rental_income"}),le=L({control:G,name:"management_fee_percentage"});V.useEffect(()=>{if(!_e||((e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling")))!==1)return;const n=setTimeout(()=>{const c=x(_e),a=x(le)/100,_=x(w("after_refurb_mortage_cost")),b=c*a,u=x(R[17])/100,f=x(R[18]),d=x(R[19]),I=c-(b+(_+u+d+f)),D=I*12,q=x(w("after_refurb_money_left_in")),oe=D!==0?q/D:0;i("management_fees",te(b)),i("profit_amount",te(I)),i("annual_profit_amount",te(D)),i("payback_period",et(oe));const y=c*12;i("annual_rental_income",te(y))},300);return()=>clearTimeout(n)},[_e,le]),V.useEffect(()=>{if(!le)return;const t=setTimeout(()=>{const n=x(le)/100,c=x(w("monthly_rental_income")),a=x(R[17])/100,_=x(R[18]),b=x(R[19]);if(c>0&&n>0){const u=c*n;i("management_fees",te(u));const f=x(w("after_refurb_mortage_cost")),d=Math.round(c-(u+(f+a+b+_))),I=d*12;i("profit_amount",te(d)),i("annual_profit_amount",te(I));const D=x(w("after_refurb_money_left_in"));if(D>0){const q=I>0?Math.max(0,D/I):0;i("payback_period",et(q))}}},300);return()=>clearTimeout(t)},[le]);const be=L({control:G,name:"average_rent_per_unit"});V.useEffect(()=>{if(!be)return;if(((e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling")))===1){const n=x(be);i("monthly_rental_income",te(n))}},[be]);const ye=L({control:G,name:"no_of_dwelling"});V.useEffect(()=>{if(!ye)return;const t=x(ye),n=x(w("average_rent_per_unit"));if(t===1&&n>0)i("monthly_rental_income",te(n));else if(t>1&&n>0){const c=t*n;i("monthly_rental_income",te(c))}},[ye]);const m=(t,n)=>{let c=t.target.value;const a=t.target,_=a.selectionStart,b=c.includes("%");let u=c.replace(/%/g,""),f=tn(u);const d=u.length-f.length;if(parseFloat(f)>100&&(f="100"),at(f,i,n,pe,W,B,w).isValid){if(!jt(f,i,n,pe,W,B,w))return}else return;i(n,f);const D=Ne(f);if(t.target.value=D,setTimeout(()=>{if(b)d>0&&_>f.length?a.setSelectionRange(Math.max(0,_-d),Math.max(0,_-d)):_<u.length?a.setSelectionRange(_,_):a.setSelectionRange(D.length-1,D.length-1);else if(_===c.length)a.setSelectionRange(D.length-1,D.length-1);else{const q=Math.max(0,_-d);a.setSelectionRange(q,q)}},0),n==="after_refurb_interest_rate_percentage"){const q=x(w("after_refurb_loan_to_value_percentage"))/100,oe=x(w("gross_domestic_value")),y=x(f)/100,M=oe*q*y/12,J=M>0?te(M):"";i("after_refurb_mortage_cost",J)}},p=t=>{let n=!0,c=[];const a=[{name:"purchase_price",label:"Purchase Price"},{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage"},{name:"gross_domestic_value",label:"Gross Domestic Value"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage"},{name:"no_of_dwelling",label:"Number of Dwellings"}];let _=!0;for(const d of a){const I=x(t[d.name]);if(!I||I<=0){_=!1;break}}if(_)for(const d of je)x(t[d]),d!=="payback_period"&&(d==="effective_rate_percentage"&&x(t.stamp_duty_amount)<=0||d==="annual_profit_amount"&&x(t.profit_amount)<=0||d==="monthly_rental_income"&&x(t.no_of_dwelling)<=0||d==="annual_rental_income"&&x(t.monthly_rental_income)<=0||d==="management_fees"&&x(t.monthly_rental_income)<=0||d==="profit_amount"&&(x(t.monthly_rental_income)<=0||x(t.after_refurb_mortage_cost)<=0));for(const d of a){const I=x(t[d.name]);if(!I||I<=0){let D=`${d.label} is required and must be greater than 0`;d.name==="purchase_price"?D="Purchase price must be greater than zero":d.name==="gross_domestic_value"?D="GDV must be greater than zero":d.name==="no_of_dwelling"&&(D="At least one unit is required"),W(d.name,{type:"manual",message:D}),c.push(d.label),n=!1}}const b=[{name:"before_refurb_loan_to_value_percentage",label:"Loan-to-Value Percentage",message:"LTV must be between 0% and 100%"},{name:"after_refurb_loan_to_value_percentage",label:"After Refurb Loan-to-Value Percentage",message:"Post-refurb LTV must be between 0% and 100%"},{name:"before_refurb_interest_rate_percentage",label:"Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"after_refurb_interest_rate_percentage",label:"After Refurb Interest Rate Percentage",message:"Interest rate must be a valid percentage"},{name:"contigency_percentage",label:"Contingency Percentage"},{name:"deposit_percentage",label:"Deposit (%)",message:"Deposit must be between 0% and 100%"}];for(const d of b){const I=x(t[d.name]);(I<=0||I>100)&&d.name!=="contigency_percentage"&&(W(d.name,{type:"manual",message:d.message}),c.push(d.label),n=!1)}const u=[{name:"gross_domestic_value",label:"Gross Domestic Value",message:"GDV must be greater than zero"},{name:"refurbishment_cost",label:"Refurbishment Cost"},{name:"deal_sourcing_fees",label:"Deal Sourcing Fees",message:"Sourcing fee cannot be negative or zero."}];for(const d of u)x(t[d.name])<=0&&(W(d.name,{type:"manual",message:d.message}),c.push(d.label),n=!1);(e==null?void 0:e.deal_type_id)==3||x(t.no_of_dwelling);const f=(e==null?void 0:e.deal_type_id)==3?1:x(t.no_of_dwelling);if((!Number.isInteger(f)||f<1)&&(W("no_of_dwelling",{type:"manual",message:"At least one unit is required"}),c.push("Number of Dwellings"),n=!1),f>1){const d=x(t.average_rent_per_unit);(!d||d<=0)&&(W("average_rent_per_unit",{type:"manual",message:"Average rent per unit is required when there are multiple dwellings"}),c.push("Average Rent per Unit"),n=!1)}return{isValid:n,errorFields:c}},k=t=>{if(!(e!=null&&e.id)){console.error("Deal ID is missing");return}const{isValid:n,errorFields:c}=p(t);if(!n){console.warn("Validation failed. These fields are missing or invalid:",c);return}const a={};Object.keys(t).forEach(b=>{a[b]=typeof t[b]=="string"?Yt(t[b]):t[b]}),je.forEach(b=>{(!a[b]||a[b]==="")&&(a[b]="0")});const _={step:2,_method:"PATCH",purchase_price:a.purchase_price||0,before_refurb_loan_to_value_percentage:a.before_refurb_loan_to_value_percentage||0,before_refurb_interest_rate_percentage:a.before_refurb_interest_rate_percentage||0,before_refurb_mortgage_value:a.before_refurb_mortgage_value||0,before_refurb_mortage_cost:a.before_refurb_mortage_cost||0,stamp_duty_amount:a.stamp_duty_amount||0,effective_rate_percentage:a.effective_rate_percentage||0,deposit_percentage:a.deposit_percentage||0,deposit_amount_required:a.deposit_amount_required||0,before_refurb_professional_fees:a.before_refurb_professional_fees||0,deal_sourcing_fees:a.deal_sourcing_fees||0,total_investment:a.total_investment||0,refurbishment_cost:a.refurbishment_cost||0,contigency_percentage:a.contigency_percentage||0,contigency_amount:a.contigency_amount||0,furnishing_cost:a.furnishing_cost||0,project_management_fees:a.project_management_fees||0,total_cash_investment:a.total_cash_investment||0,gross_domestic_value:a.gross_domestic_value||0,after_refurb_loan_to_value_percentage:a.after_refurb_loan_to_value_percentage||0,after_refurb_interest_rate_percentage:a.after_refurb_interest_rate_percentage||0,after_refurb_mortgage_value:a.after_refurb_mortgage_value||0,after_refurb_mortage_cost:a.after_refurb_mortage_cost||0,after_refurb_professional_fees:a.after_refurb_professional_fees||0,after_refurb_money_left_in:a.after_refurb_money_left_in||0,money_in_cash_invested_percentage:a.money_in_cash_invested_percentage||0,after_refurb_money_out:a.after_refurb_money_out||0,money_out_cash_invested_percentage:a.money_out_cash_invested_percentage||0,no_of_unit_achievable:(e==null?void 0:e.deal_type_id)==3?1:a.no_of_dwelling||0,average_rent_per_unit:a.average_rent_per_unit||0,monthly_rental_income:a.monthly_rental_income||0,annual_rental_income:a.annual_rental_income||0,management_fee_percentage:a.management_fee_percentage||0,management_fees:a.management_fees||0,maintenance_fee_percentage:a.maintenance_fee_percentage||0,insurance:a.insurance||0,other_expenses:a.other_expenses||0,profit_amount:a.profit_amount||0,annual_profit_amount:a.annual_profit_amount||0,return_on_cash_investment_percentage:se==null?void 0:se.payloadROI,payback_period:(se==null?void 0:se.payloadPaybackPeriod)||0,investment_type:a.investment_type||"others"};t.property_type_id,H({apiFn:()=>lt(e.id,_),onSuccess:b=>{var f;r(mt(!0));const u={step:"2",...b==null?void 0:b.deal,id:(f=b==null?void 0:b.deal)==null?void 0:f.id,management_fee_percentage:a.management_fee_percentage||"",mortgage_payment:a.mortgage_payment||"",contigency_percentage:a.contigency_percentage||""};r(gt(u)),g("/create-deal/description")},onError:b=>{console.error("Error updating deal:",b)}})},P=(t,n,c)=>{const a=["profitable","before_refurb_professional_fees","contigency_percentage","furnishing_cost","project_management_fees","after_refurb_professional_fees","management_fee_percentage","maintenance_fee_percentage"].includes(t.name),_=t.reversed,b=t.name==="payback_period",u=(e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling"));if(t.name==="average_rent_per_unit"&&u===1)return null;const f=(t==null?void 0:t.name)==="stamp_duty_amount"?!ie:t.name==="monthly_rental_income"&&u===1?!1:t.calculated,d=t.name==="monthly_rental_income"&&u===1?!1:t.calculated,I={required:d||a?!1:`${t.label} is required`,...b||d?{}:{pattern:{value:t.isPercentage?/^[0-9.,]*%?$/:/^[0-9,]*\.?[0-9]*$/,message:"Please enter numbers only"},validate:{...t.isPercentage?{percentage:y=>en(y,t.name)}:{},maxValue:y=>Jt(y,t.name)}}},D={placeholder:d?"0":t.isPercentage?"0%":"Enter Amount",className:(t==null?void 0:t.name)==="stamp_duty_amount"?wt:f?Zt:wt,onKeyPress:y=>{if(!b&&!["Backspace","Delete","Tab","Escape","Enter","ArrowLeft","ArrowRight"].includes(y.key)){if(t.isPercentage){if(y.key==="."&&!y.target.value.includes("."))return;if(y.key==="."&&y.target.value.includes(".")){y.preventDefault();return}/[0-9]/.test(y.key)||y.preventDefault();return}/[0-9,]/.test(y.key)||y.preventDefault()}},readOnly:f,onFocus:y=>{if(t.isPercentage&&!f){const j=y.target.value;j&&j.includes("%")&&setTimeout(()=>{const M=j.length-1;y.target.setSelectionRange(M,M)},0)}},onChange:y=>{let j=y.target.value;if(t.isPercentage){m(y,t.name);return}let M=j.replace(/[^0-9,]/g,"");const J=M.split(",");if(J.length>2&&(M=J[0]+","+J.slice(1).join("")),i(t.name,M),M&&!isNaN(parseFloat(M.replace(/,/g,"")))){const me=Math.round(parseFloat(M.replace(/,/g,"")));y.target.value=me.toLocaleString("en-US")}else M===""&&(y.target.value="");at(M,i,t.name,c,W,B,w),jt(M,i,t.name,c,W,B,w)},onBlur:y=>{if(t.name==="purchase_price")N(y);else if(t.isPercentage&&!f){const j=y.target.value;j&&!j.includes("%")?(y.target.value=Ne(j),i(t.name,j)):j===""&&(y.target.value="",i(t.name,""))}}};if(f&&t.isPercentage){const y=w(t.name);y&&(D.value=Ne(y))}const q=o.jsxs("div",{className:"",children:[o.jsx("div",{className:"purchase-price-input-wrap form-control",children:o.jsx("input",{type:"text",...n(t.name,I),...D})}),c[t.name]&&o.jsx("p",{className:"text-red-500 text-sm mt-2",style:{fontSize:"11px"},children:c[t.name].message})]}),oe=o.jsx("div",{className:"purchase-price-label-wrap",children:o.jsx("label",{className:"font-semibold text-[#595959] dark:text-[#C5C5C5]",children:((e==null?void 0:e.deal_type_id)===3||(e==null?void 0:e.deal_type_id)===5)&&(t==null?void 0:t.name)==="no_of_dwelling"?"Number of bedrooms":(e==null?void 0:e.deal_type_id)===5&&(t==null?void 0:t.name)==="maintenance_fee_percentage"?"Bills":t.label})});return o.jsx("div",{className:"purchase-custom-grid",children:_?o.jsxs(o.Fragment,{children:[q,oe]}):o.jsxs(o.Fragment,{children:[oe,q]})})},$=(t,n,c)=>{const a=(e==null?void 0:e.deal_type_id)==3?1:x(w("no_of_dwelling"));if(t.fields.length===1&&t.fields[0].name==="average_rent_per_unit"&&a===1)return null;const _=(t.highlight,"my-4"),b=t.fields.filter(u=>!(u.name==="no_of_dwelling"&&((e==null?void 0:e.deal_type_id)===2||(e==null?void 0:e.deal_type_id)===3)||(u.name==="insurance"||u.name==="other_expenses")&&(e==null?void 0:e.deal_type_id)===5));return b.length===0?null:t.columns===2?o.jsx("div",{className:_,children:o.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:b.map(u=>o.jsx("div",{className:"purchase-price-group-wrap relative",children:u.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[P(u,n,c),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ie?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(f=>!f),children:o.jsx(ze,{className:"w-4 h-4"})})]}):P(u,n,c)},u.name))})}):o.jsx("div",{className:"purchase-price-group-wrap",children:b.map(u=>o.jsx("div",{className:"relative",children:u.name==="stamp_duty_amount"?o.jsxs("div",{className:"relative",children:[P(u,n,c),o.jsx("button",{type:"button",className:`absolute right-3 top-[70%] ${ie?"!text-blue-600":""} -translate-y-1/2 text-gray-500 hover:text-blue-600`,onClick:()=>Fe(f=>!f),children:o.jsx(ze,{className:"w-4 h-4"})})]}):P(u,n,c)},u.name))})},A=(t,n,c)=>o.jsx("div",{className:"financial-form-main-container-wrapper",children:o.jsx("div",{className:"financial-form-container-wrapper",children:o.jsxs("div",{className:"",children:[o.jsx("div",{className:"financial-form-heading-col mb-3",children:o.jsx("h4",{className:"font-bold text-purple dark:text-white",children:t.title})}),o.jsx("div",{className:"financial-form-col-wrap relative",children:t.fields.map(a=>a.rows.map((_,b)=>o.jsx(Ie.Fragment,{children:$(_,n,c)},b)))})]})})}),Q=L({control:G,name:"before_refurb_loan_to_value_percentage"}),z=L({control:G,name:"deposit_percentage"});return V.useEffect(()=>{if(!Q)return;const t=x(Q),n=100-t;i("deposit_percentage",n.toString()),B("deposit_percentage");const c=document.querySelector('input[name="deposit_percentage"]');c&&!c.readOnly&&(c.value=Ne(n));const a=x(w("purchase_price"));if(a>0&&t>0){const _=a*(n/100);i("deposit_amount_required",te(_))}},[Q]),V.useEffect(()=>{if(!z)return;const t=x(z),n=100-t;i("before_refurb_loan_to_value_percentage",n.toString());const c=document.querySelector('input[name="before_refurb_loan_to_value_percentage"]');c&&!c.readOnly&&(c.value=Ne(n));const a=x(w("purchase_price"));if(a>0&&n>0){const _=a*(n/100);i("before_refurb_mortgage_value",te(_));const b=x(w("before_refurb_interest_rate_percentage"))/100,u=_*b/12;i("before_refurb_mortage_cost",te(u));const f=a*(t/100);i("deposit_amount_required",te(f))}},[z]),o.jsxs(o.Fragment,{children:[re&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:o.jsx("div",{children:o.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})})}),o.jsxs("form",{onSubmit:U(k),children:[$t.map(t=>o.jsx(Ie.Fragment,{children:A(t,ke,pe)},t.id)),s.pathname==="/create-deal/financials"&&o.jsxs("div",{className:"flex items-center justify-between mt-2 case3 px-4 pb-4",children:[o.jsxs("button",{type:"button",onClick:()=>g("/create-deal/address"),style:{display:"flex"},className:"w-fit items-center gap-5 justify-center",children:[o.jsx(ut,{}),"Back"]}),o.jsxs("button",{type:"submit",style:{display:"flex"},className:"w-fit purple-btn items-center gap-5 justify-center kkkk",children:["Next",o.jsx(_t,{})]})]})]})]})},rn=()=>{const e=Ue(),s=we(l=>l.deal.deal),r=e.pathname.includes("/summary"),{currentCase:g}=Lt({deal_type_id:s==null?void 0:s.deal_type_id});return o.jsxs("div",{className:"min-h-screen financial-page-main-div-wrap",children:[o.jsx("div",{className:"financial-details-step-heading",children:o.jsx("h4",{className:"font-semibold heading-color2 dark:text-white",children:"Financial details"})}),o.jsx("div",{className:"financial-page-inner-div-wrap",children:r?o.jsx(qt,{currentCase:g}):o.jsxs(o.Fragment,{children:[g==="CASE_1"&&o.jsx(Pt,{}),g==="CASE_2"&&o.jsx(Xt,{}),g==="CASE_3"&&((s==null?void 0:s.exit_type_id)===1?o.jsx(Rt,{}):o.jsx(Pt,{})),g==="CASE_4"&&o.jsx(Rt,{})]})})]})};export{rn as default};
