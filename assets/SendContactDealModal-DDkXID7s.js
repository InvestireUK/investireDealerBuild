import{u as S,r as u,t as K,cb as Q,w as R,m as s,cc as Y,z as F,aB as G,aj as J,cd as O}from"./index-_rvvEIkh.js";import{l as V}from"./lodash-DpfdCPqs.js";const te=({isOpen:f,onClose:w,selectedDeals:p})=>{const b=S(e=>e.deal.deal),{role:W,user:X}=S(e=>e.user),[g,_]=u.useState([]),[c,m]=u.useState([]),[P,N]=u.useState(!1),[j,C]=u.useState(!1),[E,y]=u.useState(""),[Z,D]=u.useState({currentPage:1,perPage:10,totalItems:0,totalPages:1,hasMorePages:!1}),[k,v]=u.useState({page:1,perPage:10,sortColumn:"created_at",sortOrder:"desc",search:""}),{showSnackbar:d}=K();u.useEffect(()=>{f?$():(m([]),y(""),v(e=>({...e,search:"",page:1})))},[f,k.page,k.search]);const A=V.debounce(e=>{v(r=>({...r,search:e,page:1}))},500),I=e=>{const r=e.target.value;y(r),A(r)},$=async()=>{var e,r,l,i,x,a,h,o;if(f){N(!0);try{const n=await Q(k),{data:t}=n==null?void 0:n.data;_((t==null?void 0:t.contacts)||[]),D({currentPage:parseInt((e=t==null?void 0:t.page_context)==null?void 0:e.page)||1,perPage:parseInt((r=t==null?void 0:t.page_context)==null?void 0:r.per_page)||10,totalItems:parseInt((l=t==null?void 0:t.page_context)==null?void 0:l.total_records)||0,totalPages:Math.ceil(parseInt(((i=t==null?void 0:t.page_context)==null?void 0:i.total_records)||0)/parseInt(((x=t==null?void 0:t.page_context)==null?void 0:x.per_page)||10)),hasMorePages:((a=t==null?void 0:t.page_context)==null?void 0:a.has_more_page)==="true"})}catch(n){console.error("Error fetching contacts:",n),d(((o=(h=n==null?void 0:n.response)==null?void 0:h.data)==null?void 0:o.message)||"Failed to fetch contacts. Please try again.","error")}finally{N(!1)}}},M=e=>{m(r=>r.includes(e)?r.filter(l=>l!==e):[...r,e])},U=e=>{if(e.target.checked){const r=g.map(l=>l.id);m(r)}else m([])},z=async()=>{var e,r,l,i,x;if(c.length===0){d("Please select at least one contact","error");return}if(!p||p.length===0){d("No deals selected to share","error");return}C(!0);try{const a=await O(c,p);d(((e=a==null?void 0:a.data)==null?void 0:e.message)||"Deals shared successfully with selected contacts","success"),w()}catch(a){console.error("Error sending deals:",a);let h="Failed to share deals. Please try again.";if((l=(r=a==null?void 0:a.response)==null?void 0:r.data)!=null&&l.errors){const o=a.response.data.errors;if(Array.isArray(o)&&o.length>0){const n=o[0],t=Object.keys(n)[0];t&&(h=n[t])}else if(typeof o=="object"&&o!==null){const n=Object.keys(o)[0];n&&(h=o[n])}else typeof o=="string"&&(h=o)}else(x=(i=a==null?void 0:a.response)==null?void 0:i.data)!=null&&x.message&&(h=a.response.data.message);d(h,"error")}finally{C(!1)}},L=async()=>{if(!(b!=null&&b.unique_id)){d("Deal information not available","error");return}try{const r=`${window.location.origin}/deal-details/${b.unique_id}`;await navigator.clipboard.writeText(r),d("Share link copied to clipboard!","success")}catch(e){console.error("Failed to copy link:",e),d("Failed to copy share link","error")}},B=()=>{m([]),y(""),v(e=>({...e,search:"",page:1})),w()},H=R(),T=()=>{H("/all-contacts")};if(!f)return null;const q=e=>{var r,l,i,x,a;return!(e!=null&&e.user_id)||((r=e==null?void 0:e.user)==null?void 0:r.deleted_at)!==null?"Inactive":((l=e==null?void 0:e.user)==null?void 0:l.deleted_at)===null&&((i=e==null?void 0:e.user)==null?void 0:i.is_active)===1?"Active":((x=e==null?void 0:e.user)==null?void 0:x.deleted_at)===null&&((a=e==null?void 0:e.user)==null?void 0:a.is_active)===0?"Disabled":"Inactive"};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-[#fff] rounded-lg p-6 w-full max-w-3xl dark:bg-[#121212]",style:{maxHeight:"80vh",overflowY:"hidden"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-5",children:[s.jsx("h3",{className:"text-xl font-semibold dark:text-white",children:"Share as"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:L,disabled:p.length!==1,className:`flex items-center gap-2 font-semibold
    ${p.length!==1?"text-gray-400 cursor-not-allowed":"text-[#6C5DD3] hover:text-[#5a4bb2]"}`,children:[s.jsx(Y,{className:"font-semibold"}),s.jsx("span",{children:"Copy link"})]}),s.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-3xl",onClick:B,children:"âœ•"})]})]}),s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"relative w-4/5",children:s.jsx("input",{type:"text",placeholder:"Email address",className:"w-full form-control py-3 px-4 text-base",value:E,onChange:I})}),s.jsx("h3",{className:"ml-4 text-sm font-semibold dark:text-white text-[#595959]",children:c&&c.length>0?`${c.length} user${c.length>1?"s":""} selected`:"None selected"})]}),s.jsxs("div",{className:"flex items-center gap-2 mb-3 pl-[9px]",children:[s.jsx("input",{type:"checkbox",checked:g.length>0&&c.length===g.length,onChange:U}),s.jsx("span",{className:"text-sm font-medium dark:text-white text-[#595959]",children:"Select all"})]}),s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("div",{className:"flex items-center gap-4"})}),s.jsx("div",{className:"overflow-x-auto overflow-y-auto",style:{minHeight:"200px",maxHeight:"calc(80vh - 250px)"},children:P?s.jsx("div",{className:"flex justify-center items-center h-full",children:s.jsx(F,{})}):g.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:s.jsx("div",{className:"text-center py-4 dark:text-white text-[#333]",children:"To share the deal you need to add contacts first."})}):s.jsx("table",{className:"w-full text-left border-collapse",children:s.jsx("tbody",{children:g.map((e,r)=>{var l;return s.jsxs("tr",{className:"flex justify-between items-center",children:[s.jsxs("td",{className:"flex items-center gap-2 p-2 py-3 dark:text-white text-[#000]",children:[s.jsx("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>M(e.id)}),s.jsx("span",{className:"text-purple-800 font-semibold text-xl bg-purple-200 w-10 h-10 flex items-center justify-center rounded-full dark:bg-purple-950 dark:text-purple-700",children:(l=e.name)==null?void 0:l.charAt(0).toUpperCase()}),s.jsx("span",{className:"max-w-[100px] truncate cursor-pointer text-[#242424] text-lg font-medium dark:text-[#F8F8F8]",title:e.name,children:e.name})]}),s.jsx("td",{className:"p-4",children:(()=>{const i=q(e);return s.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
        ${i==="Active"?"bg-[#ECFDF3] text-[#054F31] border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":i==="Disabled"?"bg-red-100 text-red-700 border border-red-300":"bg-[#FFF8E1] text-[#FB6E0A] border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:i})})()})]},e.id)})})})}),s.jsxs("div",{className:"flex justify-between mt-6 items-center gap-4 flex-shrink-0",children:[s.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-md hover:bg-[#5a4bb2] transition-colors whitespace-nowrap",onClick:T,children:[s.jsx(G,{size:14}),s.jsx("span",{children:"Add Contact"})]}),s.jsx("button",{onClick:z,disabled:c.length===0||j,className:`flex items-center justify-center gap-2 px-6 py-2 bg-[#6C5DD3] text-white rounded-md transition duration-200 whitespace-nowrap ${c.length===0||j?"opacity-50 cursor-not-allowed":"hover:bg-[#5a4bb2]"}`,children:j?s.jsx(F,{size:20}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Send Deal"}),s.jsx(J,{className:"text-lg"})]})})]})]})})};export{te as S};
