import{V as Y,v as Q,u as k,r as o,w as K,av as U,m as e,cn as J,z as W,aM as X,co as Z,cp as ee,cq as se,cr as ae,cs as O,ct as le,aO as re,aP as te,cu as ne,aR as oe,Q as ce,aH as de}from"./index-yP1sWvMT.js";import{S as ie}from"./SAManualComparables-CzK3ksk_.js";import{S as me}from"./SAComparablesMaps-_fu2a_yk.js";import"./DragAndDrop-yKTxSwUt.js";import"./index-ZFuqy95D.js";import"./ModifiedAutoAddressInput-6LSujhTJ.js";const Se=()=>{const{register:j,handleSubmit:pe,reset:N,setValue:xe,watch:u,formState:{errors:be}}=Y({defaultValues:{bedrooms:"",no_of_beds:""}}),f=Q(),M="AIzaSyDhNgmQPNc-YzwdfY9n98YwF04E770ta44",a=k(s=>{var t;return(t=s==null?void 0:s.deal)==null?void 0:t.deal});console.log("deal123456789",a);const[F,i]=o.useState(!1),[y,B]=o.useState([]),h=K(),[C,_]=o.useState(!1),[l,m]=o.useState([]),[ue,w]=o.useState(!1),g=k(s=>s.deal.manualComperable),[fe,he]=o.useState([]),{handleApiCall:P}=U(),$=()=>{l.length===d.length?m([]):m(d.map(s=>s.id||s.listing_url||s.temp_id))},d=[...Array.isArray(g)?g:[],...y||[]],v=u("bedrooms"),L=u("no_of_beds"),z=u("type_of_space");o.useEffect(()=>{a&&N({bedrooms:(a==null?void 0:a.no_of_dwelling)??"",no_of_beds:(a==null?void 0:a.no_of_guests)??""})},[a,N]);const S=async()=>{var s,t,r;try{_(!0),m([]);const c={address1:(a==null?void 0:a.address_line_1)||"",address2:(a==null?void 0:a.address_line_2)||"",city:(a==null?void 0:a.city)||"",postCode:(a==null?void 0:a.post_code)||"",country:((s=a==null?void 0:a.country)==null?void 0:s.name)||"",no_of_bedroom:v||1,no_of_beds:L||1,type_of_space:z||"",no_of_dwellings:(a==null?void 0:a.no_of_dwelling)||1,type:"ai"},n=await re(a.id,1,c),b=((t=n==null?void 0:n.data)==null?void 0:t.dealComparables)||[];B(b),b.length===0&&g.length===0&&!E&&(p(!0),x(!0))}catch(c){console.error("Error fetching AI comparables:",((r=c==null?void 0:c.response)==null?void 0:r.data)||c.message),E||(p(!0),x(!0))}finally{_(!1)}};o.useEffect(()=>{a!=null&&a.id&&S()},[]);const I=()=>{i(!0),w(!1),m([])},R=()=>{w(!1)},[ge,T]=o.useState(!1),[je,A]=o.useState(!1),[q,G]=o.useState([]),[H,p]=o.useState(!1),[E,x]=o.useState(!1),V=async()=>{var s,t;try{A(!0);const r=await te(a==null?void 0:a.id,1,q,v);f(ne(((s=r==null?void 0:r.data)==null?void 0:s.dealComparables)||[])),f(oe()),T(((t=r==null?void 0:r.data)==null?void 0:t.data)||[]),h("/create-deal/sa-comparable-table");const c={_method:"PATCH"};await P({apiFn:()=>de(a==null?void 0:a.id,c),onSuccess:n=>{var D;const b={...n==null?void 0:n.deal,id:(D=n==null?void 0:n.deal)==null?void 0:D.id};f(ce(b))},onError:n=>{console.error("Error updating deal:",n)}})}catch(r){console.error("Error fetching comparables:",r)}finally{A(!1)}};return o.useEffect(()=>{const s=d.filter(t=>l.includes(t.id||t.listing_url||t.temp_id));G(s)},[l]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sa-api-comparables-map-wrap",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[e.jsx("h5",{children:"Comparables"}),e.jsx("button",{className:"purple-btn my-4",style:{display:"flex"},onClick:()=>i(!0),children:"+ Add Comparable"})]}),F&&e.jsx(ie,{handleFinishSAManualComparable:I,handleCloseManualComparable:R,onClose:()=>i(!1)}),e.jsx("div",{className:"map-generated-sec mb-10",children:e.jsx("div",{className:"bg-[#EBEBEC] dark:bg-[#222632] flex items-center justify-center relative create-deal-upload-document-wrap",children:e.jsx(me,{locations:d,apiKey:M})})}),e.jsxs("div",{className:"sa-api-comparables-data-wrap",children:[e.jsx("h5",{className:"mb-8 font-semibold",children:"Nearby listings"}),e.jsx("div",{className:"filters my-5",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-2 mb-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"No. of Bedrooms"}),e.jsx("input",{type:"string",...j("bedrooms"),className:"form-control focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block form-label",children:"No. of Beds"}),e.jsx("input",{type:"string",...j("no_of_beds"),className:"form-control focus:outline-none"})]}),e.jsx("div",{className:"purple-btn h-[48px] mt-[30px]",children:e.jsxs("button",{className:"flex items-end gap-2 whitespace-nowrap",onClick:S,children:[e.jsx(J,{className:"text-lg"}),e.jsx("span",{children:"Search"})]})})]})}),C&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(W,{})}),!C&&d.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center border border-gray-200 rounded-xl bg-gray-50",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-700 mb-3",children:"No comparables found."}),e.jsx("p",{className:"text-gray-500 mb-5",children:"Try adjusting your filters or add a comparable manually."}),e.jsx("button",{className:"purple-btn flex items-center gap-2",onClick:()=>i(!0),children:"+ Add Manual Comparable"})]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"purple-btn cursor-pointer mb-5",onClick:$,children:l.length===d.length?"Unselect All":"Select All"}),d.map((s,t)=>{const r=s.id||s.listing_url||s.temp_id||`temp-${t}`;return e.jsxs("div",{className:`
                grid
                grid-cols-1
                md:grid-cols-[15px_1fr_2fr_10%]
                gap-5
                my-10
                items-start
            `,children:[e.jsx("input",{type:"checkbox",checked:l.includes(r),onChange:()=>{m(c=>c.includes(r)?c.filter(n=>n!==r):[...c,r])},className:"order-4 md:order-none"}),e.jsx("div",{className:"w-full h-[200px] md:h-[200px] order-1 md:order-none",children:e.jsx("img",{src:(s==null?void 0:s.image_url)||(s==null?void 0:s.image)||X,alt:"Image",className:"w-full h-full object-cover rounded-[20px]"})}),e.jsxs("div",{className:"ai-api-data flex flex-col gap-1 order-2 md:order-none",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"font-semibold text-[20px]",children:[s.title," ",e.jsx("span",{className:"text-sm text-[#595959]",children:s.distance_meters?`${Number(s.distance_meters).toFixed(2)} ml`:""})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-3",children:[e.jsxs("div",{className:"ai-information flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bedroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{}),e.jsx("span",{className:"font-semibold text-base",children:s.no_of_bathroom})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{}),e.jsxs("span",{className:"font-semibold text-base",children:[s.beds," Guests"]})]})]}),e.jsxs("div",{className:"reviews flex items-center gap-1",children:[e.jsx(ae,{className:"text-[#FB6E0A]"}),e.jsx("p",{children:s.rating||0}),e.jsxs("p",{children:["(",s.reviews||0," reviews)"]})]})]}),e.jsxs("div",{className:"ai-percentage grid grid-cols-2  md:flex  md:flex-nowrap  items-center  md:justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center border-r md:border-r border-b md:border-b-0 border-[#ECECEC] px-5 py-3",children:[e.jsx("p",{className:"text-2xl",children:s.days_available||"-"}),e.jsx("h6",{className:"text-sm",children:"Days available"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r md:border-r border-b md:border-b-0 border-[#ECECEC] px-5 py-3",children:[e.jsx("p",{className:"text-2xl",children:s.occupancy||"-"}),e.jsx("h6",{className:"text-sm",children:"Occupancy"})]}),e.jsxs("div",{className:"flex flex-col items-center border-r md:border-r border-b md:border-b-0 border-[#ECECEC] px-5 py-3",children:[e.jsxs("p",{className:"text-2xl",children:["£",s.adr||"-"]}),e.jsx("h6",{className:"text-sm",children:"ADR"})]}),e.jsxs("div",{className:"flex flex-col items-center px-5 py-3",children:[e.jsx("p",{className:"text-2xl",children:s!=null&&s.revenue?`£${s.revenue}`:"-"}),e.jsx("h6",{className:"text-sm",children:"Revenue"})]})]})]}),e.jsxs("div",{className:"links flex flex-row md:flex-col items-center gap-5 border-t md:border-t-0  md:border-l border-[#ECECEC]  pt-5 md:pt-0 order-3 md:order-none",children:[s.listing_url?e.jsx("a",{href:s.listing_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(O,{className:"w-7 h-7 text-[#6C5DD3] cursor-pointer"})}):e.jsx(O,{className:"w-7 h-7 text-gray-400 cursor-not-allowed"}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.lat},${s.lng}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(le,{className:"w-7 h-7 text-[#6C5DD3]"})})]})]},r)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-5",children:[e.jsx("button",{className:"text-[#242424] border border-[#ECECEC] px-4 py-2 rounded-lg",onClick:()=>h("/create-deal/description"),children:"Cancel"}),e.jsx("button",{onClick:()=>{(l==null?void 0:l.length)>0&&V()},className:`w-fit items-center gap-5 justify-center px-4 py-2 rounded ${(l==null?void 0:l.length)>0?"purple-btn cursor-pointer":"bg-[#ECECEC] text-[#AFAFAF] cursor-not-allowed"}`,style:{display:"flex"},disabled:(l==null?void 0:l.length)===0,children:`Import ${(l==null?void 0:l.length)||""} item${(l==null?void 0:l.length)===1?"":"s"}`})]})]}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[99999]",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3 text-center",children:"No comparables found"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Do you want to add a manual comparable or continue without adding any?"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{className:"px-4 py-2 border rounded-lg",onClick:()=>{p(!1),x(!0),i(!0)},children:"Add Manually"}),e.jsx("button",{className:"px-4 py-2 rounded-lg purple-btn",onClick:()=>{p(!1),x(!0),h("/create-deal/sa-comparable-table")},children:"Continue"})]})]})})]})};export{Se as default};
