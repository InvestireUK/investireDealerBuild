import{w as X,t as ee,ax as se,u as te,V as pe,r,bl as be,m as e,z as ae,bm as ge,bn as fe,bo as je,a5 as ve,aB as we,A as Ne,n as ke,o as ye,q as Fe,bp as Me,bq as Ee,br as Se}from"./index-CqGVojfI.js";import{D as _e}from"./DeleteConfirmationModal-D7VKndpH.js";import{l as De}from"./lodash-DbeJ46Qt.js";import Ce from"./AddMemberForm-C3l2-cEd.js";import{P as Ae}from"./PaginationNew-DHHKYoSy.js";import{u as Pe}from"./useRefreshUser-VyFRMzsO.js";const Le=({isOpen:g,onClose:p,memberId:h,onSuccess:f})=>{const z=X(),{showSnackbar:E}=ee(),{handleApiCall:C,loading:b}=se(),{role:k}=te(i=>i.user),{register:j,handleSubmit:$,reset:q,setValue:v,watch:c,formState:{errors:m}}=pe({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",role:""}}),[A,P]=r.useState(!1),[L,I]=r.useState(!1),[H,U]=r.useState([null,null]);r.useRef(null);const[O,S]=r.useState("");r.useEffect(()=>{g&&h&&(L||_())},[g,h]);const _=async()=>{var i,x,F,B;if(h){P(!0);try{const w=await be(h),N=(x=(i=w==null?void 0:w.data)==null?void 0:i.data)==null?void 0:x.user;N&&(v("first_name",N.first_name||""),v("last_name",N.last_name||""),v("email",N.email||""),v("role",((B=(F=N.roles)==null?void 0:F[0])==null?void 0:B.name)||"teamki"),v("password","")),I(!0)}catch(w){console.error("Failed to fetch member details",w),E("Failed to fetch member details","error")}finally{P(!1)}}},y=i=>{if(!h){E("Missing member ID. Cannot update.","error");return}const x={...i};x.password||delete x.password,C({apiFn:()=>je(h,x),data:x,onSuccess:()=>{E("Member updated","success"),f&&f(),p(),z("/all-members")}})},u=()=>{q(),p()};if(!g)return null;if(!h)return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg p-6 w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"No Member Selected"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Cannot open edit form without a member ID."}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",onClick:p,children:"Close"})]})});const[T,d]=r.useState(!1);return c("role"),e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl relative dark:bg-[#181818]",children:[(b||A)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(ae,{})}),e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:p,children:"✕"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-[#F8F8F8]",children:"Edit Team Member"})]}),e.jsxs("form",{onSubmit:$(y),className:"space-y-4 p-5 bg-[#FDFDFD] rounded-xl dark:bg-[#181818]",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Full Name"}),e.jsx("input",{type:"text",...j("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),m.first_name&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:m.first_name.message}),e.jsx("input",{type:"hidden",...j("last_name")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Email"}),e.jsx("input",{type:"email",...j("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),className:"w-full border px-3 py-2 rounded-xl mb-4 dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Email"}),m.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Password (leave blank to keep current)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T?"text":"password",...j("password",{minLength:{value:8,message:"Password must be at least 8 characters"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*\.]).*$/,message:"Password must contain at least one uppercase letter, one lowercase letter, and one symbol"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter New Password (optional)"}),e.jsx("span",{className:"absolute right-3 top-[38%] -translate-y-1/2 cursor-pointer text-purple",onClick:()=>d(i=>!i),children:T?e.jsx(ge,{}):e.jsx(fe,{})})]}),m.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.password.message})]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-white",children:"Select Role"}),e.jsxs("select",{...j("role",{required:"Role is required"}),disabled:k!=="deal-sourcer",className:`w-full border p-3 rounded-xl mb-4 text-sm 
      dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]
      ${k!=="deal-sourcer"?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"team-lead",children:"Team Lead"}),e.jsx("option",{value:"team",children:"Team Member"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",onClick:u,disabled:b,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",disabled:b,children:"Update Member"})]})]})]})})},Ue=()=>{var J,K,W;const{role:g,user:p}=te(s=>s.user);console.log("MembersTable user:",p);const h=X(),{showSnackbar:f}=ee(),{handleApiCall:z}=se(),[E,C]=r.useState(!1),[b,k]=r.useState([]),[j,$]=r.useState(),[q,v]=r.useState(""),[c,m]=r.useState(null),[A,P]=r.useState({top:0,left:0}),L=Pe(),[I,H]=r.useState(!1),U=(p==null?void 0:p.user_subscription)||{},O=Number(U.user_limit);Number(U.original_user_limit||0),console.log("userLimit:",O);const S=ve(),[_,y]=r.useState({isOpen:!1,memberId:null,isLoading:!1}),[u,T]=r.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[d,i]=r.useState({page:1,per_page:(u==null?void 0:u.total)>=5?5:(u==null?void 0:u.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""}),x=r.useRef(null),F=r.useRef({});r.useEffect(()=>{function s(l){x.current&&!x.current.contains(l.target)&&m(null)}function a(){c!==null&&m(null)}function o(){if(c!==null&&F.current[c]){const n=F.current[c].getBoundingClientRect(),M=window.innerHeight-n.bottom,D=n.top;H(M<200&&D>200),P({top:I?n.top-10:n.bottom+5,left:n.right-160})}}return o(),document.addEventListener("mousedown",s),document.addEventListener("scroll",a,!0),window.addEventListener("resize",o),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("scroll",a,!0),window.removeEventListener("resize",o)}},[c,I]);const B=De.debounce(s=>{i(a=>({...a,search:s,page:1}))},500),w=s=>{const a=s.target.value;v(a),B(a)},N=s=>{const{name:a,value:o}=s.target;i({...d,[a]:o,page:1})},R=async()=>{var s,a,o;C(!0);try{const l=await Me({...d,perPage:d.per_page||10,status:d.status==="all"?null:d.status}),n=l==null?void 0:l.data,M=(n==null?void 0:n.users)||[];k(M);const D=((s=n==null?void 0:n.user_subscription)==null?void 0:s.user_limit)??0,t=l.data.page_context;t&&(T({currentPage:parseInt(t==null?void 0:t.page)||1,totalPages:Math.ceil(parseInt((t==null?void 0:t.total_records)||0)/parseInt((t==null?void 0:t.per_page)||10)),from:(parseInt(t.page)-1)*parseInt(t.per_page)+1,to:Math.min(parseInt(t==null?void 0:t.page)*parseInt(t==null?void 0:t.per_page),parseInt((t==null?void 0:t.total_records)||0)),total:parseInt((t==null?void 0:t.total_records)||0),hasMorePages:(t==null?void 0:t.has_more_page)==="true"}),await L())}catch(l){console.error("Error fetching members:",l),f(((o=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to fetch team members. Please try again.","error")}finally{C(!1)}};r.useEffect(()=>{R()},[d]);const re=s=>{y({isOpen:!0,memberId:s,isLoading:!1})},Q=()=>{y({isOpen:!1,memberId:null,isLoading:!1})},le=()=>{y(s=>({...s,isLoading:!0})),z({apiFn:()=>Se(_.memberId),onSuccess:()=>{R(),Q(),f("Team member deleted successfully","success")},onError:s=>{y(a=>({...a,isLoading:!1}))}})},ne=s=>{$(s),Y(!0)},oe=()=>g==="team"?{allowed:!1,message:"You do not have permission to add team members"}:O<0?{allowed:!1,message:"You have exceeded your team limit. Please deactivate users to continue."}:O===0?{allowed:!1,message:"You've reached your plan’s team member limit. Upgrade your plan to add more team members."}:{allowed:!0},de=()=>{const s=oe();if(!s.allowed){f(s.message,"error");return}V(!0)},ie=()=>{V(!1)},ce=()=>{Y(!1)};r.useEffect(()=>{var s;(s=S.state)!=null&&s.openModal&&(setIsModalOpen(!0),h(S.pathname,{replace:!0,state:{}}))},[S.state,h,S.pathname]);const me=s=>{i(a=>({...a,sortColumn:s,sortOrder:a.sortColumn===s&&a.sortOrder==="asc"?"desc":"asc",page:1}))},ue=()=>(console.log("Current page members:",b),b),[Ie,Oe]=r.useState(null),[Z,V]=r.useState(!1),[G,Y]=r.useState(!1),xe=async s=>{const a=s.is_active?0:1;k(o=>o.map(l=>l.id===s.id?{...l,is_active:a}:l));try{await Ee(s.id,{is_active:a}),await L()}catch{k(l=>l.map(n=>n.id===s.id?{...n,is_active:s.is_active}:n)),f("User limit exceeded","error")}};return e.jsxs("div",{className:"min-h-screen dark:bg[#111827]",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col items-start justify-center  md:flex-row md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Team Members"}),e.jsx("p",{className:"text-[#333333] dark:text-white",children:"Manage your team members and their access"})]}),g!=="team"&&e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:de,className:"flex items-center gap-2 px-4 py-3 rounded-md bg-[#6C5DD3] text-white hover:bg-[#5a4bb2] transition-colors",children:[e.jsx(we,{size:14}),e.jsx("span",{children:"Add Member"})]})})]})}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:gap-0 md:flex-row space-x-4 justify-between px-4 py-4 items-start",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for team members",className:"form-control",value:q,onChange:w,style:{paddingLeft:"40px"}}),e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(s=>e.jsx("button",{onClick:()=>N({target:{name:"status",value:s.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${d.status===s.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:s.label},s.value))})})]}),e.jsx("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] overflow-hidden comparable-listing-table-wrap",children:E?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(ae,{})}):b.length===0?e.jsx("div",{className:"text-center p-12 dark:text-white text-dark",children:e.jsx("p",{children:"No team members found. Add some members to see them here."})}):e.jsx("div",{className:"whitespace-nowrap",children:e.jsxs("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-[#F8F8F8] border dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SN NO."}),e.jsx("th",{className:"p-4",children:"TEAM MEMBER"}),e.jsx("th",{className:"p-4",children:"EMAIL"}),e.jsx("th",{className:"p-4",children:"Role"}),e.jsx("th",{className:"p-4",children:"STATUS"}),e.jsxs("th",{className:"p-4 cursor-pointer",onClick:()=>me("created_at"),children:["CREATED AT",d.sortColumn==="created_at"&&e.jsx("span",{className:"ml-1",children:d.sortOrder==="asc"?"↑":"↓"})]}),g!=="team"&&e.jsx("th",{className:"p-4 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{children:ue().map((s,a)=>{var o,l,n,M,D,t;return e.jsxs("tr",{className:a%2===0?"text-dark dark:text-white":"dark:bg-[#191D27] bg-[#DEDEE0] text-dark dark:text-white",children:[e.jsx("td",{className:"p-4",children:a+1}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 dark:bg-purple-800 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-purple-800 dark:text-purple-100",children:[((o=s.first_name)==null?void 0:o[0])||"",((l=s.last_name)==null?void 0:l[0])||""]})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium",children:s.first_name||s.last_name?`${s.first_name||""} ${s.last_name||""}`:"-"})})]})}),e.jsx("td",{className:"p-4",children:s.email||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm inline-block ${s.roles&&s.roles.length>0&&((n=s.roles[0])==null?void 0:n.name)==="team"||s.roles&&s.roles.length>0&&((M=s.roles[0])==null?void 0:M.name)==="deal-sourcer-team","text-dark"}`,children:s.roles&&s.roles.length>0&&((D=s.roles[0])==null?void 0:D.name)==="team"?"Team Member":s.roles&&s.roles.length>0&&((t=s.roles[0])==null?void 0:t.name)==="team-lead"?"Team Lead":"No Role"})}),e.jsx("td",{className:"p-4",children:e.jsx("button",{onClick:()=>xe(s),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200
      ${s.is_active?"bg-[#ECFDF3] border border-[#A6F4C5] dark:bg-[#053321] dark:border-[#05603A]":"bg-[#FFF8E1] border border-[#FEDE82] dark:bg-[#E56306] dark:border-[#FC8D0B]"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full transition-transform duration-200
        ${s.is_active?"translate-x-6 bg-[#054F31] dark:bg-[#6CE9A6]":"translate-x-1 bg-[#FB6E0A] dark:bg-[#FED350]"}`})})}),e.jsx("td",{className:"p-4",children:s.created_at?new Date(s.created_at).toLocaleDateString():"-"}),g!=="team"&&e.jsx("td",{className:"relative",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:he=>F.current[s.id]=he,onClick:()=>m(c===s.id?null:s.id),className:"text-lg",children:e.jsx(ke,{className:"text-[#595959]"})})})})]},s.id)})})]}),c!==null&&e.jsxs("div",{ref:x,style:{position:"fixed",top:`${A.top}px`,left:`${A.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsxs("button",{onClick:()=>{const s=b.find(a=>a.id===c);ne(s.id),m(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(ye,{className:"mr-2"})," Edit"]}),((W=(K=(J=b.find(s=>s.id===c))==null?void 0:J.roles)==null?void 0:K[0])==null?void 0:W.name)!=="deal-sourcer-team"&&e.jsxs("button",{onClick:()=>{re(c),m(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(Fe,{className:"mr-2"})," Delete"]})]})]})})}),e.jsx(Ae,{pagination:{total:u.total,currentPage:d.page,perPage:u.total>=5?5:u.total,totalPages:Math.ceil(u.total/d.per_page)},setFilters:i})]})]}),e.jsx(_e,{isOpen:_.isOpen,onClose:Q,onConfirm:le,isLoading:_.isLoading,title:"Delete Team Member"}),Z&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:ie,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Ce,{isOpen:Z,onSuccess:R,onClose:()=>V(!1)})]})}),G&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:ce,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Le,{memberId:j,onSuccess:R,isOpen:G,onClose:()=>Y(!1)})]})})]})};export{Ue as default};
