import{u as S,r as u,t as B,c9 as K,w as Q,m as s,ca as R,z as F,az as Y,ah as G,cb as J}from"./index-DQelCLvl.js";import{l as O}from"./lodash-C5ziK2Np.js";const se=({isOpen:g,onClose:w,selectedDeals:p})=>{const f=S(e=>e.deal.deal),{role:V,user:W}=S(e=>e.user),[k,_]=u.useState([]),[c,m]=u.useState([]),[E,N]=u.useState(!1),[b,C]=u.useState(!1),[P,y]=u.useState(""),[X,D]=u.useState({currentPage:1,perPage:10,totalItems:0,totalPages:1,hasMorePages:!1}),[j,v]=u.useState({page:1,perPage:10,sortColumn:"created_at",sortOrder:"desc",search:""}),{showSnackbar:d}=B();u.useEffect(()=>{g?$():(m([]),y(""),v(e=>({...e,search:"",page:1})))},[g,j.page,j.search]);const A=O.debounce(e=>{v(r=>({...r,search:e,page:1}))},500),I=e=>{const r=e.target.value;y(r),A(r)},$=async()=>{var e,r,n,i,x,a,h,o;if(g){N(!0);try{const l=await K(j),{data:t}=l==null?void 0:l.data;_((t==null?void 0:t.contacts)||[]),D({currentPage:parseInt((e=t==null?void 0:t.page_context)==null?void 0:e.page)||1,perPage:parseInt((r=t==null?void 0:t.page_context)==null?void 0:r.per_page)||10,totalItems:parseInt((n=t==null?void 0:t.page_context)==null?void 0:n.total_records)||0,totalPages:Math.ceil(parseInt(((i=t==null?void 0:t.page_context)==null?void 0:i.total_records)||0)/parseInt(((x=t==null?void 0:t.page_context)==null?void 0:x.per_page)||10)),hasMorePages:((a=t==null?void 0:t.page_context)==null?void 0:a.has_more_page)==="true"})}catch(l){console.error("Error fetching contacts:",l),d(((o=(h=l==null?void 0:l.response)==null?void 0:h.data)==null?void 0:o.message)||"Failed to fetch contacts. Please try again.","error")}finally{N(!1)}}},z=e=>{m(r=>r.includes(e)?r.filter(n=>n!==e):[...r,e])},M=async()=>{var e,r,n,i,x;if(c.length===0){d("Please select at least one contact","error");return}if(!p||p.length===0){d("No deals selected to share","error");return}C(!0);try{const a=await J(c,p);d(((e=a==null?void 0:a.data)==null?void 0:e.message)||"Deals shared successfully with selected contacts","success"),w()}catch(a){console.error("Error sending deals:",a);let h="Failed to share deals. Please try again.";if((n=(r=a==null?void 0:a.response)==null?void 0:r.data)!=null&&n.errors){const o=a.response.data.errors;if(Array.isArray(o)&&o.length>0){const l=o[0],t=Object.keys(l)[0];t&&(h=l[t])}else if(typeof o=="object"&&o!==null){const l=Object.keys(o)[0];l&&(h=o[l])}else typeof o=="string"&&(h=o)}else(x=(i=a==null?void 0:a.response)==null?void 0:i.data)!=null&&x.message&&(h=a.response.data.message);d(h,"error")}finally{C(!1)}},U=async()=>{if(!(f!=null&&f.unique_id)){d("Deal information not available","error");return}try{const e=window.location.origin;console.log("baseUrl",e);const r=`${e}/deal-details/${f.unique_id}`;await navigator.clipboard.writeText(r),d("Share link copied to clipboard!","success")}catch(e){console.error("Failed to copy link:",e),d("Failed to copy share link","error")}},L=()=>{m([]),y(""),v(e=>({...e,search:"",page:1})),w()},H=Q(),T=()=>{H("/all-contacts")};if(!g)return null;const q=e=>{var r,n,i,x,a;return!(e!=null&&e.user_id)||((r=e==null?void 0:e.user)==null?void 0:r.deleted_at)!==null?"Inactive":((n=e==null?void 0:e.user)==null?void 0:n.deleted_at)===null&&((i=e==null?void 0:e.user)==null?void 0:i.is_active)===1?"Active":((x=e==null?void 0:e.user)==null?void 0:x.deleted_at)===null&&((a=e==null?void 0:e.user)==null?void 0:a.is_active)===0?"Disabled":"Inactive"};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-[#fff] rounded-lg p-6 w-full max-w-3xl dark:bg-[#121212]",style:{maxHeight:"80vh",overflowY:"hidden"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-5",children:[s.jsx("h3",{className:"text-xl font-semibold dark:text-white",children:"Share as"}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:U,disabled:p.length!==1,className:`flex items-center gap-2 font-semibold
    ${p.length!==1?"text-gray-400 cursor-not-allowed":"text-[#6C5DD3] hover:text-[#5a4bb2]"}`,children:[s.jsx(R,{className:"font-semibold"}),s.jsx("span",{children:"Copy link"})]}),s.jsx("button",{className:"text-gray-500 hover:text-gray-700 text-3xl",onClick:L,children:"âœ•"})]})]}),s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx("div",{className:"relative w-4/5",children:s.jsx("input",{type:"text",placeholder:"Email address",className:"w-full form-control py-3 px-4 text-base",value:P,onChange:I})}),s.jsx("h3",{className:"ml-4 text-sm font-semibold dark:text-white text-[#595959]",children:c&&c.length>0?`${c.length} user${c.length>1?"s":""} selected`:"None selected"})]}),s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("div",{className:"flex items-center gap-4"})}),s.jsx("div",{className:"overflow-x-auto overflow-y-auto",style:{minHeight:"200px",maxHeight:"calc(80vh - 250px)"},children:E?s.jsx("div",{className:"flex justify-center items-center h-full",children:s.jsx(F,{})}):k.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:s.jsx("div",{className:"text-center py-4 dark:text-white text-[#333]",children:"To share the deal you need to add contacts first."})}):s.jsx("table",{className:"w-full text-left border-collapse",children:s.jsx("tbody",{children:k.map((e,r)=>{var n;return s.jsxs("tr",{className:"flex justify-between items-center",children:[s.jsxs("td",{className:"flex items-center gap-2 p-2 py-3 dark:text-white text-[#000]",children:[s.jsx("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>z(e.id)}),s.jsx("span",{className:"text-purple-800 font-semibold text-xl bg-purple-200 w-10 h-10 flex items-center justify-center rounded-full dark:bg-purple-950 dark:text-purple-700",children:(n=e.name)==null?void 0:n.charAt(0).toUpperCase()}),s.jsx("span",{className:"max-w-[100px] truncate cursor-pointer text-[#242424] text-lg font-medium dark:text-[#F8F8F8]",title:e.name,children:e.name})]}),s.jsx("td",{className:"p-4",children:(()=>{const i=q(e);return s.jsx("span",{className:`px-2 py-1 rounded-full text-xs border
        ${i==="Active"?"bg-[#ECFDF3] text-[#054F31] border-[#A6F4C5] dark:border-[#05603A] dark:bg-[#053321] dark:text-[#6CE9A6]":i==="Disabled"?"bg-red-100 text-red-700 border border-red-300":"bg-[#FFF8E1] text-[#FB6E0A] border-[#FEDE82] dark:border-[#FC8D0B] dark:bg-[#E56306] dark:text-[#FED350]"}`,children:i})})()})]},e.id)})})})}),s.jsxs("div",{className:"flex justify-between mt-6 items-center gap-4 flex-shrink-0",children:[s.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-md hover:bg-[#5a4bb2] transition-colors whitespace-nowrap",onClick:T,children:[s.jsx(Y,{size:14}),s.jsx("span",{children:"Add Contact"})]}),s.jsx("button",{onClick:M,disabled:c.length===0||b,className:`flex items-center justify-center gap-2 px-6 py-2 bg-[#6C5DD3] text-white rounded-md transition duration-200 whitespace-nowrap ${c.length===0||b?"opacity-50 cursor-not-allowed":"hover:bg-[#5a4bb2]"}`,children:b?s.jsx(F,{size:20}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"Send Deal"}),s.jsx(G,{className:"text-lg"})]})})]})]})})};export{se as S};
