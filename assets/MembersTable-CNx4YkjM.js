import{w as ae,t as re,av as le,u as ne,V as Ne,r,bl as ke,m as e,z as oe,bm as ye,bn as Fe,bo as de,a3 as Me,az as Ee,A as Se,n as _e,o as De,q as Ce,bp as Le,bq as Pe}from"./index-CTVB7qGk.js";import{D as Ae}from"./DeleteConfirmationModal-BN6xxKBH.js";import{l as Ie}from"./lodash-DhRiSDlB.js";import Oe from"./AddMemberForm-Bfm6aae2.js";import{P as Te}from"./PaginationNew-Bq0AOLdu.js";import{u as Be}from"./useRefreshUser-CFQGkSHY.js";const Re=({isOpen:b,onClose:f,memberId:p,onSuccess:y})=>{const R=ae(),{showSnackbar:_}=re(),{handleApiCall:D,loading:j}=le(),{role:C}=ne(u=>u.user),{register:F,handleSubmit:$,reset:z,setValue:M,watch:i,formState:{errors:c}}=Ne({mode:"onChange",defaultValues:{first_name:"",last_name:"",email:"",password:"",role:""}}),[L,P]=r.useState(!1),[U,A]=r.useState(!1),[G,w]=r.useState([null,null]);r.useRef(null);const[J,q]=r.useState("");r.useEffect(()=>{b&&p&&(U||v())},[b,p]);const v=async()=>{var u,x,d,O;if(p){P(!0);try{const n=await ke(p),g=(x=(u=n==null?void 0:n.data)==null?void 0:u.data)==null?void 0:x.user;g&&(M("first_name",g.first_name||""),M("last_name",g.last_name||""),M("email",g.email||""),M("role",((O=(d=g.roles)==null?void 0:d[0])==null?void 0:O.name)||"teamki"),M("password","")),A(!0)}catch(n){console.error("Failed to fetch member details",n),_("Failed to fetch member details","error")}finally{P(!1)}}},E=u=>{if(!p){_("Missing member ID. Cannot update.","error");return}const x={...u};x.password||delete x.password,D({apiFn:()=>de(p,x),data:x,onSuccess:()=>{_("Member updated","success"),y&&y(),f(),R("/all-members")}})},I=()=>{z(),f()};if(!b)return null;if(!p)return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg p-6 w-full max-w-md text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"No Member Selected"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Cannot open edit form without a member ID."}),e.jsx("button",{className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",onClick:f,children:"Close"})]})});const[m,S]=r.useState(!1);return i("role"),e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 backdrop-blur-[10px] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg pt-3 w-full max-w-3xl relative dark:bg-[#181818]",children:[(j||L)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-50 z-10 flex items-center justify-center",children:e.jsx(oe,{})}),e.jsxs("div",{className:"form-header px-5",children:[e.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-3xl",onClick:f,children:"✕"}),e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-[#F8F8F8]",children:"Edit Team Member"})]}),e.jsxs("form",{onSubmit:$(E),className:"space-y-4 p-5 bg-[#FDFDFD] rounded-xl dark:bg-[#181818]",children:[e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Full Name"}),e.jsx("input",{type:"text",...F("first_name",{required:"Full name is required",minLength:{value:2,message:"Min 2 characters"},pattern:{value:/^[A-Za-z\s]+$/,message:"Name should contain only letters and spaces"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Full Name"}),c.first_name&&e.jsx("p",{className:"text-red-500 text-sm mb-2",children:c.first_name.message}),e.jsx("input",{type:"hidden",...F("last_name")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Email"}),e.jsx("input",{type:"email",...F("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email format"}}),className:"w-full border px-3 py-2 rounded-xl mb-4 dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter Email"}),c.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-[#F8F8F8]",children:"Password (leave blank to keep current)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:m?"text":"password",...F("password",{minLength:{value:8,message:"Password must be at least 8 characters"},pattern:{value:/^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*\.]).*$/,message:"Password must contain at least one uppercase letter, one lowercase letter, and one symbol"}}),className:"w-full border p-3 rounded-xl mb-4 text-sm dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]",placeholder:"Enter New Password (optional)"}),e.jsx("span",{className:"absolute right-3 top-[38%] -translate-y-1/2 cursor-pointer text-purple",onClick:()=>S(u=>!u),children:m?e.jsx(ye,{}):e.jsx(Fe,{})})]}),c.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.password.message})]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("label",{className:"text-sm text-black-600 my-1 dark:text-white",children:"Select Role"}),e.jsxs("select",{...F("role",{required:"Role is required"}),disabled:C!=="deal-sourcer",className:`w-full border p-3 rounded-xl mb-4 text-sm 
      dark:bg-[#121212] dark:text-[#F8F8F8] dark:border-[#454545]
      ${C!=="deal-sourcer"?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"team-lead",children:"Team Lead"}),e.jsx("option",{value:"team",children:"Team Member"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 text-black px-6 py-2 rounded-xl hover:bg-gray-400 dark:text-[#F8F8F8] dark:bg-[#121212] dark:border-[#333333]",onClick:I,disabled:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-[#6C5DD3] text-white px-6 py-2 rounded-xl hover:bg-[#5a4bb2]",disabled:j,children:"Update Member"})]})]})]})})},Ze=()=>{var ee,se,te;const{role:b,user:f}=ne(s=>s.user);console.log("MembersTable user:",f);const p=ae(),{showSnackbar:y}=re(),{handleApiCall:R}=le(),[_,D]=r.useState(!1),[j,C]=r.useState([]),[F,$]=r.useState(),[z,M]=r.useState(""),[i,c]=r.useState(null),[L,P]=r.useState({top:0,left:0}),U=Be(),[A,G]=r.useState(!1),[w,J]=r.useState(0);console.log("totalMembers:",w);const q=(f==null?void 0:f.user_subscription)||{},v=Number(q.user_limit||0),E=Number(q.original_user_limit||0),I=v>0&&w>v,m=v&&E?Math.min(v,E):0;console.log("userLimit:",v),console.log("isUserLimitExceeded:",I);const S=Me();console.log("isUserLimitExceeded:",I);const[u,x]=r.useState({isOpen:!1,memberId:null,isLoading:!1}),[d,O]=r.useState({currentPage:1,totalPages:1,from:0,to:0,total:0,hasMorePages:!1}),[n,g]=r.useState({page:1,per_page:(d==null?void 0:d.total)>=5?5:(d==null?void 0:d.total)||5,sortColumn:"created_at",sortOrder:"desc",search:"",status:"all",createdYear:""}),V=r.useRef(null),Y=r.useRef({});r.useEffect(()=>{function s(N){V.current&&!V.current.contains(N.target)&&c(null)}function t(){i!==null&&c(null)}function h(){if(i!==null&&Y.current[i]){const l=Y.current[i].getBoundingClientRect(),o=window.innerHeight-l.bottom,k=l.top;G(o<200&&k>200),P({top:A?l.top-10:l.bottom+5,left:l.right-160})}}return h(),document.addEventListener("mousedown",s),document.addEventListener("scroll",t,!0),window.addEventListener("resize",h),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("scroll",t,!0),window.removeEventListener("resize",h)}},[i,A]),r.useEffect(()=>{w>m&&b!=="team"&&y(`Your plan allows only ${m} team members.
Please delete ${w-m} member(s) to continue.`,"error")},[w,m,b]);const ie=Ie.debounce(s=>{g(t=>({...t,search:s,page:1}))},500),ce=s=>{const t=s.target.value;M(t),ie(t)},me=s=>{const{name:t,value:h}=s.target;g({...n,[t]:h,page:1})},T=async()=>{var s,t,h,N;D(!0);try{const l=await Le({...n,perPage:n.per_page||10,status:n.status==="all"?null:n.status}),o=l==null?void 0:l.data,k=(o==null?void 0:o.users)||[];C(k);const Z=((s=o==null?void 0:o.user_subscription)==null?void 0:s.user_limit)??0,B=((t=o==null?void 0:o.page_context)==null?void 0:t.total_records)??k.length;J(Number(B)),console.log("Fetched members:",k),console.log("Total members:",B);const a=l.data.page_context;a&&(O({currentPage:parseInt(a==null?void 0:a.page)||1,totalPages:Math.ceil(parseInt((a==null?void 0:a.total_records)||0)/parseInt((a==null?void 0:a.per_page)||10)),from:(parseInt(a.page)-1)*parseInt(a.per_page)+1,to:Math.min(parseInt(a==null?void 0:a.page)*parseInt(a==null?void 0:a.per_page),parseInt((a==null?void 0:a.total_records)||0)),total:parseInt((a==null?void 0:a.total_records)||0),hasMorePages:(a==null?void 0:a.has_more_page)==="true"}),await U())}catch(l){console.error("Error fetching members:",l),y(((N=(h=l==null?void 0:l.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to fetch team members. Please try again.","error")}finally{D(!1)}};r.useEffect(()=>{T()},[n]);const ue=s=>{x({isOpen:!0,memberId:s,isLoading:!1})},K=()=>{x({isOpen:!1,memberId:null,isLoading:!1})},xe=()=>{x(s=>({...s,isLoading:!0})),R({apiFn:()=>Pe(u.memberId),onSuccess:()=>{T(),K(),y("Team member deleted successfully","success")},onError:s=>{x(t=>({...t,isLoading:!1}))}})},he=s=>{$(s),Q(!0)},be=()=>b==="team"?{allowed:!1,message:"You do not have permission to add team members"}:!m||m<=0?{allowed:!1,message:"Your current plan does not allow adding team members. Please upgrade."}:v>E?{allowed:!1,message:`Your plan allows only ${E} team members. Please remove extra members to continue.`}:w>=m?{allowed:!1,message:`Your plan allows only ${m} team members.
Please delete ${w-m+1} member(s) to add a new one.`}:{allowed:!0},pe=()=>{const s=be();if(!s.allowed){y(s.message,"error");return}H(!0)},ge=()=>{H(!1)},fe=()=>{Q(!1)};r.useEffect(()=>{var s;(s=S.state)!=null&&s.openModal&&(setIsModalOpen(!0),p(S.pathname,{replace:!0,state:{}}))},[S.state,p,S.pathname]);const je=s=>{g(t=>({...t,sortColumn:s,sortOrder:t.sortColumn===s&&t.sortOrder==="asc"?"desc":"asc",page:1}))},we=()=>(console.log("Current page members:",j),j),[$e,ze]=r.useState(null),[W,H]=r.useState(!1),[X,Q]=r.useState(!1),ve=async s=>{try{const t=s.is_active?0:1;await de(s.id,{is_active:t}),dispatch(updateMemberStatus({memberId:s.id,is_active:t}))}catch(t){console.error("Failed to update member status",t)}};return e.jsxs("div",{className:"min-h-screen dark:bg[#111827]",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col items-start justify-center  md:flex-row md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold mb-2",children:"Team Members"}),e.jsx("p",{className:"text-[#333333] dark:text-white",children:"Manage your team members and their access"})]}),b!=="team"&&e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs("button",{onClick:pe,className:"flex items-center gap-2 px-4 py-3 rounded-md bg-[#6C5DD3] text-white hover:bg-[#5a4bb2] transition-colors",children:[e.jsx(Ee,{size:14}),e.jsx("span",{children:"Add Member"})]})})]})}),e.jsxs("div",{className:"border rounded-xl dark:border-[#454545]",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:gap-0 md:flex-row space-x-4 justify-between px-4 py-4 items-start",children:[e.jsxs("div",{className:"relative custom-input-w",children:[e.jsx("input",{type:"text",placeholder:"Search for team members",className:"form-control",value:z,onChange:ce,style:{paddingLeft:"40px"}}),e.jsx(Se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),e.jsx("div",{className:"p-1 bg-[#F3F3F3] dark:bg-[#2B2B2B] rounded-xl",children:e.jsx("div",{className:"flex gap-2",children:[{label:"All Members",value:"all"},{label:"Active",value:"1"},{label:"Inactive",value:"0"}].map(s=>e.jsx("button",{onClick:()=>me({target:{name:"status",value:s.value}}),className:`px-4 py-2 rounded-md transition-colors duration-200 ${n.status===s.value?"bg-white text-dark shadow-xl dark:bg-[#121212] dark:text-white":"bg-[#F3F3F3] text-gray-800 dark:bg-[#2B2B2B] dark:text-gray-300"}`,children:s.label},s.value))})})]}),e.jsx("div",{className:"dark:bg-[#222632] bg-[#EBEBEC] overflow-hidden comparable-listing-table-wrap",children:_?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(oe,{})}):j.length===0?e.jsx("div",{className:"text-center p-12 dark:text-white text-dark",children:e.jsx("p",{children:"No team members found. Add some members to see them here."})}):e.jsx("div",{className:"whitespace-nowrap",children:e.jsxs("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:[e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#F8F8F8] text-dark dark:text-[#F8F8F8] border dark:bg-[#242424] dark:border-[#454545]",children:[e.jsx("th",{className:"p-4",children:"SN NO."}),e.jsx("th",{className:"p-4",children:"TEAM MEMBER"}),e.jsx("th",{className:"p-4",children:"EMAIL"}),e.jsx("th",{className:"p-4",children:"Role"}),e.jsx("th",{className:"p-4",children:"STATUS"}),e.jsxs("th",{className:"p-4 cursor-pointer",onClick:()=>je("created_at"),children:["CREATED AT",n.sortColumn==="created_at"&&e.jsx("span",{className:"ml-1",children:n.sortOrder==="asc"?"↑":"↓"})]}),b!=="team"&&e.jsx("th",{className:"p-4 text-center",children:"ACTIONS"})]})}),e.jsx("tbody",{children:we().map((s,t)=>{var h,N,l,o,k,Z;return e.jsxs("tr",{className:t%2===0?"text-dark dark:text-white":"dark:bg-[#191D27] bg-[#DEDEE0] text-dark dark:text-white",children:[e.jsx("td",{className:"p-4",children:t+1}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-200 dark:bg-purple-800 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-purple-800 dark:text-purple-100",children:[((h=s.first_name)==null?void 0:h[0])||"",((N=s.last_name)==null?void 0:N[0])||""]})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium",children:s.first_name||s.last_name?`${s.first_name||""} ${s.last_name||""}`:"-"})})]})}),e.jsx("td",{className:"p-4",children:s.email||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-sm inline-block ${s.roles&&s.roles.length>0&&((l=s.roles[0])==null?void 0:l.name)==="team"||s.roles&&s.roles.length>0&&((o=s.roles[0])==null?void 0:o.name)==="deal-sourcer-team","text-dark"}`,children:s.roles&&s.roles.length>0&&((k=s.roles[0])==null?void 0:k.name)==="team"?"Team Member":s.roles&&s.roles.length>0&&((Z=s.roles[0])==null?void 0:Z.name)==="team-lead"?"Team Lead":"No Role"})}),e.jsx("td",{className:"p-4",children:e.jsx("button",{onClick:()=>ve(s),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200
      ${s.is_active?"bg-[#ECFDF3] border border-[#A6F4C5] dark:bg-[#053321] dark:border-[#05603A]":"bg-[#FFF8E1] border border-[#FEDE82] dark:bg-[#E56306] dark:border-[#FC8D0B]"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full transition-transform duration-200
        ${s.is_active?"translate-x-6 bg-[#054F31] dark:bg-[#6CE9A6]":"translate-x-1 bg-[#FB6E0A] dark:bg-[#FED350]"}`})})}),e.jsx("td",{className:"p-4",children:s.created_at?new Date(s.created_at).toLocaleDateString():"-"}),b!=="team"&&e.jsx("td",{className:"relative",children:e.jsx("div",{className:"flex justify-center relative",children:e.jsx("button",{ref:B=>Y.current[s.id]=B,onClick:()=>c(i===s.id?null:s.id),className:"text-lg",children:e.jsx(_e,{className:"text-[#595959]"})})})})]},s.id)})})]}),i!==null&&e.jsxs("div",{ref:V,style:{position:"fixed",top:`${L.top}px`,left:`${L.left}px`,zIndex:9999},className:"w-40 bg-white rounded-xl shadow-lg dark:bg-[#242424]",children:[e.jsxs("button",{onClick:()=>{const s=j.find(t=>t.id===i);he(s.id),c(null)},className:"flex items-center w-full px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(De,{className:"mr-2"})," Edit"]}),((te=(se=(ee=j.find(s=>s.id===i))==null?void 0:ee.roles)==null?void 0:se[0])==null?void 0:te.name)!=="deal-sourcer-team"&&e.jsxs("button",{onClick:()=>{ue(i),c(null)},className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-red-600",children:[e.jsx(Ce,{className:"mr-2"})," Delete"]})]})]})})}),e.jsx(Te,{pagination:{total:d.total,currentPage:n.page,perPage:d.total>=5?5:d.total,totalPages:Math.ceil(d.total/n.per_page)},setFilters:g})]})]}),e.jsx(Ae,{isOpen:u.isOpen,onClose:K,onConfirm:xe,isLoading:u.isLoading,title:"Delete Team Member"}),W&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:ge,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Oe,{isOpen:W,onSuccess:T,onClose:()=>H(!1)})]})}),X&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white text-black rounded-xl shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto relative p-6",children:[e.jsx("button",{onClick:fe,className:"absolute top-3 right-4 text-black hover:text-gray-700 text-2xl font-bold z-10",children:"×"}),e.jsx(Re,{memberId:F,onSuccess:T,isOpen:X,onClose:()=>Q(!1)})]})})]})};export{Ze as default};
