import{t as O,a1 as q,s as z,q as G,u as _,r as l,ci as p,bH as J,m as e,c6 as K,b$ as Q,aj as U,p as V,x as W,ak as X,al as Y,ap as Z,E as ee,bE as ae,aM as se,cj as te,ck as le,cl as re}from"./index-C0InhSkG.js";const xe=()=>{var k;const f=O(),n=q(),c=z(),{showSnackbar:j}=G(),t=_(a=>a.deal.deal),y=_(a=>a.deal.currentStep),[A,b]=l.useState(!1),[T,E]=l.useState([]),[L,C]=l.useState(!1),[w,v]=l.useState(null),[g,N]=l.useState(!1),[F,I]=l.useState(null),[u,S]=l.useState([]),[ie,ne]=l.useState(""),[ce,x]=l.useState(!1),[i,m]=l.useState("manual"),[de,oe]=l.useState(!1),[d,M]=l.useState(null);l.useEffect(()=>{const a=async()=>{var s;try{const r=await ee(t==null?void 0:t.id);r&&r.data&&M((s=r.data.data)==null?void 0:s.deal)}catch{console.log("Failed to load deal details")}};t!=null&&t.id&&a()},[t]),l.useEffect(()=>{var a,s;(a=n==null?void 0:n.state)!=null&&a.radiusId&&I(n.state.radiusId),((s=n==null?void 0:n.state)==null?void 0:s.activesetDescriptionTabTab)==="aiDescription"&&(m("ai"),c(p("ai")),x(!1))},[n.state]),l.useEffect(()=>{var a;(a=n==null?void 0:n.state)!=null&&a.activesetDescriptionTabTab||(d!=null&&d.is_ai_type?(m("ai"),c(p("ai")),x(!1)):d!=null&&d.is_manual_type?(m("manual"),c(p("manual")),x(!1)):(m("manual"),c(p("manual")),x(!1)))},[d,(k=n.state)==null?void 0:k.activesetDescriptionTabTab]),l.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{try{b(!0);const s=await ae(t.id,{type:i});s&&s.data&&E(s.data.data.dealComparables||[])}catch{j("Failed to load comparables","error")}finally{b(!1)}})()},[t==null?void 0:t.id,i]);const B=async()=>{var a;try{b(!0);const s=await se(t==null?void 0:t.id,F,{type:i});S(((a=s==null?void 0:s.data)==null?void 0:a.dealComparables)||[])}catch(s){console.log(s,"error")}finally{b(!1)}};l.useEffect(()=>{i==="ai"&&B()},[i]);const R=async()=>{var s;const a=i==="manual"?"ai":"manual";try{const r=await re({property_deal_id:t==null?void 0:t.id,type:a});S((s=r==null?void 0:r.data)==null?void 0:s.dealComparables)}catch(r){console.log(r,"error")}};l.useEffect(()=>(c({type:"deal/setCurrentStep",payload:Math.max(y,4)}),()=>{y<4&&c(J(!1))}),[c,y]);const P=a=>{a&&(c(te(a)),f("/create-deal/comparables"))},$=a=>{v(a),C(!0)},D=()=>{C(!1),v(null),N(!1)},H=async()=>{var a,s,r;if(w)try{N(!0);const o=await le(w);j(((a=o==null?void 0:o.data)==null?void 0:a.message)||"Comparable deleted successfully","success"),D(),fetchComparables()}catch(o){j(((r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.error)||"Failed to delete the comparable. Please try again.","error")}finally{N(!1)}},h=i==="manual"?T||[]:(u==null?void 0:u.length)>0?u:(d==null?void 0:d.property_deal_sa_comparables)||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"description-ai-description-tabs-wrap mb-5",children:[e.jsx("button",{className:`px-5 py-2 rounded-md description-tab transition ${i==="manual"?"bg-white text-black":"text-white"}`,onClick:()=>{m("manual"),c(p("manual")),x(!1)},children:"Manual"}),e.jsx("button",{className:`px-5 py-2 rounded-md ai-description-tab transition ${i==="ai"?"bg-white text-black":"text-white"}`,onClick:()=>{m("ai"),c(p("ai")),x(!0)},children:"AI"})]}),i==="manual"&&e.jsx(K,{className:"flex mb-5",to:"/create-deal/comparables",style:{marginLeft:"auto",width:"max-content"},children:e.jsx("button",{className:"purple-btn",style:{display:"flex"},children:"+ Add Comparable"})}),i==="ai"&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"This area only"}),e.jsx("option",{children:"Nearby areas"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"All years"}),e.jsx("option",{children:"2023"}),e.jsx("option",{children:"2024"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"All Property types"}),e.jsx("option",{children:"Flat"}),e.jsx("option",{children:"House"})]}),e.jsxs("select",{className:"form-select",children:[e.jsx("option",{children:"Listing"}),e.jsx("option",{children:"Sold"})]})]}),A?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"w-12 h-12 border-4 border-t-[#6C5DD3] border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"})}):h.length===0?i==="ai"?e.jsx("p",{className:"text-center",children:"Loading AI comparables"}):e.jsx("p",{className:"text-center",children:"No manual comparables available"}):e.jsx("div",{className:"overflow-x-auto dark:bg-[#222632] bg-[#EBEBEC] comparable-listing-table-wrap",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#6C5DD3] text-white",children:[e.jsx("th",{className:"px-6 py-3",children:"Sl No"}),e.jsx("th",{className:"px-6 py-3",children:"Image"}),e.jsx("th",{className:"px-6 py-3",children:"Title"}),e.jsx("th",{className:"px-6 py-3",children:"Price"}),e.jsx("th",{className:"px-6 py-3",children:"Legacy Name"}),e.jsx("th",{className:"px-6 py-3",children:"Average Rating"}),e.jsx("th",{className:"px-6 py-3",children:"No of Bedrooms"}),i==="manual"&&e.jsx("th",{className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:h&&(h==null?void 0:h.length)>0?h.map((a,s)=>{var r;return e.jsxs("tr",{className:"border-b dark:border-gray-700 border-gray-200",children:[e.jsx("td",{className:"px-6 py-4",children:s+1}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"comparables-table-img-wrap",children:[e.jsx("img",{src:a==null?void 0:a.image_url,alt:"comparable image"}),e.jsx("span",{className:"comparables-table-img-icon-wrap",children:e.jsx(Q,{})})]})}),e.jsx("td",{className:"px-6 py-4",children:a.title||a.title||"-"}),e.jsx("td",{className:"px-6 py-4",children:a.price_label||a.price_label||"-"}),e.jsx("td",{className:"px-6 py-4",children:a.legacy_name||a.legacy_name||"-"}),e.jsx("td",{className:"px-6 py-4",children:((r=a.property_type)==null?void 0:r.property_type_id)||a.property_type_id||"-"}),e.jsx("td",{className:"px-6 py-4",children:(a==null?void 0:a.no_of_bedroom)||"-"}),i==="manual"&&e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-lg",onClick:()=>P(a==null?void 0:a.id),children:e.jsx(U,{})}),e.jsx("button",{className:"",onClick:()=>$(a==null?void 0:a.id),children:e.jsx(V,{})})]})})]},(a==null?void 0:a.id)||s)}):e.jsx("tr",{className:"border-b dark:border-gray-700 border-gray-200",children:e.jsx("td",{colSpan:"9",className:"px-6 py-4 text-center",children:"No comparables available"})})})]})})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#222632] rounded-lg p-6 w-96",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Confirm Delete"}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this comparable? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{className:"px-4 py-2 border rounded-md",onClick:D,disabled:g,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-red-500 text-white rounded-md flex items-center",onClick:H,disabled:g,children:g?e.jsx(e.Fragment,{children:e.jsx(W,{})}):"Confirm"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-10",children:[e.jsxs("button",{onClick:()=>f("/create-deal/description"),className:"w-fit items-center gap-5 justify-center flex",children:[e.jsx(X,{}),"Back"]}),e.jsxs("button",{onClick:()=>{c(Z(!0)),R(),c(p(i)),f("/create-deal/summary")},className:"w-fit purple-btn items-center gap-5 justify-center",style:{display:"flex"},children:["Next",e.jsx(Y,{})]})]})]})};export{xe as default};
