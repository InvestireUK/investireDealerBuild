import{r,m as e,Q as ue,S as he,u as fe,s as ge,q as be,T as oe,U as ye,V as re,o as le,W as je,X as we,x as ie,Y as ce,Z as Ne}from"./index-CpEWmEc9.js";import{u as ve}from"./useRefreshUser-BvEqDQ4d.js";import{c as _e,X as ke}from"./x-CgNhINYR.js";const Ce="/assets/company-logo-baJq8U9U.png";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Pe=_e("check",Se),$e=({isOpen:a,onClose:j,imageSrc:L,onCropComplete:_,aspectRatio:f=1})=>{const[g,k]=r.useState({x:0,y:0}),[b,p]=r.useState(1),[W,o]=r.useState(!1),[D,T]=r.useState({x:0,y:0}),I=r.useRef(null),U=r.useRef(null),C=r.useRef(null);r.useEffect(()=>{if(a&&L){const s=new Image;s.onload=()=>{C.current=s,q()},s.src=L}},[a,L,g,b]);const q=()=>{const s=I.current,u=C.current;if(!s||!u)return;const n=s.getContext("2d"),y=U.current;if(!y)return;const i=y.offsetWidth,d=y.offsetHeight;s.width=i,s.height=d,n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(0,0,i,d);const S=Math.min(i/u.width,d/u.height)*b,P=u.width*S,x=u.height*S,m=(i-P)/2+g.x,O=(d-x)/2+g.y;n.save(),n.globalCompositeOperation="destination-out";const h=Math.min(i,d)*.7,w=(i-h)/2,c=(d-h)/2;f===1?(n.beginPath(),n.arc(i/2,d/2,h/2,0,Math.PI*2),n.fill()):n.fillRect(w,c,h,h/f),n.restore(),n.globalCompositeOperation="destination-over",n.drawImage(u,m,O,P,x),n.globalCompositeOperation="source-over",n.strokeStyle="#fff",n.lineWidth=2,f===1?(n.beginPath(),n.arc(i/2,d/2,h/2,0,Math.PI*2),n.stroke()):n.strokeRect(w,c,h,h/f)},H=s=>{o(!0),T({x:s.clientX-g.x,y:s.clientY-g.y})},z=s=>{W&&k({x:s.clientX-D.x,y:s.clientY-D.y})},R=()=>{o(!1)},A=r.useCallback(async()=>{const s=C.current,u=U.current;if(!s||!u)return;const n=u.offsetWidth,y=u.offsetHeight,i=Math.min(n/s.width,y/s.height)*b,d=s.width*i,S=s.height*i,P=(n-d)/2+g.x,x=(y-S)/2+g.y,m=Math.min(n,y)*.7,O=(n-m)/2,h=(y-m)/2,w=document.createElement("canvas");w.width=m,w.height=m/f;const c=w.getContext("2d"),X=(O-P)/i,B=(h-x)/i,$=m/i,G=m/f/i;c.drawImage(s,X,B,$,G,0,0,m,m/f),w.toBlob(K=>{_(K),j()},"image/jpeg",.95)},[g,b,f,_,j]);return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Crop Image"}),e.jsx("div",{ref:U,className:"relative h-96 bg-gray-100 dark:bg-gray-700 rounded-lg mb-4 overflow-hidden cursor-move",onMouseDown:H,onMouseMove:z,onMouseUp:R,onMouseLeave:R,children:e.jsx("canvas",{ref:I,className:"w-full h-full"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Zoom"}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:b,onChange:s=>p(parseFloat(s.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[e.jsx(ke,{size:16})," Cancel"]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-4 py-2 bg-[#6C5DD3] text-white rounded-lg",children:[e.jsx(Pe,{size:16}),"  Save"]})]})]})})}):null},Ee=he("pk_test_51R2ASXGDULRKMJfhQSP5SUjDWh0jNQ8sh3GLuHMkSBIvTnBoSAEcTZLQF8ExiBr8mvfVbH9aUzFyKMK42Uc4hhHL00GbA5RYKv"),Fe=()=>{const{user:a,role:j}=fe(t=>t.user),L=ge(),{showSnackbar:_}=be(),f=ve(),g="https://investier-vision.visionvivante.in/storage",[k,b]=r.useState(!1),[p,W]=r.useState(!1),[o,D]=r.useState(!(a!=null&&a.company_name)||!(a!=null&&a.sub_domain)),[T,I]=r.useState(null),[U,C]=r.useState(null),[q,H]=r.useState(null),[z,R]=r.useState(null),[A,s]=r.useState(!1),[u,n]=r.useState(null),[y,i]=r.useState(null),{register:d,handleSubmit:S,reset:P,formState:{errors:x}}=oe({defaultValues:{first_name:"",last_name:"",email:"",phone:""}}),{register:m,handleSubmit:O,reset:h,control:w,formState:{errors:c}}=oe({defaultValues:{company_name:"",sub_domain:"",company_email:"",company_phone:"",company_website:""}});r.useEffect(()=>{a&&(P({first_name:a.first_name||"",last_name:a.last_name||"",email:a.email||"",phone:a.phone||""}),h({company_name:a.company_name||"",sub_domain:a.sub_domain||"",company_email:a.company_email||"",company_phone:a.company_phone||"",company_website:a.company_website||""}),a.profile_image&&I(a.profile_image),a.company_logo_url&&C(a.company_logo_url))},[a]);const X=(t,l)=>{const N=t.target.files[0];if(!N)return;const E=new FileReader;E.onload=()=>{n(E.result),i(l),s(!0)},E.readAsDataURL(N),t.target.value=""},B=t=>{const l=new File([t],"image.jpg",{type:"image/jpeg"}),N=URL.createObjectURL(t);y==="profile"?(H(l),I(N)):(R(l),C(N))},$=ye({control:w,name:"sub_domain"}),G=async t=>{try{b(!0);const l=new FormData;l.append("_method","PATCH"),l.append("first_name",t.first_name),l.append("last_name",t.last_name),l.append("phone",t.phone),q&&l.append("profile_image",q),await ce(l),_("Profile updated successfully","success"),await f(),W(!1),H(null)}catch{_("Failed to update profile","error")}finally{b(!1)}},K=async t=>{var l,N,E,ee,te,se;try{b(!0),console.log("datataa ===>",t);const F=new FormData;F.append("_method","PATCH"),Object.entries(t).forEach(([M,Y])=>{Y&&F.append(M,Y)}),z&&F.append("company_logo",z);const V=await ce(F);_("Company updated successfully","success"),D(!1),R(null);const v=(N=(l=V==null?void 0:V.data)==null?void 0:l.data)==null?void 0:N.user;if(v){const M=window.location.hostname.split(".").slice(-2).join("."),Y=(E=document.cookie.split("; ").find(J=>J.startsWith("token=")))==null?void 0:E.split("=")[1],Z=v.access_token||Y;console.log("access",Z);const ae=((te=(ee=v==null?void 0:v.roles)==null?void 0:ee[0])==null?void 0:te.name)||j;console.log("userrole",ae),document.cookie=`token=${Z}; path=/; domain=.${M}; Secure; SameSite=None`,document.cookie=`user=${encodeURIComponent(JSON.stringify(v))}; path=/; domain=.${M}; Secure; SameSite=None`,document.cookie=`role=${ae}; path=/; domain=.${M}; Secure; SameSite=None`,L(Ne({user:v,token:Z}));const ne=(se=v.sub_domain)==null?void 0:se.trim();if(ne){const J=`https://${ne.toLowerCase()}.${M}`;window.location.href=J;return}}}catch(F){console.error(F),_("Failed to update company","error")}finally{b(!1)}},me=t=>t!=null&&t.startsWith("http")||t!=null&&t.startsWith("blob:")?t:`${g}/${t}`,de=t=>t?t.split("-").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"Not Assigned";function pe(){if(typeof window>"u")return"visionvivante.in";const t=window.location.hostname.split(".");return t.length>2?t.slice(1).join("."):window.location.hostname}const Q=pe(),xe=$!=null&&$.trim()?`https://${$.toLowerCase()}.${Q}`:`https://your-company.${Q}`;return e.jsx("div",{className:"min-h-screen my-5",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333]",children:[e.jsx("h1",{className:"text-3xl text-black dark:text-white",children:"My Profile"}),e.jsx("button",{onClick:()=>W(t=>!t),className:"flex items-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx(re,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{})," ",e.jsx("span",{children:"Edit Profile"})]})})]}),e.jsx("div",{className:"flex justify-start mt-8 ml-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:T?e.jsx("img",{src:me(T),alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(je,{className:"w-full h-full text-[#6C5DD3]"})}),p&&e.jsxs("label",{htmlFor:"profileImage",className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Image",e.jsx("input",{type:"file",id:"profileImage",className:"hidden",accept:"image/*",onChange:t=>X(t,"profile")})]})]})}),e.jsx("form",{onSubmit:S(G),children:e.jsx("div",{className:"profile-detail-form-container-main-div",children:e.jsxs("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:[e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"First Name"}),e.jsx("input",{type:"text",...d("first_name",{required:"First name is required"}),readOnly:!p,className:`form-control w-full ${x.first_name?"border border-red-500":""} ${p?"":"opacity-75 cursor-not-allowed"}`}),x.first_name&&p&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x.first_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Last Name"}),e.jsx("input",{type:"text",...d("last_name",{required:"Last name is required"}),readOnly:!p,className:`form-control w-full ${x.last_name?"border border-red-500":""} ${p?"":"opacity-75 cursor-not-allowed"}`}),x.last_name&&p&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x.last_name.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Email"}),e.jsx("input",{type:"email",...d("email"),disabled:!0,className:"form-control w-full opacity-75 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Phone Number"}),e.jsx("input",{type:"tel",...d("phone",{validate:t=>t?/^0\d{9,10}$/.test(t)||"Phone number must start with 0 and be 10 or 11 digits long":!0}),readOnly:!p,className:`form-control w-full ${x.phone?"border border-red-500":""} ${p?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),x.phone&&p&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:x.phone.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 mt-5 inline-block",children:"Role:"}),e.jsxs("div",{className:"relative opacity-75 cursor-not-allowed",children:[e.jsx("input",{type:"text",className:"form-control w-full cursor-not-allowed",value:de(j),readOnly:!0,style:{paddingLeft:"40px"}}),e.jsx("span",{className:"inline-block absolute left-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-purple",children:e.jsx(we,{})})]})]})]}),p&&e.jsx("div",{className:"text-right mb-8 mt-5",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:k,children:k?e.jsx(ie,{size:20}):e.jsx(e.Fragment,{children:" Save Profile Changes"})})})]})})}),j!=="investor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center pb-3 border-b dark:border-b-[#333333] mt-10",children:[e.jsx("h1",{className:"text-xl text-black dark:text-[#F8F8F8]",children:"Company Details"}),j!=="team"&&j!=="team-lead"&&e.jsx("button",{onClick:()=>D(t=>!t),className:"flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(re,{})," ",e.jsx("span",{children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{})," ",e.jsx("span",{children:"Edit Company"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 p-5",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden",children:e.jsx("img",{src:U||Ce,alt:"Company Logo",className:"w-full h-full object-cover"})}),o&&e.jsxs("label",{className:"border rounded-lg px-4 py-2 text-black dark:text-white cursor-pointer",children:["Upload Logo",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>X(t,"company")})]})]}),e.jsxs("form",{onSubmit:O(K),children:[e.jsx("div",{className:"dark:bg-[#181818] bg-[#fff] profile-detail-form-container-wrap",children:e.jsxs("div",{className:"w-[100%] md:w-[60%]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Name"}),e.jsx("input",{type:"text",...m("company_name",{required:"Company name is required"}),readOnly:!o,placeholder:"Enter company name",className:`form-control w-full ${c.company_name?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),c.company_name&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.company_name.message})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] my-2 inline-block",children:"Sub Domain"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{type:"text",placeholder:"your-company",...m("sub_domain",{required:"Sub domain is required",pattern:{value:new RegExp("^(?!-)[a-z0-9-]{1,63}(?<!-)$"),message:"Use only lowercase letters, numbers, and hyphens (cannot start or end with hyphen)"}}),readOnly:!o,className:`form-control w-full pr-48 ${c.sub_domain?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("span",{className:"absolute inset-y-0 right-3 flex items-center text-gray-500 text-sm font-medium pointer-events-none",children:[".",Q]})]}),c.sub_domain&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.sub_domain.message}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Your app will be available at:"," ",e.jsx("strong",{className:"text-[#6C5DD3]",children:xe})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Email"}),e.jsx("input",{type:"email",...m("company_email",{required:"Company email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Enter a valid email address"}}),readOnly:!o,placeholder:"Enter company email",className:`form-control w-full ${c.company_email?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),c.company_email&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.company_email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Phone"}),e.jsx("input",{type:"tel",...m("company_phone",{required:"Company phone is required",pattern:{value:/^0\d{9,10}$/,message:"Phone number must start with 0 and be 10 or 11 digits long"}}),readOnly:!o,placeholder:"Enter phone number",className:`form-control w-full ${c.company_phone?"border border-red-500":""} ${o?"":"opacity-75 cursor-not-allowed"}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Example: ",e.jsx("span",{className:"font-mono",children:"0**********"})]}),c.company_phone&&o&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.company_phone.message})]})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-md text-[#333] dark:text-[#fff] mb-2 inline-block",children:"Company Website"}),e.jsx("input",{type:"text",...m("company_website"),readOnly:!o,placeholder:"Enter Company website",className:`form-control w-full ${o?"":"opacity-75 cursor-not-allowed"}`})]})]})}),o&&e.jsx("div",{className:"text-right mb-8",children:e.jsx("button",{type:"submit",className:"purple-btn flex items-center gap-2 ml-auto",disabled:k,children:k?e.jsx(ie,{size:20}):e.jsx(e.Fragment,{children:" Save Company Changes"})})})]})]}),e.jsx($e,{isOpen:A,onClose:()=>s(!1),imageSrc:u,onCropComplete:B,aspectRatio:1})]})})},Ie=()=>e.jsx(ue,{stripe:Ee,children:e.jsx(Fe,{})});export{Ie as default};
